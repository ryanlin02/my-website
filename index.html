<!DOCTYPE html>
<html lang="zh-TW">
<head>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XE5XMQR0Z1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-XE5XMQR0Z1');
    </script>

    <!-- åœ¨ <head> æ¨™ç±¤å…§æ·»åŠ ä»¥ä¸‹å…§å®¹ -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#333333">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="é›è‚‰é£¯">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">

    <meta charset="UTF-8">
	<meta name="viewport" content="width=400, user-scalable=no">

    <!-- åœ¨ç¾æœ‰çš„ meta æ¨™ç±¤ä¸‹æ–¹æ·»åŠ  -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>å°æœ‹å‹è¨ˆç®—æ©Ÿ</title>

    <style>

        /* ============================================
        * 1. åŸºç¤è®Šé‡èˆ‡ä¸»é¡Œè¨­å®š
        * ============================================ */

        /* åŸºç¤ä¸»é¡Œè®Šæ•¸ï¼ˆå…±ç”¨åŸºæœ¬æ¡†æ¶ï¼‰ */
        :root {
            /* åŸºæœ¬å°ºå¯¸è®Šæ•¸ - çµ±ä¸€æ§åˆ¶é–“è·ã€åœ“è§’ç­‰å°ºå¯¸ */
            --border-radius-sm: 4px;   /* å°å‹å…ƒç´ åœ“è§’ */
            --border-radius-md: 8px;   /* ä¸­å‹å…ƒç´ åœ“è§’ */
            --border-radius-lg: 12px;  /* å¤§å‹å…ƒç´ åœ“è§’ */
            --spacing-xs: 2px;         /* æ¥µå°é–“è· */
            --spacing-sm: 4px;         /* å°é–“è· */
            --spacing-md: 8px;         /* ä¸­é–“è· */
            --spacing-lg: 15px;        /* å¤§é–“è· */
            
            /* å­—å‹å¤§å°è®Šæ•¸ - çµ±ä¸€æ§åˆ¶æ–‡å­—å°ºå¯¸ */
            --font-size-xs: 12px;      /* æ¥µå°å­—é«” */
            --font-size-sm: 14px;      /* å°å­—é«” */
            --font-size-md: 16px;      /* ä¸­å­—é«” */
            --font-size-lg: 18px;      /* å¤§å­—é«” */
            --font-size-xl: 22px;      /* ç‰¹å¤§å­—é«” */
            
            /* å‹•ç•«æ™‚é–“ - çµ±ä¸€æ§åˆ¶éæ¸¡å‹•ç•«é€Ÿåº¦ */
            --transition-fast: 0.2s;   /* å¿«é€Ÿéæ¸¡ */
            --transition-normal: 0.3s; /* æ¨™æº–éæ¸¡ */
            --transition-slow: 0.5s;   /* æ…¢é€Ÿéæ¸¡ */
            
            /* é™°å½±æ•ˆæœ - çµ±ä¸€æ§åˆ¶å…ƒç´ é™°å½± */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);  /* æ·ºé™°å½± */
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.3);  /* ä¸­é™°å½± */
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.4); /* æ·±é™°å½± */

            /* è¼¸å…¥æ¡†å’Œæ¨™ç±¤çš„ç‰¹æ®Šè¨­å®š */
            --input-font-size: 16px;      /* è¼¸å…¥æ¡†å…§æ–‡å­—å¤§å°ï¼ˆåŸ16px+2ç´šï¼‰ */
            --label-font-size: 16px;      /* æ¨™ç±¤æ–‡å­—å¤§å°ï¼ˆåŸ18px-1ç´šï¼‰ */
            --input-padding-lr: 5px;      /* è¼¸å…¥æ¡†å·¦å³å…§é‚Šè·ï¼ˆåŸ12px-7pxï¼‰ */
            --helper-text-color: #999999; /* è¼”åŠ©èªªæ˜æ–‡å­—é¡è‰² */
        }

        /* é»˜èªä¸»é¡Œï¼šæš—å¤œæ©˜ç„° - é è¨­çš„æ·±è‰²ä¸»é¡Œæ­é…æ©™è‰²å¼·èª¿è‰² */
        :root {
            /* RGBç‰ˆæœ¬çš„é¡è‰²ï¼ˆç”¨æ–¼é€æ˜åº¦æ§åˆ¶ï¼‰ */
            --primary-color-rgb: 51, 51, 51;      /* ä¸»èƒŒæ™¯è‰²RGBå€¼ */
            --secondary-color-rgb: 74, 74, 74;    /* æ¬¡èƒŒæ™¯è‰²RGBå€¼ */
            --accent-color-rgb: 255, 156, 51;     /* å¼·èª¿è‰²RGBå€¼ */
            --input-bg-rgb: 34, 34, 34;           /* è¼¸å…¥æ¡†èƒŒæ™¯RGBå€¼ */
            --error-color-rgb: 231, 76, 60;       /* éŒ¯èª¤è‰²RGBå€¼ */
            --info-color-rgb: 52, 152, 219;       /* ä¿¡æ¯è‰²RGBå€¼ */

            /* åŸºæœ¬è‰²èª¿ */
            --primary-color: #333333;             /* ä¸»èƒŒæ™¯è‰² */
            --secondary-color: #4a4a4a;           /* æ¬¡èƒŒæ™¯è‰² */
            --text-color: #ffffff;                /* æ–‡å­—è‰² */
            --border-color: #555555;              /* é‚Šæ¡†è‰² */
            --hover-color: #666666;               /* æ‡¸åœè‰² */
            --shadow-color: rgba(0, 0, 0, 0.3);   /* é™°å½±è‰² */
            
            /* å¼·èª¿è‰² */
            --accent-color: #ff9c33;              /* æ©™è‰²é‡é»è‰² */
            --accent-color-light: rgba(255, 156, 51, 0.2); /* æ·¡æ©™è‰² */
            --accent-color-dark: #e88a22;         /* æ·±æ©™è‰² */
            
            /* åŠŸèƒ½è‰² */
            --success-color: #33b5e5;             /* è—è‰²æˆåŠŸè‰² */
            --warning-color: #ff9c33;             /* æ©™è‰²è­¦å‘Šè‰² */
            --error-color: #e74c3c;               /* ç´…è‰²éŒ¯èª¤è‰² */
            --info-color: #3498db;                /* è—è‰²è³‡è¨Šè‰² */
            
            /* ç‰¹æ®Šå…ƒä»¶é¡è‰² */
            --button-primary: #ff9c33;            /* ä¸»æŒ‰éˆ•é¡è‰² */
            --button-secondary: #4a4a4a;          /* å‰¯æŒ‰éˆ•é¡è‰² */
            --input-bg: #222222;                  /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            --input-border: #555555;              /* è¼¸å…¥æ¡†é‚Šæ¡† */
            --input-focus-border: #ff9c33;        /* è¼¸å…¥æ¡†ç„¦é»é‚Šæ¡† */
            --card-bg: #333333;                   /* å¡ç‰‡èƒŒæ™¯è‰² */
            
            /* æ–‡å­—å¼·èª¿è‰² */
            --text-highlight: #ff9c33;            /* æ–‡å­—å¼·èª¿è‰² */
            --text-muted: #999999;                /* æ–‡å­—æ·¡è‰² */
            
            /* èˆ‡èˆŠä»£ç¢¼å…¼å®¹çš„è®Šæ•¸ */
            --button-orange: #ff9c33;             /* å…¼å®¹æ©™è‰²æŒ‰éˆ• */
            --button-blue: #33b5e5;               /* å…¼å®¹è—è‰²æŒ‰éˆ• */
            --button-grey: #333333;               /* å…¼å®¹ç°è‰²æŒ‰éˆ• */
        }

        /* æ¥µç°¡é»‘ç™½ä¸»é¡Œ - æ¸…çˆ½çš„ç™½åº•é»‘å­—è¨­è¨ˆ */
        :root[data-theme="white"] {
            /* RGBç‰ˆæœ¬çš„é¡è‰²ï¼ˆç”¨æ–¼é€æ˜åº¦æ§åˆ¶ï¼‰ */
            --primary-color-rgb: 250, 250, 250;   /* ä¸»èƒŒæ™¯è‰²RGBå€¼ */
            --secondary-color-rgb: 255, 255, 255; /* æ¬¡èƒŒæ™¯è‰²RGBå€¼ */
            --accent-color-rgb: 85, 85, 85;       /* å¼·èª¿è‰²RGBå€¼ */
            --input-bg-rgb: 255, 255, 255;        /* è¼¸å…¥æ¡†èƒŒæ™¯RGBå€¼ */
            --error-color-rgb: 85, 85, 85;        /* éŒ¯èª¤è‰²RGBå€¼ */
            --info-color-rgb: 85, 85, 85;         /* ä¿¡æ¯è‰²RGBå€¼ */

            /* åŸºæœ¬è‰²èª¿ */
            --primary-color: #fafafa;             /* ä¸»èƒŒæ™¯è‰² */
            --secondary-color: #ffffff;           /* æ¬¡èƒŒæ™¯è‰² */
            --text-color: #222222;                /* æ–‡å­—è‰² */
            --border-color: #cccccc;              /* é‚Šæ¡†è‰² */
            --hover-color: #f5f5f5;               /* æ‡¸åœè‰² */
            --shadow-color: rgba(0, 0, 0, 0.15);  /* é™°å½±è‰² */
            
            /* å¼·èª¿è‰² */
            --accent-color: #555555;              /* ç°è‰²é‡é»è‰² */
            --accent-color-light: rgba(85, 85, 85, 0.15); /* æ·¡ç°è‰² */
            --accent-color-dark: #333333;         /* æ·±ç°è‰² */
            
            /* åŠŸèƒ½è‰² */
            --success-color: #777777;             /* ç°è‰²æˆåŠŸè‰² */
            --warning-color: #555555;             /* ç°è‰²è­¦å‘Šè‰² */
            --error-color: #777777;               /* ç°è‰²éŒ¯èª¤è‰² */
            --info-color: #555555;                /* ç°è‰²è³‡è¨Šè‰² */
            
            /* ç‰¹æ®Šå…ƒä»¶é¡è‰² */
            --button-primary: #555555;            /* ä¸»æŒ‰éˆ•é¡è‰² */
            --button-secondary: #e0e0e0;          /* å‰¯æŒ‰éˆ•é¡è‰² */
            --input-bg: #ffffff;                  /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            --input-border: #aaaaaa;              /* è¼¸å…¥æ¡†é‚Šæ¡† */
            --input-focus-border: #555555;        /* è¼¸å…¥æ¡†ç„¦é»é‚Šæ¡† */
            --card-bg: #ffffff;                   /* å¡ç‰‡èƒŒæ™¯è‰² */
            
            /* æ–‡å­—å¼·èª¿è‰² */
            --text-highlight: #333333;            /* æ–‡å­—å¼·èª¿è‰² */
            --text-muted: #777777;                /* æ–‡å­—æ·¡è‰² */
            
            /* èˆ‡èˆŠä»£ç¢¼å…¼å®¹çš„è®Šæ•¸ */
            --button-orange: #555555;             /* å…¼å®¹æ©™è‰²æŒ‰éˆ• */
            --button-blue: #777777;               /* å…¼å®¹è—è‰²æŒ‰éˆ• */
            --button-grey: #e0e0e0;               /* å…¼å®¹ç°è‰²æŒ‰éˆ• */

            --helper-text-color: #999999;         /* è¼”åŠ©èªªæ˜æ–‡å­—é¡è‰² */
            
            background-color: #fafafa;            /* é é¢èƒŒæ™¯è‰² */
        }

        /* æ«»èŠ±é›ªä¸»é¡Œ - æµªæ¼«çš„ç²‰ç´…è‰²ç³»ä¸»é¡Œ */
        :root[data-theme="pink"] {
            /* RGBç‰ˆæœ¬çš„é¡è‰²ï¼ˆç”¨æ–¼é€æ˜åº¦æ§åˆ¶ï¼‰ */
            --primary-color-rgb: 255, 240, 245;   /* ä¸»èƒŒæ™¯è‰²RGBå€¼ */
            --secondary-color-rgb: 255, 248, 252; /* æ¬¡èƒŒæ™¯è‰²RGBå€¼ */
            --accent-color-rgb: 219, 56, 108;    /* å¼·èª¿è‰²RGBå€¼ - æ›´æ·±çš„ç²‰ç´…è‰² */
            --input-bg-rgb: 255, 250, 252;        /* è¼¸å…¥æ¡†èƒŒæ™¯RGBå€¼ - æ¥µæ·¡ç²‰è‰² */
            --error-color-rgb: 220, 53, 69;      /* éŒ¯èª¤è‰²RGBå€¼ */
            --info-color-rgb: 255, 182, 193;     /* ä¿¡æ¯è‰²RGBå€¼ - æ”¹ç‚ºæ·ºç²‰è‰² */

            /* åŸºæœ¬è‰²èª¿ */
            --primary-color: #fff0f5;             /* ä¸»èƒŒæ™¯è‰² */
            --secondary-color: #fff8fc;           /* æ¬¡èƒŒæ™¯è‰² - æ¥µæ·¡ç²‰è‰² */
            --text-color: #b8306a;                /* æ–‡å­—è‰² - æ·±æ«»èŠ±è‰² */
            --border-color: #ffb6c1;              /* é‚Šæ¡†è‰² */
            --hover-color: #ffd1dc;               /* æ‡¸åœè‰² */
            --shadow-color: rgba(255, 182, 193, 0.3); /* é™°å½±è‰² */
            
            /* å¼·èª¿è‰² */
            --accent-color: #db386c;              /* æ·±ç²‰ç´…é‡é»è‰² */
            --accent-color-light: rgba(219, 56, 108, 0.1); /* æ·¡ç²‰ç´… */
            --accent-color-dark: #b92d59;         /* æ›´æ·±ç²‰ç´… */
            
            /* åŠŸèƒ½è‰² */
            --success-color: #ff69b4;             /* ç²‰è‰²æˆåŠŸè‰² */
            --warning-color: #ff9e80;             /* æ©™è‰²è­¦å‘Šè‰² */
            --error-color: #dc3545;               /* ç´…è‰²éŒ¯èª¤è‰² */
            --info-color: #ffb6c1;                /* æ·ºç²‰è‰²è³‡è¨Šè‰² */
            
            /* ç‰¹æ®Šå…ƒä»¶é¡è‰² */
            --button-primary: #db386c;            /* ä¸»æŒ‰éˆ•é¡è‰² */
            --button-secondary: #fce4ec;          /* å‰¯æŒ‰éˆ•é¡è‰² */
            --input-bg: #fffafc;                  /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² - æ¥µæ·¡ç²‰è‰² */
            --input-border: #ffb6c1;              /* è¼¸å…¥æ¡†é‚Šæ¡† */
            --input-focus-border: #db386c;        /* è¼¸å…¥æ¡†ç„¦é»é‚Šæ¡† */
            --card-bg: #fff8fc;                   /* å¡ç‰‡èƒŒæ™¯è‰² - æ¥µæ·¡ç²‰è‰² */
            
            /* æ–‡å­—å¼·èª¿è‰² */
            --text-highlight: #db386c;            /* æ–‡å­—å¼·èª¿è‰² */
            --text-muted: #d68fa3;                /* æ–‡å­—æ·¡è‰² - æ”¹ç‚ºä¸­ç­‰ç²‰è‰² */
            
            /* èˆ‡èˆŠä»£ç¢¼å…¼å®¹çš„è®Šæ•¸ */
            --button-orange: #db386c;             /* å…¼å®¹æ©™è‰²æŒ‰éˆ• */
            --button-blue: #ff69b4;               /* å…¼å®¹è—è‰²æŒ‰éˆ• - æ”¹ç‚ºç²‰è‰² */
            --button-grey: #fce4ec;               /* å…¼å®¹ç°è‰²æŒ‰éˆ• */

            --helper-text-color: #d68fa3;         /* è¼”åŠ©èªªæ˜æ–‡å­—é¡è‰² - ä¸­ç­‰ç²‰è‰² */
        }

        /* æš—å¤œçƒˆç„°ä¸»é¡Œ - æ·±é»‘è‰²åº•æ­é…é®®ç´…è‰²èª¿ */
        :root[data-theme="red"] {
            /* RGBç‰ˆæœ¬çš„é¡è‰²ï¼ˆç”¨æ–¼é€æ˜åº¦æ§åˆ¶ï¼‰ */
            --primary-color-rgb: 26, 26, 26;      /* ä¸»èƒŒæ™¯è‰²RGBå€¼ */
            --secondary-color-rgb: 44, 44, 44;    /* æ¬¡èƒŒæ™¯è‰²RGBå€¼ */
            --accent-color-rgb: 244, 67, 54;      /* å¼·èª¿è‰²RGBå€¼ */
            --input-bg-rgb: 33, 33, 33;           /* è¼¸å…¥æ¡†èƒŒæ™¯RGBå€¼ */
            --error-color-rgb: 244, 67, 54;       /* éŒ¯èª¤è‰²RGBå€¼ */
            --info-color-rgb: 33, 150, 243;       /* ä¿¡æ¯è‰²RGBå€¼ */

            /* åŸºæœ¬è‰²èª¿ */
            --primary-color: #1a1a1a;             /* ä¸»èƒŒæ™¯è‰² */
            --secondary-color: #2c2c2c;           /* æ¬¡èƒŒæ™¯è‰² */
            --text-color: #ffffff;                /* æ–‡å­—è‰² */
            --border-color: #c62828;              /* é‚Šæ¡†è‰² */
            --hover-color: #3d2828;               /* æ‡¸åœè‰² */
            --shadow-color: rgba(198, 40, 40, 0.3); /* é™°å½±è‰² */
            
            /* å¼·èª¿è‰² */
            --accent-color: #f44336;              /* ç´…è‰²é‡é»è‰² */
            --accent-color-light: rgba(244, 67, 54, 0.2); /* æ·¡ç´…è‰² */
            --accent-color-dark: #c62828;         /* æ·±ç´…è‰² */
            
            /* åŠŸèƒ½è‰² */
            --success-color: #4caf50;             /* ç¶ è‰²æˆåŠŸè‰² */
            --warning-color: #ff9800;             /* æ©™è‰²è­¦å‘Šè‰² */
            --error-color: #f44336;               /* ç´…è‰²éŒ¯èª¤è‰² */
            --info-color: #2196f3;                /* è—è‰²è³‡è¨Šè‰² */
            
            /* ç‰¹æ®Šå…ƒä»¶é¡è‰² */
            --button-primary: #f44336;            /* ä¸»æŒ‰éˆ•é¡è‰² */
            --button-secondary: #424242;          /* å‰¯æŒ‰éˆ•é¡è‰² */
            --input-bg: #212121;                  /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            --input-border: #424242;              /* è¼¸å…¥æ¡†é‚Šæ¡† */
            --input-focus-border: #f44336;        /* è¼¸å…¥æ¡†ç„¦é»é‚Šæ¡† */
            --card-bg: #2c2c2c;                   /* å¡ç‰‡èƒŒæ™¯è‰² */
            
            /* æ–‡å­—å¼·èª¿è‰² */
            --text-highlight: #f44336;            /* æ–‡å­—å¼·èª¿è‰² */
            --text-muted: #9e9e9e;                /* æ–‡å­—æ·¡è‰² */
            
            /* èˆ‡èˆŠä»£ç¢¼å…¼å®¹çš„è®Šæ•¸ */
            --button-orange: #f44336;             /* å…¼å®¹æ©™è‰²æŒ‰éˆ• */
            --button-blue: #2196f3;               /* å…¼å®¹è—è‰²æŒ‰éˆ• */
            --button-grey: #424242;               /* å…¼å®¹ç°è‰²æŒ‰éˆ• */
        }

        /* æš®å…‰æ˜Ÿå¡µä¸»é¡Œ - æ·±è—ç´«è‰²èª¿å¸¶ä¾†ç¥ç§˜æ„Ÿ */
        :root[data-theme="blue-purple"] {
            /* RGBç‰ˆæœ¬çš„é¡è‰²ï¼ˆç”¨æ–¼é€æ˜åº¦æ§åˆ¶ï¼‰ */
            --primary-color-rgb: 26, 26, 46;      /* ä¸»èƒŒæ™¯è‰²RGBå€¼ */
            --secondary-color-rgb: 47, 47, 73;    /* æ¬¡èƒŒæ™¯è‰²RGBå€¼ */
            --accent-color-rgb: 147, 112, 219;    /* å¼·èª¿è‰²RGBå€¼ */
            --input-bg-rgb: 35, 35, 66;           /* è¼¸å…¥æ¡†èƒŒæ™¯RGBå€¼ */
            --error-color-rgb: 255, 71, 87;       /* éŒ¯èª¤è‰²RGBå€¼ */
            --info-color-rgb: 0, 206, 201;        /* ä¿¡æ¯è‰²RGBå€¼ */
            
            /* åŸºæœ¬è‰²èª¿ */
            --primary-color: #1a1a2e;             /* æ·±è—ç´«èƒŒæ™¯ */
            --secondary-color: #2f2f49;           /* è—ç´«æ¬¡èƒŒæ™¯ */
            --text-color: #e6e6ff;                /* æ·ºè—ç´«æ–‡å­— */
            --border-color: #7b68ee;              /* è–°è¡£è‰é‚Šæ¡† */
            --hover-color: #3f3f66;               /* è—ç´«æ‡¸åœ */
            --shadow-color: rgba(123, 104, 238, 0.3); /* ç´«è‰²é™°å½± */
            
            /* å¼·èª¿è‰² */
            --accent-color: #9370db;              /* ç´«è‰²é‡é»è‰² */
            --accent-color-light: rgba(147, 112, 219, 0.2); /* æ·¡ç´«è‰² */
            --accent-color-dark: #6a3ece;         /* æ·±ç´«è‰² */
            
            /* åŠŸèƒ½è‰² */
            --success-color: #00bfa5;             /* æ¾çŸ³ç¶ æˆåŠŸè‰² */
            --warning-color: #fed330;             /* é‡‘é»ƒè­¦å‘Šè‰² */
            --error-color: #ff4757;               /* ç²‰ç´…éŒ¯èª¤è‰² */
            --info-color: #00cec9;                /* è—ç¶ è³‡è¨Šè‰² */
            
            /* ç‰¹æ®Šå…ƒä»¶é¡è‰² */
            --button-primary: #9370db;            /* ä¸»æŒ‰éˆ•é¡è‰² */
            --button-secondary: #3d3d64;          /* å‰¯æŒ‰éˆ•é¡è‰² */
            --input-bg: #232342;                  /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            --input-border: #4b4b80;              /* è¼¸å…¥æ¡†é‚Šæ¡† */
            --input-focus-border: #9370db;        /* è¼¸å…¥æ¡†ç„¦é»é‚Šæ¡† */
            --card-bg: #2f2f49;                   /* å¡ç‰‡èƒŒæ™¯è‰² */
            
            /* æ–‡å­—å¼·èª¿è‰² */
            --text-highlight: #9370db;            /* æ–‡å­—å¼·èª¿è‰² */
            --text-muted: #a0a0c8;                /* æ–‡å­—æ·¡è‰² */
            
            /* èˆ‡èˆŠä»£ç¢¼å…¼å®¹çš„è®Šæ•¸ */
            --button-orange: #9370db;             /* å…¼å®¹æ©™è‰²æŒ‰éˆ• */
            --button-blue: #00cec9;               /* å…¼å®¹è—è‰²æŒ‰éˆ• */
            --button-grey: #3d3d64;               /* å…¼å®¹ç°è‰²æŒ‰éˆ• */
        }

        /* ç¿ ç‰æ¸…é¢¨ä¸»é¡Œ - æ¸…æ–°çš„ç¶ è‰²ç³»ä¸»é¡Œ */
        :root[data-theme="green"] {
            /* RGBç‰ˆæœ¬çš„é¡è‰²ï¼ˆç”¨æ–¼é€æ˜åº¦æ§åˆ¶ï¼‰ */
            --primary-color-rgb: 241, 248, 233;   /* ä¸»èƒŒæ™¯è‰²RGBå€¼ */
            --secondary-color-rgb: 255, 255, 255; /* æ¬¡èƒŒæ™¯è‰²RGBå€¼ */
            --accent-color-rgb: 76, 175, 80;      /* å¼·èª¿è‰²RGBå€¼ */
            --input-bg-rgb: 255, 255, 255;        /* è¼¸å…¥æ¡†èƒŒæ™¯RGBå€¼ */
            --error-color-rgb: 244, 67, 54;       /* éŒ¯èª¤è‰²RGBå€¼ */
            --info-color-rgb: 33, 150, 243;       /* ä¿¡æ¯è‰²RGBå€¼ */
            
            /* åŸºæœ¬è‰²èª¿ */
            --primary-color: #f1f8e9;             /* æ·ºç¶ èƒŒæ™¯ */
            --secondary-color: #ffffff;           /* ç™½è‰²æ¬¡èƒŒæ™¯ */
            --text-color: #2e7d32;                /* ç¶ è‰²æ–‡å­— */
            --border-color: #81c784;              /* ç¶ è‰²é‚Šæ¡† */
            --hover-color: #e8f5e9;               /* æ›´æ·ºç¶ æ‡¸åœ */
            --shadow-color: rgba(129, 199, 132, 0.3); /* ç¶ è‰²é™°å½± */
            
            /* å¼·èª¿è‰² */
            --accent-color: #4caf50;              /* ç¶ è‰²é‡é»è‰² */
            --accent-color-light: rgba(76, 175, 80, 0.2); /* æ·¡ç¶ è‰² */
            --accent-color-dark: #2e7d32;         /* æ·±ç¶ è‰² */
            
            /* åŠŸèƒ½è‰² */
            --success-color: #4caf50;             /* ç¶ è‰²æˆåŠŸè‰² */
            --warning-color: #ff9800;             /* æ©™è‰²è­¦å‘Šè‰² */
            --error-color: #f44336;               /* ç´…è‰²éŒ¯èª¤è‰² */
            --info-color: #2196f3;                /* è—è‰²è³‡è¨Šè‰² */
            
            /* ç‰¹æ®Šå…ƒä»¶é¡è‰² */
            --button-primary: #4caf50;            /* ä¸»æŒ‰éˆ•é¡è‰² */
            --button-secondary: #e8f5e9;          /* å‰¯æŒ‰éˆ•é¡è‰² */
            --input-bg: #ffffff;                  /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            --input-border: #81c784;              /* è¼¸å…¥æ¡†é‚Šæ¡† */
            --input-focus-border: #4caf50;        /* è¼¸å…¥æ¡†ç„¦é»é‚Šæ¡† */
            --card-bg: #ffffff;                   /* å¡ç‰‡èƒŒæ™¯è‰² */
            
            /* æ–‡å­—å¼·èª¿è‰² */
            --text-highlight: #2e7d32;            /* æ–‡å­—å¼·èª¿è‰² */
            --text-muted: #757575;                /* æ–‡å­—æ·¡è‰² */
            
            /* èˆ‡èˆŠä»£ç¢¼å…¼å®¹çš„è®Šæ•¸ */
            --button-orange: #4caf50;             /* å…¼å®¹æ©™è‰²æŒ‰éˆ• */
            --button-blue: #2196f3;               /* å…¼å®¹è—è‰²æŒ‰éˆ• */
            --button-grey: #e8f5e9;               /* å…¼å®¹ç°è‰²æŒ‰éˆ• */
        }

        /* ç§‘æŠ€è—èª¿ä¸»é¡Œ - ç¾ä»£ç§‘æŠ€æ„Ÿçš„è—è‰²ç³»è¨­è¨ˆ */
        :root[data-theme="blue"] {
            /* RGBç‰ˆæœ¬çš„é¡è‰²ï¼ˆç”¨æ–¼é€æ˜åº¦æ§åˆ¶ï¼‰ */
            --primary-color-rgb: 26, 38, 57;      /* ä¸»èƒŒæ™¯è‰²RGBå€¼ */
            --secondary-color-rgb: 46, 64, 89;    /* æ¬¡èƒŒæ™¯è‰²RGBå€¼ */
            --accent-color-rgb: 52, 152, 219;     /* å¼·èª¿è‰²RGBå€¼ */
            --input-bg-rgb: 34, 51, 71;           /* è¼¸å…¥æ¡†èƒŒæ™¯RGBå€¼ */
            --error-color-rgb: 231, 76, 60;       /* éŒ¯èª¤è‰²RGBå€¼ */
            --info-color-rgb: 52, 152, 219;       /* ä¿¡æ¯è‰²RGBå€¼ */
            
            /* åŸºæœ¬è‰²èª¿ */
            --primary-color: #1a2639;             /* æ·±è—èƒŒæ™¯ */
            --secondary-color: #2e4059;           /* ä¸­è—æ¬¡èƒŒæ™¯ */
            --text-color: #e5e5e5;                /* æ·ºç°æ–‡å­— */
            --border-color: #4d8cc4;              /* è—è‰²é‚Šæ¡† */
            --hover-color: #395981;               /* æ‡¸åœè‰² */
            --shadow-color: rgba(77, 140, 196, 0.3); /* è—è‰²é™°å½± */
            
            /* å¼·èª¿è‰² */
            --accent-color: #3498db;              /* è—è‰²é‡é»è‰² */
            --accent-color-light: rgba(52, 152, 219, 0.2); /* æ·¡è—è‰² */
            --accent-color-dark: #2980b9;         /* æ·±è—è‰² */
            
            /* åŠŸèƒ½è‰² */
            --success-color: #2ecc71;             /* ç¶ è‰²æˆåŠŸè‰² */
            --warning-color: #f39c12;             /* æ©™è‰²è­¦å‘Šè‰² */
            --error-color: #e74c3c;               /* ç´…è‰²éŒ¯èª¤è‰² */
            --info-color: #3498db;                /* è—è‰²è³‡è¨Šè‰² */
            
            /* ç‰¹æ®Šå…ƒä»¶é¡è‰² */
            --button-primary: #3498db;            /* ä¸»æŒ‰éˆ•é¡è‰² */
            --button-secondary: #34495e;          /* å‰¯æŒ‰éˆ•é¡è‰² */
            --input-bg: #223347;                  /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            --input-border: #4d8cc4;              /* è¼¸å…¥æ¡†é‚Šæ¡† */
            --input-focus-border: #3498db;        /* è¼¸å…¥æ¡†ç„¦é»é‚Šæ¡† */
            --card-bg: #2e4059;                   /* å¡ç‰‡èƒŒæ™¯è‰² */
            
            /* æ–‡å­—å¼·èª¿è‰² */
            --text-highlight: #3498db;            /* æ–‡å­—å¼·èª¿è‰² */
            --text-muted: #95a5a6;                /* æ–‡å­—æ·¡è‰² */
            
            /* èˆ‡èˆŠä»£ç¢¼å…¼å®¹çš„è®Šæ•¸ */
            --button-orange: #3498db;             /* å…¼å®¹æ©™è‰²æŒ‰éˆ• */
            --button-blue: #3498db;               /* å…¼å®¹è—è‰²æŒ‰éˆ• */
            --button-grey: #34495e;               /* å…¼å®¹ç°è‰²æŒ‰éˆ• */
        }

        /* çš‡å®¶ç´«éŸ»ä¸»é¡Œ - é«˜è²´çš„ç´«é‡‘é…è‰²æ–¹æ¡ˆ */
        :root[data-theme="royal"] {
            /* RGBç‰ˆæœ¬çš„é¡è‰²ï¼ˆç”¨æ–¼é€æ˜åº¦æ§åˆ¶ï¼‰ */
            --primary-color-rgb: 49, 27, 77;      /* ä¸»èƒŒæ™¯è‰²RGBå€¼ */
            --secondary-color-rgb: 69, 39, 107;   /* æ¬¡èƒŒæ™¯è‰²RGBå€¼ */
            --accent-color-rgb: 212, 175, 55;     /* å¼·èª¿è‰²RGBå€¼ */
            --input-bg-rgb: 40, 23, 60;           /* è¼¸å…¥æ¡†èƒŒæ™¯RGBå€¼ */
            --error-color-rgb: 179, 51, 51;       /* éŒ¯èª¤è‰²RGBå€¼ */
            --info-color-rgb: 66, 133, 244;       /* ä¿¡æ¯è‰²RGBå€¼ */
            
            /* åŸºæœ¬è‰²èª¿ */
            --primary-color: #311b4d;             /* æ·±ç´«è‰²èƒŒæ™¯ */
            --secondary-color: #45276b;           /* ä¸­ç´«è‰²æ¬¡èƒŒæ™¯ */
            --text-color: #f8f0e3;                /* æ·ºé‡‘è‰²æ–‡å­— */
            --border-color: #8a56ac;              /* äº®ç´«è‰²é‚Šæ¡† */
            --hover-color: #513082;               /* ç´«ç¾…è˜­æ‡¸åœè‰² */
            --shadow-color: rgba(49, 27, 77, 0.5); /* ç´«è‰²é™°å½± */
            
            /* å¼·èª¿è‰² */
            --accent-color: #d4af37;              /* é‡‘è‰²é‡é»è‰² */
            --accent-color-light: rgba(212, 175, 55, 0.2); /* æ·¡é‡‘è‰² */
            --accent-color-dark: #b8860b;         /* æ·±é‡‘è‰² */
            
            /* åŠŸèƒ½è‰² */
            --success-color: #4caf50;             /* ç¶ è‰²æˆåŠŸè‰² */
            --warning-color: #ff9800;             /* æ©™è‰²è­¦å‘Šè‰² */
            --error-color: #b33333;               /* ç´…è‰²éŒ¯èª¤è‰² */
            --info-color: #4285f4;                /* è—è‰²è³‡è¨Šè‰² */
            
            /* ç‰¹æ®Šå…ƒä»¶é¡è‰² */
            --button-primary: #d4af37;            /* é‡‘è‰²ä¸»æŒ‰éˆ• */
            --button-secondary: #513082;          /* ç´«è‰²å‰¯æŒ‰éˆ• */
            --input-bg: #28173c;                  /* æ·±ç´«è‰²è¼¸å…¥æ¡†èƒŒæ™¯ */
            --input-border: #8a56ac;              /* äº®ç´«è‰²è¼¸å…¥æ¡†é‚Šæ¡† */
            --input-focus-border: #d4af37;        /* é‡‘è‰²è¼¸å…¥æ¡†ç„¦é»é‚Šæ¡† */
            --card-bg: #45276b;                   /* ä¸­ç´«è‰²å¡ç‰‡èƒŒæ™¯ */
            
            /* æ–‡å­—å¼·èª¿è‰² */
            --text-highlight: #dfc15e;            /* é‡‘è‰²æ–‡å­—å¼·èª¿ */
            --text-muted: #c0a9e0;                /* æ·ºç´«è‰²æ·¡è‰²æ–‡å­— */
            
            /* èˆ‡èˆŠä»£ç¢¼å…¼å®¹çš„è®Šæ•¸ */
            --button-orange: #d4af37;             /* é‡‘è‰²æ›¿ä»£æ©™è‰² */
            --button-blue: #4285f4;               /* ä¿ç•™è—è‰² */
            --button-grey: #513082;               /* ç´«è‰²æ›¿ä»£ç°è‰² */
        }

        /* ============================================
        * 2. åŸºç¤å…ƒç´ æ¨£å¼
        * ============================================ */

        /* åŸºæœ¬é é¢æ¨£å¼ */
        html, body {
            width: 100%;                          /* ä½¿ç”¨100%å¯¬åº¦ */
            max-width: 400px;                     /* è¨­å®šæœ€å¤§å¯¬åº¦ */
            margin: 0 auto;                       /* å±…ä¸­é¡¯ç¤º */
            position: relative;                   /* ç›¸å°å®šä½ç”¨æ–¼å­å…ƒç´ çµ•å°å®šä½ */
            overflow-x: hidden;                   /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
            -webkit-text-size-adjust: 100%;       /* ç¢ºä¿å­—é«”å¤§å°ä¸è‡ªå‹•èª¿æ•´ */
            padding: 0 3px;                       /* ç‚ºé é¢æ·»åŠ å·¦å³é–“è· */
            background-color: var(--primary-color); /* ä½¿ç”¨ä¸»é¡ŒèƒŒæ™¯è‰² */
            color: var(--text-color);             /* ä½¿ç”¨ä¸»é¡Œæ–‡å­—è‰² */
            font-family: "Microsoft JhengHei", Arial, sans-serif; /* è¨­å®šå­—é«” */
            box-sizing: border-box;               /* ç›’æ¨¡å‹è¨ˆç®—åŒ…å«é‚Šæ¡†å’Œå…§é‚Šè· */

            padding-top: 26px;                       /* ç‚ºå›ºå®šheaderé ç•™ç©ºé–“ */

        }

        /* é é¢æ¨™é¡Œæ¨£å¼ */
        h1 {
            color: var(--text-color);             /* ä½¿ç”¨ä¸»é¡Œæ–‡å­—è‰² */
            font-size: 22px;                      /* è¨­å®šå­—é«”å¤§å° */
            margin-bottom: 0px;                   /* ç§»é™¤åº•éƒ¨é‚Šè· */
            border-bottom: 2px solid var(--accent-color); /* åº•éƒ¨é‚Šæ¡† */
            padding: 0 24px 5px;                  /* æ·»åŠ å…§é‚Šè· */
            position: relative;                   /* ç›¸å°å®šä½ç”¨æ–¼å½å…ƒç´  */
            transition: all 0.3s ease;            /* å¹³æ»‘éæ¸¡æ•ˆæœ */
        }

        /* æ¨™é¡Œæ‡¸åœæ•ˆæœ */
        h1:hover {
            transform: translateY(-2px);          /* æ‡¸åœæ™‚ç¨å¾®ä¸Šç§» */
            text-shadow: 0 2px 4px rgba(255, 156, 51, 0.3); /* æ‡¸åœæ™‚æ·»åŠ æ–‡å­—é™°å½± */
        }

        /* æ¨™é¡Œåº•éƒ¨ç·šæ¢å‹•ç•«æ•ˆæœ */
        h1::after {
            content: '';                          /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                   /* çµ•å°å®šä½ */
            bottom: 0;                            /* å›ºå®šåœ¨åº•éƒ¨ */
            left: 0;                              /* å·¦é‚Šå°é½Š */
            width: 100%;                          /* å¯¬åº¦100% */
            height: 2px;                          /* é«˜åº¦2px */
            background: var(--accent-color);      /* ä½¿ç”¨å¼·èª¿è‰² */
            transform: scaleX(0);                 /* åˆå§‹å¯¬åº¦ç‚º0 */
            transform-origin: right;              /* è®Šæ›èµ·é»ç‚ºå³å´ */
            transition: transform 0.6s ease-out;  /* å¹³æ»‘éæ¸¡æ•ˆæœ */
        }

        /* æ¨™é¡Œæ‡¸åœæ™‚åº•éƒ¨ç·šæ¢å‹•ç•« */
        h1:hover::after {
            transform: scaleX(1);                 /* æ‡¸åœæ™‚å¯¬åº¦æ“´å±•è‡³100% */
            transform-origin: left;               /* è®Šæ›èµ·é»æ”¹ç‚ºå·¦å´ */
        }

        /* æ¨™é¡Œå®¹å™¨ - æ·»åŠ ç¨ç«‹çš„z-indexç¢ºä¿æ­£ç¢ºçš„å±¤ç–Šé—œä¿‚ */
        /* æ¨™é¡Œå®¹å™¨æ¨£å¼ */
        .header-container {
            text-align: center;                   /* æ–‡å­—å±…ä¸­ */
            position: fixed;                      /* å›ºå®šå®šä½ */
            top: 0;                              /* è²¼é½Šé ‚éƒ¨ */
            left: 0;                             /* è²¼é½Šå·¦å´ */
            right: 0;                            /* è²¼é½Šå³å´ */
            margin-bottom: 0px;                   /* ç§»é™¤åº•éƒ¨é‚Šè· */
            z-index: 1100;                       /* è¨­ç½®æ›´é«˜å±¤ç´š */
            background-color: var(--primary-color); /* æ·»åŠ èƒŒæ™¯è‰² */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* æ·»åŠ é™°å½± */
            padding: 3px 0;                      /* æ·»åŠ ä¸Šä¸‹å…§é‚Šè· */
        }

        /* æ¨™é¡Œæ¨£å¼ - ç¢ºä¿æ‡¸åœæ•ˆæœä¸æœƒå½±éŸ¿æŒ‰éˆ• */
        h1 {
            color: var(--text-color);             /* ä½¿ç”¨ä¸»é¡Œæ–‡å­—è‰² */
            font-size: 22px;                      /* è¨­å®šå­—é«”å¤§å° */
            margin-bottom: 0px;                   /* ç§»é™¤åº•éƒ¨é‚Šè· */
            border-bottom: 2px solid var(--accent-color); /* åº•éƒ¨é‚Šæ¡† */
            padding-bottom: 5px;                  /* åº•éƒ¨å…§é‚Šè· */
            position: relative;                   /* ç›¸å°å®šä½ */
            z-index: 1;                           /* è¨­ç½®å±¤ç´š */
        }

        /* ç§»é™¤h1æ‡¸åœæ™‚çš„è®Šå½¢æ•ˆæœï¼Œé˜²æ­¢å½±éŸ¿æŒ‰éˆ• */
        h1:hover {
            text-shadow: 0 2px 4px rgba(255, 156, 51, 0.3);
            /* ç§»é™¤transformä»¥é˜²æ­¢å½±éŸ¿æŒ‰éˆ•ä½ç½® */
        }

        /* æ¨™é¡Œä¸‹æ–¹æ©™è‰²ç·šæ¢æ•ˆæœ */
        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--button-orange);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.6s ease-out;
            z-index: 1; /* ç¢ºä¿åœ¨h1ä¸‹æ–¹ */
        }

        h1:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }

        /* æ¨™é¡ŒæŒ‰éˆ•æ¨£å¼ */
        .header-btn {
            position: absolute;                   /* çµ•å°å®šä½ */
            top: 50%;                             /* å‚ç›´ç½®ä¸­ */
            transform: translateY(-50%);          /* ç²¾ç¢ºå‚ç›´ç½®ä¸­ */
            background-color: transparent;        /* é€æ˜èƒŒæ™¯ */
            color: #666666;                       /* è¨­ç½®æ–‡å­—é¡è‰² */
            border: none;                         /* ç§»é™¤é‚Šæ¡† */
            width: 22px;                          /* è¨­ç½®å¯¬åº¦ */
            height: 22px;                         /* è¨­ç½®é«˜åº¦ */
            font-size: 14px;                      /* è¨­ç½®å­—é«”å¤§å° */
            display: flex;                        /* ä½¿ç”¨flexä½ˆå±€ */
            align-items: center;                  /* å‚ç›´å±…ä¸­ */
            justify-content: center;              /* æ°´å¹³å±…ä¸­ */
            cursor: pointer;                      /* è¨­ç½®æ¸¸æ¨™æ¨£å¼ */
            z-index: 10;                          /* ç¢ºä¿æŒ‰éˆ•åœ¨æœ€ä¸Šå±¤ */
            padding: 0;                           /* ç§»é™¤å…§é‚Šè· */
            transition: color 0.2s ease;          /* å¹³æ»‘éæ¸¡æ•ˆæœ */
            outline: none;                        /* ç§»é™¤é»æ“Šè¼ªå»“ */
            
            /* ç¦æ­¢æ‰€æœ‰è®Šå½¢å’Œå‹•ç•« */
            transform: translateY(-50%) !important; /* å¼·åˆ¶ä¿æŒå‚ç›´å±…ä¸­ */
            animation: none !important;            /* ç¦æ­¢å‹•ç•« */
            box-shadow: none !important;           /* ç¦æ­¢é™°å½± */
        }

        /* å¢åŠ æŒ‰éˆ•çš„å¯é»æ“Šå€åŸŸ */
        .header-btn::before {
            content: '';
            position: absolute;
            top: -15px;
            bottom: -15px;
            left: -15px;
            right: -15px;
        }

        /* æ¨™é¡ŒæŒ‰éˆ•æ‡¸åœæ•ˆæœ */
        .header-btn:hover {
            color: #999999;                       /* æ‡¸åœæ™‚æ”¹è®Šé¡è‰² */
            /* ç¦æ­¢ä»»ä½•ä½ç½®æˆ–å¤§å°è®ŠåŒ– */
            transform: translateY(-50%) !important; /* å¼·åˆ¶ä¿æŒå‚ç›´å±…ä¸­ */
        }

        /* æ¨™é¡ŒæŒ‰éˆ•é»æ“Šæ•ˆæœ */
        .header-btn:active {
            color: var(--button-orange);          /* é»æ“Šæ™‚è®Šç‚ºå¼·èª¿è‰² */
            /* ç¦æ­¢ä»»ä½•ä½ç½®æˆ–å¤§å°è®ŠåŒ– */
            transform: translateY(-50%) !important; /* å¼·åˆ¶ä¿æŒå‚ç›´å±…ä¸­ */
        }

        /* å·¦å³æŒ‰éˆ•ä½ç½® */
        .header-btn-left {
            left: 5px;                           /* å·¦é‚ŠæŒ‰éˆ•ä½ç½® */
        }

        .header-btn-right {
            right: 5px;                          /* å³é‚ŠæŒ‰éˆ•ä½ç½® */
        }

        /* å¢åŠ å·¦å³æŒ‰éˆ•çš„å¯é»æ“Šå€åŸŸä¸åŒç¨‹åº¦ */
        .header-btn-left::before {
            left: -20px;                         /* å·¦å´æ›´å¤§çš„å¯é»æ“Šå€åŸŸ */
        }

        .header-btn-right::before {
            right: -20px;                       /* å³å´æ›´å¤§çš„å¯é»æ“Šå€åŸŸ */
        }

        /* æ¸…é™¤å¯èƒ½å½±éŸ¿æŒ‰éˆ•çš„å…¶ä»–æ¨£å¼è¦å‰‡ */
        .header-btn * {
            transition: none !important;          /* ç¦æ­¢éæ¸¡æ•ˆæœ */
            animation: none !important;           /* ç¦æ­¢å‹•ç•« */
            transform: none !important;           /* ç¦æ­¢è®Šå½¢ */
        }

        /* é˜²æ­¢å…¨å±€æ‡¸åœæ•ˆæœå½±éŸ¿æŒ‰éˆ• */
        *:hover .header-btn {
            transform: translateY(-50%) !important; /* å¼·åˆ¶ä¿æŒå‚ç›´å±…ä¸­ */
            position: absolute !important;         /* å¼·åˆ¶ä¿æŒçµ•å°å®šä½ */
        }

        /* ============================================
        * 3. ä½ˆå±€èˆ‡å®¹å™¨
        * ============================================ */

        /* è¡Œå®¹å™¨æ¨£å¼ - ç”¨æ–¼è³‡æ–™è¼¸å…¥å€åŸŸ */
        .row {
            margin: 4px 0;                        /* ä¸Šä¸‹é‚Šè· */
            display: flex;                        /* ä½¿ç”¨flexä½ˆå±€ */
            align-items: center;                  /* å‚ç›´å±…ä¸­ */
            background: var(--secondary-color);   /* ä½¿ç”¨æ¬¡èƒŒæ™¯è‰² */
            padding: 3px;                         /* å…§é‚Šè· */
            border-radius: 4px;                   /* åœ“è§’ */
            box-shadow: 0 4px 8px var(--shadow-color); /* é™°å½±æ•ˆæœ */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* éæ¸¡æ•ˆæœ */
            position: relative;                   /* ç›¸å°å®šä½ç”¨æ–¼å½å…ƒç´  */
            transform-origin: left;               /* è®Šæ›èµ·é»ç‚ºå·¦å´ */
            will-change: transform;               /* å„ªåŒ–æ¸²æŸ“æ€§èƒ½ */
        }

        /* è¡Œæ‡¸åœæ•ˆæœ */
        .row:hover {
            transform: translateX(5px);           /* æ‡¸åœæ™‚å³ç§» */
            box-shadow: 0 6px 12px var(--shadow-color); /* å¢å¼·é™°å½± */
        }

        /* è¡Œæ‡¸åœæ™‚çš„å·¦å´é‚Šæ¡†å‹•ç•« */
        .row:hover::before {
            content: '';                         /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                  /* çµ•å°å®šä½ */
            left: -5px;                          /* ä½æ–¼å·¦å´ */
            top: 50%;                            /* å‚ç›´å±…ä¸­ */
            width: 3px;                          /* å¯¬åº¦ */
            height: 0;                           /* åˆå§‹é«˜åº¦ç‚º0 */
            background: var(--button-orange);    /* ä½¿ç”¨æ©™è‰² */
            animation: expandHeight 0.3s forwards; /* åŸ·è¡Œé«˜åº¦æ“´å±•å‹•ç•« */
        }

        /* é«˜åº¦æ“´å±•å‹•ç•« */
        @keyframes expandHeight {
            to {
                height: 100%;                    /* æœ€çµ‚é«˜åº¦ç‚º100% */
                top: 0;                          /* å¾é ‚éƒ¨é–‹å§‹ */
            }
        }

        /* æ¨™ç±¤æ¨£å¼ */
        .label {
            width: 120px;                        /* å›ºå®šå¯¬åº¦ */
            margin-right: 8px;                   /* å³å´é‚Šè· - å¾15pxæ¸›å°‘åˆ°8pxè®“æ¨™ç±¤æ›´é è¿‘è¼¸å…¥æ¡† */
            text-align: right;                   /* æ–‡å­—å³å°é½Š */
            font-weight: normal;                 /* å­—é«”ç²—ç´° - æ”¹ç‚ºæ­£å¸¸ç²—ç´°ï¼ˆä¸æ˜¯ç²—é«”ï¼‰ */
            color: var(--text-color);            /* æ–‡å­—é¡è‰² */
            position: relative;                  /* ç›¸å°å®šä½ */
            overflow: hidden;                    /* éš±è—æº¢å‡ºå…§å®¹ */
            font-size: var(--label-font-size);   /* ä½¿ç”¨è®Šæ•¸æ§åˆ¶å­—é«”å¤§å° */
        }

        /* è¼¸å…¥æ¡†èˆ‡æŒ‰éµçš„è¦–è¦ºåˆ†çµ„ */
        .input-button-group {
            border: 1px solid var(--border-color); /* æ·»åŠ é‚Šæ¡† */
            border-radius: 8px;                    /* åœ“è§’ */
            margin: 4px 0;                         /* ä¸Šä¸‹é‚Šè· */
            padding: 1px;                          /* å…§é‚Šè· */
            background: var(--secondary-color);    /* ä½¿ç”¨æ¬¡èƒŒæ™¯è‰² */
            box-shadow: 0 4px 8px var(--shadow-color); /* é™°å½±æ•ˆæœ */
            position: relative;                     /* ç›¸å°å®šä½ */
            overflow: hidden;                       /* éš±è—æº¢å‡ºå…§å®¹ */
            transition: all 0.3s ease-in-out;       /* éæ¸¡æ•ˆæœ */
        }

        /* åˆ†çµ„å…§çš„è¡Œå®¹å™¨ */
        .input-button-group .row {
            background: transparent;              /* é€æ˜èƒŒæ™¯ */
            box-shadow: none;                     /* ç§»é™¤é™°å½± */
            margin: 2px 0;                        /* ä¸Šä¸‹é‚Šè· */
            padding-top: 1px;                     /* ä¸Šéƒ¨å…§é‚Šè· */
            padding-bottom: 1px;                  /* ä¸‹éƒ¨å…§é‚Šè· */
        }

        /* åˆ†çµ„å…§è¡Œå®¹å™¨çš„æ‡¸åœæ•ˆæœ */
        .input-button-group .row:hover {
            transform: translateX(2px);            /* æ‡¸åœæ™‚ç¨å¾®å³ç§» */
            box-shadow: none;                      /* ç„¡é™°å½± */
        }

        /* ç¦ç”¨åˆ†çµ„å…§è¡Œå®¹å™¨çš„å·¦å´é‚Šæ¡†å‹•ç•« */
        .input-button-group .row:hover::before {
            display: none;                         /* éš±è—å½å…ƒç´  */
        }

        /* æŒ‰éµå®¹å™¨æ¨£å¼èª¿æ•´ */
        .input-button-group div[id$="Buttons"] {
            margin: 0;                             /* ç§»é™¤é‚Šè· */
            padding-top: 0;                        /* ç§»é™¤ä¸Šéƒ¨å…§é‚Šè· */
            padding-bottom: 2px;                   /* åº•éƒ¨å…§é‚Šè· */
            border-top: none;                      /* ç§»é™¤é ‚éƒ¨é‚Šæ¡† */
            transition: all 0.3s ease-in-out, max-height 0.3s ease-in-out; /* éæ¸¡æ•ˆæœ */
            max-height: 100px;                     /* é è¨­æœ€å¤§é«˜åº¦ */
            opacity: 1;                            /* å®Œå…¨ä¸é€æ˜ */
        }
        
        /* ç•¶æ»‘é¼ æ‡¸åœåœ¨æŒ‰éµçµ„ä¸Šæ™‚çš„æ•ˆæœ */
        .input-button-group div[id$="Buttons"]:hover {
            background-color: rgba(255, 156, 51, 0.05); /* æ·»åŠ æ·¡æ©™è‰²èƒŒæ™¯ */
            border-radius: 4px;                          /* åœ“è§’ */
        }

        /* éš±è—ç‹€æ…‹çš„æŒ‰éˆ•çµ„ */
        .input-button-group div[id$="Buttons"].hidden-element {
            max-height: 0;                         /* é«˜åº¦ç‚º0 */
            opacity: 0;                            /* å®Œå…¨é€æ˜ */
            padding: 0;                            /* ç§»é™¤å…§é‚Šè· */
            margin: 0;                             /* ç§»é™¤é‚Šè· */
            overflow: hidden;                      /* éš±è—æº¢å‡ºå…§å®¹ */
        }

        /* æ™‚é–“é¡¯ç¤ºåŒ…è£å®¹å™¨ */
        .time-display-wrapper {
            position: relative;                    /* ç›¸å°å®šä½ */
            height: auto;                          /* è‡ªå‹•é«˜åº¦ */
            margin: 3px 0;                         /* ä¸Šä¸‹é‚Šè· */
            z-index: 1000;                         /* å±¤ç´š */
            margin-top: 10px;                      /* å¢åŠ é ‚éƒ¨é‚Šè· */
        }

        /* å›ºå®šé ‚éƒ¨çš„æ™‚é–“é¡¯ç¤º */
        .sticky-header {
            position: -webkit-sticky !important;   /* Safariæ”¯æŒ */
            position: sticky !important;           /* é»æ€§å®šä½ */
            top: 0;                                /* è²¼é½Šé ‚éƒ¨ */
            background: var(--secondary-color);    /* ä½¿ç”¨æ¬¡èƒŒæ™¯è‰² */
            padding: 8px;                          /* å…§é‚Šè· */
            border-radius: 4px;                    /* åœ“è§’ */
            box-shadow: 0 2px 4px var(--shadow-color); /* é™°å½±æ•ˆæœ */
            animation: fadeIn 0.8s ease-out;       /* æ·¡å…¥å‹•ç•« */
            transition: all 0.3s ease;             /* éæ¸¡æ•ˆæœ */
            z-index: 999;                          /* å±¤ç´š */
            width: calc(100% - 16px);              /* å¯¬åº¦è€ƒæ…®å…§é‚Šè· */
            margin: 0 auto;                        /* å±…ä¸­ */
        }

        /* å›ºå®šç‹€æ…‹çš„æ¨£å¼ */
        .sticky-header.is-sticky {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); /* å¢å¼·é™°å½± */
            border-radius: 0 0 4px 4px;              /* åªä¿ç•™åº•éƒ¨åœ“è§’ */
            transform: translateY(0);                 /* é‡ç½®Yè»¸ä½ç½® */
        }

        /* æ™‚é–“é¡¯ç¤ºæ¨£å¼ */
        #timeDisplay {
            margin: 3px 0;                          /* ä¸Šä¸‹é‚Šè· */
            font-size: 15px;                        /* å­—é«”å¤§å° */
            background: var(--secondary-color);     /* èƒŒæ™¯è‰² */
            color: var(--text-color);               /* æ–‡å­—é¡è‰² */
            padding: 8px;                           /* å…§é‚Šè· */
            border-radius: 4px;                     /* åœ“è§’ */
            box-shadow: 0 2px 4px var(--shadow-color); /* é™°å½± */
            animation: fadeIn 0.8s ease-out;        /* æ·¡å…¥å‹•ç•« */
            transition: all 0.3s ease;              /* éæ¸¡æ•ˆæœ */
            position: relative;                     /* ç›¸å°å®šä½ */
            overflow: hidden;                       /* éš±è—æº¢å‡ºå…§å®¹ */
        }

        /* æ™‚é–“é¡¯ç¤ºæ‡¸åœæ•ˆæœ */
        #timeDisplay:hover {
            transform: scale(1.02);                 /* æ”¾å¤§æ•ˆæœ */
            box-shadow: 0 6px 12px var(--shadow-color); /* å¢å¼·é™°å½± */
        }

        /* æ™‚é–“é¡¯ç¤ºé ‚éƒ¨ç·šæ¢å‹•ç•« */
        #timeDisplay::before {
            content: '';                           /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                    /* çµ•å°å®šä½ */
            top: 0;                                /* è²¼é½Šé ‚éƒ¨ */
            left: -100%;                           /* åˆå§‹ä½ç½®åœ¨å·¦å¤–å´ */
            width: 100%;                           /* å¯¬åº¦100% */
            height: 2px;                           /* é«˜åº¦2px */
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent); /* æ¼¸è®ŠèƒŒæ™¯ */
            animation: timelineSlide 3s linear infinite; /* æ»‘å‹•å‹•ç•« */
        }

        /* æ™‚é–“ç·šæ»‘å‹•å‹•ç•« */
        @keyframes timelineSlide {
            0% { left: -100%; }                   /* é–‹å§‹æ™‚åœ¨å·¦å¤–å´ */
            100% { left: 100%; }                  /* çµæŸæ™‚åœ¨å³å¤–å´ */
        }

        /* æ™‚é–“æ¨™ç±¤æ¨£å¼ */
        .time-label {
            font-weight: bold;                     /* ç²—é«” */
            margin-right: 10px;                    /* å³å´é‚Šè· */
            color: var(--accent-color);            /* ä½¿ç”¨å¼·èª¿è‰² */
        }

        /* æ·¡å…¥å‹•ç•« */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); } /* é–‹å§‹æ™‚é€æ˜ä¸”ä¸‹ç§» */
            to { opacity: 1; transform: translateY(0); }      /* çµæŸæ™‚ä¸é€æ˜ä¸”å›åˆ°åŸä½ */
        }

        /* 1. æµå…‰åˆ†éš”ç·š */
        .divider-flow {
            position: relative;                    /* ç›¸å°å®šä½ */
            height: 2px;                           /* é«˜åº¦2px */
            background: linear-gradient(90deg, 
                var(--secondary-color) 0%,
                var(--accent-color) 50%,
                var(--secondary-color) 100%);      /* æ¼¸è®ŠèƒŒæ™¯ */
            margin: 4px 0;                         /* ä¸Šä¸‹é‚Šè· */
            overflow: hidden;                      /* éš±è—æº¢å‡ºå…§å®¹ */
            animation: dividerFadeIn 0.5s ease-out; /* æ·¡å…¥å‹•ç•« */
        }

        /* åˆ†éš”ç·šæµå…‰æ•ˆæœ */
        .divider-flow::after {
            content: '';                           /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                    /* çµ•å°å®šä½ */
            top: 0;                                /* è²¼é½Šé ‚éƒ¨ */
            left: -100%;                           /* åˆå§‹ä½ç½®åœ¨å·¦å¤–å´ */
            width: 100%;                           /* å¯¬åº¦100% */
            height: 100%;                          /* é«˜åº¦100% */
            background: linear-gradient(90deg,
                transparent,
                var(--accent-color),
                transparent);                      /* æ¼¸è®ŠèƒŒæ™¯ */
            animation: flowLight 3s ease-in-out infinite; /* æµå…‰å‹•ç•« */
        }

        /* æµå…‰å‹•ç•« */
        @keyframes flowLight {
            0% { transform: translateX(0); }       /* é–‹å§‹ä½ç½® */
            100% { transform: translateX(200%); }  /* çµæŸä½ç½® */
        }

        /* åˆ†éš”ç·šæ·¡å…¥å‹•ç•« */
        @keyframes dividerFadeIn {
            from {
                opacity: 0;                        /* é–‹å§‹æ™‚é€æ˜ */
                transform: scaleX(0.8);            /* é–‹å§‹æ™‚å¯¬åº¦ç‚º80% */
            }
            to {
                opacity: 1;                        /* çµæŸæ™‚ä¸é€æ˜ */
                transform: scaleX(1);              /* çµæŸæ™‚å¯¬åº¦ç‚º100% */
            }
        }

        /* è¼”åŠ©èªªæ˜æ–‡å­—æ¨£å¼ - ç”¨æ–¼æ¬„ä½å³å´çš„èªªæ˜æ–‡å­— */
        .helper-text {
            margin-left: 0px;                    /* å·¦å´é‚Šè· */
            color: var(--helper-text-color);     /* ä½¿ç”¨è®Šæ•¸æ§åˆ¶æ–‡å­—é¡è‰² */
            font-size: 16px;                     /* ä¿æŒåŸå§‹å­—é«”å¤§å° */
        }

        /* å¼·èª¿é‡è¦æ¬„ä½ */
        .emphasized-row {
            border-left: 3px solid var(--accent-color); /* å·¦å´é‚Šæ¡† */
            background: linear-gradient(90deg, var(--accent-color-light), transparent); /* æ¼¸è®ŠèƒŒæ™¯ */
            transform: scale(1.01);                /* ç¨å¾®æ”¾å¤§ */
            transition: all 0.3s ease;             /* éæ¸¡æ•ˆæœ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* é™°å½±æ•ˆæœ */
        }

        /* å¼·èª¿æ¬„ä½æ¨™ç±¤ */
        .emphasized-row .label {
            color: var(--accent-color);           /* ä½¿ç”¨å¼·èª¿è‰² */
            font-weight: 700;                     /* ç²—é«” */
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); /* æ–‡å­—é™°å½± */
        }

        /* å¼·èª¿æ¬„ä½è¼¸å…¥æ¡† */
        .emphasized-row input {
            font-weight: bold;                    /* ç²—é«” */
            color: #ffffff;                       /* ç™½è‰²æ–‡å­— */
            font-size: 17px;                      /* å­—é«”å¤§å° */
            border-color: var(--accent-color);    /* ä½¿ç”¨å¼·èª¿è‰²é‚Šæ¡† */
        }

        /* å¼·èª¿æ¬„ä½æ‡¸åœæ•ˆæœ */
        .emphasized-row:hover {
            transform: scale(1.02) translateX(5px); /* æ”¾å¤§ä¸¦å³ç§» */
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.25); /* å¢å¼·é™°å½± */
        }

        /* éš±è—å…ƒç´  */
        .hidden-element {
            display: none !important;             /* å¼·åˆ¶éš±è— */
            max-height: 0 !important;             /* é«˜åº¦ç‚º0 */
            opacity: 0 !important;                /* å®Œå…¨é€æ˜ */
            padding: 0 !important;                /* ç§»é™¤å…§é‚Šè· */
            margin: 0 !important;                 /* ç§»é™¤é‚Šè· */
            transition: all 0.3s ease-in-out;     /* éæ¸¡æ•ˆæœ */
            overflow: hidden !important;          /* éš±è—æº¢å‡ºå…§å®¹ */
        }

        /* é è…³è¨Šæ¯ */
        .footer-message {
            background-color: var(--primary-color); /* ä½¿ç”¨ä¸»èƒŒæ™¯è‰² */
            color: var(--text-color);              /* ä½¿ç”¨æ–‡å­—è‰² */
            padding: 15px;                         /* å…§é‚Šè· */
            text-align: center;                    /* æ–‡å­—å±…ä¸­ */
            margin-top: 15px;                      /* é ‚éƒ¨é‚Šè· */
            border-radius: 4px;                    /* åœ“è§’ */
            transform: scale(1.05);                /* ç¨å¾®æ”¾å¤§ */
            text-shadow: 0 0 10px var(--accent-color); /* æ–‡å­—é™°å½± */
            transition: all 0.3s ease;              /* éæ¸¡æ•ˆæœ */
            position: relative;                     /* ç›¸å°å®šä½ */
        }

        /* é è…³è¨Šæ¯å‰çš„emoji */
        .footer-message::before {
            content: 'ğŸš';                         /* é¡¯ç¤ºé£¯emoji */
            margin-right: 8px;                     /* å³å´é‚Šè· */
            display: inline-block;                 /* è¡Œå…§å¡Šé¡¯ç¤º */
            transition: transform 0.3s ease;        /* éæ¸¡æ•ˆæœ */
        }

        /* é è…³è¨Šæ¯æ‡¸åœæ™‚emojiæ—‹è½‰æ•ˆæœ */
        .footer-message:hover::before {
            transform: rotate(360deg);             /* æ—‹è½‰360åº¦ */
        }

        /* é è…³é–“è· */
        .footer-spacing {
            background-color: var(--primary-color); /* ä½¿ç”¨ä¸»èƒŒæ™¯è‰² */
            height: 50px;                          /* é«˜åº¦ */
            margin-top: 0px;                       /* é ‚éƒ¨é‚Šè· */
        }

        /* ============================================
        * 4. è¼¸å…¥å…ƒç´ èˆ‡è¡¨å–®
        * ============================================ */

        /* è¼¸å…¥æ¡†åŸºæœ¬æ¨£å¼ */
        input {
            width: 95px;                           /* å›ºå®šå¯¬åº¦ */
            padding: 5px var(--input-padding-lr);  /* å…§é‚Šè· - ä½¿ç”¨è®Šæ•¸æ§åˆ¶å·¦å³é–“è· */
            margin-right: 10px;                    /* å³å´é‚Šè· */
            background-color: var(--input-bg);     /* ä½¿ç”¨ä¸»é¡Œè¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            color: var(--text-color);              /* ä½¿ç”¨ä¸»é¡Œæ–‡å­—è‰² */
            border: 1px solid var(--border-color); /* é‚Šæ¡† */
            border-radius: 4px;                    /* åœ“è§’ */
            font-size: var(--input-font-size);     /* ä½¿ç”¨è®Šæ•¸æ§åˆ¶å­—é«”å¤§å° */
            transition: all 0.3s ease;             /* éæ¸¡æ•ˆæœ */
            text-align: right;                     /* æ–‡å­—é å³å°é½Š */
        }

        /* è¼¸å…¥æ¡†èšç„¦æ•ˆæœ */
        input:focus {
            outline: none;                         /* ç§»é™¤é è¨­ç„¦é»å¤–æ¡† */
            border-color: var(--accent-color);     /* ä½¿ç”¨å¼·èª¿è‰²é‚Šæ¡† */
            box-shadow: 0 0 0 3px var(--accent-color-light); /* æ·»åŠ äº®è‰²é™°å½± */
            transform: scale(1.07);                /* ç¨å¾®æ”¾å¤§ */
        }

        /* åªè®€è¼¸å…¥æ¡†æ¨£å¼ */
        .readonly {
            background-color: var(--input-bg);     /* ä½¿ç”¨ä¸»é¡Œè¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            animation: breathe 4s ease-in-out infinite; /* å‘¼å¸å‹•ç•« */
        }

        /* å‘¼å¸å‹•ç•« - é€æ˜åº¦è®ŠåŒ– */
        @keyframes breathe {
            0%, 100% { opacity: 1; }              /* é–‹å§‹å’ŒçµæŸæ™‚å®Œå…¨ä¸é€æ˜ */
            50% { opacity: 0.8; }                 /* ä¸­é–“æ™‚ç¨å¾®é€æ˜ */
        }

        /* å€¼è®ŠåŒ–å‹•ç•« */
        .value-changed {
            animation: valueChange 0.5s ease-out;  /* å€¼è®ŠåŒ–å‹•ç•« */
            will-change: background-color;         /* å„ªåŒ–æ¸²æŸ“æ€§èƒ½ */
        }

        /* å€¼è®ŠåŒ–å‹•ç•« - èƒŒæ™¯è‰²å’Œå¤§å°è®ŠåŒ– */
        @keyframes valueChange {
            0% { 
                background-color: var(--accent-color-light); /* åˆå§‹ç”¨å¼·èª¿è‰² */
                transform: scale(1.02);            /* ç¨å¾®æ”¾å¤§ */
            }
            100% { 
                background-color: transparent;     /* æ¢å¾©é€æ˜èƒŒæ™¯ */
                transform: scale(1);               /* æ¢å¾©åŸå§‹å¤§å° */
            }
        }

        /* è­¦å‘Šæ–‡å­—æ¨£å¼ */
        .warning-text {
            color: var(--error-color) !important;    /* ä½¿ç”¨éŒ¯èª¤è‰² */
            font-weight: bold !important;            /* ç²—é«” */
            animation: pulse 1s infinite, shake 0.5s ease-in-out; /* è„ˆå‹•å’Œéœ‡å‹•å‹•ç•« */
            will-change: transform;                  /* å„ªåŒ–æ¸²æŸ“æ€§èƒ½ */
        }

        /* éœ‡å‹•å‹•ç•« */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }   /* é–‹å§‹å’ŒçµæŸä½ç½® */
            20%, 60% { transform: translateX(-1px); } /* å‘å·¦ç§»å‹• */
            40%, 80% { transform: translateX(1px); }  /* å‘å³ç§»å‹• */
        }

        /* è„ˆå‹•å‹•ç•« - å®šç¾©å…ƒç´ çš„é€æ˜åº¦å’Œç¸®æ”¾è®ŠåŒ– */
        @keyframes pulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }   /* é–‹å§‹å’ŒçµæŸç‹€æ…‹ï¼šè¼•å¾®é€æ˜å’ŒåŸå§‹å¤§å° */
            50% { opacity: 1; transform: scale(1.1); }        /* ä¸­é–“ç‹€æ…‹ï¼šå®Œå…¨ä¸é€æ˜å’Œæ”¾å¤§10% */
        }

        /* è®“ã€Œç¨…ä½£å¾Œåˆ©ç‡ã€è¼¸å…¥æ¡†æ›´æ˜é¡¯ä½†ä¸çªå…€ */
        /* ç¨…ä½£å¾Œåˆ©ç‡è¼¸å…¥æ¡†æ¨£å¼ */
        #afterCommissionRate {
            font-weight: bold;                           /* ç²—é«” */
            color: #ffffff;                              /* ç™½è‰²æ–‡å­— */
            background-color: var(--accent-color-light); /* å¼·èª¿è‰²èƒŒæ™¯ */
            border: 1px solid rgba(var(--accent-color-rgb), 0.6); /* å¼·èª¿è‰²é‚Šæ¡† */
            box-shadow: 0 0 4px rgba(var(--accent-color-rgb), 0.15); /* é™°å½±æ•ˆæœ */
        }

        /* ç¨…ä½£å¾Œåˆ©ç‡è¼¸å…¥æ¡†å€¼è®ŠåŒ–å‹•ç•« */
        #afterCommissionRate.value-changed {
            animation: afterRateChange 0.8s ease-out;    /* è‡ªå®šç¾©å‹•ç•« */
        }

        /* è‡ªå®šç¾©å‹•ç•« - å®šç¾©ç¨…ä½£å¾Œåˆ©ç‡è®ŠåŒ–æ™‚çš„èƒŒæ™¯å’Œå¤§å°è®ŠåŒ– */
        @keyframes afterRateChange {
            0% { 
                background-color: rgba(255, 156, 51, 0.3); /* é–‹å§‹æ™‚è¼ƒå¼·çš„æ©™è‰²èƒŒæ™¯ */
                transform: scale(1.02);                   /* è¼•å¾®æ”¾å¤§ */
            }
            100% { 
                background-color: rgba(255, 156, 51, 0.08); /* çµæŸæ™‚è¼ƒæ·¡çš„æ©™è‰²èƒŒæ™¯ */
                transform: scale(1);                     /* æ¢å¾©åŸå§‹å¤§å° */
            }
        }

        /* æŒ‰éˆ•åŸºæœ¬æ¨£å¼ - æ‰€æœ‰åŸºæœ¬æŒ‰éˆ•çš„å…±åŒæ¨£å¼ */
        button {
            background-color: var(--secondary-color);    /* ä½¿ç”¨æ¬¡è¦èƒŒæ™¯è‰² */
            color: var(--text-color);                   /* ä½¿ç”¨ä¸»è¦æ–‡å­—é¡è‰² */
            border: 1px solid var(--border-color);      /* ä½¿ç”¨æ¨™æº–é‚Šæ¡†è‰² */
            padding: 3px 8px;                          /* å…§éƒ¨é–“è· */
            margin: 0 5px;                             /* å·¦å³å¤–éƒ¨é–“è· */
            border-radius: 4px;                        /* åœ“è§’æ•ˆæœ */
            cursor: pointer;                           /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* å¹³æ»‘éæ¸¡æ•ˆæœ */
            font-size: 16px;                           /* æ–‡å­—å¤§å° */
        }

        /* æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœåœ¨æŒ‰éˆ•ä¸Šçš„è¦–è¦ºè®ŠåŒ– */
        button:hover {
            background-color: var(--hover-color);      /* ä½¿ç”¨æ‡¸åœèƒŒæ™¯è‰² */
            transform: translateY(-2px);               /* ä¸Šç§»2åƒç´  */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);  /* å¢åŠ é™°å½±æ•ˆæœ */
        }

        /* æŒ‰éˆ•é»æ“Šæ•ˆæœ - é»æ“ŠæŒ‰éˆ•æ™‚çš„è¦–è¦ºåé¥‹ */
        button:active {
            transform: scale(0.95) translateY(1px);    /* ç¸®å°ä¸¦è¼•å¾®ä¸‹ç§» */
            transition: transform 0.1s;                /* åƒ…å°è®Šå½¢æ‡‰ç”¨å¿«é€Ÿéæ¸¡ */
        }

        /* è¡Œå®¹å™¨ä¸­çš„æŒ‰éˆ•æ¨£å¼ - èª¿æ•´åœ¨è¡Œå®¹å™¨å…§çš„æŒ‰éˆ•å¤–è§€ */
        .row button {
            background-color: var(--secondary-color);   /* ä½¿ç”¨æ¬¡è¦èƒŒæ™¯è‰² */
            color: #888888;                            /* ä½¿ç”¨æš—ç°è‰²æ–‡å­— */
            border: 1px solid #444444;                /* æ·±è‰²é‚Šæ¡† */
            padding: 3px 8px;                         /* å…§éƒ¨é–“è· */
            margin: 0 5px;                            /* å·¦å³å¤–éƒ¨é–“è· */
            border-radius: 4px;                       /* åœ“è§’æ•ˆæœ */
            cursor: pointer;                          /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: all 0.3s ease;                /* å¹³æ»‘éæ¸¡æ•ˆæœ */
            font-size: 15px;                          /* æ–‡å­—å¤§å° */
            opacity: 0.8;                             /* è¼•å¾®é€æ˜æ•ˆæœ */
        }

        /* ç‰¹å®šæŒ‰éˆ•çµ„å…§æŒ‰éˆ•çš„æ¨£å¼ - çµ±ä¸€å„ç¨®é¡å‹æŒ‰éˆ•çš„é¡¯ç¤º */
        #periodButtons button, 
        #rateButtons button, 
        #principalButtons button, 
        #commissionButtons button, 
        #PaymentduringButtons button,
        #commissionPercentButtons button {
            min-width: 50px;       /* æœ€å°å¯¬åº¦ */
            text-align: center;    /* æ–‡å­—å±…ä¸­ */
            flex: 1;               /* å¹³å‡åˆ†é…ç©ºé–“ */
            max-width: 80px;       /* æœ€å¤§å¯¬åº¦é™åˆ¶ */
            margin: 0 2px;         /* å·¦å³å¤–éƒ¨é–“è· */
            height: 28px;          /* å›ºå®šé«˜åº¦ */
            padding: 0 5px;        /* å…§éƒ¨é–“è· */
            display: flex;         /* ä½¿ç”¨å½ˆæ€§å¸ƒå±€ */
            align-items: center;   /* å‚ç›´å±…ä¸­ */
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
            white-space: nowrap;   /* é˜²æ­¢æ–‡å­—æ›è¡Œ */
            overflow: hidden;      /* éš±è—æº¢å‡ºå…§å®¹ */
            text-overflow: ellipsis; /* æ–‡å­—æº¢å‡ºæ™‚é¡¯ç¤ºçœç•¥è™Ÿ */
        }

        /* é‡å°æŒ‰éˆ•æ•¸é‡å¤šçš„å…©å€‹çµ„åˆ¥é€²è¡Œç‰¹æ®Šèª¿æ•´ - ç¢ºä¿å¸ƒå±€ç¾è§€ */
        #periodButtons button, 
        #rateButtons button {
            min-width: 35px;      /* æ¸›å°æœ€å°å¯¬åº¦ */
            max-width: 50px;      /* æ¸›å°æœ€å¤§å¯¬åº¦ */
            padding: 0 3px;       /* æ¸›å°å…§éƒ¨é–“è· */
            font-size: 15px;      /* ç¨å¾®æ¸›å°å­—é«”å¤§å° */
        }

        /* æ¸›å°é€™å…©å€‹æŒ‰éˆ•çµ„çš„æŒ‰éˆ•é–“è· - ä½¿æ›´å¤šæŒ‰éˆ•èƒ½é©æ‡‰å¯¬åº¦ */
        #periodButtons, 
        #rateButtons {
            gap: 2px;             /* æ¸›å°æŒ‰éˆ•ä¹‹é–“çš„é–“è· */
        }

        /* è¡Œå®¹å™¨ä¸­æŒ‰éˆ•çš„æ‡¸åœæ•ˆæœ - æä¾›è¦–è¦ºåé¥‹ */
        .row button:hover {
            background-color: #4a4a4a; /* ç¨å¾®äº®ä¸€é»çš„ç°è‰² */
            color: #cccccc;           /* äº®ä¸€é»çš„æ–‡å­—é¡è‰² */
            border-color: #555555;    /* äº®ä¸€é»çš„é‚Šæ¡†é¡è‰² */
            opacity: 0.9;             /* æé«˜ä¸é€æ˜åº¦ */
        }

        /* è¡Œå®¹å™¨ä¸­æŒ‰éˆ•çš„é»æ“Šæ•ˆæœ - é»æ“Šæ™‚çš„è¦–è¦ºåé¥‹ */
        .row button:active {
            background-color: var(--secondary-color);  /* æ¢å¾©åŸæœ¬èƒŒæ™¯é¡è‰² */
            color: var(--text-color);                 /* æ¢å¾©åŸæœ¬æ–‡å­—é¡è‰² */
            border-color: var(--button-grey);         /* ä½¿ç”¨ç°è‰²æŒ‰éˆ•é‚Šæ¡† */
        }

        /* è¡Œå®¹å™¨ä¸­æŒ‰éˆ•é»æ“Šå¾Œçš„æ³¢ç´‹æ•ˆæœ - å‰µå»ºé»æ“Šæ¼£æ¼ªæ•ˆæœ */
        .row button::after {
            content: '';                             /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                      /* çµ•å°å®šä½ */
            top: 50%;                               /* å¾ä¸­é–“é–‹å§‹ */
            left: 50%;                              /* å¾ä¸­é–“é–‹å§‹ */
            width: 0;                               /* åˆå§‹å¯¬åº¦ç‚º0 */
            height: 0;                              /* åˆå§‹é«˜åº¦ç‚º0 */
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%); /* æ¼¸è®ŠèƒŒæ™¯ */
            transition: width 0.3s ease-out, height 0.3s ease-out; /* å¹³æ»‘éæ¸¡æ•ˆæœ */
            transform: translate(-50%, -50%);       /* ç¢ºä¿å±…ä¸­ */
            border-radius: 50%;                     /* åœ“å½¢æ•ˆæœ */
        }

        /* è¡Œå®¹å™¨ä¸­æŒ‰éˆ•é»æ“Šæ™‚çš„æ³¢ç´‹å‹•ç•« - æ“´å±•æ¼£æ¼ªæ•ˆæœ */
        .row button:active::after {
            width: 150px;                          /* æ“´å±•å¯¬åº¦ */
            height: 150px;                         /* æ“´å±•é«˜åº¦ */
        }

        /* å°‡çµ„å…§çš„æŒ‰éµè¼•å¾®çªå‡ºé¡¯ç¤º - å¢åŠ è¦–è¦ºå±¤æ¬¡æ„Ÿ */
        .input-button-group div[id$="Buttons"] button {
            position: relative;                    /* ç›¸å°å®šä½ */
            z-index: 2;                           /* æé«˜å±¤ç´š */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15); /* è¼•å¾®é™°å½± */
        }

        /* æ”¹é€²æŒ‰éµé»æ“Šåé¥‹ - æä¾›æ›´æ˜é¡¯çš„é»æ“Šè¦–è¦ºæ•ˆæœ */
        .input-button-group div[id$="Buttons"] button:active {
            transform: scale(0.95);               /* ç¸®å°æ•ˆæœ */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); /* æ¸›å°é™°å½± */
            transition: transform 0.1s, box-shadow 0.1s; /* å¿«é€Ÿéæ¸¡æ•ˆæœ */
        }

        /* æ·»åŠ è¼•å¾®çš„æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„é‚Šæ¡†è®ŠåŒ– */
        .input-button-group div[id$="Buttons"] button:hover {
            border-color: var(--button-orange);   /* ä½¿ç”¨æ©™è‰²é‚Šæ¡† */
        }

        /* ç‰¹å®šIDçµå°¾çš„æŒ‰éˆ•çµ„æ¨£å¼ - ç‚ºé€™äº›æŒ‰éˆ•çµ„è¨­ç½®çµ±ä¸€æ¨£å¼ */
        div[id$="Buttons"] button {
            background-color: var(--secondary-color); /* ä½¿ç”¨æ¬¡è¦èƒŒæ™¯è‰² */
            color: #bcbcbc;                         /* äº®ç°è‰²æ–‡å­— */
            border: 1px solid var(--button-orange);  /* ä½¿ç”¨æ©™è‰²å¤–æ¡† */
            padding: 4px 9px;                       /* å…§éƒ¨é–“è· */
            margin: 0 4px;                          /* å·¦å³å¤–éƒ¨é–“è· */
            border-radius: 4px;                     /* åœ“è§’æ•ˆæœ */
            cursor: pointer;                        /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: all 0.3s ease;              /* å¹³æ»‘éæ¸¡æ•ˆæœ */
            font-size: 15px;                        /* æ–‡å­—å¤§å° */
            opacity: 0.95;                          /* è¼ƒé«˜ä¸é€æ˜åº¦ */
        }

        /* ç‰¹å®šIDçµå°¾çš„æŒ‰éˆ•çµ„æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        div[id$="Buttons"] button:hover {
            background-color: rgba(255, 156, 51, 0.15); /* æ·¡æ©˜è‰²èƒŒæ™¯ */
            color: #ffffff;                           /* ç™½è‰²æ–‡å­— */
            border-color: var(--button-orange);       /* æ©™è‰²é‚Šæ¡† */
            transform: translateY(-1px);              /* è¼•å¾®ä¸Šç§» */
            box-shadow: 0 2px 4px rgba(255, 156, 51, 0.2); /* æ©™è‰²é™°å½± */
        }

        /* ç‰¹å®šIDçµå°¾çš„æŒ‰éˆ•çµ„é»æ“Šæ•ˆæœ - é»æ“Šæ™‚çš„è¦–è¦ºåé¥‹ */
        div[id$="Buttons"] button:active {
            transform: translateY(1px);              /* è¼•å¾®ä¸‹ç§» */
            background-color: rgba(255, 156, 51, 0.3); /* è¼ƒæ·±æ©™è‰²èƒŒæ™¯ */
            box-shadow: 0 0 5px rgba(255, 156, 51, 0.5) inset; /* å…§é™°å½±æ•ˆæœ */
            transition: all 0.1s ease;               /* å¿«é€Ÿéæ¸¡æ•ˆæœ */
        }

        /* æ·»åŠ æ»šåŠ¨æ—¶çš„æ•ˆæœ - é ­éƒ¨å›ºå®šå€åŸŸæ¨£å¼ */
        .sticky-header.is-sticky {
            border-radius: 0 0 4px 4px;              /* åº•éƒ¨åœ“è§’ */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); /* å¢å¼·é™°å½± */
            transform: translateY(0);                /* é‡ç½®Yè»¸ä½ç½® */
        }

        /* å„ç¨®æŒ‰éˆ•çµ„çš„å¸ƒå±€ - å‰µå»ºå½ˆæ€§å¸ƒå±€å®¹å™¨ */
        #periodButtons, #rateButtons, #principalButtons, #commissionButtons, #PaymentduringButtons, #commissionPercentButtons {
            margin: 0;                              /* ç§»é™¤å¤–éƒ¨é–“è· */
            display: flex;                          /* ä½¿ç”¨å½ˆæ€§å¸ƒå±€ */
            flex-wrap: wrap;                        /* å…è¨±æ›è¡Œ */
            gap: 3px;                               /* é …ç›®é–“è· */
            width: 100%;                            /* å æ»¿å®¹å™¨å¯¬åº¦ */
            justify-content: center;                /* æ°´å¹³å±…ä¸­ */
            padding: 0 5px;                         /* å·¦å³å…§éƒ¨é–“è· */
            box-sizing: border-box;                 /* ç›’æ¨¡å‹è¨ˆç®—æ–¹å¼ */
            min-height: 32px;                       /* æœ€å°é«˜åº¦ */
            align-items: center;                    /* å‚ç›´å±…ä¸­ */
        }

        /* æŒ‰éˆ•åŸºæœ¬ç‰¹æ€§ - é˜²æ­¢æŒ‰éˆ•åœ¨å½ˆæ€§å¸ƒå±€ä¸­è¢«æ‹‰ä¼¸ */
        button {
            flex-shrink: 0;                         /* ç¦æ­¢æŒ‰éˆ•ç¸®å° */
        }

        /* æ–°çš„æŒ‰éˆ•çµ„æ¨£å¼ - åŠŸèƒ½æŒ‰éˆ•çµ„çš„å®¹å™¨ */
        .function-buttons {
            display: flex;                          /* ä½¿ç”¨å½ˆæ€§å¸ƒå±€ */
            flex-direction: column;                 /* å‚ç›´æ’åˆ— */
            gap: 4px;                               /* é …ç›®é–“è· */
            margin: 4px 0;                          /* ä¸Šä¸‹å¤–éƒ¨é–“è· */
            padding: 0;                             /* ç§»é™¤å…§éƒ¨é–“è· */
            width: 100%;                            /* å æ»¿å®¹å™¨å¯¬åº¦ */
        }

        /* åŠŸèƒ½æŒ‰éˆ•è¡Œå®¹å™¨ - æ°´å¹³æ’åˆ—çš„æŒ‰éˆ• */
        .function-buttons .button-row {
            display: flex;                          /* ä½¿ç”¨å½ˆæ€§å¸ƒå±€ */
            justify-content: space-between;         /* å…©ç«¯å°é½Š */
            gap: 4px;                               /* æ¸›å°æŒ‰éˆ•é–“è· */
            width: 100%;                            /* å æ»¿å®¹å™¨å¯¬åº¦ */
        }

        /* èª¿æ•´é ‚éƒ¨æŒ‰éˆ•çµ„ - é ‚éƒ¨åŠŸèƒ½æŒ‰éˆ•çš„å¸ƒå±€ */
        .top-buttons .button-row button {
            flex: 1;                                /* å¹³å‡åˆ†é…ç©ºé–“ */
            min-width: 0;                           /* å…è¨±æŒ‰éˆ•è®Šçª„ */
        }

        /* èª¿æ•´åº•éƒ¨æŒ‰éˆ•çµ„ - åº•éƒ¨åŠŸèƒ½æŒ‰éˆ•çš„å¸ƒå±€ */
        .bottom-buttons .button-row button {
            flex: 1;                                /* å¹³å‡åˆ†é…ç©ºé–“ */
            min-width: 0;                           /* å…è¨±æŒ‰éˆ•è®Šçª„ */
        }

        /* åŠŸèƒ½æŒ‰éˆ•ä¸Šä¸‹è¡Œæ¨£å¼ - ç¢ºä¿çµ±ä¸€å¸ƒå±€ */
        .function-buttons .top-row,
        .function-buttons .bottom-row {
            display: flex;                          /* ä½¿ç”¨å½ˆæ€§å¸ƒå±€ */
            justify-content: space-between;         /* å…©ç«¯å°é½Š */
            gap: 10px;                              /* é …ç›®é–“è· */
        }

        /* é ‚éƒ¨è¡ŒæŒ‰éˆ•æ¨£å¼ - ç¢ºä¿æŒ‰éˆ•å¹³å‡åˆ†å¸ƒ */
        .function-buttons .top-row button {
            flex: 1;                                /* å¹³å‡åˆ†é…ç©ºé–“ */
            min-width: 0;                           /* å…è¨±æŒ‰éˆ•è®Šçª„ */
            margin: 0;                              /* ç§»é™¤å¤–éƒ¨é–“è· */
        }

        /* åº•éƒ¨è¡ŒæŒ‰éˆ•æ¨£å¼ - ç¢ºä¿æŒ‰éˆ•å¹³å‡åˆ†å¸ƒ */
        .function-buttons .bottom-row button {
            flex: 1;                                /* å¹³å‡åˆ†é…ç©ºé–“ */
            min-width: 0;                           /* å…è¨±æŒ‰éˆ•è®Šçª„ */
            margin: 0;                              /* ç§»é™¤å¤–éƒ¨é–“è· */
        }

        /* çµ±ä¸€æ‰€æœ‰åŠŸèƒ½æŒ‰éˆ•çš„åŸºç¤æ¨£å¼ - å‰µå»ºè¦–è¦ºä¸€è‡´çš„æŒ‰éˆ• */
        .function-buttons button {
            background-color: var(--secondary-color); /* ä½¿ç”¨æ¬¡è¦èƒŒæ™¯è‰² */
            color: #ffffff;                         /* ç™½è‰²æ–‡å­— */
            border: 1px solid var(--button-orange);  /* æ©™è‰²é‚Šæ¡† */
            border-radius: 6px;                     /* åœ“è§’æ•ˆæœ */
            padding: 8px 0;                         /* ä¸Šä¸‹å…§éƒ¨é–“è· */
            font-size: 16px;                        /* æ–‡å­—å¤§å° */
            font-weight: 600;                       /* æ–‡å­—ç²—ç´° */
            cursor: pointer;                        /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* å¹³æ»‘éæ¸¡æ•ˆæœ */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* é™°å½±æ•ˆæœ */
            text-align: center;                     /* æ–‡å­—å±…ä¸­ */
            position: relative;                     /* ç›¸å°å®šä½ */
            overflow: hidden;                      /* éš±è—æº¢å‡ºå…§å®¹ */
            flex: 1;                                /* å¹³å‡åˆ†é…ç©ºé–“ */
            min-width: 0;                           /* å…è¨±æŒ‰éˆ•è®Šçª„ */
            margin: 0;                              /* ç§»é™¤å¤–éƒ¨é–“è· */
        }

        /* åŠŸèƒ½æŒ‰éˆ•å½å…ƒç´  - å‰µå»ºæ‡¸åœæ™‚çš„æ¼¸è®Šæ•ˆæœ */
        .function-buttons button::before {
            content: '';                            /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                     /* çµ•å°å®šä½ */
            top: 0;                                /* å¾é ‚éƒ¨é–‹å§‹ */
            left: 0;                               /* å¾å·¦å´é–‹å§‹ */
            width: 100%;                           /* å¯¬åº¦100% */
            height: 100%;                          /* é«˜åº¦100% */
            background: linear-gradient(to right, rgba(255, 156, 51, 0.1), transparent); /* æ¼¸è®ŠèƒŒæ™¯ */
            z-index: -1;                           /* ç½®æ–¼æŒ‰éˆ•ä¸‹å±¤ */
            transform: translateX(-100%);          /* åˆå§‹ä½ç½®åœ¨å·¦å´å¤– */
            transition: transform 0.6s ease;       /* å¹³æ»‘éæ¸¡æ•ˆæœ */
        }

        /* çµ±ä¸€æ‰€æœ‰æŒ‰éˆ•çš„æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .function-buttons button:hover {
            background-color: var(--button-orange); /* æ©™è‰²èƒŒæ™¯ */
            color: #ffffff;                        /* ç™½è‰²æ–‡å­— */
            transform: translateY(-2px);           /* ä¸Šç§»æ•ˆæœ */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* å¢å¼·é™°å½± */
        }

        /* åŠŸèƒ½æŒ‰éˆ•æ‡¸åœæ™‚å½å…ƒç´ æ•ˆæœ - é¡¯ç¤ºæ»‘å…¥æ•ˆæœ */
        .function-buttons button:hover::before {
            transform: translateX(0);              /* æ»‘å…¥è‡³å¯è¦‹å€åŸŸ */
        }

        /* çµ±ä¸€æ‰€æœ‰æŒ‰éˆ•çš„é»æ“Šæ•ˆæœ - æŒ‰ä¸‹æ™‚çš„è¦–è¦ºåé¥‹ */
        .function-buttons button:active {
            transform: translateY(1px);            /* ä¸‹ç§»æ•ˆæœ */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); /* æ¸›å¼±é™°å½± */
            transition: all 0.1s;                  /* å¿«é€Ÿéæ¸¡æ•ˆæœ */
        }

        /* ä¸»è¦æ“ä½œæŒ‰éˆ•æ¨£å¼ - èˆ‡ä¸€èˆ¬åŠŸèƒ½æŒ‰éˆ•ä¸€è‡´ */
        .function-buttons .main-action-btn {
            background-color: var(--secondary-color); /* ä½¿ç”¨æ¬¡è¦èƒŒæ™¯è‰² */
            color: #ffffff;                        /* ç™½è‰²æ–‡å­— */
            padding: 8px 0;                        /* ä¸Šä¸‹å…§éƒ¨é–“è· */
            border: 1px solid var(--button-orange); /* æ©™è‰²é‚Šæ¡† */
        }

        /* ä¸»è¦æ“ä½œæŒ‰éˆ•å½å…ƒç´  - é™ä½æ¼¸è®Šäº®åº¦ */
        .function-buttons .main-action-btn::before {
            background: linear-gradient(to right, rgba(255, 255, 255, 0.05), transparent); /* è¼ƒæ·¡çš„æ¼¸è®Š */
        }

        /* ä¸»è¦æ“ä½œæŒ‰éˆ•æ‡¸åœæ•ˆæœ - æ›´æ˜é¡¯çš„æ‡¸åœæ¨£å¼ */
        .function-buttons .main-action-btn:hover {
            background-color: var(--button-orange); /* æ©™è‰²èƒŒæ™¯ */
            box-shadow: 0 7px 14px rgba(255, 156, 51, 0.4); /* æ©™è‰²é™°å½± */
            transform: translateY(-3px);           /* æ›´æ˜é¡¯çš„ä¸Šç§» */
        }

        /* ä¸»è¦æ“ä½œæŒ‰éˆ•é»æ“Šæ•ˆæœ - æŒ‰ä¸‹æ™‚çš„è¦–è¦ºåé¥‹ */
        .function-buttons .main-action-btn:active {
            transform: translateY(1px);            /* ä¸‹ç§»æ•ˆæœ */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* è¼•å¾®é™°å½± */
        }

        /* å ±åƒ¹è¡¨æ ¼æ¨£å¼ - é¡¯ç¤ºè¨ˆç®—çµæœçš„è¡¨æ ¼ */
        .quote-table {
            width: 100%;                           /* å æ»¿å®¹å™¨å¯¬åº¦ */
            border-collapse: separate;             /* åˆ†é›¢é‚Šæ¡†æ¨¡å‹ */
            border-spacing: 0;                     /* å–®å…ƒæ ¼é–“è· */
            margin: 10px 0;                        /* ä¸Šä¸‹å¤–éƒ¨é–“è· */
            background: var(--primary-color);      /* ä½¿ç”¨ä¸»èƒŒæ™¯è‰² */
            border-radius: 12px;                   /* åœ“è§’æ•ˆæœ */
            overflow: hidden;                      /* éš±è—æº¢å‡ºå…§å®¹ */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4); /* æ·±è‰²é™°å½± */
        }

        /* å ±åƒ¹è¡¨æ ¼è¡Œæ¨£å¼ - è¡¨æ ¼è¡Œçš„èƒŒæ™¯èˆ‡éæ¸¡æ•ˆæœ */
        .quote-table tr {
            background: var(--secondary-color);    /* ä½¿ç”¨æ¬¡è¦èƒŒæ™¯è‰² */
            transition: background-color 0.3s ease; /* èƒŒæ™¯è‰²éæ¸¡æ•ˆæœ */
        }

        /* å ±åƒ¹è¡¨æ ¼è¡Œæ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„èƒŒæ™¯è®ŠåŒ– */
        .quote-table tr:hover {
            background: var(--hover-color);        /* ä½¿ç”¨æ‡¸åœèƒŒæ™¯è‰² */
        }

        /* å ±åƒ¹è¡¨æ ¼å–®å…ƒæ ¼æ¨£å¼ - èª¿æ•´å–®å…ƒæ ¼å…§éƒ¨é–“è·èˆ‡å¤–è§€ */
        .quote-table td {
            padding: 10px 10px;                    /* å…§éƒ¨é–“è· */
            border-bottom: 1px solid var(--border-color); /* åº•éƒ¨é‚Šæ¡† */
            color: var(--text-color);              /* ä½¿ç”¨æ–‡å­—é¡è‰² */
            font-size: 16px;                       /* æ–‡å­—å¤§å° */
            line-height: 1.2;                      /* è¡Œé«˜ */
        }

        /* å ±åƒ¹è¡¨æ ¼ç¬¬ä¸€åˆ—å–®å…ƒæ ¼æ¨£å¼ - æ¨™ç±¤åˆ—çš„æ ¼å¼ */
        .quote-table td:first-child {
            width: 140px;                          /* å›ºå®šå¯¬åº¦ */
            white-space: nowrap;                   /* ç¦æ­¢æ›è¡Œ */
            color: var(--button-orange);           /* æ©™è‰²æ–‡å­— */
            font-weight: 700;                      /* æ–‡å­—ç²—ç´° */
            text-align: right;                     /* æ–‡å­—å³å°é½Š */
            padding-right: 10px;                   /* å³å´å…§éƒ¨é–“è· */
            font-size: 16px;                       /* æ–‡å­—å¤§å° */
        }

        /* å ±åƒ¹è¡¨æ ¼æœ€å¾Œä¸€åˆ—å–®å…ƒæ ¼æ¨£å¼ - æ•¸å€¼åˆ—çš„æ ¼å¼ */
        .quote-table td:last-child {
            text-align: right;                     /* æ–‡å­—å³å°é½Š */
            font-family: monospace;                /* ç­‰å¯¬å­—é«” */
            font-size: 16px;                       /* æ–‡å­—å¤§å° */
            letter-spacing: 0px;                   /* å­—ç¬¦é–“è· */
        }

        /* å ±åƒ¹å®¹å™¨æ¨£å¼ - åŒ…å«å ±åƒ¹è¡¨æ ¼çš„å®¹å™¨ */
        #quoteContainer {
            padding: 24px;                         /* å…§éƒ¨é–“è· */
            background: #333333;                   /* æ·±ç°èƒŒæ™¯ */
            border-radius: 16px;                   /* åœ“è§’æ•ˆæœ */
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5); /* æ·±è‰²é™°å½± */
            margin: 20px;                          /* å¤–éƒ¨é–“è· */
        }

        /* åŠŸèƒ½æŒ‰éˆ•å½å…ƒç´  - å‰µå»ºç™¼å…‰é‚Šæ¡†æ•ˆæœ */
        .function-buttons button::before {
            content: '';                           /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                    /* çµ•å°å®šä½ */
            top: -2px;                            /* å‘ä¸Šå»¶ä¼¸ */
            left: -2px;                           /* å‘å·¦å»¶ä¼¸ */
            right: -2px;                          /* å‘å³å»¶ä¼¸ */
            bottom: -2px;                         /* å‘ä¸‹å»¶ä¼¸ */
            background: var(--button-orange);      /* æ©™è‰²èƒŒæ™¯ */
            z-index: -1;                          /* ç½®æ–¼æŒ‰éˆ•ä¸‹å±¤ */
            border-radius: 6px;                   /* åœ“è§’æ•ˆæœ */
            opacity: 0;                           /* åˆå§‹é€æ˜ */
            transition: opacity 0.3s;             /* é€æ˜åº¦éæ¸¡æ•ˆæœ */
        }

        /* åŠŸèƒ½æŒ‰éˆ•æ‡¸åœæ™‚å½å…ƒç´ æ•ˆæœ - é¡¯ç¤ºè„ˆå‹•ç™¼å…‰ */
        .function-buttons button:hover::before {
            opacity: 0.2;                         /* åŠé€æ˜æ•ˆæœ */
            animation: pulseGlow 1.5s infinite;   /* è„ˆå‹•ç™¼å…‰å‹•ç•« */
        }

        /* è„ˆå‹•ç™¼å…‰å‹•ç•« - å®šç¾©æŒ‰éˆ•èƒŒæ™¯çš„è„ˆå‹•æ•ˆæœ */
        @keyframes pulseGlow {
            0% { transform: scale(1); opacity: 0.2; }     /* åˆå§‹ç‹€æ…‹ */
            50% { transform: scale(1.05); opacity: 0.3; } /* æ”¾å¤§ä¸¦å¢åŠ ä¸é€æ˜åº¦ */
            100% { transform: scale(1); opacity: 0.2; }   /* è¿”å›åˆå§‹ç‹€æ…‹ */
        }

        /* åŠŸèƒ½æŒ‰éˆ•é»æ“Šå¾Œæ•ˆæœ - å‰µå»ºé»æ“Šæ³¢ç´‹æ•ˆæœ */
        .function-buttons button::after {
            content: '';                          /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                   /* çµ•å°å®šä½ */
            top: 50%;                            /* å¾ä¸­å¿ƒé–‹å§‹ */
            left: 50%;                           /* å¾ä¸­å¿ƒé–‹å§‹ */
            width: 100%;                         /* åˆå§‹å¯¬åº¦ */
            height: 100%;                        /* åˆå§‹é«˜åº¦ */
            background: rgba(255, 255, 255, 0.1); /* ç™½è‰²åŠé€æ˜èƒŒæ™¯ */
            transform: translate(-50%, -50%) scale(0); /* åˆå§‹ç¸®æ”¾ç‚º0 */
            border-radius: 50%;                  /* åœ“å½¢æ•ˆæœ */
            transition: transform 0.5s;          /* è®Šå½¢éæ¸¡æ•ˆæœ */
        }

        /* åŠŸèƒ½æŒ‰éˆ•æ‡¸åœæ•ˆæœ - æ”¹è®ŠæŒ‰éˆ•é¡è‰²å’Œæ–‡å­— */
        .function-buttons button:hover {
            background-color: var(--button-orange); /* æ©™è‰²èƒŒæ™¯ */
            color: var(--text-color);               /* ä½¿ç”¨ä¸»è¦æ–‡å­—é¡è‰² */
            border-color: var(--button-orange);     /* æ©™è‰²é‚Šæ¡† */
        }

        /* åŠŸèƒ½æŒ‰éˆ•æ‡¸åœæ™‚å¾Œæ•ˆæœçš„å‹•ç•« - æ“´å¤§æ³¢ç´‹æ•ˆæœ */
        .function-buttons button:hover::after {
            transform: translate(-50%, -50%) scale(2); /* æ”¾å¤§æ³¢ç´‹è‡³2å€ */
        }

        /* åŠŸèƒ½æŒ‰éˆ•é»æ“Šæ•ˆæœ - é»æ“Šæ™‚çš„é¡è‰²è®ŠåŒ– */
        .function-buttons button:active {
            background-color: var(--secondary-color); /* æ¢å¾©æ¬¡è¦èƒŒæ™¯è‰² */
            color: var(--button-orange);             /* æ©™è‰²æ–‡å­— */
            border-color: var(--button-orange);      /* æ©™è‰²é‚Šæ¡† */
        }

        /* ç™¼å…‰é‚Šæ¡†å‹•ç•« - å‰µå»ºè„ˆå‹•çš„ç™¼å…‰é‚Šæ¡†æ•ˆæœ */
        @keyframes glowBorder {
            0%, 100% { box-shadow: 0 0 5px var(--accent-color); }        /* åˆå§‹å’ŒçµæŸç‹€æ…‹çš„é™°å½± */
            50% { box-shadow: 0 0 15px var(--accent-color), 0 0 30px rgba(var(--accent-color-rgb), 0.3); } /* ä¸­é–“ç‹€æ…‹çš„å¢å¼·é™°å½± */
        }

        /* ç™¼å…‰æ•ˆæœå‹•ç•« - æ§åˆ¶åˆ†éš”ç·šä¸­çš„æµå…‰æ•ˆæœ */
        @keyframes dividerGlow {
            0% {
                left: -100%;      /* é–‹å§‹åœ¨å·¦å´å¤–éƒ¨ */
            }
            50% {
                left: 100%;       /* ä¸­é–“ç§»å‹•åˆ°å³å´ */
            }
            100% {
                left: 100%;       /* çµæŸæ–¼å³å´ */
            }
        }

        /* æ­·å²è¨˜éŒ„é¢æ¿æ¨£å¼ - é¡¯ç¤ºä¿å­˜çš„è²¸æ¬¾è¨˜éŒ„ */
        .history-panel {
            display: none;                                        /* åˆå§‹éš±è— */
            position: fixed;                                      /* å›ºå®šå®šä½ */
            top: 0;                                              /* è²¼é½Šé ‚éƒ¨ */
            left: 0;                                             /* è²¼é½Šå·¦å´ */
            width: 100%;                                         /* å¯¬åº¦100% */
            height: 100%;                                        /* é«˜åº¦100% */
            background-color: rgba(var(--primary-color-rgb), 0.95); /* åŠé€æ˜èƒŒæ™¯ */
            z-index: 1200;                                       /* æé«˜å±¤ç´šï¼Œé«˜æ–¼header */
            overflow-y: auto;                                    /* å‚ç›´æ»¾å‹• */
            animation: fadeIn 0.3s ease-out;                     /* æ·¡å…¥å‹•ç•« */
            padding-top: 0;                                      /* ç§»é™¤é ‚éƒ¨å…§é‚Šè· */
        }

        /* æ­·å²è¨˜éŒ„é¢æ¿é ­éƒ¨æ¨£å¼ - åŒ…å«æ¨™é¡Œå’ŒæŒ‰éˆ•çš„é ‚éƒ¨å€åŸŸ */
        .history-header {
            display: flex;                                       /* å½ˆæ€§å¸ƒå±€ */
            justify-content: space-between;                      /* å…©ç«¯å°é½Š */
            align-items: center;                                 /* å‚ç›´å±…ä¸­ */
            padding: 15px;                                       /* å…§éƒ¨é–“è· */
            background-color: var(--primary-color);              /* ä¸»èƒŒæ™¯è‰² */
            position: sticky;                                    /* ç²˜æ€§å®šä½ */
            top: 0;                                             /* è²¼é½Šé ‚éƒ¨ */
            z-index: 1201;                                      /* æé«˜å±¤ç´š */
            border-bottom: 2px solid var(--accent-color);        /* åº•éƒ¨é‚Šæ¡† */
            box-shadow: 0 2px 10px var(--shadow_color);          /* é™°å½±æ•ˆæœ */
            margin-top: 0;                                       /* ç¢ºä¿è²¼é½Šé ‚éƒ¨ */
        }

        /* æ­·å²è¨˜éŒ„é¢æ¿é ­éƒ¨å·¦å´å€åŸŸ - ç”¨æ–¼æ¨™é¡Œ */
        .header-left {
            flex: 1;                                            /* ä½”ç”¨å‰©é¤˜ç©ºé–“ */
        }

        /* æ­·å²è¨˜éŒ„é¢æ¿é ­éƒ¨å³å´å€åŸŸ - ç”¨æ–¼åŠŸèƒ½æŒ‰éˆ• */
        .header-right {
            margin-right: 10px;                                 /* å³å´å¤–éƒ¨é–“è· */
        }

        /* æ­·å²è¨˜éŒ„é¢æ¿æ¨™é¡Œæ¨£å¼ - é ‚éƒ¨æ¨™é¡Œæ–‡å­— */
        .history-header h2 {
            margin: 0;                                          /* ç§»é™¤å¤–éƒ¨é–“è· */
            color: var(--accent-color);                         /* å¼·èª¿è‰²æ–‡å­— */
            font-size: 20px;                                    /* æ–‡å­—å¤§å° */
            text-shadow: 0 1px 2px var(--shadow-color);         /* æ–‡å­—é™°å½± */
        }

        /* é—œé–‰æŒ‰éˆ•æ¨£å¼ - ç”¨æ–¼é—œé–‰æ¨¡æ…‹æ¡† */
        .close-btn {
            background: none;                                   /* ç„¡èƒŒæ™¯ */
            border: none;                                       /* ç„¡é‚Šæ¡† */
            color: var(--text-color);                           /* æ–‡å­—é¡è‰² */
            font-size: 28px;                                    /* æ–‡å­—å¤§å° */
            cursor: pointer;                                    /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: color 0.3s ease;                        /* åªéæ¸¡é¡è‰² */
            padding: 0;                                         /* ç§»é™¤å…§éƒ¨é–“è· */
            margin-left: 10px;                                  /* å·¦å´å¤–éƒ¨é–“è· */
            line-height: 1;                                     /* è¡Œé«˜è¨­ç‚º1 */
            width: auto;                                        /* è‡ªå‹•å¯¬åº¦ */
            height: auto;                                       /* è‡ªå‹•é«˜åº¦ */
        }

        /* é—œé–‰æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .close-btn:hover {
            color: var(--accent-color);                         /* å¼·èª¿è‰²æ–‡å­— */
        }

        /* æ­·å²è¨˜éŒ„å…§å®¹å€åŸŸ - é¡¯ç¤ºæ­·å²è¨˜éŒ„åˆ—è¡¨çš„å®¹å™¨ */
        .history-content {
            padding: 8px;                                       /* å…§éƒ¨é–“è· */
            max-width: 400px;                                   /* æœ€å¤§å¯¬åº¦ */
            margin: 0 auto;                                     /* æ°´å¹³å±…ä¸­ */
            padding-top: 20px;                                  /* å¢åŠ é ‚éƒ¨é–“è· */
        }

        /* æ­·å²è¨˜éŒ„åˆ—è¡¨æ¨£å¼ - æ‰€æœ‰æ­·å²è¨˜éŒ„é …ç›®çš„å®¹å™¨ */
        .history-list {
            display: flex;                                      /* å½ˆæ€§å¸ƒå±€ */
            flex-direction: column;                             /* å‚ç›´æ’åˆ— */
            gap: 10px;                                          /* é …ç›®é–“è· */
            padding: 3px;                                       /* å…§éƒ¨é–“è· */
            margin-bottom: 10px;                                /* åº•éƒ¨å¤–éƒ¨é–“è· */
        }

        /* æ­·å²è¨˜éŒ„é …ç›®æ¨£å¼ - å–®å€‹æ­·å²è¨˜éŒ„çš„å¡ç‰‡ */
        .history-item {
            background-color: var(--secondary-color);           /* æ¬¡è¦èƒŒæ™¯è‰² */
            padding: 8px;                                       /* å…§éƒ¨é–“è· */
            border-radius: 8px;                                 /* åœ“è§’æ•ˆæœ */
            position: relative;                                 /* ç›¸å°å®šä½ */
            transition: all 0.3s ease;                          /* éæ¸¡æ•ˆæœ */
            border-left: 3px solid var(--accent-color);         /* å·¦å´é‚Šæ¡† */
            display: flex;                                      /* å½ˆæ€§å¸ƒå±€ */
            flex-direction: column;                             /* å‚ç›´æ’åˆ— */
            gap: 6px;                                           /* é …ç›®é–“è· */
            box-shadow: 0 2px 4px var(--shadow-color);          /* é™°å½±æ•ˆæœ */
            margin-bottom: 10px;                                /* åº•éƒ¨å¤–éƒ¨é–“è· */
        }

        /* æ­·å²è¨˜éŒ„é …ç›®æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .history-item:hover {
            transform: translateX(5px);                         /* å³ç§»æ•ˆæœ */
            box-shadow: 0 5px 15px var(--shadow-color);         /* å¢å¼·é™°å½± */
        }

        /* æ­·å²è¨˜éŒ„é …ç›®é ­éƒ¨å€åŸŸ - é¡¯ç¤ºæ—¥æœŸå’Œç¨…ä½£å¾Œåˆ©ç‡ */
        .history-item-header {
            display: flex;                                      /* å½ˆæ€§å¸ƒå±€ */
            justify-content: space-between;                     /* å…©ç«¯å°é½Š */
            align-items: center;                                /* å‚ç›´å±…ä¸­ */
            width: 100%;                                        /* å¯¬åº¦100% */
            padding-bottom: 2px;                                /* åº•éƒ¨å…§éƒ¨é–“è· */
        }

        /* æ­·å²è¨˜éŒ„æ—¥æœŸæ¨£å¼ - é¡¯ç¤ºè¨˜éŒ„ä¿å­˜çš„æ—¥æœŸ */
        .history-date {
            font-weight: bold;                                  /* æ–‡å­—ç²—ç´° */
            color: var(--accent-color);                         /* å¼·èª¿è‰²æ–‡å­— */
            font-size: 14px;                                    /* æ–‡å­—å¤§å° */
            padding: 2px 0;                                     /* ä¸Šä¸‹å…§éƒ¨é–“è· */
            margin-left: 5px;                                   /* æ·»åŠ å·¦å´é–“è·ï¼Œé€²ä¸€æ­¥åˆ†éš”å‹¾é¸æ¡†å’Œæ—¥æœŸ */
        }

        /* ç¨…ä½£å¾Œåˆ©ç‡æ¨£å¼ - åœ¨æ­·å²è¨˜éŒ„é ­éƒ¨é¡¯ç¤ºçš„åˆ©ç‡ */
        .history-header-rate {
            font-weight: bold;                                  /* æ–‡å­—ç²—ç´° */
            color: var(--text-color);                           /* æ–‡å­—é¡è‰² */
            font-size: 16px;                                    /* æ–‡å­—å¤§å° */
            background-color: var(--accent-color-light);        /* æ·¡è‰²å¼·èª¿èƒŒæ™¯ */
            padding: 2px 6px;                                   /* å…§éƒ¨é–“è· */
            border-radius: 4px;                                 /* åœ“è§’æ•ˆæœ */
        }

        /* æ­·å²è©³æƒ…é¡¯ç¤ºå€ - é¡¯ç¤ºè²¸æ¬¾åƒæ•¸çš„ç¶²æ ¼å¸ƒå±€ */
        .history-details {
            display: grid;                                      /* ç¶²æ ¼å¸ƒå±€ */
            grid-template-columns: repeat(2, 1fr);              /* å…©åˆ—ç­‰å¯¬ */
            gap: 6px;                                           /* ç¶²æ ¼é–“è· */
            background-color: rgba(var(--primary-color-rgb), 0.15); /* åŠé€æ˜èƒŒæ™¯ */
            padding: 6px;                                       /* å…§éƒ¨é–“è· */
            border-radius: 4px;                                 /* åœ“è§’æ•ˆæœ */
        }

        /* æ­·å²è©³æƒ…é …ç›®æ¨£å¼ - å–®å€‹åƒæ•¸çš„é¡¯ç¤º */
        .history-detail-item {
            display: flex;                                      /* å½ˆæ€§å¸ƒå±€ */
            flex-direction: column;                             /* å‚ç›´æ’åˆ— */
            gap: 1px;                                           /* é …ç›®é–“è· */
        }

        /* è©³æƒ…æ¨™ç±¤æ¨£å¼ - åƒæ•¸åç¨±çš„é¡¯ç¤º */
        .detail-label {
            font-size: 12px;                                    /* æ–‡å­—å¤§å° */
            color: var(--text-muted);                           /* æ·¡è‰²æ–‡å­— */
        }

        /* è©³æƒ…æ•¸å€¼æ¨£å¼ - åƒæ•¸å€¼çš„é¡¯ç¤º */
        .detail-value {
            font-size: 18px;                                    /* æ–‡å­—å¤§å° */
            font-weight: bold;                                  /* æ–‡å­—ç²—ç´° */
            color: var(--text-color);                           /* æ–‡å­—é¡è‰² */
            line-height: 1.2;                                   /* è¡Œé«˜ */
        }

        /* ç§»å‹•è¨­å‚™é©é… - èª¿æ•´å°å±å¹•ä¸‹çš„é¡¯ç¤ºæ•ˆæœ */
        @media screen and (max-width: 360px) {
            .history-item {
                padding: 6px;                                   /* æ¸›å°‘å…§éƒ¨é–“è· */
                gap: 4px;                                       /* æ¸›å°‘é …ç›®é–“è· */
            }
            
            .history-header-rate {
                font-size: 13px;                                /* æ¸›å°æ–‡å­—å¤§å° */
                padding: 2px 5px;                               /* æ¸›å°‘å…§éƒ¨é–“è· */
            }
            
            .history-date {
                font-size: 13px;                                /* æ¸›å°æ–‡å­—å¤§å° */
            }
            
            .detail-value {
                font-size: 15px;                                /* æ¸›å°æ–‡å­—å¤§å° */
            }
            
            .history-details {
                padding: 5px;                                   /* æ¸›å°‘å…§éƒ¨é–“è· */
                gap: 5px;                                       /* æ¸›å°‘ç¶²æ ¼é–“è· */
            }
            
            .delete-btn, .detail-btn {
                padding: 5px 10px;                              /* æ¸›å°‘æŒ‰éˆ•å…§éƒ¨é–“è· */
                font-size: 12px;                                /* æ¸›å°æŒ‰éˆ•æ–‡å­—å¤§å° */
                min-width: 65px;                                /* è¨­ç½®æœ€å°å¯¬åº¦ */
            }
        }

        /* æŒ‰éˆ•å€åŸŸ - æ­·å²è¨˜éŒ„é …ç›®åº•éƒ¨çš„æ“ä½œæŒ‰éˆ• */
        .history-actions {
            display: flex;                                      /* å½ˆæ€§å¸ƒå±€ */
            justify-content: flex-end;                          /* å³å°é½Š */
            gap: 8px;                                           /* æŒ‰éˆ•é–“è· */
            margin-top: 3px;                                    /* é ‚éƒ¨å¤–éƒ¨é–“è· */
        }

        /* åˆªé™¤æŒ‰éˆ•å’Œè©³æƒ…æŒ‰éˆ•å…±ç”¨æ¨£å¼ - æ“ä½œæŒ‰éˆ•çš„åŸºæœ¬æ¨£å¼ */
        .delete-btn, .detail-btn {
            padding: 6px 12px;                                  /* å…§éƒ¨é–“è· */
            border-radius: 4px;                                 /* åœ“è§’æ•ˆæœ */
            font-size: 13px;                                    /* æ–‡å­—å¤§å° */
            font-weight: bold;                                  /* æ–‡å­—ç²—ç´° */
            transition: all 0.25s ease;                         /* éæ¸¡æ•ˆæœ */
            display: flex;                                      /* å½ˆæ€§å¸ƒå±€ */
            align-items: center;                                /* å‚ç›´å±…ä¸­ */
            justify-content: center;                            /* æ°´å¹³å±…ä¸­ */
            border: none;                                       /* ç„¡é‚Šæ¡† */
            min-width: 70px;                                    /* æœ€å°å¯¬åº¦ */
        }

        /* åˆªé™¤æŒ‰éˆ•æ¨£å¼ - ç”¨ç´…è‰²ç³»è¡¨ç¤ºåˆªé™¤æ“ä½œ */
        .delete-btn {
            background-color: rgba(var(--error-color-rgb), 0.25); /* åŠé€æ˜ç´…è‰²èƒŒæ™¯ */
            color: var(--text-color);                           /* æ–‡å­—é¡è‰² */
            border: 1px solid rgba(var(--error-color-rgb), 0.5); /* ç´…è‰²é‚Šæ¡† */
        }

        /* åˆªé™¤æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .delete-btn:hover {
            background-color: var(--error-color);               /* éŒ¯èª¤è‰²èƒŒæ™¯ */
            color: white;                                       /* ç™½è‰²æ–‡å­— */
            transform: translateY(-2px);                        /* ä¸Šç§»æ•ˆæœ */
            box-shadow: 0 3px 5px rgba(var(--error-color-rgb), 0.4); /* ç´…è‰²é™°å½± */
        }

        /* åˆªé™¤æŒ‰éˆ•é»æ“Šæ•ˆæœ - é»æ“Šæ™‚çš„è¦–è¦ºåé¥‹ */
        .delete-btn:active {
            transform: translateY(1px);                         /* ä¸‹ç§»æ•ˆæœ */
        }

        /* è©³æƒ…æŒ‰éˆ•æ¨£å¼ - ç”¨è—è‰²ç³»è¡¨ç¤ºä¿¡æ¯æ“ä½œ */
        .detail-btn {
            background-color: rgba(var(--info-color-rgb), 0.25); /* åŠé€æ˜è—è‰²èƒŒæ™¯ */
            color: var(--text-color);                          /* æ–‡å­—é¡è‰² */
            border: 1px solid rgba(var(--info-color-rgb), 0.5); /* è—è‰²é‚Šæ¡† */
        }

        /* è©³æƒ…æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .detail-btn:hover {
            background-color: var(--info-color);               /* ä¿¡æ¯è‰²èƒŒæ™¯ */
            color: white;                                      /* ç™½è‰²æ–‡å­— */
            transform: translateY(-2px);                       /* ä¸Šç§»æ•ˆæœ */
            box-shadow: 0 3px 5px rgba(var(--info-color-rgb), 0.4); /* è—è‰²é™°å½± */
        }

        /* è©³æƒ…æŒ‰éˆ•é»æ“Šæ•ˆæœ - é»æ“Šæ™‚çš„è¦–è¦ºåé¥‹ */
        .detail-btn:active {
            transform: translateY(1px);                        /* ä¸‹ç§»æ•ˆæœ */
        }

        /* ç„¡æ•¸æ“šæç¤ºæ¨£å¼ - ç•¶æ²’æœ‰æ­·å²è¨˜éŒ„æ™‚é¡¯ç¤º */
        .no-data {
            text-align: center;                                /* æ–‡å­—å±…ä¸­ */
            color: var(--text-muted);                          /* æ·¡è‰²æ–‡å­— */
            font-style: italic;                                /* æ–œé«”æ–‡å­— */
            padding: 30px 0;                                   /* ä¸Šä¸‹å…§éƒ¨é–“è· */
            font-size: 16px;                                   /* æ–‡å­—å¤§å° */
        }

        /* å…¨éƒ¨åˆªé™¤æŒ‰éˆ•æ”¹é€² - åˆªé™¤æ‰€æœ‰æ­·å²è¨˜éŒ„çš„æŒ‰éˆ• */
        .delete-all-btn {
            background: rgba(var(--error-color-rgb), 0.15);    /* æ·¡ç´…è‰²èƒŒæ™¯ */
            border: 1px solid var(--error-color);             /* ç´…è‰²é‚Šæ¡† */
            color: var(--error-color);                        /* ç´…è‰²æ–‡å­— */
            font-size: 14px;                                  /* æ–‡å­—å¤§å° */
            padding: 6px 14px;                                /* å…§éƒ¨é–“è· */
            border-radius: 6px;                               /* åœ“è§’æ•ˆæœ */
            cursor: pointer;                                  /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: all 0.3s ease;                        /* éæ¸¡æ•ˆæœ */
            font-weight: bold;                                /* æ–‡å­—ç²—ç´° */
        }

        /* å…¨éƒ¨åˆªé™¤æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .delete-all-btn:hover {
            background-color: var(--error-color);             /* ç´…è‰²èƒŒæ™¯ */
            color: white;                                     /* ç™½è‰²æ–‡å­— */
            transform: translateY(-2px);                      /* ä¸Šç§»æ•ˆæœ */
            box-shadow: 0 3px 5px rgba(var(--error-color-rgb), 0.4); /* ç´…è‰²é™°å½± */
        }

        /* å…¨éƒ¨åˆªé™¤æŒ‰éˆ•é»æ“Šæ•ˆæœ - é»æ“Šæ™‚çš„è¦–è¦ºåé¥‹ */
        .delete-all-btn:active {
            transform: translateY(1px);                       /* ä¸‹ç§»æ•ˆæœ */
            box-shadow: none;                                 /* ç§»é™¤é™°å½± */
        }

        /* æ¨¡æ…‹æ¡†èƒŒæ™¯æ¨£å¼ - è¦†è“‹æ•´å€‹é é¢çš„åŠé€æ˜èƒŒæ™¯ */
        .modal-overlay {
            display: none;                                    /* åˆå§‹éš±è— */
            position: fixed;                                  /* å›ºå®šå®šä½ */
            top: 0;                                          /* è²¼é½Šé ‚éƒ¨ */
            left: 0;                                         /* è²¼é½Šå·¦å´ */
            width: 100%;                                     /* å¯¬åº¦100% */
            height: 100%;                                    /* é«˜åº¦100% */
            background-color: rgba(var(--primary-color-rgb), 0.7); /* åŠé€æ˜èƒŒæ™¯ */
            z-index: 2000;                                   /* å±¤ç´š */
            justify-content: center;                         /* æ°´å¹³å±…ä¸­ */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            animation: fadeIn 0.3s ease-out;                 /* æ·¡å…¥å‹•ç•« */
        }

        /* æ¨¡æ…‹æ¡†å®¹å™¨æ¨£å¼ - é¡¯ç¤ºå…§å®¹çš„ä¸­å¿ƒå€åŸŸ */
        .modal-container {
            background-color: var(--primary-color);          /* ä¸»èƒŒæ™¯è‰² */
            border-radius: 10px;                             /* åœ“è§’æ•ˆæœ */
            width: 90%;                                      /* å®¹å™¨å¯¬åº¦ */
            max-width: 350px;                                /* æœ€å¤§å¯¬åº¦ */
            box-shadow: 0 10px 25px rgba(var(--shadow-color)); /* é™°å½±æ•ˆæœ */
            animation: modalSlideIn 0.3s ease-out;           /* æ»‘å…¥å‹•ç•« */
            overflow: hidden;                                /* éš±è—æº¢å‡ºå…§å®¹ */
        }

        /* æ¨¡æ…‹æ¡†æ»‘å…¥å‹•ç•« - å®šç¾©æ¨¡æ…‹æ¡†é€²å…¥ç•«é¢çš„æ•ˆæœ */
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); } /* åˆå§‹åœ¨ä¸Šæ–¹ä¸”é€æ˜ */
            to { opacity: 1; transform: translateY(0); }       /* æœ€çµ‚åœ¨æ­£å¸¸ä½ç½®ä¸”ä¸é€æ˜ */
        }

        /* æ¨¡æ…‹æ¡†é ­éƒ¨æ¨£å¼ - åŒ…å«æ¨™é¡Œå’Œé—œé–‰æŒ‰éˆ•çš„é ‚éƒ¨å€åŸŸ */
        .modal-header {
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            justify-content: space-between;                  /* å…©ç«¯å°é½Š */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            padding: 15px;                                   /* å…§éƒ¨é–“è· */
            border-bottom: 1px solid var(--border-color);    /* åº•éƒ¨é‚Šæ¡† */
            background-color: var(--secondary-color);        /* æ¬¡è¦èƒŒæ™¯è‰² */
        }

        /* æ¨¡æ…‹æ¡†æ¨™é¡Œæ¨£å¼ - é ‚éƒ¨æ¨™é¡Œæ–‡å­— */
        .modal-header h3 {
            margin: 0;                                       /* ç§»é™¤å¤–éƒ¨é–“è· */
            color: var(--accent-color);                      /* å¼·èª¿è‰²æ–‡å­— */
            font-size: 18px;                                 /* æ–‡å­—å¤§å° */
        }

        /* æ¨¡æ…‹æ¡†å…§å®¹å€åŸŸæ¨£å¼ - é¡¯ç¤ºä¸»è¦å…§å®¹çš„å€åŸŸ */
        .modal-content {
            padding: 20px 15px;                              /* å…§éƒ¨é–“è· */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            max-height: 100vh;                                /* æœ€å¤§é«˜åº¦ */
            overflow-y: auto;                                /* å‚ç›´æ»¾å‹• */
        }

        /* æ¨¡æ…‹æ¡†åº•éƒ¨å€åŸŸæ¨£å¼ - åŒ…å«æ“ä½œæŒ‰éˆ•çš„åº•éƒ¨å€åŸŸ */
        .modal-footer {
            padding: 10px 15px 15px;                         /* å…§éƒ¨é–“è· */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            justify-content: flex-end;                       /* å³å°é½Š */
            gap: 10px;                                       /* æŒ‰éˆ•é–“è· */
            border-top: 1px solid var(--border-color);       /* é ‚éƒ¨é‚Šæ¡† */
            background-color: var(--secondary-color);        /* æ¬¡è¦èƒŒæ™¯è‰² */
        }

        /* æ¨¡æ…‹æ¡†æŒ‰éˆ•å…±ç”¨æ¨£å¼ - æ¨¡æ…‹æ¡†ä¸­æ‰€æœ‰æŒ‰éˆ•çš„åŸºæœ¬æ¨£å¼ */
        .modal-btn {
            padding: 8px 15px;                               /* å…§éƒ¨é–“è· */
            border-radius: 10px;                             /* åœ“è§’æ•ˆæœ */
            cursor: pointer;                                 /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            font-size: 15px;                                 /* æ–‡å­—å¤§å° */
            transition: all 0.3s ease;                       /* éæ¸¡æ•ˆæœ */
            border: none;                                    /* ç„¡é‚Šæ¡† */
        }

        /* æ¨¡æ…‹æ¡†ä¸»è¦æŒ‰éˆ•æ¨£å¼ - ç”¨æ–¼ç¢ºèªã€æäº¤ç­‰ä¸»è¦æ“ä½œ */
        .modal-btn-primary {
            background-color: var(--accent-color);           /* å¼·èª¿è‰²èƒŒæ™¯ */
            color: white;                                    /* ç™½è‰²æ–‡å­— */
        }

        /* æ¨¡æ…‹æ¡†ä¸»è¦æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .modal-btn-primary:hover {
            background-color: var(--accent-color-dark);      /* æ·±è‰²å¼·èª¿èƒŒæ™¯ */
            transform: translateY(-2px);                     /* ä¸Šç§»æ•ˆæœ */
        }

        /* æ¨¡æ…‹æ¡†æ¬¡è¦æŒ‰éˆ•æ¨£å¼ - ç”¨æ–¼å–æ¶ˆã€è¿”å›ç­‰æ¬¡è¦æ“ä½œ */
        .modal-btn-secondary {
            background-color: var(--secondary-color);        /* æ¬¡è¦èƒŒæ™¯è‰² */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            border: 1px solid var(--border-color);           /* é‚Šæ¡† */
        }

        /* æ¨¡æ…‹æ¡†æ¬¡è¦æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .modal-btn-secondary:hover {
            background-color: var(--hover-color);            /* æ‡¸åœèƒŒæ™¯è‰² */
            transform: translateY(-2px);                     /* ä¸Šç§»æ•ˆæœ */
        }

        /* æç¤ºæ¡†æ¨£å¼ - é¡¯ç¤ºçŸ­æš«æ¶ˆæ¯çš„æµ®å‹•æç¤º */
        .toast-message {
            position: fixed;                                 /* å›ºå®šå®šä½ */
            bottom: 60px;                                    /* è·åº•éƒ¨è·é›¢ */
            left: 50%;                                       /* æ°´å¹³å±…ä¸­ */
            transform: translateX(-50%);                     /* ç²¾ç¢ºå±…ä¸­ */
            background-color: rgba(var(--info-color-rgb), 0.9); /* åŠé€æ˜ä¿¡æ¯è‰²èƒŒæ™¯ */
            color: white;                                    /* ç™½è‰²æ–‡å­— */
            padding: 10px 20px;                              /* å…§éƒ¨é–“è· */
            border-radius: 5px;                              /* åœ“è§’æ•ˆæœ */
            z-index: 9999;                                   /* æœ€é«˜å±¤ç´š */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
            box-shadow: 0 2px 10px var(--shadow-color);      /* é™°å½±æ•ˆæœ */
            opacity: 1;                                      /* å®Œå…¨ä¸é€æ˜ */
            transition: opacity 0.5s ease;                   /* é€æ˜åº¦éæ¸¡æ•ˆæœ */
        }

        /* æ•¸å­—è¼¸å…¥æ¨¡æ…‹æ¡†æ¨£å¼ - è‡ªå®šç¾©è¨ˆç®—å™¨è¼¸å…¥ç•Œé¢ */
        .number-input-modal {
            background-color: var(--primary-color);          /* ä¸»èƒŒæ™¯è‰² */
            border-radius: 12px;                             /* åœ“è§’æ•ˆæœ */
            width: 95%;                                      /* å®¹å™¨å¯¬åº¦ */
            max-width: 350px;                                /* æœ€å¤§å¯¬åº¦ */
            box-shadow: 0 10px 25px var(--shadow-color);     /* é™°å½±æ•ˆæœ */
            overflow: hidden;                                /* éš±è—æº¢å‡ºå…§å®¹ */
            animation: modalSlideIn 0.3s ease-out;           /* æ»‘å…¥å‹•ç•« */
        }

        /* è¨ˆç®—å™¨é¡¯ç¤ºå€åŸŸ - é¡¯ç¤ºè¨ˆç®—è¼¸å…¥èˆ‡çµæœçš„å€åŸŸ */
        .calculator-display {
            background-color: var(--input-bg);               /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            font-size: 32px;                                 /* æ–‡å­—å¤§å° */
            padding: 10px 15px;                              /* å…§éƒ¨é–“è· */
            text-align: right;                               /* æ–‡å­—å³å°é½Š */
            margin: 10px;                                    /* å¤–éƒ¨é–“è· */
            border-radius: 6px;                              /* åœ“è§’æ•ˆæœ */
            border: 1px solid var(--border-color);           /* é‚Šæ¡† */
            height: 46px;                                    /* å›ºå®šé«˜åº¦ */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            justify-content: flex-end;                       /* å³å°é½Š */
            overflow: hidden;                                /* éš±è—æº¢å‡ºå…§å®¹ */
            box-shadow: inset 0 2px 4px var(--shadow-color); /* å…§é™°å½±æ•ˆæœ */
        }

        /* è¨ˆç®—å™¨é¡¯ç¤ºå®¹å™¨ - åŒ…å«è¨ˆç®—æ­·å²å’Œç•¶å‰è¼¸å…¥çš„å®¹å™¨ */
        .calculator-display-container {
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            flex-direction: column;                          /* å‚ç›´æ’åˆ— */
            background-color: var(--input-bg);               /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            margin: 10px;                                    /* å¤–éƒ¨é–“è· */
            border-radius: 10px;                             /* åœ“è§’æ•ˆæœ */
            border: 1px solid var(--border-color);           /* é‚Šæ¡† */
            box-shadow: inset 0 2px 8px var(--shadow-color); /* å…§é™°å½±æ•ˆæœ */
            overflow: hidden;                                /* éš±è—æº¢å‡ºå…§å®¹ */
            height: 110px;                                   /* å›ºå®šé«˜åº¦ */
            position: relative;                              /* ç›¸å°å®šä½ */
        }

        /* è¨ˆç®—å™¨æ­·å²è¨˜éŒ„å€åŸŸ - é¡¯ç¤ºå…ˆå‰çš„è¨ˆç®—æ­¥é©Ÿ */
        .calculator-history {
            color: var(--text-muted);                        /* æ·¡è‰²æ–‡å­— */
            font-size: 16px;                                 /* æ–‡å­—å¤§å° */
            padding: 8px 15px;                               /* å…§éƒ¨é–“è· */
            text-align: right;                               /* æ–‡å­—å³å°é½Š */
            height: 40px;                                    /* å›ºå®šé«˜åº¦ */
            overflow-y: hidden;                              /* éš±è—å‚ç›´æº¢å‡º */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            flex-direction: column;                          /* å‚ç›´æ’åˆ— */
            justify-content: flex-end;                       /* åº•éƒ¨å°é½Š */
            line-height: 1.3;                                /* è¡Œé«˜ */
            word-break: break-all;                           /* å…è¨±å–®è©å…§æ›è¡Œ */
            font-family: 'Consolas', monospace;              /* ç­‰å¯¬å­—é«” */
            position: relative;                              /* ç›¸å°å®šä½ */
            background: linear-gradient(to bottom, 
                rgba(var(--input-bg-rgb), 0.8), 
                rgba(var(--secondary-color-rgb), 0.8));      /* æ¼¸è®ŠèƒŒæ™¯ */
        }

        /* è¨ˆç®—å™¨æ­·å²è¨˜éŒ„åº•éƒ¨åˆ†éš”ç·š - å‰µå»ºè¦–è¦ºåˆ†éš” */
        .calculator-history::after {
            content: '';                                     /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                              /* çµ•å°å®šä½ */
            left: 0;                                         /* è²¼é½Šå·¦å´ */
            right: 0;                                        /* è²¼é½Šå³å´ */
            bottom: 0;                                       /* è²¼é½Šåº•éƒ¨ */
            height: 1px;                                     /* é«˜åº¦1åƒç´  */
            background: linear-gradient(to right, transparent, 
                rgba(var(--accent-color-rgb), 0.4), transparent); /* æ¼¸è®ŠèƒŒæ™¯ */
        }

        /* è¨ˆç®—å™¨é¡¯ç¤ºå€åŸŸå¢å¼·æ¨£å¼ - ä¸»é¡¯ç¤ºå€çš„è¦–è¦ºæ•ˆæœ */
        .calculator-display {
            background-color: var(--input-bg);               /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            font-size: 36px;                                 /* è¼ƒå¤§æ–‡å­—å¤§å° */
            padding: 10px 15px;                              /* å…§éƒ¨é–“è· */
            text-align: right;                               /* æ–‡å­—å³å°é½Š */
            flex: 1;                                         /* ä½”ç”¨å‰©é¤˜ç©ºé–“ */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            justify-content: flex-end;                       /* å³å°é½Š */
            overflow: hidden;                                /* éš±è—æº¢å‡ºå…§å®¹ */
            margin: 0;                                       /* ç§»é™¤å¤–éƒ¨é–“è· */
            border: none;                                    /* ç§»é™¤é‚Šæ¡† */
            box-shadow: none;                                /* ç§»é™¤é™°å½± */
            font-family: 'Consolas', monospace;              /* ç­‰å¯¬å­—é«” */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
            letter-spacing: 1px;                             /* å­—ç¬¦é–“è· */
            border-bottom-left-radius: 8px;                  /* å·¦ä¸‹åœ“è§’ */
            border-bottom-right-radius: 8px;                 /* å³ä¸‹åœ“è§’ */
            position: relative;                              /* ç›¸å°å®šä½ */
            background: linear-gradient(to bottom, 
                rgba(var(--input-bg-rgb), 0.9), 
                rgba(var(--input-bg-rgb), 0.7));             /* æ¼¸è®ŠèƒŒæ™¯ */
            text-shadow: 0 1px 2px var(--shadow-color);      /* æ–‡å­—é™°å½± */
        }

        /* è¨ˆç®—å™¨æ»¾å‹•æŒ‡ç¤ºå™¨ - é¡¯ç¤ºå…§å®¹å¯æ»¾å‹•çš„æç¤º */
        .calculator-scroll-indicator {
            position: absolute;                              /* çµ•å°å®šä½ */
            top: 5px;                                        /* è·é ‚éƒ¨è·é›¢ */
            right: 5px;                                      /* è·å³å´è·é›¢ */
            width: 12px;                                     /* å¯¬åº¦ */
            height: 12px;                                    /* é«˜åº¦ */
            background-color: rgba(var(--accent-color-rgb), 0.7); /* åŠé€æ˜å¼·èª¿è‰²èƒŒæ™¯ */
            border-radius: 50%;                              /* åœ“å½¢æ•ˆæœ */
            opacity: 0;                                      /* åˆå§‹é€æ˜ */
            transition: opacity 0.3s ease;                   /* é€æ˜åº¦éæ¸¡æ•ˆæœ */
            z-index: 10;                                     /* å±¤ç´š */
        }

        /* è¨ˆç®—å™¨æŒ‰éˆ•å€åŸŸ - åŒ…å«æ‰€æœ‰è¨ˆç®—å™¨æŒ‰éˆ•çš„ç¶²æ ¼ */
        .calculator-buttons {
            display: grid;                                   /* ç¶²æ ¼å¸ƒå±€ */
            grid-template-columns: repeat(4, 1fr);           /* å››åˆ—ç­‰å¯¬ */
            grid-template-rows: repeat(5, auto);             /* äº”è¡Œè‡ªå‹•é«˜åº¦ */
            gap: 6px;                                        /* ç¶²æ ¼é–“è· */
            padding: 10px;                                   /* å…§éƒ¨é–“è· */
        }

        /* è¨ˆç®—å™¨æŒ‰éˆ•åŸºæœ¬æ¨£å¼ - æ‰€æœ‰æŒ‰éˆ•çš„å…±åŒæ¨£å¼ */
        .calculator-buttons button {
            padding: 10px 0;                                 /* ä¸Šä¸‹å…§éƒ¨é–“è· */
            font-size: 20px;                                 /* æ–‡å­—å¤§å° */
            border-radius: 10px;                             /* åœ“è§’æ•ˆæœ */
            background-color: var(--secondary-color);        /* æ¬¡è¦èƒŒæ™¯è‰² */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            border: none;                                    /* ç§»é™¤é‚Šæ¡† */
            transition: all 0.2s ease;                       /* éæ¸¡æ•ˆæœ */
            margin: 0;                                       /* ç§»é™¤å¤–éƒ¨é–“è· */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            justify-content: center;                         /* æ°´å¹³å±…ä¸­ */
            height: 48px;                                    /* å›ºå®šé«˜åº¦ */
            box-shadow: 0 2px 4px var(--shadow-color);       /* é™°å½±æ•ˆæœ */
            position: relative;                              /* ç›¸å°å®šä½ */
            overflow: hidden;                                /* éš±è—æº¢å‡ºå…§å®¹ */
        }

        /* è¨ˆç®—å™¨æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .calculator-buttons button:hover {
            background-color: var(--hover-color);            /* æ‡¸åœèƒŒæ™¯è‰² */
            transform: translateY(-2px);                     /* ä¸Šç§»æ•ˆæœ */
            box-shadow: 0 4px 8px var(--shadow-color);       /* å¢å¼·é™°å½± */
        }

        /* è¨ˆç®—å™¨æŒ‰éˆ•é»æ“Šæ•ˆæœ - é»æ“Šæ™‚çš„è¦–è¦ºåé¥‹ */
        .calculator-buttons button:active {
            transform: scale(0.95);                          /* ç¸®å°æ•ˆæœ */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);        /* æ¸›å¼±é™°å½± */
        }

        /* æ•¸å­—æŒ‰éˆ•æ¨£å¼ */
        /* æ•¸å­—æŒ‰éˆ•æ¨£å¼ - æ°´å¹³æ’åˆ—æ•¸å­—å’Œè²¡å‹™ç¬¦è™Ÿ */
        .calculator-buttons .number-btn {
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            flex-direction: row;                             /* æ°´å¹³æ’åˆ— */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            justify-content: center;                         /* æ°´å¹³å±…ä¸­ */
            padding: 5px 2px;                                /* å…§éƒ¨é–“è· */
            position: relative;                              /* ç›¸å°å®šä½ */
        }

        /* é˜¿æ‹‰ä¼¯æ•¸å­—æ¨£å¼ - ä¸»è¦é¡¯ç¤ºçš„æ•¸å­— */
        .calculator-buttons .arabic-number {
            font-size: 28px;                                 /* è¼ƒå¤§æ–‡å­—å¤§å° */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
            line-height: 1;                                  /* è¡Œé«˜ */
            margin-right: 3px;                               /* å³å´å¤–éƒ¨é–“è· */
            flex-grow: 0;                                    /* ç¦æ­¢å¢é•· */
        }

        /* è²¡å‹™ç¬¦è™Ÿæ¨£å¼ - é¡¯ç¤ºåœ¨æŒ‰éˆ•ä¸Šçš„ä¸­æ–‡æ•¸å­— */
        .calculator-buttons .financial-char {
            font-size: 18px;                                 /* è¼ƒå°æ–‡å­—å¤§å° */
            color: var(--button-orange);                     /* æ©™è‰²æ–‡å­— */
            line-height: 1;                                  /* è¡Œé«˜ */
            position: absolute;                              /* çµ•å°å®šä½ */
            right: 6px;                                      /* è·å³å´è·é›¢ */
            opacity: 0.9;                                    /* è¼•å¾®é€æ˜ */
        }

        /* æ•¸å­—æŒ‰éˆ•ç›¸å°å®šä½ - ç¢ºä¿å…§éƒ¨å…ƒç´ çš„æ­£ç¢ºå®šä½ */
        .calculator-buttons .number-btn {
            position: relative;                              /* ç›¸å°å®šä½ */
        }

        /* é˜¿æ‹‰ä¼¯æ•¸å­—å³å´é–“è· - ç‚ºè²¡å‹™ç¬¦è™Ÿç•™å‡ºç©ºé–“ */
        .calculator-buttons .number-btn .arabic-number {
            margin-right: 3px;                               /* å³å´å¤–éƒ¨é–“è· */
        }

        /* è²¡å‹™ç¬¦è™Ÿå®šä½ - å›ºå®šåœ¨æŒ‰éˆ•å³å´ */
        .calculator-buttons .number-btn .financial-char {
            right: 6px;                                      /* è·å³å´è·é›¢ */
            font-size: 18px;                                 /* æ–‡å­—å¤§å° */
            color: var(--accent-color);                      /* å¼·èª¿è‰²æ–‡å­— */
            position: absolute;                              /* çµ•å°å®šä½ */
            opacity: 0.9;                                    /* è¼•å¾®é€æ˜ */
        }

        /* æ•¸å­—æŒ‰éˆ•é»æ“Šæ™‚çš„æ–‡å­—é¡è‰²è®ŠåŒ– - æä¾›è¦–è¦ºåé¥‹ */
        .calculator-buttons .number-btn:active .arabic-number,
        .calculator-buttons .number-btn:active .financial-char {
            color: white;                                    /* ç™½è‰²æ–‡å­— */
        }

        /* é›¶éµæ¨£å¼ - èª¿æ•´é›¶æŒ‰éˆ•çš„ç‰¹æ®Šå¸ƒå±€ */
        .calculator-buttons .zero {
            background-color: #3a3a3a;                       /* æ·±ç°èƒŒæ™¯ */
            flex-direction: column;                          /* å‚ç›´æ’åˆ— */
            align-items: center;                             /* æ°´å¹³å±…ä¸­ */
            justify-content: center;                         /* å‚ç›´å±…ä¸­ */
        }

        /* é‹ç®—ç¬¦å’Œç­‰è™Ÿæ–‡å­—å¤§å° - ç¢ºä¿è¦–è¦ºå¹³è¡¡ */
        .calculator-buttons .operator,
        .calculator-buttons .equals {
            font-size: 22px;                                 /* æ–‡å­—å¤§å° */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
        }

        /* æ¸…é™¤å’ŒåŠŸèƒ½éµæ–‡å­—å¤§å° - çµ±ä¸€ç‰¹æ®ŠæŒ‰éˆ•çš„æ–‡å­—å¤§å° */
        .calculator-buttons .clear,
        .calculator-buttons .function {
            font-size: 20px;                                 /* æ–‡å­—å¤§å° */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
        }

        /* æŒ‰éˆ•é»æ“Šæ³¢ç´‹æ•ˆæœ - å‰µå»ºé»æ“Šæ™‚çš„æ“´æ•£æ•ˆæœ */
        .calculator-buttons button::after {
            content: '';                                     /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                              /* çµ•å°å®šä½ */
            top: 50%;                                        /* å¾ä¸­å¿ƒé–‹å§‹ */
            left: 50%;                                       /* å¾ä¸­å¿ƒé–‹å§‹ */
            width: 5px;                                      /* åˆå§‹å¯¬åº¦ */
            height: 5px;                                     /* åˆå§‹é«˜åº¦ */
            background: rgba(255, 255, 255, 0.5);            /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ */
            opacity: 0;                                      /* åˆå§‹é€æ˜ */
            border-radius: 100%;                             /* åœ“å½¢æ•ˆæœ */
            transform: scale(1, 1) translate(-50%, -50%);    /* åˆå§‹è®Šå½¢ */
            transform-origin: 50% 50%;                       /* è®Šå½¢åŸé» */
        }

        /* æŒ‰éˆ•é»æ“Šæ™‚çš„æ³¢ç´‹å‹•ç•« - é»æ“Šæ™‚è§¸ç™¼æ³¢ç´‹æ“´æ•£ */
        .calculator-buttons button:active::after {
            animation: ripple 0.4s ease-out;                 /* æ³¢ç´‹å‹•ç•« */
        }

        /* æ³¢ç´‹å‹•ç•«å®šç¾© - æ§åˆ¶é»æ“Šæ³¢ç´‹çš„æ“´æ•£æ•ˆæœ */
        @keyframes ripple {
            0% {
                transform: scale(0, 0) translate(-50%, -50%); /* åˆå§‹ç‚ºé» */
                opacity: 0.5;                                /* åŠé€æ˜ */
            }
            100% {
                transform: scale(20, 20) translate(-50%, -50%); /* æ“´æ•£ç‚ºå¤§åœ“ */
                opacity: 0;                                  /* å®Œå…¨é€æ˜ */
            }
        }

        /* åŠŸèƒ½éµæ¨£å¼ - ç‰¹æ®ŠåŠŸèƒ½æŒ‰éˆ•çš„é¡è‰² */
        .calculator-buttons .function {
            background-color: #4d4d4d;                       /* ä¸­ç°è‰²èƒŒæ™¯ */
            color: #eee;                                     /* æ·ºç°è‰²æ–‡å­— */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
        }

        /* é‹ç®—ç¬¦è™Ÿæ¨£å¼ - æ•¸å­¸é‹ç®—ç¬¦æŒ‰éˆ•çš„é¡è‰² */
        .calculator-buttons .operator {
            background-color: var(--accent-color);           /* å¼·èª¿è‰²èƒŒæ™¯ */
            color: white;                                    /* ç™½è‰²æ–‡å­— */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
            box-shadow: 0 2px 6px rgba(var(--accent-color-rgb), 0.4); /* å¼·èª¿è‰²é™°å½± */
        }

        /* æ¸…é™¤éµæ¨£å¼ - æ¸…é™¤æŒ‰éˆ•çš„é¡è‰² */
        .calculator-buttons .clear {
            background-color: var(--error-color);            /* éŒ¯èª¤è‰²èƒŒæ™¯ */
            color: white;                                    /* ç™½è‰²æ–‡å­— */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
            box-shadow: 0 2px 6px rgba(var(--error-color-rgb), 0.4); /* éŒ¯èª¤è‰²é™°å½± */
        }

        /* ç­‰è™Ÿéµæ¨£å¼ - ç­‰è™ŸæŒ‰éˆ•çš„é¡è‰² */
        .calculator-buttons .equals {
            background-color: var(--info-color);             /* ä¿¡æ¯è‰²èƒŒæ™¯ */
            color: white;                                    /* ç™½è‰²æ–‡å­— */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
            box-shadow: 0 2px 6px rgba(var(--info-color-rgb), 0.4); /* ä¿¡æ¯è‰²é™°å½± */
        }

        /* é›¶éµä½”æ“šå…©æ¬„ - æ“´å±•é›¶æŒ‰éˆ•çš„å¯¬åº¦ */
        .calculator-buttons .zero {
            grid-column: span 2;                            /* ä½”æ“šå…©åˆ— */
            background-color: #3a3a3a;                      /* æ·±ç°è‰²èƒŒæ™¯ */
        }

        /* æäº¤æŒ‰éˆ•ä½”æ“šå…©æ¬„ - æ“´å±•ç¢ºèªæŒ‰éˆ•çš„å¯¬åº¦ */
        .calculator-buttons .submit {
            grid-column: span 2;                            /* ä½”æ“šå…©åˆ— */
            background-color: var(--accent-color);          /* å¼·èª¿è‰²èƒŒæ™¯ */
            color: white;                                   /* ç™½è‰²æ–‡å­— */
            font-weight: bold;                              /* æ–‡å­—ç²—ç´° */
            box-shadow: 0 2px 6px rgba(var(--accent-color-rgb), 0.4); /* å¼·èª¿è‰²é™°å½± */
        }

        /* éŒ¯èª¤æç¤ºæ¨£å¼ - é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯çš„toast */
        .toast-error {
            background-color: rgba(var(--error-color-rgb), 0.9); /* åŠé€æ˜éŒ¯èª¤è‰²èƒŒæ™¯ */
        }

        /* æ·»åŠ ç®­é ­æ—‹è½‰å‹•ç•« - æ§åˆ¶å±•é–‹/æ”¶èµ·æŒ‡ç¤ºå™¨ */
        #toggleIcon {
            display: inline-block;                          /* è¡Œå…§å¡Šé¡¯ç¤º */
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* å¹³æ»‘éæ¸¡æ•ˆæœ */
        }

        /* ç®­é ­ä¸Šæ—‹è½‰æ¨£å¼ - è¡¨ç¤ºæ”¶èµ·ç‹€æ…‹ */
        #toggleIcon.icon-rotate-up {
            transform: rotate(180deg);                      /* ä¸Šæ—‹è½‰180åº¦ */
        }

        /* ç®­é ­ä¸Šæ—‹è½‰é€šç”¨é¡ - å¯æ‡‰ç”¨æ–¼å…¶ä»–å…ƒç´  */
        .icon-rotate-up {
            transform: rotate(180deg);                      /* ä¸Šæ—‹è½‰180åº¦ */
        }

        /* æŒ‰éˆ•çµ„çš„è½‰æ›æ•ˆæœ - æ§åˆ¶æŒ‰éˆ•çµ„çš„å±•é–‹/æ”¶èµ· */
        .input-button-group div[id$="Buttons"] {
            transition: all 0.3s ease-in-out, max-height 0.3s ease-in-out; /* éæ¸¡æ•ˆæœ */
            max-height: 100px;                              /* æœ€å¤§é«˜åº¦ */
            opacity: 1;                                     /* å®Œå…¨ä¸é€æ˜ */
        }

        /* æ­·å²è¨˜éŒ„å‚™è¨»å®¹å™¨ - åŒ…å«å‚™è¨»çš„å€åŸŸ */
        .history-note-container {
            background-color: rgba(var(--primary-color-rgb), 0.1); /* åŠé€æ˜èƒŒæ™¯ */
            border-radius: 4px;                             /* åœ“è§’æ•ˆæœ */
            margin: 6px 0;                                  /* ä¸Šä¸‹å¤–éƒ¨é–“è· */
            padding: 6px;                                   /* å…§éƒ¨é–“è· */
        }

        /* æ­·å²è¨˜éŒ„é …ç›®åº•éƒ¨ - åŒ…å«å‚™è¨»å’ŒæŒ‰éˆ•çš„åº•éƒ¨å€åŸŸ */
        .history-item-footer {
            display: flex;                                  /* å½ˆæ€§å¸ƒå±€ */
            align-items: center;                            /* å‚ç›´å±…ä¸­ */
            gap: 8px;                                       /* é …ç›®é–“è· */
        }

        /* æ­·å²è¨˜éŒ„å‚™è¨»é è¦½ - é¡¯ç¤ºå‚™è¨»å…§å®¹çš„é è¦½ */
        .history-note-preview {
            color: #bcbcbc;                                 /* æ·ºç°è‰²æ–‡å­— */
            font-size: 14px;                                /* æ–‡å­—å¤§å° */
            min-height: 20px;                               /* æœ€å°é«˜åº¦ */
            padding: 4px;                                   /* å…§éƒ¨é–“è· */
            border: 1px solid transparent;                  /* é€æ˜é‚Šæ¡† */
            transition: all 0.3s ease;                      /* éæ¸¡æ•ˆæœ */
            cursor: pointer;                                /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            white-space: nowrap;                            /* ç¦æ­¢æ›è¡Œ */
            overflow: hidden;                               /* éš±è—æº¢å‡ºå…§å®¹ */
            text-overflow: ellipsis;                        /* æ–‡å­—æº¢å‡ºé¡¯ç¤ºçœç•¥è™Ÿ */
            flex-grow: 1;                                   /* ä½”ç”¨å‰©é¤˜ç©ºé–“ */
            max-width: 170px;                               /* æœ€å¤§å¯¬åº¦ */
        }

        /* æ­·å²è¨˜éŒ„æ“ä½œæŒ‰éˆ•å€åŸŸ - ç½®æ–¼å³å´çš„æŒ‰éˆ•çµ„ */
        .history-actions {
            display: flex;                                  /* å½ˆæ€§å¸ƒå±€ */
            gap: 4px;                                       /* æŒ‰éˆ•é–“è· */
            margin-left: auto;                              /* æ¨åˆ°å³å´ */
        }

        /* æ­·å²è¨˜éŒ„å‚™è¨»é è¦½æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .history-note-preview:hover {
            background-color: var(--accent-color-light);    /* æ·¡è‰²å¼·èª¿èƒŒæ™¯ */
            border-color: rgba(var(--accent-color-rgb), 0.3); /* åŠé€æ˜å¼·èª¿è‰²é‚Šæ¡† */
        }

        /* å‚™è¨»ç·¨è¼¯å™¨æ¨¡æ…‹æ¡† - ç·¨è¼¯å‚™è¨»çš„å½ˆå‡ºçª—å£ */
        .note-editor-modal {
            display: none;                                  /* åˆå§‹éš±è— */
            position: fixed;                                /* å›ºå®šå®šä½ */
            top: 0;                                         /* è²¼é½Šé ‚éƒ¨ */
            left: 0;                                        /* è²¼é½Šå·¦å´ */
            width: 100%;                                    /* å¯¬åº¦100% */
            height: 100%;                                   /* é«˜åº¦100% */
            background-color: rgba(var(--primary-color-rgb), 0.7); /* åŠé€æ˜èƒŒæ™¯ */
            z-index: 2000;                                  /* å±¤ç´š */
            justify-content: center;                        /* æ°´å¹³å±…ä¸­ */
            align-items: flex-start;                        /* é ‚éƒ¨å°é½Š */
            padding-top: 160px;                             /* é ‚éƒ¨å…§éƒ¨é–“è· */
        }

        /* å‚™è¨»ç·¨è¼¯å™¨å…§å®¹å€åŸŸ - åŒ…å«è¼¸å…¥æ¡†å’ŒæŒ‰éˆ•çš„ä¸»é«” */
        .note-editor-content {
            background-color: var(--primary-color);         /* ä¸»èƒŒæ™¯è‰² */
            border-radius: 12px;                            /* åœ“è§’æ•ˆæœ */
            width: 80%;                                     /* å®¹å™¨å¯¬åº¦ */
            max-width: 320px;                               /* æœ€å¤§å¯¬åº¦ */
            padding: 15px;                                  /* å…§éƒ¨é–“è· */
            box-shadow: 0 10px 25px var(--shadow-color);    /* é™°å½±æ•ˆæœ */
            border: 1px solid var(--accent-color);          /* å¼·èª¿è‰²é‚Šæ¡† */
            animation: slideDown 0.3s ease-out;             /* æ»‘å…¥å‹•ç•« */
            margin: 0 auto;                                 /* æ°´å¹³å±…ä¸­ */
        }

        /* å‘ä¸‹æ»‘å…¥å‹•ç•« - å®šç¾©æ¨¡æ…‹æ¡†é€²å…¥ç•«é¢çš„æ•ˆæœ */
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; } /* åˆå§‹åœ¨ä¸Šæ–¹ä¸”é€æ˜ */
            to { transform: translateY(0); opacity: 1; }       /* æœ€çµ‚åœ¨æ­£å¸¸ä½ç½®ä¸”ä¸é€æ˜ */
        }

        /* å‚™è¨»ç·¨è¼¯å™¨è¼¸å…¥æ¡† - å¤šè¡Œæ–‡æœ¬è¼¸å…¥å€åŸŸ */
        .note-editor-input {
            width: calc(100% - 24px);                       /* è¨ˆç®—å¯¬åº¦ */
            padding: 12px;                                  /* å…§éƒ¨é–“è· */
            margin: 12px 0;                                 /* ä¸Šä¸‹å¤–éƒ¨é–“è· */
            background-color: var(--input-bg);              /* è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            color: var(--text-color);                       /* æ–‡å­—é¡è‰² */
            border: 1px solid var(--border-color);          /* é‚Šæ¡† */
            border-radius: 8px;                             /* åœ“è§’æ•ˆæœ */
            min-height: 100px;                              /* æœ€å°é«˜åº¦ */
            resize: none;                                   /* ç¦æ­¢èª¿æ•´å¤§å° */
            font-size: 16px;                                /* æ–‡å­—å¤§å° */
            box-shadow: inset 0 2px 4px var(--shadow-color); /* å…§é™°å½±æ•ˆæœ */
            transition: all 0.3s ease;                      /* éæ¸¡æ•ˆæœ */
            box-sizing: border-box;                         /* ç›’æ¨¡å‹è¨ˆç®—æ–¹å¼ */
        }

        /* å‚™è¨»ç·¨è¼¯å™¨è¼¸å…¥æ¡†èšç„¦æ•ˆæœ - è¼¸å…¥æ™‚çš„è¦–è¦ºåé¥‹ */
        .note-editor-input:focus {
            border-color: var(--accent-color);              /* å¼·èª¿è‰²é‚Šæ¡† */
            box-shadow: 0 0 0 2px var(--accent-color-light); /* å¼·èª¿è‰²é™°å½± */
            outline: none;                                  /* ç§»é™¤é»˜èªè¼ªå»“ */
        }

        /* å‚™è¨»ç·¨è¼¯å™¨æŒ‰éˆ•å€åŸŸ - åº•éƒ¨æ“ä½œæŒ‰éˆ•çš„å®¹å™¨ */
        .note-editor-buttons {
            display: flex;                                  /* å½ˆæ€§å¸ƒå±€ */
            justify-content: flex-end;                      /* å³å°é½Š */
            gap: 8px;                                       /* æŒ‰éˆ•é–“è· */
            margin-top: 8px;                                /* é ‚éƒ¨å¤–éƒ¨é–“è· */
        }

        /* å‚™è¨»ç·¨è¼¯å™¨æ¨™é¡Œ - é ‚éƒ¨æ¨™é¡Œæ¨£å¼ */
        .note-editor-content h3 {
            color: var(--accent-color);                     /* å¼·èª¿è‰²æ–‡å­— */
            font-size: 18px;                                /* æ–‡å­—å¤§å° */
            margin: 0 0 8px 0;                              /* å¤–éƒ¨é–“è· */
            padding-bottom: 8px;                            /* åº•éƒ¨å…§éƒ¨é–“è· */
            border-bottom: 1px solid rgba(var(--accent-color-rgb), 0.3); /* åŠé€æ˜å¼·èª¿è‰²åº•éƒ¨é‚Šæ¡† */
        }

        /* æˆªåœ–åŠ è¼‰æç¤ºæ¨£å¼ - ç”Ÿæˆå ±åƒ¹å¡ç‰‡æ™‚çš„åŠ è¼‰æç¤º */
        #screenshot-loading {
            position: fixed;                                /* å›ºå®šå®šä½ */
            top: 0;                                         /* è²¼é½Šé ‚éƒ¨ */
            left: 0;                                        /* è²¼é½Šå·¦å´ */
            width: 100%;                                    /* å¯¬åº¦100% */
            height: 100%;                                   /* é«˜åº¦100% */
            background-color: rgba(var(--primary-color-rgb), 0.7); /* åŠé€æ˜èƒŒæ™¯ */
            display: flex;                                  /* å½ˆæ€§å¸ƒå±€ */
            align-items: center;                            /* å‚ç›´å±…ä¸­ */
            justify-content: center;                        /* æ°´å¹³å±…ä¸­ */
            z-index: 9999;                                  /* æœ€é«˜å±¤ç´š */
        }

        /* åŠ è¼‰å…§å®¹æ¨£å¼ - é¡¯ç¤ºåŠ è¼‰æç¤ºçš„å®¹å™¨ */
        .loading-content {
            background-color: rgba(var(--info-color-rgb), 0.9); /* åŠé€æ˜ä¿¡æ¯è‰²èƒŒæ™¯ */
            color: white;                                   /* ç™½è‰²æ–‡å­— */
            padding: 15px 25px;                             /* å…§éƒ¨é–“è· */
            font-size: 16px;                                /* æ–‡å­—å¤§å° */
            font-weight: bold;                              /* æ–‡å­—ç²—ç´° */
            border-radius: 8px;                             /* åœ“è§’æ•ˆæœ */
            box-shadow: 0 4px 12px var(--shadow-color);     /* é™°å½±æ•ˆæœ */
            animation: pulseLoading 1.5s infinite;          /* è„ˆå‹•å‹•ç•« */
        }

        /* åŠ è¼‰è„ˆå‹•å‹•ç•« - å®šç¾©åŠ è¼‰æç¤ºçš„å‘¼å¸æ•ˆæœ */
        @keyframes pulseLoading {
            0%, 100% { opacity: 0.9; transform: scale(1); }   /* åˆå§‹å’ŒçµæŸç‹€æ…‹ */
            50% { opacity: 1; transform: scale(1.05); }       /* ä¸­é–“ç‹€æ…‹ */
        }

        /* åˆ†äº«æ¨¡æ…‹æ¡†å®¹å™¨æ¨£å¼ - èª¿æ•´åˆ†äº«ç•Œé¢çš„å®¹å™¨ */
        #shareModalOverlay .modal-container {
            width: 95%;                                     /* å®¹å™¨å¯¬åº¦ */
            max-width: 370px;                               /* æœ€å¤§å¯¬åº¦ */
            padding-bottom: 15px;                           /* åº•éƒ¨å…§éƒ¨é–“è· */
            background-color: var(--primary-color);         /* ä¸»èƒŒæ™¯è‰² */
        }

        /* åˆ†äº«å ±åƒ¹å¡ç‰‡æ¨£å¼ - é¡¯ç¤ºè¦åˆ†äº«çš„å ±åƒ¹å¡ç‰‡çš„å®¹å™¨ */
        #shareQuoteCard {
            border-radius: 12px;                            /* åœ“è§’æ•ˆæœ */
            overflow: hidden;                               /* éš±è—æº¢å‡ºå…§å®¹ */
            background-color: var(--primary-color);         /* ä¸»èƒŒæ™¯è‰² */
            margin: 10px auto;                              /* å¤–éƒ¨é–“è· */
            max-width: 340px;                               /* æœ€å¤§å¯¬åº¦ */
        }

        /* åˆ†äº«é¸é …æŒ‰éˆ•æ¨£å¼ - åˆ†äº«æ“ä½œçš„æŒ‰éˆ• */
        #shareOptions button {
            flex: 1;                                        /* å¹³å‡åˆ†é…ç©ºé–“ */
            padding: 10px 15px;                             /* å…§éƒ¨é–“è· */
            font-size: 15px;                                /* æ–‡å­—å¤§å° */
            transition: all 0.3s ease;                      /* éæ¸¡æ•ˆæœ */
        }

        /* åˆ†äº«é¸é …æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        #shareOptions button:hover {
            transform: translateY(-3px);                     /* ä¸Šç§»æ•ˆæœ */
            box-shadow: 0 5px 15px var(--shadow-color);      /* å¢å¼·é™°å½± */
        }

        /* åˆ†äº«ç‹€æ…‹ä¿¡æ¯ - é¡¯ç¤ºåˆ†äº«æ“ä½œçµæœçš„æ–‡æœ¬å€åŸŸ */
        #shareStatus {
            height: 20px;                                    /* å›ºå®šé«˜åº¦ */
            font-style: italic;                              /* æ–œé«”æ–‡å­— */
            color: var(--accent-color);                      /* å¼·èª¿è‰²æ–‡å­— */
        }

        /* å ±åƒ¹å¡ç‰‡åœ–ç‰‡æ¨£å¼ - å ±åƒ¹å¡ç‰‡æˆªåœ–çš„æ¨£å¼ */
        #shareQuoteCard img {
            width: 100%;                                     /* å¯¬åº¦100% */
            max-width: 380px;                                /* æœ€å¤§å¯¬åº¦ */
            border-radius: 12px;                             /* åœ“è§’æ•ˆæœ */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);          /* é™°å½±æ•ˆæœ */
            display: block;                                  /* å¡Šç´šé¡¯ç¤º */
            margin: 0 auto;                                  /* æ°´å¹³å±…ä¸­ */
        }

        /* èª¿æ•´åˆ†äº«æ¨¡æ…‹æ¡†å…§å®¹å€åŸŸ - å„ªåŒ–é¡¯ç¤ºç©ºé–“ */
        #shareModalOverlay .modal-content {
            padding: 10px !important;                        /* å¼·åˆ¶å…§éƒ¨é–“è· */
            overflow: visible !important;                    /* å¼·åˆ¶é¡¯ç¤ºæº¢å‡ºå…§å®¹ */
        }

        /* å„ªåŒ–æ‰‹æ©Ÿç‰ˆå ±åƒ¹å¡ç‰‡æ¨£å¼ - åœ¨å°å±å¹•ä¸Šçš„é©é… */
        @media screen and (max-width: 480px) {
            #shareQuoteCard {
                width: 95%;                                  /* å®¹å™¨å¯¬åº¦ */
                max-width: 340px;                            /* æœ€å¤§å¯¬åº¦ */
                margin: 0 auto;                              /* æ°´å¹³å±…ä¸­ */
            }
            
            #shareQuoteCard img {
                width: 100%;                                 /* å¯¬åº¦100% */
                max-width: 340px;                            /* æœ€å¤§å¯¬åº¦ */
            }
            
            .modal-container {
                width: 95%;                                  /* å®¹å™¨å¯¬åº¦ */
                max-width: 350px;                            /* æœ€å¤§å¯¬åº¦ */
            }
            
            .modal-content {
                padding: 5px !important;                     /* å¼·åˆ¶å…§éƒ¨é–“è· */
            }
            
            #shareOptions {
                gap: 8px;                                    /* æŒ‰éˆ•é–“è· */
            }
            
            #shareOptions button {
                font-size: 14px;                             /* æ–‡å­—å¤§å° */
                padding: 8px 12px;                           /* å…§éƒ¨é–“è· */
            }
        }

        /* é¸å–®å®¹å™¨æ¨£å¼ - å´é‚Šé¸å–®çš„å…¨å±èƒŒæ™¯ */
        .menu-container {
            position: fixed;                                 /* å›ºå®šå®šä½ */
            top: 0;                                          /* è²¼é½Šé ‚éƒ¨ */
            left: 0;                                         /* è²¼é½Šå·¦å´ */
            width: 100%;                                     /* å¯¬åº¦100% */
            height: 100%;                                    /* é«˜åº¦100% */
            background-color: rgba(0, 0, 0, 0.7);            /* æ·±è‰²åŠé€æ˜èƒŒæ™¯ */
            backdrop-filter: blur(10px);                     /* èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */
            -webkit-backdrop-filter: blur(10px);             /* Safariæ”¯æŒ */
            z-index: 2500;                                   /* å±¤ç´š */
            display: none;                                   /* åˆå§‹éš±è— */
            justify-content: flex-start;                     /* å·¦å°é½Š */
            align-items: flex-start;                         /* é ‚éƒ¨å°é½Š */
            opacity: 0;                                      /* åˆå§‹é€æ˜ */
            transition: opacity 0.3s ease;                   /* é€æ˜åº¦éæ¸¡ */
        }

        .menu-container.show {
            opacity: 1;                                      /* é¡¯ç¤ºæ™‚ä¸é€æ˜ */
        }

        /* é¸å–®å…§å®¹æ¨£å¼ - å´é‚Šæ¬„çš„ä¸»è¦å…§å®¹å€åŸŸ */
        .menu-content {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            width: 85%;                                      /* å®¹å™¨å¯¬åº¦ */
            max-width: 320px;                                /* æœ€å¤§å¯¬åº¦ */
            height: 100%;                                    /* é«˜åº¦100% */
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.4);      /* æ›´æ·±çš„é™°å½± */
            overflow: hidden;                                /* éš±è—æº¢å‡ºå…§å®¹ */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            flex-direction: column;                          /* å‚ç›´æ’åˆ— */
            transform-origin: left;                          /* è®Šå½¢åŸé» */
            transform: translateX(-100%);                    /* åˆå§‹ä½ç½®åœ¨å·¦å´å¤– */
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* å¹³æ»‘å‹•ç•« */
        }

        .menu-container.show .menu-content {
            transform: translateX(0);                        /* é¡¯ç¤ºæ™‚ç§»åˆ°æ­£å¸¸ä½ç½® */
        }

        /* é¸å–®é ­éƒ¨æ¨£å¼ - åŒ…å«æ¨™é¡Œå’Œé—œé–‰æŒ‰éˆ•çš„é ‚éƒ¨å€åŸŸ */
        .menu-header {
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            border-bottom: none;                             /* ç§»é™¤é‚Šæ¡† */
            padding: 20px;                                   /* å…§éƒ¨é–“è· */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            justify-content: space-between;                  /* å…©ç«¯å°é½Š */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);      /* é™°å½±æ•ˆæœ */
        }

        /* é¸å–®æ¨™é¡Œæ¨£å¼ - é ‚éƒ¨æ¨™é¡Œæ–‡å­— */
        .menu-header h3 {
            margin: 0;                                       /* ç§»é™¤å¤–éƒ¨é–“è· */
            color: white;                                    /* ç™½è‰²æ–‡å­— */
            font-size: 24px;                                 /* æ–‡å­—å¤§å° */
            font-weight: 300;                                /* è¼ƒç´°å­—é«” */
            letter-spacing: 1px;                             /* å­—æ¯é–“è· */
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);      /* æ–‡å­—é™°å½± */
        }

        /* é¸å–®é—œé–‰æŒ‰éˆ•æ¨£å¼ - ç”¨æ–¼é—œé–‰å´é‚Šé¸å–® */
        .menu-close-btn {
            background: none;                                /* ç„¡èƒŒæ™¯ */
            border: none;                                    /* ç„¡é‚Šæ¡† */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            font-size: 24px;                                 /* æ–‡å­—å¤§å° */
            cursor: pointer;                                 /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: color 0.3s ease;                     /* åªéæ¸¡é¡è‰² */
            padding: 0;                                      /* ç§»é™¤å…§éƒ¨é–“è· */
            line-height: 1;                                  /* è¡Œé«˜è¨­ç‚º1 */
        }

        /* é¸å–®é—œé–‰æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .menu-close-btn:hover {
            color: var(--button-orange);                     /* æ©™è‰²æ–‡å­— */
        }

        /* é¸å–®åˆ—è¡¨æ¨£å¼ - é¸å–®é …ç›®çš„åˆ—è¡¨å®¹å™¨ */
        .menu-list {
            flex: 1;                                         /* ä½”ç”¨å‰©é¤˜ç©ºé–“ */
            overflow-y: auto;                                /* å‚ç›´æ»¾å‹• */
            margin: 0;                                       /* ç§»é™¤å¤–éƒ¨é–“è· */
            padding: 0;                                      /* ç§»é™¤å…§éƒ¨é–“è· */
            list-style: none;                                /* ç§»é™¤åˆ—è¡¨æ¨£å¼ */
        }

        /* é¸å–®é …ç›®æ¨£å¼ - å–®å€‹é¸å–®é¸é …çš„æ¨£å¼ */
        .menu-item {
            padding: 18px 24px;                              /* å…§éƒ¨é–“è· */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* ç´°å¾®é‚Šæ¡† */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            cursor: pointer;                                 /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: all 0.3s ease;                       /* éæ¸¡æ•ˆæœ */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            justify-content: space-between;                  /* å…©ç«¯å°é½Š */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            font-size: 16px;                                 /* æ–‡å­—å¤§å° */
            font-weight: 400;                                /* æ­£å¸¸å­—é‡ */
            position: relative;                              /* ç›¸å°å®šä½ */
            overflow: hidden;                                /* éš±è—æº¢å‡º */
        }

        .menu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background-color: var(--accent-color);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        /* é¸å–®é …ç›®æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„èƒŒæ™¯è®ŠåŒ– */
        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.05);     /* å¾®é€æ˜ç™½è‰²èƒŒæ™¯ */
            padding-left: 32px;                              /* å¢åŠ å·¦å…§è· */
            color: var(--accent-color);                      /* å¼·èª¿è‰²æ–‡å­— */
        }

        .menu-item:hover::before {
            transform: translateX(0);                        /* é¡¯ç¤ºå·¦å´æ¢ */
        }

        /* é¸å–®é …ç›®é»æ“Šæ•ˆæœ - é»æ“Šæ™‚çš„èƒŒæ™¯è®ŠåŒ– */
        .menu-item:active {
            background-color: rgba(255, 156, 51, 0.2);       /* åŠé€æ˜æ©™è‰²èƒŒæ™¯ */
        }

        /* é¸å–®é …ç›®ç®­é ­æ¨£å¼ - æŒ‡ç¤ºå­é¸å–®çš„ç®­é ­åœ–æ¨™ */
        .menu-item-arrow {
            font-size: 12px;                                 /* æ–‡å­—å¤§å° */
            transition: transform 0.3s ease;                 /* éæ¸¡æ•ˆæœ */
        }

        /* æ·»åŠ åˆ†éš”ç·šæ•ˆæœ - ç‚ºé¸å–®é …ç›®æ·»åŠ åº•éƒ¨åˆ†éš”ç·š */
        .menu-item, .submenu-item {
            position: relative;                              /* ç›¸å°å®šä½ */
        }

        /* é¸å–®é …ç›®åˆ†éš”ç·š - åº•éƒ¨æ¼¸è®Šåˆ†éš”ç·šæ•ˆæœ */
        .menu-item:after, .submenu-item:after {
            content: '';                                     /* å‰µå»ºç©ºå…§å®¹ */
            position: absolute;                              /* çµ•å°å®šä½ */
            bottom: 0;                                       /* è²¼é½Šåº•éƒ¨ */
            left: 15px;                                      /* è·å·¦å´è·é›¢ */
            right: 15px;                                     /* è·å³å´è·é›¢ */
            height: 1px;                                     /* é«˜åº¦1åƒç´  */
            background: linear-gradient(to right, transparent, var(--border-color), transparent); /* æ¼¸è®ŠèƒŒæ™¯ */
        }

        /* å­é¸å–®å®¹å™¨æ¨£å¼ - èˆ‡ä¸»é¸å–®é¡ä¼¼çš„å…¨å±èƒŒæ™¯ */
        .submenu-container {
            position: fixed;                                 /* å›ºå®šå®šä½ */
            top: 0;                                          /* è²¼é½Šé ‚éƒ¨ */
            left: 0;                                         /* è²¼é½Šå·¦å´ */
            width: 100%;                                     /* å¯¬åº¦100% */
            height: 100%;                                    /* é«˜åº¦100% */
            background-color: rgba(0, 0, 0, 0.7);            /* æ·±è‰²åŠé€æ˜èƒŒæ™¯ */
            backdrop-filter: blur(10px);                     /* èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */
            -webkit-backdrop-filter: blur(10px);             /* Safariæ”¯æŒ */
            z-index: 2600;                                   /* å±¤ç´š */
            display: none;                                   /* åˆå§‹éš±è— */
            justify-content: flex-start;                     /* å·¦å°é½Š */
            align-items: flex-start;                         /* é ‚éƒ¨å°é½Š */
            opacity: 0;                                      /* åˆå§‹é€æ˜ */
            transition: opacity 0.3s ease;                   /* é€æ˜åº¦éæ¸¡ */
        }

        .submenu-container.show {
            opacity: 1;                                      /* é¡¯ç¤ºæ™‚ä¸é€æ˜ */
        }

        /* å­é¸å–®å…§å®¹æ¨£å¼ - èˆ‡ä¸»é¸å–®é¡ä¼¼çš„å´é‚Šæ¬„ */
        .submenu-content {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            width: 85%;                                      /* å®¹å™¨å¯¬åº¦ */
            max-width: 320px;                                /* æœ€å¤§å¯¬åº¦ */
            height: 100%;                                    /* é«˜åº¦100% */
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.4);      /* æ›´æ·±çš„é™°å½± */
            overflow: hidden;                                /* éš±è—æº¢å‡ºå…§å®¹ */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            flex-direction: column;                          /* å‚ç›´æ’åˆ— */
            transform-origin: left;                          /* è®Šå½¢åŸé» */
            transform: translateX(-100%);                    /* åˆå§‹ä½ç½®åœ¨å·¦å´å¤– */
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* å¹³æ»‘å‹•ç•« */
        }

        .submenu-container.show .submenu-content {
            transform: translateX(0);                        /* é¡¯ç¤ºæ™‚ç§»åˆ°æ­£å¸¸ä½ç½® */
        }

        /* å­é¸å–®é ­éƒ¨æ¨£å¼ - åŒ…å«æ¨™é¡Œå’Œè¿”å›æŒ‰éˆ•çš„é ‚éƒ¨å€åŸŸ */
        .submenu-header {
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            border-bottom: none;                             /* ç§»é™¤é‚Šæ¡† */
            padding: 20px;                                   /* å…§éƒ¨é–“è· */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            justify-content: space-between;                  /* å…©ç«¯å°é½Š */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);      /* é™°å½±æ•ˆæœ */
        }

        /* å­é¸å–®æ¨™é¡Œæ¨£å¼ - é ‚éƒ¨æ¨™é¡Œæ–‡å­— */
        .submenu-header h3 {
            margin: 0;                                       /* ç§»é™¤å¤–éƒ¨é–“è· */
            color: white;                                    /* ç™½è‰²æ–‡å­— */
            font-size: 24px;                                 /* æ–‡å­—å¤§å° */
            font-weight: 300;                                /* è¼ƒç´°å­—é«” */
            letter-spacing: 1px;                             /* å­—æ¯é–“è· */
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);      /* æ–‡å­—é™°å½± */
        }

        /* å­é¸å–®æ¨™é¡Œåº•éƒ¨æ©˜è‰²ç·šæ¢ */
        .submenu-header h3::after {
            content: '';
            display: block;
            width: 50px;
            height: 3px;
            background-color: var(--accent-color);
            margin-top: 8px;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .submenu-header:hover h3::after {
            width: 80px;
        }

        /* é¸å–®æ¨™é¡Œæ¨£å¼ - é ‚éƒ¨æ¨™é¡Œæ–‡å­— */
        .menu-header h3 {
            margin: 0;                                       /* ç§»é™¤å¤–éƒ¨é–“è· */
            color: var(--accent-color);                      /* å¼·èª¿è‰²æ–‡å­— */
            font-size: 22px;                                 /* æ–‡å­—å¤§å° */
            font-weight: bold;                               /* æ–‡å­—ç²—ç´° */
        }

        /* å­é¸å–®è¿”å›æŒ‰éˆ•æ¨£å¼ - è¿”å›ä¸»é¸å–®çš„æŒ‰éˆ• */
        .submenu-back-btn {
            background: none;                                /* ç„¡èƒŒæ™¯ */
            border: none;                                    /* ç„¡é‚Šæ¡† */
            color: rgba(255, 255, 255, 0.8);                /* åŠé€æ˜ç™½è‰² */
            font-size: 18px;                                 /* æ–‡å­—å¤§å° */
            cursor: pointer;                                 /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: all 0.3s ease;                       /* éæ¸¡æ•ˆæœ */
            display: flex;                                   /* å½ˆæ€§å¸ƒå±€ */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            gap: 8px;                                        /* é–“è· */
            padding: 0;                                      /* ç§»é™¤å…§é‚Šè· */
        }

        /* å­é¸å–®è¿”å›æŒ‰éˆ•æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .submenu-back-btn:hover {
            color: var(--button-orange);                     /* æ©™è‰²æ–‡å­— */
            transform: translateX(-3px);                     /* è¼•å¾®å·¦ç§» */
        }

        /* å­é¸å–®åˆ—è¡¨æ¨£å¼ - å­é¸å–®é …ç›®çš„åˆ—è¡¨å®¹å™¨ */
        .submenu-list {
            flex: 1;                                         /* ä½”ç”¨å‰©é¤˜ç©ºé–“ */
            overflow-y: auto;                                /* å‚ç›´æ»¾å‹• */
            margin: 0;                                       /* ç§»é™¤å¤–éƒ¨é–“è· */
            padding: 0;                                      /* ç§»é™¤å…§éƒ¨é–“è· */
            list-style: none;                                /* ç§»é™¤åˆ—è¡¨æ¨£å¼ */
        }

        /* å­é¸å–®é …ç›®æ¨£å¼ - å–®å€‹å­é¸å–®é¸é …çš„æ¨£å¼ */
        .submenu-item {
            padding: 18px 24px;                              /* å…§éƒ¨é–“è· */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* ç´°å¾®é‚Šæ¡† */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            cursor: pointer;                                 /* æ»‘é¼ æŒ‡æ¨™è®Šç‚ºæ‰‹å‹ */
            transition: all 0.3s ease;                       /* éæ¸¡æ•ˆæœ */
            font-size: 16px;                                 /* æ–‡å­—å¤§å° */
            font-weight: 400;                                /* æ­£å¸¸å­—é‡ */
            position: relative;                              /* ç›¸å°å®šä½ */
            overflow: hidden;                                /* éš±è—æº¢å‡º */
        }

        .submenu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background-color: var(--accent-color);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        /* å­é¸å–®é …ç›®æ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„èƒŒæ™¯è®ŠåŒ– */
        .submenu-item:hover {
            background-color: rgba(255, 255, 255, 0.05);     /* å¾®é€æ˜ç™½è‰²èƒŒæ™¯ */
            padding-left: 32px;                              /* å¢åŠ å·¦å…§è· */
            color: var(--accent-color);                      /* å¼·èª¿è‰²æ–‡å­— */
        }

        .submenu-item:hover::before {
            transform: translateX(0);                        /* é¡¯ç¤ºå·¦å´æ¢ */
        }

        /* å­é¸å–®é …ç›®é»æ“Šæ•ˆæœ - é»æ“Šæ™‚çš„èƒŒæ™¯è®ŠåŒ– */
        .submenu-item:active {
            background-color: rgba(255, 156, 51, 0.2);       /* åŠé€æ˜æ©™è‰²èƒŒæ™¯ */
        }

        /* ç‰ˆæœ¬ä¿¡æ¯æ¨£å¼ - é¡¯ç¤ºåœ¨é¸å–®åº•éƒ¨çš„ç‰ˆæœ¬è™Ÿ */
        .version-info {
            padding: 20px;                                   /* å…§éƒ¨é–“è· */
            font-size: 12px;                                 /* æ–‡å­—å¤§å° */
            color: rgba(255, 255, 255, 0.5);                /* åŠé€æ˜ç™½è‰²æ–‡å­— */
            text-align: center;                              /* æ–‡å­—å±…ä¸­ */
            border-top: 1px solid rgba(255, 255, 255, 0.1); /* é ‚éƒ¨é‚Šæ¡† */
            background-color: rgba(0, 0, 0, 0.2);            /* æ·±è‰²èƒŒæ™¯ */
            margin-top: auto;                                /* æ¨åˆ°åº•éƒ¨ */
            font-weight: 300;                                /* ç´°å­—é«” */
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ - å¹³æ¿åŠä»¥ä¸Šè¨­å‚™çš„é©é… */
        @media screen and (min-width: 768px) {
            .menu-content, .submenu-content {
                width: 320px;                                /* å›ºå®šå¯¬åº¦ */
            }
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ - æ¡Œé¢è¨­å‚™çš„é©é… */
        @media screen and (min-width: 1024px) {
            .menu-btn {
                width: 24px;                                 /* æŒ‰éˆ•å¯¬åº¦ */
                height: 24px;                                /* æŒ‰éˆ•é«˜åº¦ */
                font-size: 18px;                             /* æ–‡å­—å¤§å° */
                left: 12px;                                  /* è·å·¦å´è·é›¢ */
            }
            
            .menu-item, .submenu-item {
                padding: 14px 18px;                          /* å…§éƒ¨é–“è· */
            }
            
            .menu-header h3, .submenu-header h3 {
                font-size: 20px;                             /* æ–‡å­—å¤§å° */
            }
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ - å°å‹æ‰‹æ©Ÿçš„é©é… */
        @media screen and (max-width: 480px) {
            .menu-content, .submenu-content {
                width: 85%;                                  /* æ›´å¯¬çš„æ¯”ä¾‹ */
            }
        }

        /* ä¸»é¡Œç›¸é—œå…ƒç´ æ¨£å¼èª¿æ•´ - ç¢ºä¿å…ƒç´ ä½¿ç”¨ä¸»é¡Œè®Šé‡ */
        .row {
            background-color: var(--secondary-color);        /* ä½¿ç”¨æ¬¡è¦èƒŒæ™¯è‰² */
            border-left: 3px solid transparent;              /* é€æ˜å·¦å´é‚Šæ¡† */
            transition: all var(--transition-normal) ease;   /* ä½¿ç”¨ä¸»é¡Œéæ¸¡æ™‚é–“ */
        }

        /* è¡Œæ‡¸åœæ•ˆæœ - é¼ æ¨™æ‡¸åœæ™‚çš„è¦–è¦ºè®ŠåŒ– */
        .row:hover {
            transform: translateX(5px);                      /* å³ç§»æ•ˆæœ */
            box-shadow: 0 6px 12px var(--shadow-color);      /* å¢å¼·é™°å½± */
        }

        /* è¡Œæ‡¸åœæ™‚çš„å·¦å´é‚Šæ¡† - é¼ æ¨™æ‡¸åœæ™‚é¡¯ç¤ºå¼·èª¿è‰²é‚Šæ¡† */
        .row:hover::before {
            background: var(--accent-color);                 /* ä½¿ç”¨å¼·èª¿è‰² */
        }

        /* è¡Œæ¨™ç±¤æ–‡å­—é¡è‰² - ä½¿ç”¨ä¸»é¡Œæ–‡å­—è‰² */
        .row .label {
            color: var(--text-color);                        /* ä½¿ç”¨æ–‡å­—é¡è‰² */
        }

        /* å¼·èª¿è¡Œæ¨£å¼ - ç‰¹æ®Šçªå‡ºé¡¯ç¤ºçš„è¡Œ */
        .emphasized-row {
            border-left: 3px solid var(--accent-color);      /* å¼·èª¿è‰²å·¦å´é‚Šæ¡† */
            background: linear-gradient(90deg, var(--accent-color-light), transparent); /* æ¼¸è®ŠèƒŒæ™¯ */
        }

        /* å¼·èª¿è¡Œæ¨™ç±¤æ–‡å­—é¡è‰² - ä½¿ç”¨å¼·èª¿è‰² */
        .emphasized-row .label {
            color: var(--accent-color);                      /* å¼·èª¿è‰²æ–‡å­— */
        }

        /* å¼·èª¿è¡Œè¼¸å…¥æ¡†é‚Šæ¡† - ä½¿ç”¨å¼·èª¿è‰²é‚Šæ¡† */
        .emphasized-row input {
            border-color: var(--accent-color);               /* å¼·èª¿è‰²é‚Šæ¡† */
        }

        /* è¼¸å…¥æ¡†æ¨£å¼ - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        input {
            background-color: var(--input-bg);               /* ä½¿ç”¨è¼¸å…¥æ¡†èƒŒæ™¯è‰² */
            color: var(--text-color);                        /* ä½¿ç”¨æ–‡å­—é¡è‰² */
            border: 1px solid var(--input-border);           /* ä½¿ç”¨è¼¸å…¥æ¡†é‚Šæ¡†è‰² */
        }

        /* è¼¸å…¥æ¡†èšç„¦æ•ˆæœ - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        input:focus {
            border-color: var(--accent-color);               /* å¼·èª¿è‰²é‚Šæ¡† */
            box-shadow: 0 0 0 3px var(--accent-color-light); /* æ·¡è‰²å¼·èª¿é™°å½± */
        }

        /* æŒ‰éˆ•æ¨£å¼ - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        button {
            background-color: var(--secondary-color);        /* æ¬¡è¦èƒŒæ™¯è‰² */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            border: 1px solid var(--border-color);           /* é‚Šæ¡†è‰² */
        }

        /* æŒ‰éˆ•æ‡¸åœæ•ˆæœ - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        button:hover {
            background-color: var(--hover-color);            /* æ‡¸åœèƒŒæ™¯è‰² */
        }

        /* åŠŸèƒ½æŒ‰éˆ•æ¨£å¼ - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        .function-buttons button {
            background-color: var(--secondary-color);        /* æ¬¡è¦èƒŒæ™¯è‰² */
            color: var(--text-color);                        /* æ–‡å­—é¡è‰² */
            border: 1px solid var(--accent-color);           /* å¼·èª¿è‰²é‚Šæ¡† */
        }

        /* åŠŸèƒ½æŒ‰éˆ•æ‡¸åœæ•ˆæœ - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        .function-buttons button:hover {
            background-color: var(--accent-color);           /* å¼·èª¿è‰²èƒŒæ™¯ */
        }

        /* æç¤ºè¨Šæ¯æ¨£å¼ - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        .toast-message {
            background-color: var(--info-color);             /* ä¿¡æ¯è‰²èƒŒæ™¯ */
        }

        /* éŒ¯èª¤æç¤ºæ¨£å¼ - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        .toast-error {
            background-color: var(--error-color);            /* éŒ¯èª¤è‰²èƒŒæ™¯ */
        }

        /* è­¦å‘Šæ–‡å­—æ¨£å¼ - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        .warning-text {
            color: var(--error-color) !important;            /* å¼·åˆ¶ä½¿ç”¨éŒ¯èª¤è‰²æ–‡å­— */
        }

        /* æ­·å²è¨˜éŒ„é …ç›®å·¦å´é‚Šæ¡† - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        .history-item {
            border-left: 3px solid var(--accent-color);      /* å¼·èª¿è‰²å·¦å´é‚Šæ¡† */
        }

        /* æ­·å²è¨˜éŒ„æ—¥æœŸæ–‡å­—é¡è‰² - æ‡‰ç”¨ä¸»é¡Œè®Šé‡ */
        .history-date {
            color: var(--accent-color);                      /* å¼·èª¿è‰²æ–‡å­— */
        }

        /* ç™½è‰²ä¸»é¡Œè¼¸å…¥æ¡†èƒŒæ™¯ - ç‚ºç™½è‰²ä¸»é¡Œæä¾›ç‰¹å®šæ¨£å¼ */
        :root[data-theme="white"] input,
        :root[data-theme="white"] .row,
        :root[data-theme="white"] #timeDisplay,
        :root[data-theme="white"] .sticky-header,
        :root[data-theme="white"] .modal-container {
            background-color: var(--secondary-color);        /* ä½¿ç”¨æ¬¡è¦èƒŒæ™¯è‰² */
        }

        /* æœŸæ•¸æ–¹æ¡ˆå°æ¯”è¡¨æ ¼æ¨£å¼ */
        .period-comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
        }

        .period-comparison-table th, 
        .period-comparison-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .period-comparison-table th {
            background-color: var(--secondary-color);
            font-weight: bold;
        }

        .period-comparison-table tr:nth-child(even) {
            background-color: var(--secondary-color);
        }

        .period-comparison-table tr:nth-child(odd) {
            background-color: var(--primary-color);
        }

        .period-comparison-table tr:hover {
            background-color: var(--hover-color);
        }

        .select-plan-btn {
            padding: 5px 8px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .select-plan-btn:hover {
            background-color: var(--accent-color-dark);
            transform: translateY(-2px);
        }

        .select-plan-btn:active {
            transform: translateY(0);
        }

        /* æ·»åŠ åˆ°æ ·å¼è¡¨çš„.history-itemç›¸å…³éƒ¨åˆ†ä¹‹å */
        .checkbox-date-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-item-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.2s ease;
            margin: 0;
            flex-shrink: 0;
        }

        .history-item-checkbox:checked {
            accent-color: var(--accent-color);
        }

        .history-item-checkbox:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .compare-selected-btn {
            background: rgba(var(--accent-color-rgb), 0.15);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin-right: 10px;
        }

        .compare-selected-btn:hover:not(:disabled) {
            background-color: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 5px rgba(var(--accent-color-rgb), 0.4);
        }

        .compare-selected-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(150, 150, 150, 0.15);
            border: 1px solid #999;
            color: #999;
        }

        .comparison-highlight {
            border-left: 3px solid #33b5e5 !important;
            background: linear-gradient(90deg, rgba(51, 181, 229, 0.1), transparent) !important;
        }

        /* æç¤ºè¦–çª—çš„èƒŒæ™¯é®ç½© */
        .install-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        /* æç¤ºè¦–çª— */
        .install-modal {
            width: 90%;
            max-width: 350px;
            background-color: var(--secondary-color);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border: 3px solid #ff0000; /* ç´…è‰²å¤–æ¡† */
        }

        /* æç¤ºè¦–çª—æ¨™é¡Œ */
        .install-modal-title {
            background-color: #ff0000; /* ç´…è‰²èƒŒæ™¯ */
            color: white;
            padding: 12px 15px;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin: 0;
        }

        /* æç¤ºè¦–çª—å…§å®¹ */
        .install-modal-content {
            padding: 15px;
            color: var(--text-color);
            font-size: 13px;
            line-height: 1.4;
            text-align: center;
        }

        /* æç¤ºè¦–çª—æŒ‰éˆ•å€åŸŸ */
        .install-modal-buttons {
            display: flex;
            padding: 10px 15px 15px;
            justify-content: center;
            gap: 15px;
        }

        /* æç¤ºè¦–çª—æŒ‰éˆ• */
        .install-modal-btn {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            text-align: center;
        }

        /* ç¢ºèªæŒ‰éˆ• */
        .install-btn-confirm {
            background-color: var(--accent-color);
            color: white;
        }

        /* å–æ¶ˆæŒ‰éˆ• */
        .install-btn-cancel {
            background-color: #666;
            color: white;
        }

        /* å®‰è£æç¤ºå€åŸŸ */
        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--secondary-color);
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
            z-index: 9998;
        }

        /* å®‰è£æç¤ºæ–‡å­— */
        .install-banner-text {
            flex: 1;
            font-size: 14px;
            color: var(--text-color);
        }

        /* å®‰è£æŒ‰éˆ• */
        .install-banner-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
        }

        /* é—œé–‰å®‰è£æç¤ºæŒ‰éˆ• */
        .install-banner-close {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 24px;
            line-height: 1;
            padding: 0;
            margin-right: 5px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        /* æ«»èŠ±é›ªä¸»é¡Œçš„è¼¸å…¥æ¡†æ¨£å¼å„ªåŒ– */
        :root[data-theme="pink"] input {
            color: #b8306a !important;            /* ä½¿ç”¨æ·±æ«»èŠ±è‰²æ–‡å­— */
            background-color: #fffafc !important; /* ä½¿ç”¨æ¥µæ·¡ç²‰è‰²èƒŒæ™¯ */
            border: 1px solid #ffb6c1 !important; /* ç²‰è‰²é‚Šæ¡† */
        }

        /* æ«»èŠ±é›ªä¸»é¡Œçš„è¼¸å…¥æ¡†èšç„¦æ•ˆæœå„ªåŒ– */
        :root[data-theme="pink"] input:focus {
            border-color: #db386c !important;      /* æ·±ç²‰è‰²é‚Šæ¡† */
            box-shadow: 0 0 0 3px rgba(219, 56, 108, 0.2) !important; /* æ·±ç²‰è‰²é™°å½± */
        }

        /* æ«»èŠ±é›ªä¸»é¡Œä¸‹ç‰¹æ®Šè¼¸å…¥æ¡†å„ªåŒ– */
        :root[data-theme="pink"] #afterCommissionRate {
            color: #b8306a !important;             /* ä½¿ç”¨æ·±æ«»èŠ±è‰²æ–‡å­— */
            background-color: rgba(219, 56, 108, 0.08) !important; /* éå¸¸æ·¡çš„ç²‰è‰²èƒŒæ™¯ */
            border: 1px solid rgba(219, 56, 108, 0.4) !important;  /* åŠé€æ˜ç²‰è‰²é‚Šæ¡† */
        }

        /* æ«»èŠ±é›ªä¸»é¡Œçš„æŒ‰éˆ•æ¨£å¼å„ªåŒ– */
        :root[data-theme="pink"] button {
            background-color: #fce4ec !important;  /* æ·¡ç²‰è‰²èƒŒæ™¯ */
            color: #b8306a !important;             /* æ·±æ«»èŠ±è‰²æ–‡å­— */
            border: 1px solid #ffb6c1 !important;  /* ç²‰è‰²é‚Šæ¡† */
        }

        :root[data-theme="pink"] button:hover {
            background-color: #ffd1dc !important;  /* æ‡¸åœæ™‚ç¨æ·±çš„ç²‰è‰² */
        }

        /* æ«»èŠ±é›ªä¸»é¡Œçš„å”¯è®€æ¬„ä½ */
        :root[data-theme="pink"] .readonly {
            background-color: #fffafc !important;  /* æ¥µæ·¡ç²‰è‰²èƒŒæ™¯ */
            color: #b8306a !important;             /* æ·±æ«»èŠ±è‰²æ–‡å­— */
        }

        /* æ«»èŠ±é›ªä¸»é¡Œçš„åˆ†éš”ç·š */
        :root[data-theme="pink"] .divider-flow {
            background: linear-gradient(90deg, 
                #fce4ec 0%,
                #ffb6c1 50%,
                #fce4ec 100%);                     /* ç²‰è‰²æ¼¸è®Š */
        }

        /* ä¸­æ–‡åœ‹å­—å¤§å¯«æ¬„ä½æ¨£å¼ */
        .chinese-amount-row {
            margin: 4px 0;
            display: flex;
            align-items: center;
            background: var(--secondary-color);
            padding: 3px;
            border-radius: 4px;
            box-shadow: 0 4px 8px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            transform-origin: left;
            will-change: transform;
        }

        .chinese-amount-result {
            width: 100%;
            padding: 6px 8px;
            margin-bottom: 0;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 18px;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            min-height: 42px;
            max-height: 76px;
            overflow-y: auto;
            overflow-x: auto;
            white-space: normal;
            word-wrap: break-word;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            display: block;
            text-align: right;
            line-height: 1.2;
            margin-left: 3px;
        }

        .chinese-amount-result::after {
            content: attr(data-placeholder);
            opacity: 0.5;
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            color: #888888;
            font-size: 16px;
            white-space: nowrap;
            pointer-events: none;
        }

        .chinese-amount-result:not(:empty)::after {
            display: none;
        }

        /* å°ˆé–€ç‚ºä¸­æ–‡åœ‹å­—å¤§å¯«æ·»åŠ çš„æ¨£å¼ */
        .financial-digit {
            color: #FFBE7A;
            display: inline;
        }

        /* ç¸½ç¹³æ¬¾ä¸­æ–‡åœ‹å­—å¤§å¯«æ¬„ä½æ¨£å¼ */
        .total-payment-chinese-row {
            margin: 4px 0;
            display: flex;
            align-items: center;
            background: var(--secondary-color);
            padding: 3px;
            border-radius: 4px;
            box-shadow: 0 4px 8px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            transform-origin: left;
            will-change: transform;
        }

        .total-payment-chinese-result {
            width: 100%;
            padding: 6px 8px;
            margin-bottom: 0;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 18px;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            min-height: 42px;
            max-height: 76px;
            overflow-y: auto;
            overflow-x: auto;
            white-space: normal;
            word-wrap: break-word;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            display: block;
            text-align: right;
            line-height: 1.2;
            margin-left: 3px;
        }

        .total-payment-chinese-result::after {
            content: attr(data-placeholder);
            opacity: 0.5;
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            color: #888888;
            font-size: 16px;
            white-space: nowrap;
            pointer-events: none;
        }

        .total-payment-chinese-result:not(:empty)::after {
            display: none;
        }

        /* ä¸­æ–‡å¤§å¯«æ¬„ä½çš„ç‰¹æ®Šæ¨™ç±¤æ¨£å¼ - è®“ç™¼ç¥¨å’Œç¸½ç¹³çš„æ¨™ç±¤èˆ‡è¼¸å…¥æ¡†é–“è·æ›´åˆç† */
        .chinese-amount-row .label,
        .total-payment-chinese-row .label {
            margin-right: 3px;                  /* ä¿æŒèˆ‡æœªç¨…é‡‘é¡ç›¸åŒçš„é–“è· */
        }

        /* ä¸­æ–‡å¤§å¯«æ¬„ä½çš„çµæœé¡¯ç¤ºæ¡†èª¿æ•´ - è®“è¼¸å…¥æ¡†å‘å·¦å»¶ä¼¸ */
        .chinese-amount-result,
        .total-payment-chinese-result {
            margin-left: 3px !important;         /* æ¸›å°‘å·¦å´é‚Šè·ï¼Œè®“è¼¸å…¥æ¡†æ›´å¯¬ */
        }

        /* æœŸæ•¸æ–¹æ¡ˆå°æ¯”å…¨è¢å¹•æ¨£å¼ */
        #paymentComparisonModal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            background-color: var(--primary-color) !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        #paymentComparisonModal .modal-container {
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            margin: 0 !important;
            border-radius: 0 !important;
            display: flex !important;
            flex-direction: column !important;
        }

        #paymentComparisonModal .modal-header {
            flex-shrink: 0;
        }

        #paymentComparisonModal .modal-content {
            flex: 1;
            overflow-y: auto;
            background-color: var(--primary-color);
            padding: 15px;
            padding-bottom: 20px; /* åº•éƒ¨ç•™ä¸€é»ç©ºé–“ */
        }

        /* ç¢ºä¿è¡¨æ ¼èƒ½å……åˆ†åˆ©ç”¨ç©ºé–“ */
        #paymentComparisonModal table {
            margin-bottom: 10px;
        }

        /* èª¿æ•´æ¨™é¡Œå€åŸŸæ¨£å¼ */
        #paymentComparisonModal .modal-header {
            position: sticky;
            top: 0;
            background-color: var(--secondary-color);
            z-index: 100;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        #paymentComparisonModal .modal-footer {
            flex-shrink: 0;
        }

        /* å…¨è¢å¹•æ¯”è¼ƒè²¸æ¬¾æ¨£å¼ */
        #multiLoanComparisonModal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            background-color: var(--primary-color) !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        #multiLoanComparisonModal .modal-container {
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            margin: 0 !important;
            border-radius: 0 !important;
            display: flex !important;
            flex-direction: column !important;
        }

        #multiLoanComparisonModal .modal-header {
            flex-shrink: 0;
            position: sticky;
            top: 0;
            background-color: var(--secondary-color);
            z-index: 100;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        #multiLoanComparisonModal .modal-content {
            flex: 1;
            overflow-y: auto;
            background-color: var(--primary-color);
            padding-bottom: 20px; /* åº•éƒ¨ç•™ä¸€é»ç©ºé–“ */
        }

        /* è²¸æ¬¾é¸æ“‡å°è©±æ¡†å…¨è¢å¹•æ¨£å¼ */
        #loanSelectionModal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            background-color: var(--primary-color) !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        #loanSelectionModal .modal-container {
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            margin: 0 !important;
            border-radius: 0 !important;
            display: flex !important;
            flex-direction: column !important;
        }

        #loanSelectionModal .modal-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        // æª¢æ¸¬æ˜¯å¦ç‚ºç¨ç«‹å®‰è£çš„PWAæ‡‰ç”¨
        function isInstalledPWA() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }
    
        // é é¢åŠ è¼‰æ™‚æª¢æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            if (!isInstalledPWA()) {
                // å¦‚æœä¸æ˜¯å·²å®‰è£çš„PWAï¼Œé¡¯ç¤ºæç¤ºè¦–çª—
                showInstallPrompt();
            }
            // å¦‚æœæ˜¯å·²å®‰è£çš„PWAï¼Œä¸åšä»»ä½•äº‹ï¼Œç›´æ¥é¡¯ç¤ºè¨ˆç®—æ©Ÿ
        });
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

</head>
<body>

	<div class="header-container">
        <button id="menuBtn" class="header-btn header-btn-left" aria-label="é¸å–®">
            <span id="menuIcon">â‰¡</span>
        </button>
        <h1>å°æœ‹å‹å°ˆç”¨è¨ˆç®—æ©Ÿ</h1>
        <button id="toggleViewBtn" class="header-btn header-btn-right" aria-label="åˆ‡æ›è¦–åœ–">
            <span id="toggleIcon">â–¼</span>
        </button>
    </div>
	
    <div class="time-display-wrapper">
        <div id="timeDisplay" class="sticky-header">
            <div style="display: flex; justify-content: center; width: 100%;">
                <span class="time-label">å ±åƒ¹æ™‚é–“ï¼š</span>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>
    
    <div class="input-button-group">
        <div class="row">
            <span class="label">æœŸæ•¸</span>
            <input type="text" id="period" step="0.1" readonly>
            <button onclick="calculatePeriod()">ç®—</button>
            <button onclick="clearField('period')">æ¸…</button>
        </div>
    
        <div id="periodButtons">
            <button onclick="adjustPeriod(-1)">-1</button>
            <button onclick="setPeriod(13)">åº•</button>
            <button onclick="setPeriod(24)">2</button>
            <button onclick="setPeriod(36)">3</button>
            <button onclick="setPeriod(48)">4</button>
            <button onclick="setPeriod(60)">5</button>
            <button onclick="setPeriod(72)">6</button>
            <button onclick="adjustPeriod(1)">+1</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row">
            <span class="label">ç¨…å‰åˆ©ç‡</span>
            <input type="text" id="rate" step="0.001" readonly>
            <button onclick="calculateRate()">ç®—</button>
            <button onclick="clearField('rate')">æ¸…</button>
        </div>

        <div id="rateButtons">
            <button onclick="adjustRate(-0.2)">-0.2</button>
            <button onclick="setRate(4)">4</button>
            <button onclick="setRate(6)">6</button>
            <button onclick="setRate(8)">8</button>
            <button onclick="setRate(10)">10</button>
            <button onclick="setRate(13)">13</button>
            <button onclick="adjustRate(0.2)">+0.2</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row">
            <span class="label">æœ¬é‡‘</span>
            <input type="text" id="principal" min="0" readonly>
            <button onclick="calculatePrincipal()">ç®—</button>
            <button onclick="clearField('principal')">æ¸…</button>
        </div>

        <div id="principalButtons">
            <button onclick="adjustPrincipal(-1000000)">-100</button>
            <button onclick="adjustPrincipal(-100000)">-10</button>
            <button onclick="adjustPrincipal(-10000)">-1</button>
            <button onclick="adjustPrincipal(10000)">+1</button>
            <button onclick="adjustPrincipal(100000)">+10</button>
            <button onclick="adjustPrincipal(1000000)">+100</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row">
            <span class="label">æœŸç¹³</span>
            <input type="text" id="payment" step="0.01" readonly>
            <button onclick="calculatePayment()">ç®—</button>
            <button onclick="clearField('payment')">æ¸…</button>
        </div>

        <div id="PaymentduringButtons">
            <button onclick="adjustPayment(-100)">-100</button>
            <button onclick="adjustPayment(-50)">-50</button>
            <button onclick="roundPayment('down', 100)">æ¨ç™¾</button>
            <button onclick="roundPayment('up', 100)">é€²ç™¾</button>
            <button onclick="adjustPayment(50)">+50</button>
            <button onclick="adjustPayment(100)">+100</button>
        </div>
    </div>

    <div class="row">
        <span class="label">ç¸½ç¹³æ¬¾</span>
        <input type="text" id="totalPayment" class="readonly" readonly>
    </div>

	<div class="row">
        <span class="label">ç¸½åˆ©æ¯</span>
        <input type="text" id="totalInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">æ¯å¹´åˆ©æ¯</span>
        <input type="text" id="yearlyInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">æ¯æœˆåˆ©æ¯</span>
        <input type="text" id="monthlyInterest" class="readonly" readonly>
    </div>

    <div class="divider-flow"></div>

    <div class="row">
        <span class="label">ç¨…é‡‘</span>
        <input type="text" id="tax" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ç¨…å¾Œåˆ©ç‡</span>
        <input type="text" id="afterTaxRate" step="0.001" class="readonly" readonly>
    </div>

    <div class="divider-flow"></div>

    <div class="input-button-group">
        <div class="row">
            <span class="label">æ¨å»£</span>
            <input type="text" id="commission" min="0" step="1" readonly>
            <button onclick="calculateAfterCommissionRate()">ç®—</button>
            <button onclick="clearCommission()">æ¸…</button>
        </div>

        <div id="commissionButtons">
            <button onclick="adjustCommission(-10000)">-è¬</button>
            <button onclick="adjustCommission(-1000)">-åƒ</button>
            <button onclick="adjustCommission(-100)">-ç™¾</button>
            <button onclick="adjustCommission(100)">+ç™¾</button>
            <button onclick="adjustCommission(1000)">+åƒ</button>
            <button onclick="adjustCommission(10000)">+è¬</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row">
            <span class="label">æ¨å»£æ¯”ä¾‹</span>
            <input type="text" id="commissionRatio" class="readonly" readonly>
        </div>
    
        <div id="commissionPercentButtons">
            <button onclick="setCommissionPercent(1)">1%</button>
            <button onclick="setCommissionPercent(2)">2%</button>
            <button onclick="setCommissionPercent(3)">3%</button>
            <button onclick="setCommissionPercent(4)">4%</button>
            <button onclick="setCommissionPercent(5)">5%</button>
        </div>
    </div>

    <div class="row">
        <span class="label">ä½£å¾Œåˆ©ç‡</span>
        <input type="text" id="afterCommissionOnlyRate" class="readonly" readonly>
        <span class="helper-text">è³‡è²¸</span>
    </div>

    <div class="row">
        <span class="label">ç¨…ä½£å¾Œåˆ©ç‡</span>
        <input type="text" id="afterCommissionRate" class="readonly" readonly>
        <span class="helper-text">åˆ†æœŸ</span>
    </div>

    <div class="divider-flow"></div>

    <div class="row">
        <span class="label">ç™¾è¬æ¯å¹´åˆ©æ¯</span>
        <input type="text" id="annualMillionInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ç™¾è¬æ¯æœˆåˆ©æ¯</span>
        <input type="text" id="monthlyMillionInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ä¸€è¬æ¯å¹´åˆ©æ¯</span>
        <input type="text" id="annualTenThousandInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ä¸€è¬æ¯æœˆåˆ©æ¯</span>
        <input type="text" id="monthlyTenThousandInterest" class="readonly" readonly>
    </div>

    <div class="divider-flow"></div>

    <div class="row">
        <span class="label">æœ¬æœˆè³‡é‡‘æˆæœ¬</span>
        <input type="text" id="monthlyCost" value="2.2297" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">Spread</span>
        <input type="text" id="spread" class="readonly" readonly>
    </div>
	
    <div class="row">
        <span class="label">NPV</span>
        <input type="text" id="fundingCost" class="readonly" readonly>
        <span class="helper-text">ç¨…ä½£å¾Œé ä¼°</span>
    </div>

    <div class="divider-flow"></div>

    <!-- æ–°å¢ï¼šå®¢æˆ¶ç™¼ç¥¨ã€ç‡Ÿæ¥­ç¨…ã€æœªç¨…é‡‘é¡æ¬„ä½ -->
    <div class="row">
        <span class="label">å®¢æˆ¶ç™¼ç¥¨</span>
        <input type="text" id="customerInvoice" class="readonly" readonly>
    </div>
    <div class="row">
        <span class="label">ç‡Ÿæ¥­ç¨…</span>
        <input type="text" id="businessTax" class="readonly" readonly>
    </div>
    <div class="row">
        <span class="label">æœªç¨…é‡‘é¡</span>
        <input type="text" id="untaxedAmount" class="readonly" readonly>
    </div>

    <div class="row chinese-amount-row">
        <span class="label">ç™¼ç¥¨</span>
        <div class="result chinese-amount-result" id="chineseAmount" data-placeholder="å®¢æˆ¶ç™¼ç¥¨çš„ä¸­æ–‡åœ‹å­—å¤§å¯«"></div>
    </div>

    <div class="row total-payment-chinese-row">
        <span class="label">ç¸½ç¹³</span>
        <div class="result total-payment-chinese-result" id="totalPaymentChinese" data-placeholder="ç¸½ç¹³æ¬¾çš„ä¸­æ–‡åœ‹å­—å¤§å¯«"></div>
    </div>
    

    <!-- æŒ‰éˆ•å€åŸŸé‡æ–°çµ„ç¹” -->
    <div class="divider-flow"></div>

    <div class="function-buttons top-buttons">
        <div class="button-row">
            <button onclick="saveLoanData()" >ä¿å­˜è¨ˆç®—</button>
            <button onclick="toggleHistoryPanel()" >æ­·å²è¨˜éŒ„</button>
            <button onclick="compareLoan()" >æ¯”è¼ƒè²¸æ¬¾</button>
        </div>
    </div>

    <div class="divider-flow"></div>

    <div class="function-buttons bottom-buttons">
        <div class="button-row">
            <button onclick="window.open('https://travel.chiayi.gov.tw/Folder/TurkeyRice', '_blank')">é›è‚‰é£¯</button>
            <button onclick="clearAllFieldsExceptMonthlyCost()">æ¸…é™¤</button>
            <button onclick="generateQuote()">æˆªåœ–</button>
        </div>
    </div>

    <div class="footer-message">å ±åƒ¹å¾Œè¨˜å¾—åƒç¢—ç«é›è‚‰é£¯å”·ï¼</div>

    <div class="divider-flow"></div>

    <!-- æ·»åŠ æ­·å²è¨˜éŒ„é¢æ¿ -->
    <!-- é‡æ–°è®¾è®¡çš„å†å²è®°å½•é¢æ¿ -->
    <div id="historyPanel" class="history-panel">
        <div class="history-header">
            <div class="header-left">
                <h2>æ­·å²è¨˜éŒ„</h2>
            </div>
            <div class="header-right">
                <button id="compareSelectedBtn" class="compare-selected-btn" onclick="compareSelectedLoans()" disabled>æ¯”è¼ƒå‹¾é¸</button>
                <button class="delete-all-btn" onclick="confirmDeleteAll()">å…¨éƒ¨åˆªé™¤</button>
            </div>
            <button class="close-btn" onclick="toggleHistoryPanel()">Ã—</button>
        </div>
        <div id="historyContent" class="history-content"></div>
    </div>

    <!-- æ™®é€šæç¤ºæ¨¡æ…‹æ¡† -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle">æç¤º</h3>
                <button class="close-btn" onclick="hideModal()">Ã—</button>
            </div>
            <div id="modalContent" class="modal-content"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="hideModal()">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <!-- ç¢ºèªæ¨¡æ…‹æ¡† -->
    <div id="confirmModalOverlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="confirmModalTitle">ç¢ºèª</h3>
                <button class="close-btn" onclick="hideConfirmModal()">Ã—</button>
            </div>
            <div id="confirmModalContent" class="modal-content"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="hideConfirmModal()">å–æ¶ˆ</button>
                <button id="confirmModalOk" class="modal-btn modal-btn-primary">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <div class="footer-spacing"></div>

<script>

    

    window.onload = function() {
        // åƒ…åˆå§‹åŒ–æ™‚é–“é¡¯ç¤º
        updateTime();
    }

    // ç²å–è£ç½®é¡å‹
    function getDeviceType() {
        const ua = navigator.userAgent;
        if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) {
            return "tablet";
        }
        if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(ua)) {
            return "mobile";
        }
        return "desktop";
    }

    // ç²å–ç€è¦½å™¨è³‡è¨Š
    function getBrowserInfo() {
        const ua = navigator.userAgent;
        let browser = "Unknown";
        if (ua.indexOf("Chrome") > -1) browser = "Chrome";
        else if (ua.indexOf("Safari") > -1) browser = "Safari";
        else if (ua.indexOf("Firefox") > -1) browser = "Firefox";
        else if (ua.indexOf("Edge") > -1) browser = "Edge";
        else if (ua.indexOf("Opera") > -1) browser = "Opera";
        else if (ua.indexOf("MSIE") > -1 || ua.indexOf("Trident/") > -1) browser = "Internet Explorer";
        
        return `${browser} ${navigator.platform}`;
    }

	// æ·»åŠ éœ‡å‹•å‡½æ•¸
	function vibrate() {
		if (navigator.vibrate) {
		navigator.vibrate(30); // éœ‡å‹•30æ¯«ç§’
		}
	}

    // æ·»åŠ é€™å€‹æ–°å‡½æ•¸åˆ°ç¬¬ä¸€å€‹ script æ¨™ç±¤å…§ï¼ŒupdateTime å‡½æ•¸ä¹‹å‰
    function calculateNPV(payment, period, principal, monthlyCost) {
        try {
            // æª¢æŸ¥è¼¸å…¥å€¼æ˜¯å¦æœ‰æ•ˆ
            if (!payment || !period || !principal || !monthlyCost || 
                isNaN(payment) || isNaN(period) || isNaN(principal) || isNaN(monthlyCost)) {
                return 0;
            }
            
            // æª¢æŸ¥æ¥µç«¯å€¼
            if (period > 1200) { // 100å¹´
                console.warn('NPVè¨ˆç®—: æœŸæ•¸éå¤§å¯èƒ½å°è‡´è¨ˆç®—ä¸æº–ç¢º');
                period = 1200; // é™åˆ¶æœ€å¤§æœŸæ•¸
            }
            
            // å°‡å¹´åˆ©ç‡è½‰æ›ç‚ºæœˆåˆ©ç‡
            const monthlyRate = monthlyCost / 100 / 12;
            
            // è™•ç†åˆ©ç‡æ¥è¿‘0çš„æƒ…æ³
            if (Math.abs(monthlyRate) < 1e-10) {
                // å¦‚æœåˆ©ç‡æ¥è¿‘0ï¼Œä½¿ç”¨ç°¡åŒ–å…¬å¼è¨ˆç®—ç¾å€¼
                return payment * period - principal;
            }
            
            // è¨ˆç®—è²¸æ¬¾ç¾å€¼ (PV) - ä½¿ç”¨æœ¬æ¯å¹³å‡æ”¤é‚„å…¬å¼
            // PV = PMT Ã— [(1 - (1 + r)^(-n)) / r]
            const presentValue = payment * (1 - Math.pow(1 + monthlyRate, -period)) / monthlyRate;
            
            // ç²å–ç¨…é‡‘å’Œæ¨å»£è²»
            const taxElement = document.getElementById('tax');
            const commissionElement = document.getElementById('commission');
            
            // è§£æç¨…é‡‘å€¼ï¼ˆç§»é™¤åƒä½åˆ†éš”ç¬¦ï¼‰
            let tax = 0;
            if (taxElement && taxElement.value) {
                tax = parseFloat(taxElement.value.replace(/,/g, '')) || 0;
            }
            
            // è§£ææ¨å»£è²»å€¼ï¼ˆç§»é™¤åƒä½åˆ†éš”ç¬¦ï¼‰
            let commission = 0;
            if (commissionElement && commissionElement.value) {
                commission = parseFloat(commissionElement.value.replace(/,/g, '')) || 0;
            }
            
            // è¨ˆç®—æœ€çµ‚NPVï¼šè²¸æ¬¾ç¾å€¼ - ç¨…é‡‘ - æ¨å»£è²» - æœ¬é‡‘
            const npv = presentValue - tax - commission - principal;
            
            // æª¢æŸ¥è¨ˆç®—çµæœæ˜¯å¦æœ‰æ•ˆ
            if (!isFinite(npv) || isNaN(npv)) {
                console.error('NPVè¨ˆç®—çµæœç„¡æ•ˆ');
                return 0;
            }
            
            return Math.round(npv);
        } catch (error) {
            console.error('NPV è¨ˆç®—éŒ¯èª¤:', error);
            return 0;
        }
    }

    // æ·»åŠ æ›´æ–°æ™‚é–“çš„å‡½æ•¸
    function updateTime() {
        const now = new Date();
        const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        
        // èª¿æ•´ç‚ºå°åŒ—æ™‚é–“ (GMT+8)
        const taipeiTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
        
        const year = taipeiTime.getUTCFullYear();
        const month = String(taipeiTime.getUTCMonth() + 1).padStart(2, '0');
        const date = String(taipeiTime.getUTCDate()).padStart(2, '0');
        const day = days[taipeiTime.getUTCDay()];
        const hours = String(taipeiTime.getUTCHours()).padStart(2, '0');
        const minutes = String(taipeiTime.getUTCMinutes()).padStart(2, '0');
        const seconds = String(taipeiTime.getUTCSeconds()).padStart(2, '0');
        
        const timeString = `${year}å¹´${month}æœˆ${date}æ—¥
            æ˜ŸæœŸ${day} ${hours}:${minutes}:${seconds}`;
        document.getElementById('currentTime').textContent = timeString;
    }

    // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ™‚é–“
    setInterval(updateTime, 1000);
    updateTime(); // åˆå§‹åŒ–é¡¯ç¤º

    // åŸå§‹çš„JavaScriptå‡½æ•¸ä¿æŒä¸è®Š
    function PMT(rate, nper, pv) {
        // åƒæ•¸é©—è­‰
        if (!nper || nper <= 0) {
            showToast('éŒ¯èª¤ï¼šæœŸæ•¸å¿…é ˆç‚ºæ­£æ•¸', true);
            return 0;
        }
        
        if (!pv || pv <= 0) {
            showToast('éŒ¯èª¤ï¼šæœ¬é‡‘å¿…é ˆç‚ºæ­£æ•¸', true);
            return 0;
        }
        
        // è½‰æ›åˆ©ç‡ç‚ºæœˆåˆ©ç‡
        rate = rate / 100 / 12;
        
        try {
            // ç‰¹æ®Šæƒ…æ³ï¼šåˆ©ç‡ç‚º0æˆ–æ¥è¿‘0
            if (Math.abs(rate) < 1e-10) {
                return pv / nper; // å¦‚æœåˆ©ç‡æ¥è¿‘0ï¼Œç°¡å–®åœ°å°‡æœ¬é‡‘é™¤ä»¥æœŸæ•¸
            }
            
            // æ¨™æº–ç­‰é¡æœ¬æ¯å…¬å¼
            return (pv * rate * Math.pow(1 + rate, nper)) / (Math.pow(1 + rate, nper) - 1);
        } catch (error) {
            console.error('PMT è¨ˆç®—éŒ¯èª¤:', error);
            showToast('æœŸç¹³é‡‘é¡è¨ˆç®—å‡ºéŒ¯ï¼Œè«‹æª¢æŸ¥è¼¸å…¥å€¼', true);
            return 0;
        }
    }
        
    function RATE(nper, pmt, pv) {
        // åƒæ•¸é©—è­‰
        if (!nper || nper <= 0) {
            showToast('éŒ¯èª¤ï¼šæœŸæ•¸å¿…é ˆç‚ºæ­£æ•¸', true);
            return 0;
        }
        
        if (!pmt || pmt <= 0) {
            showToast('éŒ¯èª¤ï¼šæœŸç¹³é‡‘é¡å¿…é ˆç‚ºæ­£æ•¸', true);
            return 0;
        }
        
        if (!pv || pv <= 0) {
            showToast('éŒ¯èª¤ï¼šæœ¬é‡‘å¿…é ˆç‚ºæ­£æ•¸', true);
            return 0;
        }
        
        // åŸºæœ¬æª¢æŸ¥ï¼šå¦‚æœæœŸç¹³ç¸½é¡å°æ–¼æœ¬é‡‘ï¼Œç„¡æ³•è¨ˆç®—æœ‰æ•ˆåˆ©ç‡
        if (pmt * nper <= pv) {
            showToast('éŒ¯èª¤ï¼šæœŸç¹³ç¸½é¡å¿…é ˆå¤§æ–¼æœ¬é‡‘æ‰èƒ½è¨ˆç®—åˆ©ç‡', true);
            return 0;
        }
        
        let rate = 0.1; // åˆå§‹çŒœæ¸¬å€¼ï¼Œ10%
        let step = 0.05;
        let tolerance = 0.0001;
        let maxIterations = 100;
        let iteration = 0;
        
        try {
            while (iteration < maxIterations) {
                let monthlyRate = rate / 12;
                
                // é¿å…é™¤é›¶éŒ¯èª¤
                let denominator = Math.pow(1 + monthlyRate, nper) - 1;
                if (Math.abs(denominator) < 1e-10) { // æ¥è¿‘é›¶çš„æƒ…æ³
                    rate += step; // èª¿æ•´ä¸¦ç¹¼çºŒè¿­ä»£
                    step *= 0.5;
                    iteration++;
                    continue;
                }
                
                let calculated = pv * monthlyRate * Math.pow(1 + monthlyRate, nper) / denominator;
                
                if (Math.abs(calculated - pmt) < tolerance) {
                    return Math.max(0, rate * 100); // ç¢ºä¿ä¸è¿”å›è² åˆ©ç‡
                }
                
                if (calculated > pmt) {
                    rate -= step;
                } else {
                    rate += step;
                }
                
                // ç¢ºä¿åˆ©ç‡ä¸æœƒè®Šç‚ºè² æ•¸
                rate = Math.max(0.0001, rate);
                
                step *= 0.5;
                iteration++;
            }
            
            // å¦‚æœé”åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•¸ä»æœªæ”¶æ–‚
            console.warn('RATE è¨ˆç®—æœªæ”¶æ–‚ï¼Œè¿”å›æœ€ä½³è¿‘ä¼¼å€¼');
            return Math.max(0, rate * 100);
        } catch (error) {
            console.error('RATE è¨ˆç®—éŒ¯èª¤:', error);
            showToast('åˆ©ç‡è¨ˆç®—å‡ºéŒ¯ï¼Œè«‹æª¢æŸ¥è¼¸å…¥å€¼', true);
            return 0;
        }
    }

    function calculatePeriod() {
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, ''));
        
        // TODO: Implement period calculation
        updateAllFields();
    }

    function calculateRate() {
        const period = parseFloat(document.getElementById('period').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, ''));
        
        // åªæœ‰ç•¶è‡³å°‘ä¸‰å€‹æ¬„ä½å·²å¡«å¯«æ™‚æ‰é¡¯ç¤ºè­¦å‘Š
        const filledFields = countFilledFields();
        const shouldWarn = filledFields >= 3;
        
        // è¼¸å…¥é©—è­‰
        if (shouldWarn) {
            if (isNaN(period) || period <= 0) {
                showToast('è«‹è¼¸å…¥æœ‰æ•ˆçš„æœŸæ•¸', true);
                return;
            }
            
            if (isNaN(principal) || principal <= 0) {
                showToast('è«‹è¼¸å…¥æœ‰æ•ˆçš„æœ¬é‡‘', true);
                return;
            }
            
            if (isNaN(payment) || payment <= 0) {
                showToast('è«‹è¼¸å…¥æœ‰æ•ˆçš„æœŸç¹³é‡‘é¡', true);
                return;
            }
            
            // åŸºæœ¬è²¡å‹™æª¢æŸ¥ï¼šç¸½é‚„æ¬¾æ‡‰è¶…éæœ¬é‡‘
            if (payment * period <= principal) {
                showToast('æœŸç¹³ç¸½é¡å¿…é ˆå¤§æ–¼æœ¬é‡‘æ‰èƒ½è¨ˆç®—æœ‰æ•ˆåˆ©ç‡', true);
                return;
            }
        } else {
            // å¦‚æœæ¬„ä½æ•¸ä¸è¶³ï¼Œä½†è¼¸å…¥ç„¡æ•ˆï¼Œç›´æ¥è¿”å›
            if (isNaN(period) || isNaN(principal) || isNaN(payment) || 
                period <= 0 || principal <= 0 || payment <= 0 ||
                payment * period <= principal) {
                return;
            }
        }
        
        try {
            const rate = RATE(period, payment, principal);
            
            // æª¢æŸ¥è¨ˆç®—çµæœæ˜¯å¦æœ‰æ•ˆ
            if (isNaN(rate) || !isFinite(rate) || rate < 0) {
                if (shouldWarn) {
                    showToast('åˆ©ç‡è¨ˆç®—çµæœç„¡æ•ˆï¼Œè«‹æª¢æŸ¥è¼¸å…¥å€¼', true);
                }
                return;
            }
            
            // æª¢æŸ¥åˆ©ç‡æ˜¯å¦è¶…é20%
            if (rate > 20) {
                showToast('è­¦å‘Šï¼šè¨ˆç®—çµæœé¡¯ç¤ºåˆ©ç‡è¶…é20%ï¼Œå¯èƒ½ä¸ç¬¦åˆä¸€èˆ¬è²¸æ¬¾æ¢ä»¶', true);
            }
            
            // é™åˆ¶åˆ©ç‡é¡¯ç¤ºçš„å°æ•¸ä½æ•¸ä¸¦æ›´æ–°ç•Œé¢ï¼Œä¸æˆªæ–·è¶…é20%çš„æ•¸å€¼
            document.getElementById('rate').value = rate.toFixed(4);
            updateAllFields();
        } catch (error) {
            console.error('åˆ©ç‡è¨ˆç®—éŒ¯èª¤:', error);
            if (shouldWarn) {
                showToast('è¨ˆç®—åˆ©ç‡æ™‚å‡ºéŒ¯', true);
            }
        }
    }

    function calculatePrincipal() {
        const period = parseFloat(document.getElementById('period').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, ''));
        
        // TODO: Implement principal calculation
        updateAllFields();
    }

    function calculatePayment() {
        const period = parseFloat(document.getElementById('period').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        
        // åªæœ‰ç•¶è‡³å°‘ä¸‰å€‹æ¬„ä½å·²å¡«å¯«æ™‚æ‰é¡¯ç¤ºè­¦å‘Š
        const filledFields = countFilledFields();
        const shouldWarn = filledFields >= 3;
        
        // æª¢æŸ¥æ‰€æœ‰è¼¸å…¥ä¸¦æä¾›å…·é«”éŒ¯èª¤è¨Šæ¯
        if (shouldWarn) {
            if (isNaN(period) || period <= 0) {
                showToast('è«‹è¼¸å…¥æœ‰æ•ˆçš„æœŸæ•¸', true);
                return;
            }
            
            if (isNaN(rate) || rate <= 0) {
                showToast('è«‹è¼¸å…¥æœ‰æ•ˆçš„åˆ©ç‡', true);
                return;
            }
            
            if (isNaN(principal) || principal <= 0) {
                showToast('è«‹è¼¸å…¥æœ‰æ•ˆçš„æœ¬é‡‘', true);
                return;
            }
        } else {
            // å¦‚æœæ¬„ä½æ•¸ä¸è¶³ï¼Œä½†è¼¸å…¥ç„¡æ•ˆï¼Œç›´æ¥è¿”å›
            if (isNaN(period) || isNaN(rate) || isNaN(principal) || 
                period <= 0 || rate <= 0 || principal <= 0) {
                return;
            }
        }
        
        try {
            // é™åˆ¶æ¥µç«¯å€¼
            const safeRate = Math.min(Math.max(rate, 0.0001), 50); // é™åˆ¶åˆ©ç‡åœ¨åˆç†ç¯„åœå…§
            const safePeriod = Math.min(Math.max(period, 1), 999); // é™åˆ¶æœŸæ•¸ä¸è¶…é999æœŸ
            
            const payment = PMT(safeRate, safePeriod, principal);
            
            // æª¢æŸ¥è¨ˆç®—çµæœæ˜¯å¦æœ‰æ•ˆ
            if (isNaN(payment) || !isFinite(payment) || payment <= 0) {
                if (shouldWarn) {
                    showToast('è¨ˆç®—çµæœç„¡æ•ˆï¼Œè«‹æª¢æŸ¥è¼¸å…¥å€¼', true);
                }
                return;
            }
            
            // å››æ¨äº”å…¥ç‚ºæ•´æ•¸ä¸¦æ ¼å¼åŒ–
            document.getElementById('payment').value = formatNumberWithCommas(Math.round(payment));
            updateAllFields();
        } catch (error) {
            console.error('æœŸç¹³é‡‘é¡è¨ˆç®—éŒ¯èª¤:', error);
            if (shouldWarn) {
                showToast('è¨ˆç®—æœŸç¹³é‡‘é¡æ™‚å‡ºéŒ¯', true);
            }
        }
    }


    function updateAllFields() {
        // ç²å–åŸºæœ¬å€¼ - éœ€è¦å…ˆç§»é™¤åƒä½åˆ†éš”ç¬¦å†è½‰æ›ç‚ºæ•¸å­—
        const period = parseFloat(document.getElementById('period').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, '')) || 0;
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, '')) || 0;
        const monthlyCost = parseFloat(document.getElementById('monthlyCost').value);

        // æœŸæ•¸æª¢æŸ¥
        const periodInput = document.getElementById('period');
        if (period <= 12) {
            periodInput.classList.add('warning-text');
        } else {
            periodInput.classList.remove('warning-text');
        }

        // æª¢æŸ¥å››å€‹åŸºæœ¬è¼¸å…¥æ¡†æ˜¯å¦éƒ½æœ‰å€¼
        const hasAllRequiredValues = period && rate && principal && payment && 
                                    !isNaN(period) && !isNaN(rate) && !isNaN(principal) && !isNaN(payment);

        // è¨ˆç®—ä¸¦é¡¯ç¤ºç¸½ç¹³æ¬¾
        const totalPaymentField = document.getElementById('totalPayment');
        if (hasAllRequiredValues) {
            // è¨ˆç®—ç¸½ç¹³æ¬¾
            const totalPaymentValue = payment * period;
            // ç¸½ç¹³æ¬¾æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            totalPaymentField.value = formatNumberWithCommas(Math.round(totalPaymentValue));
        } else {
            // å¦‚æœç¼ºå°‘ä»»ä½•å¿…è¦å€¼ï¼Œæ¸…ç©ºç¸½ç¹³æ¬¾è¼¸å…¥æ¡†
            totalPaymentField.value = '';
        }

        // è¨ˆç®—ä¸¦é¡¯ç¤ºç¸½åˆ©æ¯
        const totalInterestField = document.getElementById('totalInterest');
        if (hasAllRequiredValues) {
            // è¨ˆç®—ç¸½åˆ©æ¯
            const totalInterest = (payment * period) - principal;
            // ç¸½åˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            totalInterestField.value = formatNumberWithCommas(Math.round(totalInterest));
        } else {
            // å¦‚æœç¼ºå°‘ä»»ä½•å¿…è¦å€¼ï¼Œæ¸…ç©ºç¸½åˆ©æ¯è¼¸å…¥æ¡†
            totalInterestField.value = '';
        }

        // è¨ˆç®—ä¸¦é¡¯ç¤ºæ¯å¹´åˆ©æ¯
        const yearlyInterestField = document.getElementById('yearlyInterest');
        if (hasAllRequiredValues) {
            // è¨ˆç®—æ¯å¹´åˆ©æ¯ = ç¸½åˆ©æ¯ Ã· æœŸæ•¸ Ã— 12
            const totalInterest = (payment * period) - principal;
            const yearlyInterest = (totalInterest / period) * 12;
            // æ¯å¹´åˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            yearlyInterestField.value = formatNumberWithCommas(Math.round(yearlyInterest));
        } else {
            // å¦‚æœç¼ºå°‘ä»»ä½•å¿…è¦å€¼ï¼Œæ¸…ç©ºæ¯å¹´åˆ©æ¯è¼¸å…¥æ¡†
            yearlyInterestField.value = '';
        }

        // è¨ˆç®—ä¸¦é¡¯ç¤ºæ¯æœˆåˆ©æ¯
        const monthlyInterestField = document.getElementById('monthlyInterest');
        if (hasAllRequiredValues) {
            // è¨ˆç®—æ¯æœˆåˆ©æ¯ = æ¯å¹´åˆ©æ¯ Ã· 12
            const totalInterest = (payment * period) - principal;
            const yearlyInterest = (totalInterest / period) * 12;
            const monthlyInterest = yearlyInterest / 12;
            // æ¯æœˆåˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            monthlyInterestField.value = formatNumberWithCommas(Math.round(monthlyInterest));
        } else {
            // å¦‚æœç¼ºå°‘ä»»ä½•å¿…è¦å€¼ï¼Œæ¸…ç©ºæ¯æœˆåˆ©æ¯è¼¸å…¥æ¡†
            monthlyInterestField.value = '';
        }

        // è¨ˆç®—ç¨…é‡‘ - åŒæ¨£éœ€è¦æª¢æŸ¥ç¸½åˆ©æ¯æ˜¯å¦å·²è¨ˆç®—
        const taxField = document.getElementById('tax');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            const tax = totalInterest / 21;
            taxField.value = formatNumberWithCommas(tax.toFixed(2));
        } else {
            taxField.value = '';
        }

        // è¨ˆç®—ç¨…å¾Œåˆ©ç‡ - åŒæ¨£éœ€è¦æª¢æŸ¥å¿…è¦å€¼
        const afterTaxRateInput = document.getElementById('afterTaxRate');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            const tax = totalInterest / 21;
            const afterTaxRate = RATE(period, payment, principal + tax);
            afterTaxRateInput.value = afterTaxRate.toFixed(4);
            
            // æª¢æŸ¥ç¨…å¾Œåˆ©ç‡æ˜¯å¦è¶…é20%
            if (afterTaxRate > 20) {
                afterTaxRateInput.classList.add('warning-text');
                if (countFilledFields() >= 3) {
                    showToast('è­¦å‘Šï¼šç¨…å¾Œåˆ©ç‡è¶…é20%ï¼Œå¯èƒ½ä¸ç¬¦åˆä¸€èˆ¬è²¸æ¬¾æ¢ä»¶', true);
                }
            } else if (afterTaxRate <= 2.5) {
                afterTaxRateInput.classList.add('warning-text');
            } else {
                afterTaxRateInput.classList.remove('warning-text');
            }
        } else {
            afterTaxRateInput.value = '';
            afterTaxRateInput.classList.remove('warning-text');
        }

        // ä½£é‡‘æ ¼å¼åŒ–ç‚ºæ•´æ•¸ä¸¦å¸¶åƒä½åˆ†éš”ç¬¦
        const commission = parseFloat(document.getElementById('commission').value.replace(/,/g, '')) || 0;
        document.getElementById('commission').value = formatNumberWithCommas(Math.round(commission));
        
        // æª¢æŸ¥ä½£é‡‘æ˜¯å¦è¶…éç¸½åˆ©æ¯çš„45%
        const commissionInput = document.getElementById('commission');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            if (commission >= totalInterest * 0.45) {
                commissionInput.classList.add('warning-text');
                // æ–°å¢è­¦å‘Šæç¤º
                showToast('è«‹æ³¨æ„æ¨å»£è²»èˆ‡ç¸½åˆ©æ¯æ¯”ä¾‹ï¼', true);
            } else {
                commissionInput.classList.remove('warning-text');
            }
        } else {
            commissionInput.classList.remove('warning-text');
        }

        // è¨ˆç®—ä¸¦æ›´æ–°æ¨å»£è²»æ¯”ä¾‹
        const commissionRatioInput = document.getElementById('commissionRatio');
        if (principal > 0 && commission > 0) {
            const commissionRatio = commission / principal * 100;
            commissionRatioInput.value = commissionRatio.toFixed(2);
            
            // æª¢æŸ¥æ¨å»£è²»æ¯”ä¾‹æ˜¯å¦è¶…é5%
            if (commissionRatio > 5) {
                commissionRatioInput.classList.add('warning-text');
            } else {
                commissionRatioInput.classList.remove('warning-text');
            }
        } else {
            commissionRatioInput.value = '';
            commissionRatioInput.classList.remove('warning-text');
        }

        // è¨ˆç®—ä½£å¾Œåˆ©ç‡
        const afterCommissionOnlyRateInput = document.getElementById('afterCommissionOnlyRate');
        if (hasAllRequiredValues) {
            try {
                // è¨ˆç®—ä½£å¾Œåˆ©ç‡ï¼ˆåªè€ƒæ…®ä½£é‡‘ï¼Œä¸è€ƒæ…®ç¨…é‡‘ï¼‰
                const afterCommissionOnlyRate = RATE(period, payment, principal + commission);
                
                // æª¢æŸ¥çµæœæ˜¯å¦æœ‰æ•ˆ
                if (isNaN(afterCommissionOnlyRate) || !isFinite(afterCommissionOnlyRate)) {
                    afterCommissionOnlyRateInput.value = "è¨ˆç®—éŒ¯èª¤";
                    afterCommissionOnlyRateInput.classList.add('warning-text');
                } else {
                    // ä½£å¾Œåˆ©ç‡ä¸éœ€è¦åƒä½åˆ†éš”ç¬¦
                    afterCommissionOnlyRateInput.value = afterCommissionOnlyRate.toFixed(4);
                    if (afterCommissionOnlyRate <= 2.5) {
                        afterCommissionOnlyRateInput.classList.add('warning-text');
                    } else {
                        afterCommissionOnlyRateInput.classList.remove('warning-text');
                    }
                }
            } catch (error) {
                console.error('ä½£å¾Œåˆ©ç‡è¨ˆç®—éŒ¯èª¤:', error);
                afterCommissionOnlyRateInput.value = "è¨ˆç®—éŒ¯èª¤";
                afterCommissionOnlyRateInput.classList.add('warning-text');
            }
        } else {
            afterCommissionOnlyRateInput.value = '';
            afterCommissionOnlyRateInput.classList.remove('warning-text');
        }

        // è¨ˆç®—ç¨…ä½£å¾Œåˆ©ç‡
        // è¨ˆç®—ç¨…ä½£å¾Œåˆ©ç‡
        const afterCommissionRateInput = document.getElementById('afterCommissionRate');
        if (hasAllRequiredValues) {
            try {
                const totalInterest = (payment * period) - principal;
                const tax = totalInterest / 21;
                
                // æª¢æŸ¥è¨ˆç®—æ˜¯å¦åˆç†
                const totalCost = principal + tax + commission;
                if (totalCost >= payment * period) {
                    // å¦‚æœæˆæœ¬è¶…éç¸½é‚„æ¬¾é¡ï¼Œç„¡æ³•è¨ˆç®—æœ‰æ•ˆåˆ©ç‡
                    afterCommissionRateInput.value = "N/A";
                    afterCommissionRateInput.classList.add('warning-text');
                    
                    // åŒæ™‚æ›´æ–° Spread
                    const spreadInput = document.getElementById('spread');
                    spreadInput.value = "N/A";
                    spreadInput.classList.add('warning-text');
                } else {
                    // æ­£å¸¸è¨ˆç®—
                    const afterCommissionRate = RATE(period, payment, principal + tax + commission);
                    
                    // æª¢æŸ¥çµæœæ˜¯å¦æœ‰æ•ˆ
                    if (isNaN(afterCommissionRate) || !isFinite(afterCommissionRate)) {
                        afterCommissionRateInput.value = "è¨ˆç®—éŒ¯èª¤";
                        afterCommissionRateInput.classList.add('warning-text');
                    } else {
                        // ç¨…ä½£å¾Œåˆ©ç‡ä¸éœ€è¦åƒä½åˆ†éš”ç¬¦
                        afterCommissionRateInput.value = afterCommissionRate.toFixed(4);
                        if (afterCommissionRate <= 2.5) {
                            afterCommissionRateInput.classList.add('warning-text');
                        } else {
                            afterCommissionRateInput.classList.remove('warning-text');
                        }
                        
                        // è¨ˆç®— Spread
                        const spread = afterCommissionRate - monthlyCost;
                        // Spread ä¸éœ€è¦åƒä½åˆ†éš”ç¬¦
                        const spreadInput = document.getElementById('spread');
                        spreadInput.value = spread.toFixed(4);
                        if (spread <= 0) {
                            spreadInput.classList.add('warning-text');
                        } else {
                            spreadInput.classList.remove('warning-text');
                        }
                    }
                }
            } catch (error) {
                console.error('ç¨…ä½£å¾Œåˆ©ç‡è¨ˆç®—éŒ¯èª¤:', error);
                afterCommissionRateInput.value = "è¨ˆç®—éŒ¯èª¤";
                afterCommissionRateInput.classList.add('warning-text');
                
                document.getElementById('spread').value = '';
                document.getElementById('spread').classList.remove('warning-text');
            }
        } else {
            afterCommissionRateInput.value = '';
            afterCommissionRateInput.classList.remove('warning-text');
            
            document.getElementById('spread').value = '';
            document.getElementById('spread').classList.remove('warning-text');
        }
        
        // è¨ˆç®—ç™¾è¬åˆ©æ¯ç›¸é—œ
        if (rate > 0) {
            // ç™¾è¬åˆ©æ¯è¨ˆç®—
            const millionPayment = PMT(rate, 12, 1000000);
            const annualMillionInterest = (millionPayment * 12) - 1000000;
            
            // ç™¾è¬æ¯å¹´åˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            document.getElementById('annualMillionInterest').value = formatNumberWithCommas(Math.round(annualMillionInterest));
            // ç™¾è¬æ¯æœˆåˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            document.getElementById('monthlyMillionInterest').value = formatNumberWithCommas(Math.round(annualMillionInterest / 12));
            
            // ä¸€è¬åˆ©æ¯
            const tenThousandPayment = PMT(rate, 12, 10000);
            const annualTenThousandInterest = (tenThousandPayment * 12) - 10000;
            
            // ä¸€è¬æ¯å¹´åˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            document.getElementById('annualTenThousandInterest').value = formatNumberWithCommas(Math.round(annualTenThousandInterest));
            // ä¸€è¬æ¯æœˆåˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            document.getElementById('monthlyTenThousandInterest').value = formatNumberWithCommas(Math.round(annualTenThousandInterest / 12));
        } else {
            document.getElementById('annualMillionInterest').value = '';
            document.getElementById('monthlyMillionInterest').value = '';
            document.getElementById('annualTenThousandInterest').value = '';
            document.getElementById('monthlyTenThousandInterest').value = '';
        }
        
        // è¨ˆç®— NPV
        const npvValue = calculateNPV(
            payment,
            period,
            principal,
            monthlyCost
        );
        
        // æ›´æ–° NPV é¡¯ç¤ºï¼Œå¸¶åƒä½åˆ†éš”ç¬¦
        const fundingCostInput = document.getElementById('fundingCost');
        if (hasAllRequiredValues) {
            fundingCostInput.value = formatNumberWithCommas(npvValue);
            
            // æ›´æ–°è­¦å‘Šæ¨£å¼
            if (npvValue < 0) {
                fundingCostInput.classList.add('warning-text');
            } else {
                fundingCostInput.classList.remove('warning-text');
            }
        } else {
            fundingCostInput.value = '';
            fundingCostInput.classList.remove('warning-text');
        }

        // æ–°å¢ï¼šè‡ªå‹•æ›´æ–°ä¸‰å€‹æ–°æ¬„ä½
        const principalValue = principal;
        const customerInvoiceField = document.getElementById('customerInvoice');
        const businessTaxField = document.getElementById('businessTax');
        const untaxedAmountField = document.getElementById('untaxedAmount');
        if (principalValue > 0) {
            // å®¢æˆ¶ç™¼ç¥¨ = æœ¬é‡‘
            customerInvoiceField.value = formatNumberWithCommas(Math.round(principalValue));
            // ç‡Ÿæ¥­ç¨… = å®¢æˆ¶ç™¼ç¥¨ / 21ï¼Œå››æ¨äº”å…¥è‡³æ•´æ•¸
            const businessTax = Math.round(principalValue / 21);
            businessTaxField.value = formatNumberWithCommas(businessTax);
            // æœªç¨…é‡‘é¡ = å®¢æˆ¶ç™¼ç¥¨ - ç‡Ÿæ¥­ç¨…ï¼Œé¡¯ç¤ºæ­£æ•´æ•¸
            const untaxedAmount = Math.max(0, Math.round(principalValue - businessTax));
            untaxedAmountField.value = formatNumberWithCommas(untaxedAmount);
        } else {
            customerInvoiceField.value = '';
            businessTaxField.value = '';
            untaxedAmountField.value = '';
        }

        // æ–°å¢ï¼šæ›´æ–°ä¸­æ–‡åœ‹å­—å¤§å¯«æ¬„ä½
        const chineseAmountField = document.getElementById('chineseAmount');
        if (principalValue > 0) {
            try {
                // è½‰æ›å®¢æˆ¶ç™¼ç¥¨é‡‘é¡ç‚ºä¸­æ–‡åœ‹å­—å¤§å¯«
                const chineseAmount = arabicToChineseNumber(principalValue, 'financial') + ' åœ“æ•´';
                chineseAmountField.innerHTML = chineseAmount; // ä½¿ç”¨ innerHTML ä»¥æ”¯æŒHTMLæ¨™ç±¤
            } catch (error) {
                console.error('ä¸­æ–‡è½‰æ›éŒ¯èª¤:', error);
                chineseAmountField.textContent = 'è½‰æ›éŒ¯èª¤';
            }
        } else {
            chineseAmountField.innerHTML = ''; // æ¸…ç©ºé¡¯ç¤º
        }

        // æ–°å¢ï¼šæ›´æ–°ç¸½ç¹³æ¬¾ä¸­æ–‡åœ‹å­—å¤§å¯«æ¬„ä½
        const totalPaymentChineseField = document.getElementById('totalPaymentChinese');
        if (hasAllRequiredValues) {
            try {
                // è¨ˆç®—ç¸½ç¹³æ¬¾
                const totalPaymentValue = payment * period;
                const roundedTotalPayment = Math.round(totalPaymentValue);
                
                // è½‰æ›ç¸½ç¹³æ¬¾ç‚ºä¸­æ–‡åœ‹å­—å¤§å¯«
                const totalPaymentChinese = arabicToChineseNumber(roundedTotalPayment, 'financial') + ' åœ“æ•´';
                totalPaymentChineseField.innerHTML = totalPaymentChinese; // ä½¿ç”¨ innerHTML ä»¥æ”¯æŒHTMLæ¨™ç±¤
            } catch (error) {
                console.error('ç¸½ç¹³æ¬¾ä¸­æ–‡è½‰æ›éŒ¯èª¤:', error);
                totalPaymentChineseField.textContent = 'è½‰æ›éŒ¯èª¤';
            }
        } else {
            totalPaymentChineseField.innerHTML = ''; // æ¸…ç©ºé¡¯ç¤º
        }

        // åœ¨æ›´æ–°å€¼ä¹‹å‰ä¿å­˜èˆŠå€¼
        const oldValues = {};
        const fieldsToTrack = ['totalInterest', 'afterTaxRate', 'spread'];
        fieldsToTrack.forEach(field => {
            oldValues[field] = document.getElementById(field).value;
        });

        // åœ¨æ›´æ–°å¾Œæª¢æŸ¥è®ŠåŒ–
        fieldsToTrack.forEach(field => {
            const newValue = document.getElementById(field).value;
            if (oldValues[field] !== newValue) {
                animateValueChange(field);
            }
        });
    }

    // åœ¨ clearField å‡½æ•¸ä¹‹å‰æ·»åŠ é€™å€‹æ–°å‡½æ•¸
    // ä¿®æ”¹ validatePrincipalInput å‡½æ•°
    function validatePrincipalInput(input) {
        // ç§»é™¤è´Ÿå·ï¼Œç¡®ä¿ä¸ºæ­£æ•´æ•°
        let value = Math.floor(Math.abs(parseFloat(input.value))) || 0;
        
        // å¦‚æœè¾“å…¥ä¸º0ï¼Œè®¾ç½®ä¸ºæœ€å°å€¼1
        if (value <= 0) {
            value = 1;
        }
        
        // æ›´æ–°è¾“å…¥æ¡†å€¼å¹¶æ ¼å¼åŒ–
        input.value = formatNumberWithCommas(value);
        
        // æ›´æ–°ç›¸å…³è®¡ç®—
        updateAllFields();
    }

    function clearField(fieldId) {
        vibrate();
        document.getElementById(fieldId).value = '';
    }

    function clearCommission() {
        vibrate();
        document.getElementById('commission').value = '';
        updateAllFields(); // æ›´æ–°æ‰€æœ‰æ¬„ä½
    }

    function adjustPeriod(delta) {
        vibrate();
        const periodField = document.getElementById('period');
        const currentValue = parseFloat(periodField.value) || 0;
        periodField.value = currentValue + delta;
        calculatePayment();
    }

    function setPeriod(value) {
        vibrate();
        document.getElementById('period').value = value;
        
        // æª¢æŸ¥å…¶ä»–å¿…è¦è¼¸å…¥æ˜¯å¦å·²æœ‰å€¼
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        
        if (!isNaN(rate) && !isNaN(principal) && rate > 0 && principal > 0) {
            calculatePayment(); // åªæœ‰ç•¶å…¶ä»–å¿…è¦å€¼éƒ½å­˜åœ¨æ™‚æ‰è¨ˆç®—
        }
    }

    function adjustRate(delta) {
        vibrate();
        const rateField = document.getElementById('rate');
        const currentValue = parseFloat(rateField.value) || 0;
        const newRate = currentValue + delta;
        
        // æª¢æŸ¥æ–°åˆ©ç‡æ˜¯å¦è¶…é20%
        if (newRate > 20) {
            showToast('è­¦å‘Šï¼šåˆ©ç‡è¶…é20%ï¼Œå¯èƒ½ä¸ç¬¦åˆä¸€èˆ¬è²¸æ¬¾æ¢ä»¶', true);
        }
        
        rateField.value = newRate.toFixed(4);
        calculatePayment();
    }

    function setRate(value) {
        vibrate();
        // æª¢æŸ¥æ–°åˆ©ç‡æ˜¯å¦è¶…é20%
        if (value > 20) {
            showToast('è­¦å‘Šï¼šåˆ©ç‡è¶…é20%ï¼Œå¯èƒ½ä¸ç¬¦åˆä¸€èˆ¬è²¸æ¬¾æ¢ä»¶', true);
        }
        
        document.getElementById('rate').value = value;
        calculatePayment();
    }

    function validateCommissionInput(input) {
        // ç§»é™¤å°æ•¸é»
        let value = parseInt(input.value) || 0;
        
        // å¦‚æœæ˜¯è² æ•¸ï¼Œè¨­ç‚º0
        if (value < 0) {
            value = 0;
        }
        
        // æ›´æ–°è¼¸å…¥æ¡†çš„å€¼ç‚ºæ•´æ•¸
        input.value = Math.floor(value);
        
        // æ›´æ–°ç›¸é—œè¨ˆç®—
        updateAllFields();
    }

    function adjustCommission(delta) {
        vibrate();
        const commissionField = document.getElementById('commission');
        
        // ç²å–ç•¶å‰å€¼ï¼Œå¦‚æœç‚ºç©ºå‰‡é è¨­ç‚º0ï¼Œç§»é™¤åƒä½åˆ†éš”ç¬¦
        const currentValue = parseFloat(commissionField.value.replace(/,/g, '')) || 0;
        
        // è¨ˆç®—æ–°å€¼
        const newValue = Math.max(0, currentValue + delta);
        
        // æ›´æ–°è¼¸å…¥æ¡†çš„å€¼ï¼Œä½¿ç”¨ Math.floor å–æ•´æ•¸ä¸¦æ·»åŠ åƒä½åˆ†éš”ç¬¦
        commissionField.value = formatNumberWithCommas(Math.floor(newValue));
        
        // æ›´æ–°æ‰€æœ‰ç›¸é—œæ¬„ä½çš„è¨ˆç®—
        updateAllFields();
    }

    function setCommissionPercent(percent) {
        vibrate(); // è§¸ç™¼éœ‡å‹•
        
        // ç²å–æœ¬é‡‘å€¼ï¼ˆç§»é™¤åƒä½åˆ†éš”ç¬¦ï¼‰
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, '')) || 0;
        
        if (principal <= 0) {
            showToast('è«‹å…ˆè¼¸å…¥æœ‰æ•ˆçš„æœ¬é‡‘é‡‘é¡', true);
            return;
        }
        
        // è¨ˆç®—å°æ‡‰ç™¾åˆ†æ¯”çš„é‡‘é¡ï¼Œä¸¦ç„¡æ¢ä»¶æ¨å»è‡³æ•´æ•¸
        const commissionAmount = Math.floor(principal * (percent / 100));
        
        // æ›´æ–°æ¨å»£è¼¸å…¥æ¡†çš„å€¼ï¼Œä¸¦æ·»åŠ åƒä½åˆ†éš”ç¬¦
        document.getElementById('commission').value = formatNumberWithCommas(commissionAmount);
        
        // æ›´æ–°ç›¸é—œæ¬„ä½çš„è¨ˆç®—
        updateAllFields();
    }

    // ä¿®æ”¹ adjustPrincipal å‡½æ•°
    function adjustPrincipal(delta) {
        vibrate();
        const principalField = document.getElementById('principal');
        // ç§»é™¤åƒä½åˆ†éš”ç¬¦åå†è½¬æ¢ä¸ºæ•°å­—
        const currentValue = parseFloat(principalField.value.replace(/,/g, '')) || 0;
        // è®¡ç®—æ–°å€¼ï¼Œç¡®ä¿æ˜¯æ­£æ•´æ•°
        const newValue = Math.max(1, Math.floor(currentValue + delta)); // ç¡®ä¿æœ€å°å€¼ä¸º1ä¸”ä¸ºæ•´æ•°
        // æ·»åŠ åƒä½åˆ†éš”ç¬¦æ˜¾ç¤º
        principalField.value = formatNumberWithCommas(newValue);
        calculatePayment();
        updateAllFields();
    }

    function calculateAfterCommissionRate() {
        const period = parseFloat(document.getElementById('period').value);
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, ''));
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        const tax = parseFloat(document.getElementById('tax').value.replace(/,/g, ''));
        const commission = parseFloat(document.getElementById('commission').value.replace(/,/g, '')) || 0;

        updateAllFields(); // æ›´æ–°æ‰€æœ‰æ¬„ä½
    }

    // ä¿®æ”¹ roundPayment å‡½æ•°ä»¥ä¿æŒæ­£æ•°é™åˆ¶
    function roundPayment(direction, base) {
        vibrate();
        const paymentField = document.getElementById('payment');
        // ç§»é™¤åƒä½åˆ†éš”ç¬¦åå†è½¬æ¢ä¸ºæ•°å­—
        let value = parseFloat(paymentField.value.replace(/,/g, '')) || 0;
        
        if (direction === 'down') {
            value = Math.floor(value / base) * base;
        } else {
            value = Math.ceil(value / base) * base;
        }
        
        // ç¡®ä¿å€¼ä¸ºæ­£æ•´æ•°
        value = Math.max(1, Math.round(value));
        
        // æ·»åŠ åƒä½åˆ†éš”ç¬¦æ˜¾ç¤ºï¼Œä¸å†ä¿ç•™å°æ•¸ä½
        paymentField.value = formatNumberWithCommas(value);
        calculateRate(); // ç¡®ä¿è¿™ä¸ªè°ƒç”¨èƒ½æ­£ç¡®è®¡ç®—ç¨å‰åˆ©ç‡
    }

    // ä¿®æ”¹ adjustPayment å‡½æ•°
    function adjustPayment(delta) {
        vibrate();
        const paymentField = document.getElementById('payment');
        // ç§»é™¤åƒä½åˆ†éš”ç¬¦åå†è½¬æ¢ä¸ºæ•°å­—
        const currentValue = parseFloat(paymentField.value.replace(/,/g, '')) || 0;
        // è®¡ç®—æ–°å€¼ï¼Œç¡®ä¿æ˜¯æ­£æ•´æ•°
        const newValue = Math.max(1, Math.round(currentValue + delta)); // ä½¿ç”¨Math.roundç¢ºä¿æ˜¯æ•´æ•¸
        // æ·»åŠ åƒä½åˆ†éš”ç¬¦æ˜¾ç¤ºï¼Œä¸å†ä¿ç•™å°æ•¸
        paymentField.value = formatNumberWithCommas(newValue);
        calculateRate(); // ç¡®ä¿è¿™ä¸ªè°ƒç”¨èƒ½æ­£ç¡®è®¡ç®—ç¨å‰åˆ©ç‡
    }

    function saveData() {
        const dataToSave = {
        period: document.getElementById('period').value,
        rate: document.getElementById('rate').value,
        principal: document.getElementById('principal').value,
        payment: document.getElementById('payment').value,
        commission: document.getElementById('commission').value
        };
        localStorage.setItem('loanCalculatorData', JSON.stringify(dataToSave));
        alert('è³‡æ–™å·²æš«å­˜ï¼');
    }

    function generateQuote() {
        // è§¸ç™¼æŒ¯å‹•åé¥‹
        vibrate();
        
        // æª¢æŸ¥è¡¨å–®æ˜¯å¦æœ‰å¿…è¦æ•¸æ“š
        const requiredFields = ['period', 'rate', 'principal', 'payment'];
        const missingFields = requiredFields.filter(fieldId => !document.getElementById(fieldId).value);
        
        if (missingFields.length > 0) {
            showToast('è«‹å…ˆå®Œæˆå¿…è¦æ¬„ä½ï¼ˆæœŸæ•¸ã€åˆ©ç‡ã€æœ¬é‡‘ã€æœŸç¹³ï¼‰çš„è¨ˆç®—ï¼');
            return;
        }
        
        // é¡¯ç¤ºåŠ è¼‰æç¤º
        const loadingToast = document.createElement('div');
        loadingToast.id = 'screenshot-loading';
        loadingToast.innerHTML = '<div class="loading-content">æ­£åœ¨ç”Ÿæˆå ±åƒ¹å¡ç‰‡...</div>';
        document.body.appendChild(loadingToast);
        
        // æª¢æ¸¬æ˜¯å¦ç‚ºç§»å‹•è¨­å‚™
        const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        // å»¶é²ä¸€é»æ™‚é–“ä»¥ç¢ºä¿åŠ è¼‰æç¤ºé¡¯ç¤º
        setTimeout(() => {
            try {
                // å‰µå»ºä¸€å€‹ç°¡å–®çš„å ±åƒ¹å¡ç‰‡ HTML
                const quoteHtml = generateQuoteCardHtml();
                
                // å‰µå»ºä¸€å€‹ç”¨æ–¼é¡¯ç¤ºçš„å ±åƒ¹å¡ç‰‡
                const shareQuoteCard = document.getElementById('shareQuoteCard');
                if (shareQuoteCard) {
                    shareQuoteCard.innerHTML = quoteHtml;
                }
                
                // å¦‚æœæ˜¯ç§»å‹•è¨­å‚™ï¼Œå˜—è©¦ä½¿ç”¨å‚™ç”¨æ–¹æ³•
                if (isMobileDevice) {
                    // ç§»å‹•è¨­å‚™ä¸Šä½¿ç”¨å‚™ç”¨æ–¹æ¡ˆï¼šç›´æ¥ä½¿ç”¨HTMLç‰ˆæœ¬
                    if (document.getElementById('screenshot-loading')) {
                        document.body.removeChild(document.getElementById('screenshot-loading'));
                    }
                    
                    document.getElementById('shareModalOverlay').style.display = 'flex';
                    
                    // èª¿æ•´ä¸‹è¼‰æŒ‰éˆ•åŠŸèƒ½ - åœ¨ç§»å‹•è¨­å‚™ä¸Šæç¤ºç”¨æˆ¶æˆªåœ–
                    const downloadBtn = document.getElementById('downloadBtn');
                    if (downloadBtn) {
                        downloadBtn.textContent = 'æ‰‹å‹•æˆªåœ–';
                        downloadBtn.onclick = function() {
                            showToast('è«‹ä½¿ç”¨ç³»çµ±æˆªåœ–åŠŸèƒ½ä¿å­˜åœ–ç‰‡', false, 3000);
                        };
                    }
                    
                    // éš±è—åˆ†äº«æŒ‰éˆ•ï¼Œå› ç‚ºæ²’æœ‰åœ–ç‰‡
                    const shareBtn = document.getElementById('shareBtn');
                    if (shareBtn) {
                        shareBtn.style.display = 'none';
                    }
                    
                    const shareStatus = document.getElementById('shareStatus');
                    if (shareStatus) {
                        shareStatus.textContent = 'è«‹ä½¿ç”¨ç³»çµ±æˆªåœ–åŠŸèƒ½ä¿å­˜æ­¤å ±åƒ¹';
                        shareStatus.style.color = '#ff9c33';
                    }
                    
                    return;
                }
                
                // ä»¥ä¸‹æ˜¯æ¡Œé¢ç‰ˆçš„è™•ç†é‚è¼¯
                // å‰µå»ºä¸€å€‹è‡¨æ™‚çš„å®¹å™¨ä¾†æ¸²æŸ“å ±åƒ¹å¡ç‰‡
                const tempContainer = document.createElement('div');
                tempContainer.id = 'tempQuoteContainer';
                tempContainer.style.position = 'fixed';
                tempContainer.style.left = '-9999px';
                tempContainer.style.top = '0';
                tempContainer.style.zIndex = '-1000';
                tempContainer.style.background = '#333333';
                tempContainer.style.width = '380px';
                tempContainer.style.padding = '10px';
                tempContainer.innerHTML = quoteHtml;
                document.body.appendChild(tempContainer);
                
                // ä½¿ç”¨html2canvaså°‡è‡¨æ™‚å®¹å™¨è½‰ç‚ºåœ–ç‰‡
                html2canvas(tempContainer, {
                    backgroundColor: '#333333',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    width: 380,
                    height: 520
                }).then(canvas => {
                    // ç”Ÿæˆåœ–ç‰‡URL
                    const imageDataUrl = canvas.toDataURL('image/png');
                    
                    // æ›´æ–°åˆ†äº«æ¨¡æ…‹æ¡†ä¸­çš„å…§å®¹ç‚ºåœ–ç‰‡
                    if (shareQuoteCard) {
                        shareQuoteCard.innerHTML = `<img src="${imageDataUrl}" style="width: 100%; max-width: 340px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">`;
                    }
                    
                    // è¨­ç½®ä¸‹è¼‰æŒ‰éˆ•åŠŸèƒ½
                    const downloadBtn = document.getElementById('downloadBtn');
                    if (downloadBtn) {
                        downloadBtn.textContent = 'ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡';
                        downloadBtn.onclick = function() {
                            const link = document.createElement('a');
                            const dateTime = new Date().toISOString().replace(/[^0-9]/g, '').slice(0, 14);
                            link.download = `è²¸æ¬¾è¨ˆç®—å ±åƒ¹_${dateTime}.png`;
                            link.href = imageDataUrl;
                            link.click();
                            showToast('åœ–ç‰‡å·²ä¿å­˜è‡³æ‚¨çš„è¨­å‚™ï¼');
                        };
                    }
                    
                    // è¨­ç½®åˆ†äº«æŒ‰éˆ•åŠŸèƒ½
                    const shareBtn = document.getElementById('shareBtn');
                    if (shareBtn) {
                        shareBtn.style.display = 'inline-block';
                        shareBtn.onclick = function() {
                            shareQuoteImage(imageDataUrl);
                        };
                    }
                    
                    // ç§»é™¤åŠ è¼‰æç¤ºä¸¦é¡¯ç¤ºåˆ†äº«æ¨¡æ…‹æ¡†
                    if (document.getElementById('screenshot-loading')) {
                        document.body.removeChild(document.getElementById('screenshot-loading'));
                    }
                    
                    // ç§»é™¤è‡¨æ™‚å®¹å™¨
                    document.body.removeChild(tempContainer);
                    
                    // é¡¯ç¤ºåˆ†äº«æ¨¡æ…‹æ¡†
                    document.getElementById('shareModalOverlay').style.display = 'flex';
                    
                    // é‡ç½®ç‹€æ…‹è¨Šæ¯
                    const shareStatus = document.getElementById('shareStatus');
                    if (shareStatus) {
                        shareStatus.textContent = '';
                    }
                    
                }).catch(error => {
                    console.error('ç”Ÿæˆå ±åƒ¹å¡ç‰‡åœ–ç‰‡æ™‚å‡ºéŒ¯:', error);
                    // éŒ¯èª¤æ™‚çš„å‚™ç”¨æ–¹æ¡ˆ
                    handleGenerateError(shareQuoteCard, quoteHtml);
                });
            } catch (error) {
                console.error('æº–å‚™å ±åƒ¹å¡ç‰‡æ™‚å‡ºéŒ¯:', error);
                
                // ç§»é™¤åŠ è¼‰æç¤º
                if (document.getElementById('screenshot-loading')) {
                    document.body.removeChild(document.getElementById('screenshot-loading'));
                }
                
                showToast('ç”Ÿæˆå ±åƒ¹å¡ç‰‡æ™‚å‡ºéŒ¯ï¼Œè«‹ç¨å¾Œå†è©¦', true);
            }
        }, 100);
    }

    // æ·»åŠ ä¸€å€‹æ–°çš„éŒ¯èª¤è™•ç†å‡½æ•¸
    function handleGenerateError(shareQuoteCard, quoteHtml) {
        // ç§»é™¤åŠ è¼‰æç¤º
        if (document.getElementById('screenshot-loading')) {
            document.body.removeChild(document.getElementById('screenshot-loading'));
        }
        
        // å›é€€åˆ°ç´”HTMLæ–¹å¼é¡¯ç¤º
        if (shareQuoteCard) {
            shareQuoteCard.innerHTML = quoteHtml;
        }
        
        // è¨­ç½®ä¸‹è¼‰æŒ‰éˆ•åŠŸèƒ½
        const downloadBtn = document.getElementById('downloadBtn');
        if (downloadBtn) {
            downloadBtn.textContent = 'æ‰‹å‹•æˆªåœ–';
            downloadBtn.onclick = function() {
                showToast('è«‹ä½¿ç”¨ç³»çµ±æˆªåœ–åŠŸèƒ½ä¿å­˜åœ–ç‰‡', false, 3000);
            };
        }
        
        // éš±è—åˆ†äº«æŒ‰éˆ•ï¼Œå› ç‚ºæ²’æœ‰åœ–ç‰‡
        const shareBtn = document.getElementById('shareBtn');
        if (shareBtn) {
            shareBtn.style.display = 'none';
        }
        
        // é¡¯ç¤ºåˆ†äº«æ¨¡æ…‹æ¡†
        document.getElementById('shareModalOverlay').style.display = 'flex';
        
        // æ›´æ–°ç‹€æ…‹è¨Šæ¯
        const shareStatus = document.getElementById('shareStatus');
        if (shareStatus) {
            shareStatus.textContent = 'è«‹ä½¿ç”¨ç³»çµ±æˆªåœ–åŠŸèƒ½ä¿å­˜æ­¤å ±åƒ¹';
            shareStatus.style.color = '#ff9c33';
        }
    }

    // ç”Ÿæˆå ±åƒ¹å¡ç‰‡ HTML
    function generateQuoteCardHtml() {
        // ç²å–æ•¸æ“š
        const period = document.getElementById('period').value;
        const rate = document.getElementById('rate').value;
        const principal = document.getElementById('principal').value;
        const payment = document.getElementById('payment').value;
        const totalInterest = document.getElementById('totalInterest').value;
        const afterTaxRate = document.getElementById('afterTaxRate').value;
        const commission = document.getElementById('commission').value;
        const afterCommissionRate = document.getElementById('afterCommissionRate').value;
        const currentTime = document.getElementById('currentTime').textContent;
        
        // æ˜¯å¦é¡¯ç¤ºæ¨å»£è²»ç”¨
        const showCommission = commission && commission !== "0";
        
        // ç²å–ç•¶å‰ä¸»é¡Œçš„ CSS è®Šé‡
        const style = getComputedStyle(document.documentElement);
        const primaryColor = style.getPropertyValue('--primary-color').trim();
        const textColor = style.getPropertyValue('--text-color').trim();
        const accentColor = style.getPropertyValue('--accent-color').trim();
        const borderColor = style.getPropertyValue('--border-color').trim();
        const textMuted = style.getPropertyValue('--text-muted').trim();
        
        return `
            <div style="width: 90%; max-width: 340px; margin: 0 auto; background-color: ${primaryColor}; padding: 20px; border-radius: 15px; font-family: 'Microsoft JhengHei', Arial, sans-serif; color: ${textColor}; border: 2px solid ${accentColor}; box-sizing: border-box;">
                <div style="text-align: center; margin-bottom: 15px; border-bottom: 2px solid ${accentColor}; padding-bottom: 10px;">
                    <div style="margin: 0; font-size: 22px; color: ${accentColor}; font-weight: bold;">è²¸æ¬¾è¨ˆç®—å ±åƒ¹å–®</div>
                    <div style="font-size: 14px; margin-top: 8px;">${currentTime}</div>
                </div>
                
                <table style="width: 100%; border-collapse: separate; border-spacing: 0 10px; font-size: 16px;">
                    <tr>
                        <td style="width: 35%; text-align: right; padding-right: 15px; color: ${accentColor}; font-weight: bold; white-space: nowrap;">æœŸæ•¸:</td>
                        <td style="text-align: left; font-weight: bold; width: 65%;">${period} æœŸ</td>
                    </tr>
                    <tr>
                        <td style="width: 35%; text-align: right; padding-right: 15px; color: ${accentColor}; font-weight: bold; white-space: nowrap;">ç¨…å‰åˆ©ç‡:</td>
                        <td style="text-align: left; font-weight: bold; width: 65%;">${rate}%</td>
                    </tr>
                    <tr>
                        <td style="width: 35%; text-align: right; padding-right: 15px; color: ${accentColor}; font-weight: bold; white-space: nowrap;">æœ¬é‡‘:</td>
                        <td style="text-align: left; font-weight: bold; width: 65%;">${principal} å…ƒ</td>
                    </tr>
                    <tr>
                        <td style="width: 35%; text-align: right; padding-right: 15px; color: ${accentColor}; font-weight: bold; white-space: nowrap;">æœŸç¹³:</td>
                        <td style="text-align: left; font-weight: bold; width: 65%;">${payment} å…ƒ/æœŸ</td>
                    </tr>
                    <tr>
                        <td style="width: 35%; text-align: right; padding-right: 15px; color: ${accentColor}; font-weight: bold; white-space: nowrap;">ç¸½åˆ©æ¯:</td>
                        <td style="text-align: left; font-weight: bold; width: 65%;">${totalInterest} å…ƒ</td>
                    </tr>
                    <tr>
                        <td style="width: 35%; text-align: right; padding-right: 15px; color: ${accentColor}; font-weight: bold; white-space: nowrap;">ç¨…å¾Œåˆ©ç‡:</td>
                        <td style="text-align: left; font-weight: bold; width: 65%;">${afterTaxRate}%</td>
                    </tr>
                    ${showCommission ? `
                    <tr>
                        <td style="width: 35%; text-align: right; padding-right: 15px; color: ${accentColor}; font-weight: bold; white-space: nowrap;">æ¨å»£:</td>
                        <td style="text-align: left; font-weight: bold; width: 65%;">${commission} å…ƒ</td>
                    </tr>
                    ` : ''}
                    <tr>
                        <td style="width: 35%; text-align: right; padding-right: 15px; color: ${accentColor}; font-weight: bold; white-space: nowrap;">ç¨…ä½£å¾Œåˆ©ç‡:</td>
                        <td style="text-align: left; font-weight: bold; width: 65%;">${afterCommissionRate}%</td>
                    </tr>
                </table>
                
                <div style="text-align: center; margin-top: 15px; font-size: 14px; color: ${textMuted}; border-top: 1px dashed ${borderColor}; padding-top: 12px;">
                    å ±åƒ¹å¾Œè¨˜å¾—åƒç¢—ç«é›è‚‰é£¯å”·ï¼
                </div>
            </div>
        `;
    }

    // éš±è—åˆ†äº«æ¨¡æ…‹æ¡†
    function hideShareModal() {
        const overlay = document.getElementById('shareModalOverlay');
        if (overlay) {
            overlay.style.display = 'none';
            
            // é‡ç½®å…§å®¹ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ‰“é–‹æ™‚é‡æ–°ç”Ÿæˆ
            const shareQuoteCard = document.getElementById('shareQuoteCard');
            if (shareQuoteCard) {
                shareQuoteCard.innerHTML = '';
            }
            
            // é‡ç½®ç‹€æ…‹è¨Šæ¯
            const shareStatus = document.getElementById('shareStatus');
            if (shareStatus) {
                shareStatus.textContent = '';
            }
            
            // é‡è¨­æŒ‰éˆ•æ–‡å­—
            const downloadBtn = document.getElementById('downloadBtn');
            if (downloadBtn) {
                downloadBtn.textContent = 'ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡';
            }
            
            // é‡è¨­åˆ†äº«æŒ‰éˆ•é¡¯ç¤º
            const shareBtn = document.getElementById('shareBtn');
            if (shareBtn) {
                shareBtn.style.display = 'inline-block';
            }
        }
    }

    // åˆ†äº«å ±åƒ¹åœ–ç‰‡
    function shareQuoteImage(imageDataUrl) {
        const shareStatusElement = document.getElementById('shareStatus');
        
        // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æŒç¶²é åˆ†äº«API
        if (navigator.share) {
            try {
                // é¦–å…ˆå˜—è©¦åˆ†äº«URL
                navigator.share({
                    title: 'è²¸æ¬¾è¨ˆç®—å ±åƒ¹',
                    text: 'é€™æ˜¯æˆ‘çš„è²¸æ¬¾è¨ˆç®—å ±åƒ¹çµæœ',
                    url: location.href
                })
                .then(() => {
                    shareStatusElement.textContent = 'åˆ†äº«é€£çµæˆåŠŸï¼';
                    setTimeout(() => {
                        shareStatusElement.textContent = '';
                    }, 2000);
                })
                .catch(err => {
                    console.error('åˆ†äº«é€£çµå¤±æ•—:', err);
                    
                    // å¤±æ•—å¾Œå˜—è©¦åˆ†äº«æ–‡ä»¶
                    shareQuoteImageAsFile(imageDataUrl, shareStatusElement);
                });
            } catch (error) {
                console.error('æº–å‚™åˆ†äº«æ™‚å‡ºéŒ¯:', error);
                shareStatusElement.textContent = 'åˆ†äº«éç¨‹ä¸­å‡ºéŒ¯ï¼Œè«‹ä½¿ç”¨ä¸‹è¼‰é¸é …ã€‚';
            }
        } else {
            // å¦‚æœç€è¦½å™¨ä¸æ”¯æŒï¼Œé¡¯ç¤ºæç¤º
            shareStatusElement.textContent = 'æ‚¨çš„è¨­å‚™ä¸æ”¯æŒç›´æ¥åˆ†äº«åŠŸèƒ½ã€‚è«‹ä½¿ç”¨ä¸‹è¼‰é¸é …ã€‚';
        }
    }

    function shareQuoteImageAsFile(imageDataUrl, statusElement) {
        try {
            // å‰µå»ºä¸€å€‹ Blob å°è±¡
            fetch(imageDataUrl)
                .then(res => res.blob())
                .then(blob => {
                    // å‰µå»ºæ–‡ä»¶å°è±¡
                    const dateTime = document.getElementById('currentTime').textContent.replace(/[^0-9]/g, '');
                    const fileName = `è²¸æ¬¾è¨ˆç®—å ±åƒ¹_${dateTime}.png`;
                    const file = new File([blob], fileName, { type: 'image/png' });
                    
                    // ä½¿ç”¨ Web Share API åˆ†äº«æ–‡ä»¶
                    navigator.share({
                        title: 'è²¸æ¬¾è¨ˆç®—å ±åƒ¹',
                        files: [file]
                    })
                    .then(() => {
                        statusElement.textContent = 'åˆ†äº«åœ–ç‰‡æˆåŠŸï¼';
                        setTimeout(() => {
                            statusElement.textContent = '';
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('åˆ†äº«åœ–ç‰‡å¤±æ•—:', err);
                        statusElement.textContent = 'åˆ†äº«åœ–ç‰‡å¤±æ•—ï¼Œè«‹ä½¿ç”¨ä¸‹è¼‰é¸é …ã€‚';
                    });
                })
                .catch(err => {
                    console.error('è™•ç†åœ–ç‰‡å¤±æ•—:', err);
                    statusElement.textContent = 'è™•ç†åœ–ç‰‡æ™‚å‡ºéŒ¯ï¼Œè«‹ä½¿ç”¨ä¸‹è¼‰é¸é …ã€‚';
                });
        } catch (error) {
            console.error('åˆ†äº«åœ–ç‰‡å‡ºéŒ¯:', error);
            statusElement.textContent = 'åˆ†äº«åœ–ç‰‡å¤±æ•—ï¼Œè«‹ä½¿ç”¨ä¸‹è¼‰é¸é …ã€‚';
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        // ç‚ºç›¸é—œè¼¸å…¥æ¬„ä½æ·»åŠ äº‹ä»¶ç›£è½
        const inputIds = ['period', 'payment', 'principal', 'monthlyCost'];
        inputIds.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', updateAllFields);
                element.addEventListener('change', updateAllFields);
            }
        });
    });

    // æ·»åŠ æ•¸å€¼è®ŠåŒ–å‹•ç•«
        function animateValueChange(elementId) {
        const element = document.getElementById(elementId);
        element.classList.remove('value-changed');
        void element.offsetWidth; // è§¸ç™¼é‡ç¹ª
        element.classList.add('value-changed');
    }

    

    // ä¿å­˜è²¸æ¬¾è¨ˆç®—çµæœ
    // ä¿®æ”¹ saveLoanData å‡½æ•°æ¥ç¡®ä¿ä¿å­˜çš„æ•°æ®æ˜¯å¹²å‡€çš„æ•°å­—å€¼
    function saveLoanData() {
        const period = document.getElementById('period').value;
        const rate = document.getElementById('rate').value;
        // ç§»é™¤åƒä½åˆ†éš”ç¬¦ä»¥ä¿å­˜å¹²å‡€çš„æ•°å€¼
        const principal = document.getElementById('principal').value.replace(/,/g, '');
        const payment = document.getElementById('payment').value.replace(/,/g, '');
        const afterTaxRate = document.getElementById('afterTaxRate').value;
        const commission = document.getElementById('commission').value.replace(/,/g, '');
        const afterCommissionRate = document.getElementById('afterCommissionRate').value;
        
        // æ£€æŸ¥å¿…è¦å­—æ®µæ˜¯å¦å¡«å†™
        if (!period || !rate || !principal || !payment) {
            showToast('è«‹å…ˆå®Œæˆå¿…è¦æ¬„ä½ï¼ˆæœŸæ•¸ã€åˆ©ç‡ã€æœ¬é‡‘ã€æœŸç¹³ï¼‰çš„è¨ˆç®—ï¼');
            return;
        }
        
        const loanDate = new Date();
        const year = loanDate.getFullYear();
        const month = String(loanDate.getMonth() + 1).padStart(2, '0');
        const date = String(loanDate.getDate()).padStart(2, '0');
        const formattedDate = `${year}-${month}-${date}`;
        
        const loanData = {
            id: new Date().getTime(),
            date: formattedDate,
            period: period,
            rate: rate,
            principal: principal,
            payment: payment,
            afterTaxRate: afterTaxRate,
            commission: commission || '0',
            afterCommissionRate: afterCommissionRate,
            totalInterest: document.getElementById('totalInterest').value.replace(/,/g, ''),
            timestamp: new Date().toISOString(),
            note: '' // åˆå§‹å‚™è¨»ç‚ºç©º
        };
        
        // è·å–å·²å­˜å‚¨çš„è´·æ¬¾è®°å½•
        let loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        loanHistory.push(loanData);
        
        // ä¿å­˜åˆ° localStorage
        localStorage.setItem('loanHistory', JSON.stringify(loanHistory));
        
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        showToast('è²¸æ¬¾è¨ˆç®—çµæœå·²ä¿å­˜ï¼');
        
        // è§¦è§‰åé¦ˆï¼ˆå¦‚æœè®¾å¤‡æ”¯æŒï¼‰
        if (navigator.vibrate) {
            navigator.vibrate(70);
        }
    }

    // å…¨å±€è®Šé‡ï¼Œç”¨æ–¼å­˜å„²æ¯”è¼ƒçš„è²¸æ¬¾æ•¸æ“š
    let compareLoanData = null;

    // æ¯”è¼ƒè²¸æ¬¾å‡½æ•¸
    function compareLoan() {
        // æª¢æŸ¥æ˜¯å¦æœ‰è¶³å¤ çš„æ•¸æ“šé€²è¡Œæ¯”è¼ƒ
        const period = document.getElementById('period').value;
        const rate = document.getElementById('rate').value;
        const principal = document.getElementById('principal').value.replace(/,/g, '');
        const payment = document.getElementById('payment').value.replace(/,/g, '');
        
        if (!period || !rate || !principal || !payment) {
            showToast('è«‹å…ˆå®Œæˆå¿…è¦æ¬„ä½ï¼ˆæœŸæ•¸ã€åˆ©ç‡ã€æœ¬é‡‘ã€æœŸç¹³ï¼‰çš„è¨ˆç®—ï¼');
            return;
        }
        
        // ç²å–ç•¶å‰è²¸æ¬¾æ•¸æ“š
        const currentLoan = {
            id: 'current',
            period: period,
            rate: rate,
            principal: principal,
            payment: payment,
            afterTaxRate: document.getElementById('afterTaxRate').value,
            commission: document.getElementById('commission').value.replace(/,/g, '') || '0',
            afterCommissionRate: document.getElementById('afterCommissionRate').value,
            totalInterest: document.getElementById('totalInterest').value.replace(/,/g, ''),
            date: 'ç›®å‰è¨ˆç®—'
        };
        
        // ç²å–æ­·å²è¨˜éŒ„
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        
        if (loanHistory.length === 0) {
            showToast('å°šç„¡æ­·å²è¨˜éŒ„å¯æ¯”è¼ƒï¼Œè«‹å…ˆä¿å­˜ç•¶å‰è¨ˆç®—');
            return;
        }
        
        // é¡¯ç¤ºè²¸æ¬¾é¸æ“‡å°è©±æ¡†
        showLoanSelectionModal(currentLoan, loanHistory);
        
        // è§¸ç™¼éœ‡å‹•åé¥‹
        vibrate();
    }

    // é¡¯ç¤ºè²¸æ¬¾é¸æ“‡å°è©±æ¡†
    function showLoanSelectionModal(currentLoan, loanHistory) {
        // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰é¢
        loanHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        // ç”Ÿæˆæ­·å²è¨˜éŒ„åˆ—è¡¨
        let historyItemsHtml = '';
        loanHistory.forEach(loan => {
            historyItemsHtml += `
                <div class="comparison-history-item" onclick="selectLoanForComparison(${loan.id})">
                    <div class="comparison-history-header">
                        <span>${formatDate(loan.date)}</span>
                        <span>ç¨…ä½£å¾Œåˆ©ç‡: ${parseFloat(loan.afterCommissionRate).toFixed(4)}%</span>
                    </div>
                    <div class="comparison-history-details">
                        <div>æœŸæ•¸: ${loan.period}</div>
                        <div>æœ¬é‡‘: ${formatNumberWithCommas(loan.principal)}</div>
                    </div>
                </div>
            `;
        });
        
        // å‰µå»ºæ¨¡æ…‹æ¡†
        const modalHTML = `
        <div class="modal-header">
            <h3>é¸æ“‡è¦æ¯”è¼ƒçš„è²¸æ¬¾æ–¹æ¡ˆ</h3>
            <button class="close-btn" onclick="closeCustomModal('loanSelectionModal')">Ã—</button>
        </div>
        <div class="modal-content">
            <div style="margin-bottom: 15px;">
                <p>ç›®å‰çš„è¨ˆç®—çµæœï¼š</p>
                <div class="current-loan-summary">
                    <div>æœŸæ•¸: ${currentLoan.period} | åˆ©ç‡: ${currentLoan.rate}%</div>
                    <div>æœ¬é‡‘: ${formatNumberWithCommas(currentLoan.principal)} | æœŸç¹³: ${formatNumberWithCommas(currentLoan.payment)}</div>
                </div>
                <p style="margin-top: 15px;">è«‹é¸æ“‡è¦æ¯”è¼ƒçš„æ­·å²æ–¹æ¡ˆï¼š</p>
            </div>
            <div class="comparison-history-list">
                ${historyItemsHtml}
            </div>
        </div>
        `;
        
        // å°‡ç•¶å‰è²¸æ¬¾æ•¸æ“šä¿å­˜åœ¨ localStorage ä¸­ï¼Œä»¥ä¾¿å¾ŒçºŒä½¿ç”¨
        localStorage.setItem('currentLoanForComparison', JSON.stringify(currentLoan));
        
        // å‰µå»ºä¸¦é¡¯ç¤ºå…¨è¢å¹•æ¨¡æ…‹æ¡†
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        modalOverlay.id = 'loanSelectionModal';
        modalOverlay.style.cssText = 'display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--primary-color); z-index: 9999;';
        modalOverlay.innerHTML = `<div class="modal-container" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%; margin: 0; border-radius: 0; display: flex; flex-direction: column;">${modalHTML}</div>`;

        // æ·»åŠ åˆ°ç¶²é 
        document.body.appendChild(modalOverlay);

        vibrate();
        
        // æ·»åŠ æ¨£å¼
        const style = document.createElement('style');
        style.textContent = `
            .current-loan-summary {
                background-color: var(--secondary-color);
                padding: 12px;
                border-radius: 8px;
                margin-top: 5px;
            }
            
            .comparison-history-list {
                max-height: 60vh;
                overflow-y: auto;
            }
            
            .comparison-history-item {
                background-color: var(--secondary-color);
                margin: 8px 0;
                padding: 12px;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            
            .comparison-history-item:hover {
                transform: translateX(5px);
                box-shadow: 0 2px 8px var(--shadow-color);
            }
            
            .comparison-history-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
            }
            
            .comparison-history-details {
                display: flex;
                justify-content: space-between;
            }
        `;
        document.head.appendChild(style);
    }

    // é¸æ“‡è²¸æ¬¾é€²è¡Œæ¯”è¼ƒ
    function selectLoanForComparison(loanId) {
        // ç²å–ç•¶å‰è²¸æ¬¾æ•¸æ“š
        const currentLoan = JSON.parse(localStorage.getItem('currentLoanForComparison'));
        
        // ç²å–é¸ä¸­çš„æ­·å²è²¸æ¬¾æ•¸æ“š
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        const selectedLoan = loanHistory.find(loan => loan.id === loanId);
        
        if (!selectedLoan) {
            showToast('æ‰¾ä¸åˆ°é¸ä¸­çš„è²¸æ¬¾è¨˜éŒ„');
            return;
        }
        
        // é—œé–‰é¸æ“‡å°è©±æ¡†
        closeCustomModal('loanSelectionModal');
        
        // é¡¯ç¤ºæ¯”è¼ƒè¦–åœ–
        showMultiLoanComparison([currentLoan, selectedLoan]);
    }

    // é¡¯ç¤ºå¤šè²¸æ¬¾æ¯”è¼ƒè¦–åœ–
    function showMultiLoanComparison(loans) {
        vibrate();
        
        // ç¢ºä¿è‡³å°‘æœ‰2å€‹è²¸æ¬¾æ–¹æ¡ˆ
        if (loans.length < 2) {
            showToast('è‡³å°‘éœ€è¦2å€‹è²¸æ¬¾æ–¹æ¡ˆé€²è¡Œæ¯”è¼ƒ');
            return;
        }
        
        // é—œé–‰æ­·å²è¨˜éŒ„é¢æ¿
        document.getElementById('historyPanel').style.display = 'none';
        
        // è¨ˆç®—æ¯”è¼ƒçµæœ
        const comparisonReport = generateComparisonReport(loans);
        
        // ç”Ÿæˆè¡¨æ ¼HTML
        let tableHTML = `
        <div class="comparison-tabs">
            <button class="tab-btn active" onclick="switchComparisonTab('table')">è¡¨æ ¼æ¯”è¼ƒ</button>
            <button class="tab-btn" onclick="switchComparisonTab('report')">åˆ†æå ±å‘Š</button>
        </div>
        
        <div id="table-tab" class="comparison-tab-content">
            <table class="comparison-table">
                <tr>
                    <th>é …ç›®</th>
                    ${loans.map((loan, index) => `<th>${loan.id === 'current' ? 'ç›®å‰è¨ˆç®—' : 'æ–¹æ¡ˆ ' + (index + 1)}</th>`).join('')}
                </tr>
                <tr>
                    <td>æ—¥æœŸ</td>
                    ${loans.map(loan => `<td>${loan.id === 'current' ? 'ç›®å‰è¨ˆç®—' : formatDate(loan.date)}</td>`).join('')}
                </tr>
                <tr>
                    <td>æœŸæ•¸</td>
                    ${loans.map(loan => `<td>${loan.period}</td>`).join('')}
                </tr>
                <tr>
                    <td>ç¨…å‰åˆ©ç‡</td>
                    ${loans.map(loan => `<td>${loan.rate}%</td>`).join('')}
                </tr>
                <tr>
                    <td>æœ¬é‡‘</td>
                    ${loans.map(loan => `<td>${formatNumberWithCommas(loan.principal)}</td>`).join('')}
                </tr>
                <tr>
                    <td>æœŸç¹³</td>
                    ${loans.map(loan => `<td>${formatNumberWithCommas(loan.payment)}</td>`).join('')}
                </tr>
                <tr>
                    <td>ç¸½åˆ©æ¯</td>
                    ${loans.map(loan => `<td>${formatNumberWithCommas(loan.totalInterest)}</td>`).join('')}
                </tr>
                <tr>
                    <td>ç¨…å¾Œåˆ©ç‡</td>
                    ${loans.map(loan => `<td>${loan.afterTaxRate}%</td>`).join('')}
                </tr>
                <tr>
                    <td>æ¨å»£è²»</td>
                    ${loans.map(loan => `<td>${formatNumberWithCommas(loan.commission)}</td>`).join('')}
                </tr>
                <tr class="highlight-row">
                    <td>ç¨…ä½£å¾Œåˆ©ç‡</td>
                    ${loans.map(loan => `<td>${loan.afterCommissionRate}%</td>`).join('')}
                </tr>
                <tr class="highlight-row">
                    <td>ç¸½é‚„æ¬¾</td>
                    ${loans.map(loan => {
                        const totalPayment = parseFloat(loan.payment) * parseFloat(loan.period);
                        return `<td>${formatNumberWithCommas(totalPayment.toFixed(2))}</td>`;
                    }).join('')}
                </tr>
            </table>
        </div>
        
        <div id="report-tab" class="comparison-tab-content" style="display: none;">
            <div class="comparison-report">
                <h4>æ–¹æ¡ˆæ¯”è¼ƒåˆ†æå ±å‘Š</h4>
                ${comparisonReport.map(item => `
                    <div class="report-item">
                        <div class="report-title">${item.title}</div>
                        <div class="report-content">${item.content}</div>
                    </div>
                `).join('')}
            </div>
        </div>
        `;
        
        // å‰µå»ºæ¨¡æ…‹æ¡†
        const modalHTML = `
        <div class="modal-header">
            <h3>è²¸æ¬¾æ–¹æ¡ˆæ¯”è¼ƒ</h3>
            <button class="close-btn" onclick="closeCustomModal('multiLoanComparisonModal')">Ã—</button>
        </div>
        <div class="modal-content" style="padding: 10px; flex: 1; overflow-y: auto; background-color: var(--primary-color);">
            ${tableHTML}
        </div>
        `;
        
        // å‰µå»ºä¸¦é¡¯ç¤ºå…¨è¢å¹•æ¨¡æ…‹æ¡†
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        modalOverlay.id = 'multiLoanComparisonModal';
        modalOverlay.style.cssText = 'display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--primary-color); z-index: 9999;';
        modalOverlay.innerHTML = `<div class="modal-container" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%; margin: 0; border-radius: 0; display: flex; flex-direction: column;">${modalHTML}</div>`;

        // æ·»åŠ åˆ°ç¶²é 
        document.body.appendChild(modalOverlay);

        // é»æ“ŠèƒŒæ™¯é—œé–‰ï¼ˆç§»é™¤æ­¤åŠŸèƒ½ä»¥ç¢ºä¿å…¨è¢å¹•ï¼‰
        // modalOverlay.addEventListener('click', function(event) {
        //     if (event.target === this) {
        //         closeCustomModal('multiLoanComparisonModal');
        //     }
        // });

        vibrate();
        
        // æ·»åŠ æ¨£å¼
        const style = document.createElement('style');
        style.textContent = `
            .comparison-tabs {
                display: flex;
                border-bottom: 1px solid var(--border-color);
                margin-bottom: 15px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab-btn {
                background: none;
                border: none;
                padding: 10px 15px;
                color: var(--text-color);
                cursor: pointer;
                transition: all 0.3s ease;
                white-space: nowrap;
                border-bottom: 2px solid transparent;
            }
            
            .tab-btn.active {
                color: var(--accent-color);
                border-bottom: 2px solid var(--accent-color);
            }
            
            .comparison-tab-content {
                padding: 10px 0;
            }
            
            .comparison-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 14px;
            }
            
            .comparison-table th, 
            .comparison-table td {
                padding: 8px;
                text-align: center;
                border-bottom: 1px solid var(--border-color);
            }
            
            .comparison-table th {
                background-color: var(--secondary-color);
                position: sticky;
                top: 0;
                z-index: 10;
            }
            
            .comparison-table td:first-child {
                text-align: left;
                font-weight: bold;
                color: var(--accent-color);
            }
            
            .comparison-table tr:hover {
                background-color: var(--hover-color);
            }
            
            .highlight-row {
                background-color: var(--accent-color-light);
            }
    
            .comparison-report {
                padding: 10px;
            }
            
            .report-item {
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 1px dashed var(--border-color);
            }
            
            .report-title {
                font-weight: bold;
                color: var(--accent-color);
                margin-bottom: 5px;
            }
            
            .report-content {
                line-height: 1.5;
            }
        `;
        document.head.appendChild(style);
    }

    // åˆ‡æ›æ¯”è¼ƒæ¨™ç±¤é 
    function switchComparisonTab(tabName) {
        vibrate();
        
        // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
        const tabContents = document.querySelectorAll('.comparison-tab-content');
        tabContents.forEach(tab => {
            tab.style.display = 'none';
        });
        
        // ç§»é™¤æ‰€æœ‰æ¨™ç±¤æŒ‰éˆ•çš„æ´»å‹•ç‹€æ…‹
        const tabButtons = document.querySelectorAll('.tab-btn');
        tabButtons.forEach(btn => {
            btn.classList.remove('active');
        });
        
        // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤å…§å®¹ä¸¦æ¿€æ´»å°æ‡‰æŒ‰éˆ•
        document.getElementById(`${tabName}-tab`).style.display = 'block';
        document.querySelector(`.tab-btn[onclick="switchComparisonTab('${tabName}')"]`).classList.add('active');
    }

    function generateComparisonReport(loans) {
        // åˆå§‹åŒ–å ±å‘Šé …ç›®
        const report = [];
        
        // 1. æœ€ä½ç¨…ä½£å¾Œåˆ©ç‡
        const minRateIndex = loans.reduce((minIdx, loan, idx, arr) => 
            parseFloat(loan.afterCommissionRate) < parseFloat(arr[minIdx].afterCommissionRate) ? idx : minIdx, 0);
        
        report.push({
            title: 'æœ€ä½å¯¦éš›åˆ©ç‡',
            content: `æ–¹æ¡ˆ ${loans[minRateIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minRateIndex]) + 1)} çš„ç¨…ä½£å¾Œåˆ©ç‡ç‚º ${loans[minRateIndex].afterCommissionRate}%ï¼Œæ˜¯æ‰€æœ‰æ–¹æ¡ˆä¸­æœ€ä½çš„ã€‚`
        });
        
        // 2. æœ€ä½æœˆä»˜æ¬¾
        const minPaymentIndex = loans.reduce((minIdx, loan, idx, arr) => 
            parseFloat(loan.payment) < parseFloat(arr[minIdx].payment) ? idx : minIdx, 0);
        
        report.push({
            title: 'æœ€ä½æœŸç¹³é‡‘é¡',
            content: `æ–¹æ¡ˆ ${loans[minPaymentIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minPaymentIndex]) + 1)} çš„æœŸç¹³é‡‘é¡ç‚º ${formatNumberWithCommas(loans[minPaymentIndex].payment)} å…ƒï¼Œæ˜¯æ‰€æœ‰æ–¹æ¡ˆä¸­æœ€ä½çš„ã€‚`
        });
        
        // 3. ç¸½åˆ©æ¯æ¯”è¼ƒ
        const minInterestIndex = loans.reduce((minIdx, loan, idx, arr) => 
            parseFloat(loan.totalInterest) < parseFloat(arr[minIdx].totalInterest) ? idx : minIdx, 0);
        
        report.push({
            title: 'æœ€ä½ç¸½åˆ©æ¯',
            content: `æ–¹æ¡ˆ ${loans[minInterestIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minInterestIndex]) + 1)} çš„ç¸½åˆ©æ¯ç‚º ${formatNumberWithCommas(loans[minInterestIndex].totalInterest)} å…ƒï¼Œæ˜¯æ‰€æœ‰æ–¹æ¡ˆä¸­æœ€ä½çš„ã€‚`
        });
        
        // 4. ç¸½é‚„æ¬¾æ¯”è¼ƒ
        const totalPayments = loans.map(loan => parseFloat(loan.payment) * parseFloat(loan.period));
        const minTotalPaymentIndex = totalPayments.reduce((minIdx, total, idx, arr) => 
            total < arr[minIdx] ? idx : minIdx, 0);
        
        report.push({
            title: 'æœ€ä½ç¸½é‚„æ¬¾',
            content: `æ–¹æ¡ˆ ${loans[minTotalPaymentIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minTotalPaymentIndex]) + 1)} çš„ç¸½é‚„æ¬¾é‡‘é¡ç‚º ${formatNumberWithCommas(totalPayments[minTotalPaymentIndex].toFixed(2))} å…ƒï¼Œæ˜¯æ‰€æœ‰æ–¹æ¡ˆä¸­æœ€ä½çš„ã€‚`
        });
        
        // 5. æœ¬é‡‘å·®ç•°
        if (loans.length === 2) {
            const principalDiff = Math.abs(parseFloat(loans[0].principal) - parseFloat(loans[1].principal));
            const principalPctDiff = (principalDiff / parseFloat(loans[0].principal) * 100).toFixed(2);
            
            report.push({
                title: 'æœ¬é‡‘å·®ç•°',
                content: `å…©å€‹æ–¹æ¡ˆçš„æœ¬é‡‘ç›¸å·® ${formatNumberWithCommas(principalDiff)} å…ƒï¼ˆ${principalPctDiff}%ï¼‰ã€‚`
            });
        }
        
        // 6. æœŸæ•¸å·®ç•°
        const periodRange = loans.map(loan => parseInt(loan.period));
        const minPeriod = Math.min(...periodRange);
        const maxPeriod = Math.max(...periodRange);
        
        if (minPeriod !== maxPeriod) {
            report.push({
                title: 'æœŸæ•¸å·®ç•°',
                content: `æ–¹æ¡ˆä¸­çš„æœŸæ•¸å¾ ${minPeriod} æœŸåˆ° ${maxPeriod} æœŸä¸ç­‰ï¼Œå·®ç•°ç‚º ${maxPeriod - minPeriod} æœŸã€‚`
            });
        }
        
        // 7. ç¶œåˆå»ºè­°
        let recommendationText = '';
        
        // åŸºæ–¼åˆ©ç‡ã€æœŸç¹³ã€ç¸½åˆ©æ¯ç¶œåˆè€ƒé‡
        if (minRateIndex === minTotalPaymentIndex) {
            recommendationText = `æ–¹æ¡ˆ ${loans[minRateIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minRateIndex]) + 1)} åŒæ™‚å…·æœ‰æœ€ä½çš„å¯¦éš›åˆ©ç‡å’Œæœ€ä½çš„ç¸½é‚„æ¬¾é‡‘é¡ï¼Œç¶œåˆä¾†çœ‹æ˜¯æœ€å„ªé¸æ“‡ã€‚`;
        } else if (minRateIndex === minInterestIndex) {
            recommendationText = `æ–¹æ¡ˆ ${loans[minRateIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minRateIndex]) + 1)} å…·æœ‰æœ€ä½çš„å¯¦éš›åˆ©ç‡å’Œæœ€ä½çš„ç¸½åˆ©æ¯ï¼Œå¾é•·æœŸæˆæœ¬è€ƒé‡æ˜¯è¼ƒä½³é¸æ“‡ã€‚`;
        } else if (minPaymentIndex === minTotalPaymentIndex) {
            recommendationText = `æ–¹æ¡ˆ ${loans[minPaymentIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minPaymentIndex]) + 1)} åŒæ™‚å…·æœ‰æœ€ä½çš„æœŸç¹³é‡‘é¡å’Œæœ€ä½çš„ç¸½é‚„æ¬¾é‡‘é¡ï¼Œå°æ–¼ç¾é‡‘æµæ•æ„Ÿçš„æƒ…æ³æ˜¯è¼ƒä½³é¸æ“‡ã€‚`;
        } else {
            recommendationText = `å„æ–¹æ¡ˆå„æœ‰å„ªåŠ£ï¼šæ–¹æ¡ˆ ${loans[minRateIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minRateIndex]) + 1)} åˆ©ç‡æœ€ä½ï¼›æ–¹æ¡ˆ ${loans[minPaymentIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minPaymentIndex]) + 1)} æœŸç¹³æœ€ä½ï¼›æ–¹æ¡ˆ ${loans[minInterestIndex].id === 'current' ? 'ç›®å‰è¨ˆç®—' : (loans.indexOf(loans[minInterestIndex]) + 1)} ç¸½åˆ©æ¯æœ€ä½ã€‚å»ºè­°æ ¹æ“šå€‹äººè²¡å‹™ç‹€æ³é¸æ“‡æœ€é©åˆçš„æ–¹æ¡ˆã€‚`;
        }
        
        report.push({
            title: 'ç¶œåˆå»ºè­°',
            content: recommendationText
        });
        
        return report;
    }


    // é¡¯ç¤ºè²¸æ¬¾æ¯”è¼ƒæ¨¡æ…‹æ¡†
    function showLoanComparisonModal(loan1, loan2) {
        // å‰µå»ºæ¯”è¼ƒæ¨¡æ…‹æ¡†çš„HTML
        const modalHTML = `
        <div class="modal-header">
            <h3>è²¸æ¬¾æ–¹æ¡ˆæ¯”è¼ƒ</h3>
            <button class="close-btn" onclick="closeLoanComparisonModal()">Ã—</button>
        </div>
        <div class="modal-content" style="flex: 1; overflow-y: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <th style="text-align: left; padding: 8px; border-bottom: 1px solid var(--border-color);">é …ç›®</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">æ–¹æ¡ˆ1</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">æ–¹æ¡ˆ2</th>
                    <th style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">å·®ç•°</th>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">æœŸæ•¸</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan1.period}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.period}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.period - loan1.period}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">ç¨…å‰åˆ©ç‡</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan1.rate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.rate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${(parseFloat(loan2.rate) - parseFloat(loan1.rate)).toFixed(4)}%</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">æœ¬é‡‘</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan1.principal)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.principal)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.principal - loan1.principal)}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">æœŸç¹³</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan1.payment)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.payment)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.payment - loan1.payment)}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">ç¸½åˆ©æ¯</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan1.totalInterest)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.totalInterest)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.totalInterest - loan1.totalInterest)}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">ç¨…å¾Œåˆ©ç‡</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan1.afterTaxRate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.afterTaxRate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${(parseFloat(loan2.afterTaxRate) - parseFloat(loan1.afterTaxRate)).toFixed(4)}%</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">æ¨å»£</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan1.commission)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.commission)}</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(loan2.commission - loan1.commission)}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">ç¨…ä½£å¾Œåˆ©ç‡</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan1.afterCommissionRate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${loan2.afterCommissionRate}%</td>
                    <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${(parseFloat(loan2.afterCommissionRate) - parseFloat(loan1.afterCommissionRate)).toFixed(4)}%</td>
                </tr>
            </table>
            
            <div style="margin-top: 20px; padding: 15px; background-color: var(--secondary-color); border-radius: 8px;">
                <h4 style="margin-top: 0; color: var(--accent-color);">æ–¹æ¡ˆæ¯”è¼ƒæ‘˜è¦</h4>
                <p>ç¸½æˆæœ¬å·®ç•°: ${formatNumberWithCommas(Math.round((parseFloat(loan2.totalInterest) + parseFloat(loan2.commission)) - (parseFloat(loan1.totalInterest) + parseFloat(loan1.commission))))} å…ƒ</p>
                <p>æœˆä»˜æ¬¾å·®ç•°: ${formatNumberWithCommas(Math.round(loan2.payment - loan1.payment))} å…ƒ/æœˆ</p>
                <p>å¯¦éš›åˆ©ç‡å·®ç•°: ${(parseFloat(loan2.afterCommissionRate) - parseFloat(loan1.afterCommissionRate)).toFixed(4)}%</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn modal-btn-secondary" onclick="clearComparisonData()">æ¸…é™¤æ¯”è¼ƒ</button>
            <button class="modal-btn modal-btn-primary" onclick="closeLoanComparisonModal()">é—œé–‰</button>
        </div>
        `;
        
        // å‰µå»ºæ¯”è¼ƒæ¨¡æ…‹æ¡†
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        modalOverlay.id = 'loanComparisonModal';
        modalOverlay.style.display = 'flex';
        modalOverlay.innerHTML = `<div class="modal-container">${modalHTML}</div>`;
        
        // æ·»åŠ åˆ°ç¶²é 
        document.body.appendChild(modalOverlay);
        
        // æ·»åŠ èƒŒæ™¯é»æ“Šé—œé–‰åŠŸèƒ½
        modalOverlay.addEventListener('click', function(event) {
            if (event.target === this) {
                closeLoanComparisonModal();
            }
        });
        
        // æ·»åŠ éœ‡å‹•åé¥‹
        vibrate();
    }

    // é—œé–‰è²¸æ¬¾æ¯”è¼ƒæ¨¡æ…‹æ¡†
    function closeLoanComparisonModal() {
        const modal = document.getElementById('loanComparisonModal');
        if (modal) {
            document.body.removeChild(modal);
        }
        
        // æ·»åŠ éœ‡å‹•åé¥‹
        vibrate();
    }

    // æ¸…é™¤æ¯”è¼ƒæ•¸æ“š
    function clearComparisonData() {
        compareLoanData = null;
        showToast('æ¯”è¼ƒæ•¸æ“šå·²æ¸…é™¤');
        closeLoanComparisonModal();
        
        // æ·»åŠ éœ‡å‹•åé¥‹
        vibrate();
    }

    // é¡¯ç¤º/éš±è—æ­·å²è¨˜éŒ„é¢æ¿
    function toggleHistoryPanel() {
        const panel = document.getElementById('historyPanel');
        if (panel.style.display === 'block') {
            panel.style.display = 'none';
        } else {
            panel.style.display = 'block';
            loadHistoryData();
            
            // æ·»åŠ ä¸€æ¬¡æ€§èƒŒæ™¯ç‚¹å‡»å…³é—­äº‹ä»¶
            panel.onclick = function(event) {
                if (event.target === this) {
                    this.style.display = 'none';
                }
            };
        }
    }

    // è¼‰å…¥æ­·å²è¨˜éŒ„
    // ä¿®æ”¹ loadHistoryData å‡½æ•°ä»¥ä½¿ç”¨æ–°çš„è®¾è®¡
    function loadHistoryData() {
        const historyContent = document.getElementById('historyContent');
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        
        if (loanHistory.length === 0) {
            historyContent.innerHTML = '<p class="no-data">å°šç„¡è²¸æ¬¾è¨ˆç®—è¨˜éŒ„</p>';
            return;
        }
        
        // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰é¢
        loanHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        let html = '<div class="history-list">';
        loanHistory.forEach(loan => {
            // ç¡®ä¿æ•°å€¼æ­£ç¡®æ˜¾ç¤ºï¼Œç§»é™¤åƒä½åˆ†éš”ç¬¦åå†æ ¼å¼åŒ–
            const principalDisplay = formatNumber(loan.principal);
            const paymentDisplay = formatNumber(loan.payment);
            const commissionDisplay = formatNumber(loan.commission);
            
            html += `
                <div class="history-item" data-loan-id="${loan.id}">
                    <div class="history-item-header">
                        <div class="checkbox-date-container">
                            <input type="checkbox" class="history-item-checkbox" data-loan-id="${loan.id}" onchange="updateCompareButton()">
                            <div class="history-date">${formatDate(loan.date)}</div>
                        </div>
                        <div class="history-header-rate">ç¨…ä½£å¾Œåˆ©ç‡: ${parseFloat(loan.afterCommissionRate).toFixed(4)}%</div>
                    </div>
                    
                    <div class="history-details">
                        <div class="history-detail-item">
                            <span class="detail-label">æœŸæ•¸</span>
                            <span class="detail-value">${loan.period}</span>
                        </div>
                        <div class="history-detail-item">
                            <span class="detail-label">æ¨å»£</span>
                            <span class="detail-value">${commissionDisplay}</span>
                        </div>
                        <div class="history-detail-item">
                            <span class="detail-label">æœ¬é‡‘</span>
                            <span class="detail-value">${principalDisplay}</span>
                        </div>
                        <div class="history-detail-item">
                            <span class="detail-label">æœŸç¹³</span>
                            <span class="detail-value">${paymentDisplay}</span>
                        </div>
                    </div>

                    <div class="history-note-container">
                        <div class="history-item-footer">
                            <div class="history-note-preview" onclick="openNoteEditor(${loan.id}, '${loan.note || ''}')">
                                ${loan.note ? loan.note : 'é»æ“Šæ·»åŠ å‚™è¨»'}
                            </div>
                            <div class="history-actions">
                                <button class="detail-btn" onclick="loadLoanToForm(${loan.id})">è¼‰å…¥è¨ˆç®—</button>
                                <button class="delete-btn" onclick="deleteLoan(${loan.id})">åˆªé™¤</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        
        historyContent.innerHTML = html;
    }

    // æ›´æ–°æ¯”è¼ƒæŒ‰éˆ•ç‹€æ…‹
    function updateCompareButton() {
        const checkboxes = document.querySelectorAll('.history-item-checkbox:checked');
        const compareButton = document.getElementById('compareSelectedBtn');
        
        // å¦‚æœæœ‰2å€‹æˆ–ä»¥ä¸Šé¸ä¸­çš„é …ç›®ï¼Œå•Ÿç”¨æ¯”è¼ƒæŒ‰éˆ•
        if (checkboxes.length >= 2) {
            compareButton.disabled = false;
        } else {
            compareButton.disabled = true;
        }
    }

    // æ¯”è¼ƒé¸ä¸­çš„è²¸æ¬¾
    function compareSelectedLoans() {
        const checkboxes = document.querySelectorAll('.history-item-checkbox:checked');
        if (checkboxes.length < 2) {
            showToast('è«‹è‡³å°‘é¸æ“‡2å€‹è²¸æ¬¾æ–¹æ¡ˆé€²è¡Œæ¯”è¼ƒ');
            return;
        }
        
        // ç²å–æ‰€æœ‰é¸ä¸­çš„è²¸æ¬¾ID
        const selectedIds = Array.from(checkboxes).map(checkbox => 
            parseInt(checkbox.getAttribute('data-loan-id'))
        );
        
        // å¾æ­·å²è¨˜éŒ„ä¸­ç²å–é¸ä¸­çš„è²¸æ¬¾æ•¸æ“š
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        const selectedLoans = loanHistory.filter(loan => selectedIds.includes(loan.id));
        
        // é¡¯ç¤ºæ¯”è¼ƒè¦–åœ–
        showMultiLoanComparison(selectedLoans);
    }

    function openNoteEditor(loanId, existingNote = '') {
        // å‰µå»ºå‚™è¨»ç·¨è¼¯å™¨æ¨¡æ…‹æ¡†
        const noteEditorModal = document.createElement('div');
        noteEditorModal.className = 'note-editor-modal';
        noteEditorModal.id = 'noteEditorModal';
        noteEditorModal.innerHTML = `
            <div class="note-editor-content">
                <h3>å‚™è¨»ç·¨è¼¯</h3>
                <textarea id="noteEditorInput" class="note-editor-input" placeholder="è«‹è¼¸å…¥å‚™è¨»å…§å®¹...">${existingNote}</textarea>
                <div class="note-editor-buttons">
                    <button onclick="closeNoteEditor(false)" class="modal-btn modal-btn-secondary">å–æ¶ˆ</button>
                    <button onclick="saveNote(${loanId})" class="modal-btn modal-btn-primary">å„²å­˜</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(noteEditorModal);
        
        // é¡¯ç¤ºæ¨¡æ…‹æ¡†
        noteEditorModal.style.display = 'flex';
        
        // è‡ªå‹•èšç„¦åˆ°è¼¸å…¥æ¡†ä¸¦èª¿å‡ºéµç›¤
        const noteInput = document.getElementById('noteEditorInput');
        noteInput.focus();
        
        // æ·»åŠ é»æ“Šç©ºç™½è™•é—œé–‰åŠŸèƒ½
        noteEditorModal.addEventListener('click', function(event) {
            if (event.target === this) {
                closeNoteEditor();
            }
        });
        
        // ç›£è½éµç›¤å½ˆå‡ºäº‹ä»¶ï¼Œé€²ä¸€æ­¥èª¿æ•´ä½ç½®
        window.addEventListener('resize', adjustNoteEditorPosition);
        
        // åˆå§‹èª¿æ•´ä½ç½®
        adjustNoteEditorPosition();
    }

    // æ–°å¢å‡½æ•¸ï¼šèª¿æ•´å‚™è¨»ç·¨è¼¯å™¨ä½ç½®
    function adjustNoteEditorPosition() {
        const modal = document.getElementById('noteEditorModal');
        if (!modal) return;
        
        // åµæ¸¬è¦–çª—é«˜åº¦è®ŠåŒ–ä¾†æ¨æ¸¬éµç›¤æ˜¯å¦å½ˆå‡º
        const windowHeight = window.innerHeight;
        const viewportHeight = window.visualViewport ? window.visualViewport.height : windowHeight;
        
        // éµç›¤å½ˆå‡ºæ™‚æœƒæ¸›å°‘è¦–å£é«˜åº¦
        if (viewportHeight < windowHeight * 0.8) {
            // éµç›¤å·²å½ˆå‡ºï¼Œå°‡ç·¨è¼¯å™¨ç§»è‡³æ›´é é ‚éƒ¨çš„ä½ç½®
            modal.style.paddingTop = '180px';
            modal.style.justifyContent = 'center'; // ä¿æŒæ°´å¹³ç½®ä¸­
        } else {
            // éµç›¤æ”¶èµ·ï¼Œæ¢å¾©åŸæœ¬ä½ç½®
            modal.style.paddingTop = '180px';
            modal.style.justifyContent = 'center'; // ä¿æŒæ°´å¹³ç½®ä¸­
        }
    }

    function closeNoteEditor(isCancelled = true) {
        const noteEditorModal = document.getElementById('noteEditorModal');
        if (noteEditorModal) {
            document.body.removeChild(noteEditorModal);
        }
        
        // ç§»é™¤äº‹ä»¶ç›£è½å™¨
        window.removeEventListener('resize', adjustNoteEditorPosition);
    }

    function saveNote(loanId) {
        const noteInput = document.getElementById('noteEditorInput');
        const newNote = noteInput.value.trim();
        
        // ç²å–ç•¶å‰çš„æ­·å²è¨˜éŒ„
        let loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        
        // æ‰¾åˆ°å°æ‡‰çš„è²¸æ¬¾è¨˜éŒ„ä¸¦æ›´æ–°å‚™è¨»
        const updatedHistory = loanHistory.map(loan => {
            if (loan.id === loanId) {
                return { ...loan, note: newNote };
            }
            return loan;
        });
        
        // å„²å­˜æ›´æ–°å¾Œçš„æ­·å²è¨˜éŒ„
        localStorage.setItem('loanHistory', JSON.stringify(updatedHistory));
        
        // é—œé–‰å‚™è¨»ç·¨è¼¯å™¨
        closeNoteEditor();
        
        // é‡æ–°è¼‰å…¥æ­·å²è¨˜éŒ„
        loadHistoryData();
        
        // é¡¯ç¤ºæˆåŠŸæç¤º
        showToast('å‚™è¨»å·²å„²å­˜');
    }

    // æ ¼å¼åŒ–æ—¥æœŸé¡¯ç¤º
    function formatDate(dateString) {
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}/${month}/${day}`;
    }

    // ä¿®æ”¹ formatNumber å‡½æ•°
    function formatNumber(num) {
        if (!num) return '0';
        
        // å¦‚æœæ˜¯å­—ç¬¦ä¸²ä¸”åŒ…å«é€—å·ï¼Œå…ˆå»é™¤åƒä½åˆ†éš”ç¬¦
        if (typeof num === 'string') {
            num = num.replace(/,/g, '');
        }
        
        // ç¡®ä¿æ˜¯æ•°å­—ï¼Œç„¶åæ ¼å¼åŒ–
        return parseFloat(num).toLocaleString();
    }

    // è¼‰å…¥è²¸æ¬¾è¨˜éŒ„åˆ°è¡¨å–®
    function loadLoanToForm(id) {
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        const loan = loanHistory.find(item => item.id === id);
        
        if (loan) {
            // é™¤äº†åŸæœ‰çš„è¼‰å…¥é‚è¼¯å¤–ï¼Œä¸è¦é‡ç½®å‚™è¨»
            document.getElementById('period').value = loan.period;
            document.getElementById('rate').value = loan.rate;
            
            document.getElementById('principal').value = formatNumberWithCommas(Math.round(parseFloat(loan.principal)));
            document.getElementById('payment').value = formatNumberWithCommas(Math.round(parseFloat(loan.payment)));
            document.getElementById('commission').value = formatNumberWithCommas(Math.round(parseFloat(loan.commission)));
            
            calculatePayment();
            updateAllFields();
            
            document.getElementById('historyPanel').style.display = 'none';
            
            showToast('å·²è¼‰å…¥è²¸æ¬¾è¨ˆç®—è³‡æ–™');
            
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
    }

    // åˆªé™¤è²¸æ¬¾è¨˜éŒ„
    function deleteLoan(id) {
        let loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        loanHistory = loanHistory.filter(loan => loan.id !== id);
        localStorage.setItem('loanHistory', JSON.stringify(loanHistory));
        loadHistoryData(); // é‡æ–°è¼‰å…¥æ­·å²è¨˜éŒ„
        showToast('è²¸æ¬¾è¨˜éŒ„å·²åˆªé™¤ï¼');
        
        // è§¸è¦ºåé¥‹
        if (navigator.vibrate) {
            navigator.vibrate([30, 20, 30]);
        }
    }

    // ç¢ºèªæ˜¯å¦åˆªé™¤æ‰€æœ‰è²¸æ¬¾è¨˜éŒ„
    function confirmDeleteAll() {
        showConfirmModal('ç¢ºèªåˆªé™¤', 'ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰è²¸æ¬¾è¨ˆç®—è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚', deleteAllLoans);
    }

    // åˆªé™¤æ‰€æœ‰è²¸æ¬¾è¨˜éŒ„
    function deleteAllLoans() {
        localStorage.removeItem('loanHistory');
        loadHistoryData(); // é‡æ–°è¼‰å…¥æ­·å²è¨˜éŒ„ï¼ˆæœƒé¡¯ç¤ºç„¡è¨˜éŒ„ï¼‰
        showToast('æ‰€æœ‰è²¸æ¬¾è¨˜éŒ„å·²åˆªé™¤ï¼');
        
        // è§¸è¦ºåé¥‹
        if (navigator.vibrate) {
            navigator.vibrate([50, 30, 50, 30, 50]);
        }
    }

    // é¡¯ç¤ºä¸€èˆ¬æ¨¡æ…‹æ¡†
    function showModal(title, content) {
        document.getElementById('modalTitle').textContent = title || 'æç¤º';
        document.getElementById('modalContent').innerHTML = content;
        document.getElementById('modalOverlay').style.display = 'flex';
        
        // æ·»åŠ èƒŒæ™¯é»æ“Šé—œé–‰åŠŸèƒ½
        document.getElementById('modalOverlay').onclick = function(event) {
            if (event.target === this) {
                hideModal();
            }
        };
    }

    // éš±è—ä¸€èˆ¬æ¨¡æ…‹æ¡†
    function hideModal() {
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // é¡¯ç¤ºç¢ºèªæ¨¡æ…‹æ¡†
    function showConfirmModal(title, content, confirmCallback) {
        document.getElementById('confirmModalTitle').textContent = title || 'ç¢ºèª';
        document.getElementById('confirmModalContent').innerHTML = content;
        document.getElementById('confirmModalOverlay').style.display = 'flex';
        
        // è¨­å®šç¢ºèªæŒ‰éˆ•é»æ“Šäº‹ä»¶
        const confirmButton = document.getElementById('confirmModalOk');
        
        // ç§»é™¤èˆŠçš„äº‹ä»¶ç›£è½å™¨ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
        const newConfirmButton = confirmButton.cloneNode(true);
        confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
        
        // æ·»åŠ æ–°çš„äº‹ä»¶ç›£è½å™¨
        newConfirmButton.addEventListener('click', function() {
            hideConfirmModal();
            if (typeof confirmCallback === 'function') {
                confirmCallback();
            }
        });
        
        // æ·»åŠ èƒŒæ™¯é»æ“Šé—œé–‰åŠŸèƒ½
        document.getElementById('confirmModalOverlay').onclick = function(event) {
            if (event.target === this) {
                hideConfirmModal();
            }
        };
    }

    // éš±è—ç¢ºèªæ¨¡æ…‹æ¡†
    function hideConfirmModal() {
        document.getElementById('confirmModalOverlay').style.display = 'none';
    }

    // é¡¯ç¤ºè¼•é‡ç´šçš„æç¤ºè¨Šæ¯
    function showToast(message, isError = false, duration = 2000) {
        // æª¢æŸ¥æ˜¯å¦å·²æœ‰ toast å­˜åœ¨
        const existingToast = document.querySelector('.toast-message');
        if (existingToast) {
            document.body.removeChild(existingToast);
        }
        
        // å‰µå»ºä¸€å€‹æ–°çš„ toast å…ƒç´ 
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        if (isError) {
            toast.classList.add('toast-error');
        }
        toast.textContent = message;
        document.body.appendChild(toast);
        
        // æŒ‡å®šæ™‚é–“å¾Œè‡ªå‹•æ¶ˆå¤±
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 500);
        }, duration);
    }

    // æ¸…ç©ºæ‰€æœ‰æ¬„ä½é™¤äº†æœ¬æœˆè³‡é‡‘æˆæœ¬
    function clearAllFieldsExceptMonthlyCost() {
        // éœ‡å‹•æ•ˆæœ
        vibrate();
        
        // è¦æ¸…ç©ºçš„æ¬„ä½IDåˆ—è¡¨
        const fieldsToReset = [
            'period', 'rate', 'principal', 'payment', 
            'totalPayment', 'totalInterest', 'tax', 'afterTaxRate', 
            'commission', 'commissionRatio', 'afterCommissionRate',
            'afterCommissionOnlyRate',     // ä½£å¾Œåˆ©ç‡
            'annualMillionInterest', 'monthlyMillionInterest',
            'annualTenThousandInterest', 'monthlyTenThousandInterest',
            'spread', 'fundingCost', 'monthlyInterest', 'yearlyInterest',
            'customerInvoice',             // å®¢æˆ¶ç™¼ç¥¨
            'businessTax',                 // ç‡Ÿæ¥­ç¨…
            'untaxedAmount',               // æœªç¨…é‡‘é¡
            'chineseAmount',               // ä¸­æ–‡åœ‹å­—å¤§å¯«
            'totalPaymentChinese'          // ç¸½ç¹³å¤§å¯« 

        ];
        
        // æ¸…ç©ºæ¯å€‹æ¬„ä½
        fieldsToReset.forEach(fieldId => {
            const element = document.getElementById(fieldId);
            if (element) {  // æª¢æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œé¿å…éŒ¯èª¤
                element.value = '';
                // ç§»é™¤ä»»ä½•è­¦å‘Šæ¨£å¼
                element.classList.remove('warning-text');
            }
        });
        
        // é¡¯ç¤ºæç¤ºè¨Šæ¯
        showToast('å·²æ¸…ç©ºæ‰€æœ‰æ¬„ä½');
    }

    // å…¨å±€è®Šé‡
    let currentInputField = null;
    let calculatorValue = "0";
    let calculatorOperator = null;
    let calculatorFirstValue = null;
    let calculatorWaitingForSecondValue = false;
    let calculatorHistory = ""; // æ–°å¢ï¼šè¨ˆç®—éç¨‹è¨˜éŒ„

    // é–‹å•Ÿè¨ˆç®—æ©Ÿè¼¸å…¥å™¨
    function openCalculator(inputId, title) {
        currentInputField = inputId;
        document.getElementById('inputModalTitle').textContent = title;
        
        // ç²å–ç•¶å‰è¼¸å…¥æ¡†çš„å€¼
        const currentValue = document.getElementById(inputId).value;
        
        if (currentValue && currentValue !== '') {
            // å¦‚æœè¼¸å…¥æ¡†æœ‰å€¼ï¼Œä½¿ç”¨è©²å€¼åˆå§‹åŒ–è¨ˆç®—å™¨
            calculatorValue = currentValue.replace(/,/g, ''); // ç§»é™¤åƒä½åˆ†éš”ç¬¦
            document.getElementById('calculatorDisplay').textContent = calculatorValue;
        } else {
            // å¦‚æœè¼¸å…¥æ¡†æ²’æœ‰å€¼ï¼Œä½¿ç”¨ "0"
            calculatorValue = "0";
            document.getElementById('calculatorDisplay').textContent = calculatorValue;
        }
        
        calculatorOperator = null;
        calculatorFirstValue = null;
        calculatorWaitingForSecondValue = false;
        calculatorHistory = ""; // æ¸…ç©ºè¨ˆç®—æ­·å²
        document.getElementById('calculatorHistory').textContent = ""; // æ¸…ç©ºæ­·å²é¡¯ç¤º
        document.getElementById('historyScrollIndicator').style.opacity = '0'; // éš±è—æ»¾å‹•æŒ‡ç¤ºå™¨
        
        document.getElementById('numberInputModal').style.display = 'flex';
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // é—œé–‰æ¨¡æ…‹æ¡†
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿæ•¸å­—è¼¸å…¥
    function calculatorInput(num) {
        if (calculatorWaitingForSecondValue) {
            calculatorValue = num.toString();
            calculatorWaitingForSecondValue = false;
        } else {
            calculatorValue = calculatorValue === '0' ? num.toString() : calculatorValue + num.toString();
        }
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿå°æ•¸é»è¼¸å…¥
    function calculatorDecimal() {
        // å¦‚æœæ­£åœ¨ç­‰å¾…ç¬¬äºŒå€‹å€¼ï¼Œé‡ç½®é¡¯ç¤º
        if (calculatorWaitingForSecondValue) {
            calculatorValue = '0';
            calculatorWaitingForSecondValue = false;
        }
        
        // å¦‚æœç•¶å‰å€¼ä¸åŒ…å«å°æ•¸é»ï¼Œå‰‡æ·»åŠ 
        if (!calculatorValue.includes('.')) {
            calculatorValue += '.';
        }
        
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿæ¸…é™¤
    function calculatorClear() {
        calculatorValue = '0';
        calculatorOperator = null;
        calculatorFirstValue = null;
        calculatorWaitingForSecondValue = false;
        calculatorHistory = ""; // æ¸…ç©ºè¨ˆç®—æ­·å²
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        document.getElementById('calculatorHistory').textContent = ""; // æ¸…ç©ºæ­·å²é¡¯ç¤º
        document.getElementById('historyScrollIndicator').style.opacity = '0'; // éš±è—æ»¾å‹•æŒ‡ç¤ºå™¨
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿé€€æ ¼
    function calculatorBackspace() {
        if (calculatorValue.length > 1) {
            calculatorValue = calculatorValue.slice(0, -1);
        } else {
            calculatorValue = '0';
        }
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿé‹ç®—ç¬¦
    function calculatorOperation(op) {
        // å¦‚æœå·²ç¶“æœ‰é‹ç®—ç¬¦åœ¨ç­‰å¾…ï¼Œå…ˆé€²è¡Œè¨ˆç®—
        if (calculatorFirstValue !== null && calculatorOperator !== null) {
            calculatorEquals();
        }
        
        calculatorFirstValue = parseFloat(calculatorValue);
        calculatorOperator = op;
        calculatorWaitingForSecondValue = true;
        
        // æ›´æ–°è¨ˆç®—æ­·å²
        let opSymbol = op;
        switch(op) {
            case '+': opSymbol = ' + '; break;
            case '-': opSymbol = ' - '; break;
            case '*': opSymbol = ' Ã— '; break;
            case '/': opSymbol = ' Ã· '; break;
        }
        
        // æ·»åŠ ç•¶å‰æ•¸å­—å’Œé‹ç®—ç¬¦åˆ°æ­·å²è¨˜éŒ„
        if (calculatorHistory === "") {
            calculatorHistory = calculatorValue + opSymbol;
        } else {
            // æª¢æŸ¥æ˜¯å¦éœ€è¦æ›è¡Œ
            if (calculatorHistory.length > 20) {
                calculatorHistory += "\n" + calculatorValue + opSymbol;
            } else {
                calculatorHistory += calculatorValue + opSymbol;
            }
        }
        
        // é¡¯ç¤ºè¨ˆç®—æ­·å²ä¸¦æª¢æŸ¥æ˜¯å¦éœ€è¦é¡¯ç¤ºæ»¾å‹•æŒ‡ç¤ºå™¨
        updateCalculatorHistory();
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿç­‰è™Ÿ
    function calculatorEquals() {
        if (calculatorFirstValue === null || calculatorOperator === null) return;
        
        const secondValue = parseFloat(calculatorValue);
        let result;
        
        // å®Œæˆæ­·å²è¨˜éŒ„çš„é‹ç®—å¼
        let completeExpression = calculatorHistory + calculatorValue + " = ";
        
        switch (calculatorOperator) {
            case '+':
                result = calculatorFirstValue + secondValue;
                break;
            case '-':
                result = calculatorFirstValue - secondValue;
                break;
            case '*':
                result = calculatorFirstValue * secondValue;
                break;
            case '/':
                // å¢åŠ é™¤é›¶æª¢æŸ¥
                if (secondValue === 0) {
                    showToast('éŒ¯èª¤ï¼šä¸èƒ½é™¤ä»¥é›¶', true);
                    calculatorClear();
                    return;
                }
                result = calculatorFirstValue / secondValue;
                break;
            default:
                return;
        }
        
        // é™åˆ¶å°æ•¸é»ä½æ•¸ï¼Œä½†ä¿ç•™æœ‰æ„ç¾©çš„æ•¸å­—
        calculatorValue = result.toString();
        if (calculatorValue.includes('.')) {
            // å¦‚æœæ˜¯å°æ•¸ï¼Œé™åˆ¶æœ€å¤šé¡¯ç¤º8ä½ï¼Œä½†å»é™¤å°¾éƒ¨ç„¡æ„ç¾©çš„é›¶
            calculatorValue = parseFloat(result.toFixed(8)).toString();
        }
        
        // æ›´æ–°é¡¯ç¤º
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // æ›´æ–°æ­·å²è¨˜éŒ„ï¼Œä¿æŒè¼ƒçŸ­çš„é¡¯ç¤º
        if (completeExpression.length > 30) {
            // å¦‚æœè¡¨é”å¼å¤ªé•·ï¼Œåªé¡¯ç¤ºæœ€å¾Œçš„ç­‰è™Ÿéƒ¨åˆ†
            calculatorHistory = calculatorValue;
        } else {
            // å¦‚æœè¡¨é”å¼ä¸å¤ªé•·ï¼Œé¡¯ç¤ºå®Œæ•´è¡¨é”å¼
            calculatorHistory = completeExpression;
        }
        
        // é¡¯ç¤ºè¨ˆç®—æ­·å²ä¸¦æª¢æŸ¥æ˜¯å¦éœ€è¦é¡¯ç¤ºæ»¾å‹•æŒ‡ç¤ºå™¨
        updateCalculatorHistory();
        
        // ç‚ºä¸‹ä¸€æ¬¡è¨ˆç®—æº–å‚™
        calculatorOperator = null;
        calculatorFirstValue = parseFloat(calculatorValue);
        calculatorWaitingForSecondValue = true;
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // ä¿®æ”¹ submitCalculatorValue å‡½æ•°
    function submitCalculatorValue() {
        if (!currentInputField) return;
        
        let value = parseFloat(calculatorValue);
        if (isNaN(value)) value = 0;
        
        // æ ¹æ®ä¸åŒè¾“å…¥æ¡†è¿›è¡ŒéªŒè¯
        switch (currentInputField) {
            case 'period':
                // æœŸæ•°ä¸éœ€è¦åƒä½åˆ†éš”ç¬¦
                value = Math.floor(value);
                if (value < 0) {
                    showToast('éŒ¯èª¤ï¼šæœŸæ•¸ä¸èƒ½ç‚ºè² æ•¸', true);
                    return;
                }
                if (value > 999) {
                    showToast('éŒ¯èª¤ï¼šæœŸæ•¸ä¸èƒ½è¶…é3ä½æ•¸', true);
                    return;
                }
                document.getElementById(currentInputField).value = value;
                break;
                
                case 'rate':
                    // åˆ©ç‡ä¸éœ€è¦åƒä½åˆ†éš”ç¬¦
                    if (value < 0) {
                        showToast('éŒ¯èª¤ï¼šåˆ©ç‡ä¸èƒ½ç‚ºè² æ•¸', true);
                        return;
                    }
                    if (value > 20) {
                        showToast('è­¦å‘Šï¼šåˆ©ç‡è¶…é20%ï¼Œå¯èƒ½ä¸ç¬¦åˆä¸€èˆ¬è²¸æ¬¾æ¢ä»¶', true);
                        // å…è¨±è¶…é20%çš„åˆ©ç‡ï¼Œä½†é¡¯ç¤ºè­¦å‘Š
                    }
                    document.getElementById(currentInputField).value = value.toFixed(4);
                    break;
                
            case 'principal':
                // æœ¬é‡‘éœ€è¦åƒä½åˆ†éš”ç¬¦å¹¶ä¸”åªèƒ½æ˜¯æ­£æ•´æ•°
                value = Math.floor(value); // ç¡®ä¿æ˜¯æ•´æ•°
                if (value <= 0) {
                    showToast('éŒ¯èª¤ï¼šæœ¬é‡‘å¿…é ˆæ˜¯æ­£æ•´æ•¸', true);
                    return;
                }
                if (value > 999999999) {
                    showToast('éŒ¯èª¤ï¼šæœ¬é‡‘ä¸èƒ½è¶…é9ä½æ•¸', true);
                    return;
                }
                document.getElementById(currentInputField).value = formatNumberWithCommas(value);
                break;
                
            case 'payment':
                // æœŸç¹³å¿…é¡»æ˜¯æ­£æ•´æ•°
                value = Math.max(1, Math.round(value)); // æ”¹ç‚ºå–æ•´æ•¸
                if (value > 999999) {
                    showToast('éŒ¯èª¤ï¼šæœŸç¹³æ¬¾é‡‘é¡ä¸èƒ½è¶…é6ä½æ•¸', true);
                    return;
                }
                document.getElementById(currentInputField).value = formatNumberWithCommas(value);
                break;
                
            case 'commission':
                // æ¨å»£éœ€è¦åƒä½åˆ†éš”ç¬¦
                value = Math.floor(value);
                if (value < 0) {
                    showToast('éŒ¯èª¤ï¼šæ¨å»£è²»å¿…é ˆç‚ºæ­£æ•´æ•¸', true);
                    return;
                }
                if (value > 999999) {
                    showToast('éŒ¯èª¤ï¼šæ¨å»£è²»ä¸èƒ½è¶…é6ä½æ•¸', true);
                    return;
                }
                document.getElementById(currentInputField).value = formatNumberWithCommas(value);
                break;
        }
        
        // è§¦å‘ change äº‹ä»¶ä»¥æ›´æ–°ç›¸å…³è®¡ç®—
        const event = new Event('change');
        document.getElementById(currentInputField).dispatchEvent(event);
        
        // å…³é—­æ¨¡æ€æ¡†
        closeModal('numberInputModal');
        
        // æ ¹æ®å­—æ®µæ‰§è¡Œç›¸åº”çš„è®¡ç®—å‡½æ•°
        if (currentInputField === 'period' || currentInputField === 'rate' || currentInputField === 'principal') {
            calculatePayment();
        } else if (currentInputField === 'payment') {
            calculateRate();
        } else if (currentInputField === 'commission') {
            calculateAfterCommissionRate();
        }
        
        // æ·»åŠ éœ‡åŠ¨æ•ˆæœ
        vibrate();
    }

    // æ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼ˆå¯é‡ç”¨ç°æœ‰çš„ showToast å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰çš„è¯æ·»åŠ è¿™ä¸ªï¼‰
    function showToast(message, isError = false) {
        // æ£€æŸ¥æ˜¯å¦å·²æœ‰ toast
        const existingToast = document.querySelector('.toast-message');
        if (existingToast) {
            document.body.removeChild(existingToast);
        }
        
        // åˆ›å»ºæ–°çš„ toast
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        if (isError) {
            toast.classList.add('toast-error');
        }
        toast.textContent = message;
        document.body.appendChild(toast);
        
        // 2ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 500);
        }, 2000);
    }

    // æ ¼å¼åŒ–æ•°å­— - æ·»åŠ åƒä½åˆ†éš”ç¬¦
    function formatNumberWithCommas(num) {
        if (!num && num !== 0) return '';
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // æ›´æ–°è®¡ç®—å†å²æ˜¾ç¤ºï¼Œå¹¶æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºæ»šåŠ¨æŒ‡ç¤ºå™¨
    function updateCalculatorHistory() {
        const historyElement = document.getElementById('calculatorHistory');
        const indicatorElement = document.getElementById('historyScrollIndicator');
        
        // æ›´æ–°å†å²å†…å®¹
        historyElement.textContent = calculatorHistory;
        
        // æ£€æŸ¥æ˜¯å¦å†…å®¹æº¢å‡ºéœ€è¦æ˜¾ç¤ºæ»šåŠ¨æŒ‡ç¤ºå™¨
        const isOverflowing = historyElement.scrollWidth > historyElement.clientWidth || 
                            historyElement.scrollHeight > historyElement.clientHeight;
        
        if (isOverflowing) {
            historyElement.classList.add('has-overflow');
        } else {
            historyElement.classList.remove('has-overflow');
        }
    }

    function countFilledFields() {
        const period = document.getElementById('period').value;
        const rate = document.getElementById('rate').value;
        const principal = document.getElementById('principal').value;
        const payment = document.getElementById('payment').value;
        
        let count = 0;
        if (period && period !== '0') count++;
        if (rate && rate !== '0') count++;
        if (principal && principal !== '0') count++;
        if (payment && payment !== '0') count++;
        
        return count;
    }

    // æœŸæ•°æ–¹æ¡ˆå¯¹æ¯”
    function showPaymentComparison() {
        // ä¸éœ€è¦é—œé–‰é€²éšé¸å–®äº†ï¼Œå› ç‚ºå·²ç¶“ç§»é™¤
        
        // è·å–å½“å‰çš„åˆ©ç‡å’Œæœ¬é‡‘
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        
        // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®
        if (isNaN(rate) || isNaN(principal) || rate <= 0 || principal <= 0) {
            showToast('è«‹å…ˆè¼¸å…¥æœ‰æ•ˆçš„åˆ©ç‡å’Œæœ¬é‡‘', true);
            return;
        }
        
        // ç”Ÿæˆä¸åŒæœŸæ•°çš„è¿˜æ¬¾æ–¹æ¡ˆ
        const periods = [12, 18, 24, 30, 36, 48, 60, 72, 84, 96, 120]; // å¸¸è§æœŸæ•°é€‰é¡¹
        const plans = [];
        
        // ç§»é™¤ interestRatio ç›¸å…³è®¡ç®—
        for (const period of periods) {
            const payment = PMT(rate, period, principal);
            const totalPayment = payment * period;
            const totalInterest = totalPayment - principal;
            
            plans.push({
                period: period,
                payment: payment,
                totalPayment: totalPayment,
                totalInterest: totalInterest
            });
        }
        
        // åˆ›å»ºè¡¨æ ¼HTML
        let tableHTML = `
        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
            <tr style="background-color: var(--secondary-color);">
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border-color);">æœŸæ•¸</th>
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border-color);">æœŸç¹³</th>
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border-color);">ç¸½é‚„æ¬¾</th>
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border-color);">ç¸½åˆ©æ¯</th>
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border-color);">æ“ä½œ</th>
            </tr>
        `;
        
        // ç§»é™¤ã€Œåˆ©æ¯æ¯”ä¾‹ã€åˆ—çš„æ•°æ®
        plans.forEach((plan, index) => {
            tableHTML += `
            <tr style="background-color: ${index % 2 === 0 ? 'var(--secondary-color)' : 'var(--primary-color)'};">
                <td style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border-color);">${plan.period}</td>
                <td style="padding: 10px; text-align: right; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(Math.round(plan.payment))}</td>
                <td style="padding: 10px; text-align: right; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(Math.round(plan.totalPayment))}</td>
                <td style="padding: 10px; text-align: right; border-bottom: 1px solid var(--border-color);">${formatNumberWithCommas(Math.round(plan.totalInterest))}</td>
                <td style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border-color);">
                    <button onclick="selectPlan(${plan.period}, ${rate}, ${principal}, ${plan.payment})" 
                            style="padding: 5px 8px; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer;">
                        é¸æ“‡
                    </button>
                </td>
            </tr>
            `;
        });
        
        tableHTML += `</table>`;
        
        // åˆ›å»ºæ¨¡æ€æ¡†
        const modalHTML = `
        <div class="modal-header">
            <h3>ä¸åŒæœŸæ•¸æ–¹æ¡ˆå°æ¯”</h3>
            <button class="close-btn" onclick="closeCustomModal('paymentComparisonModal')">Ã—</button>
        </div>
        <div class="modal-content" style="flex: 1; overflow-y: auto;">
            <div style="margin-bottom: 15px;">
                <p>æœ¬é‡‘: ${formatNumberWithCommas(principal)} å…ƒ</p>
                <p>åˆ©ç‡: ${rate}%</p>
                <p>ä»¥ä¸‹æ˜¯ä¸åŒæœŸæ•¸çš„é‚„æ¬¾æ–¹æ¡ˆå°æ¯”ï¼Œæ‚¨å¯ä»¥é»æ“Šã€Œé¸æ“‡ã€å¥—ç”¨åˆ°å°æœ‹å‹å°ˆç”¨è¨ˆç®—æ©Ÿ</p>
            </div>
            ${tableHTML}
        </div>
        `;
        
        // åˆ›å»ºå¹¶æ˜¾ç¤ºæ¨¡æ€æ¡†
        showCustomModal('paymentComparisonModal', modalHTML);
    }

    // é€‰æ‹©ç‰¹å®šæ–¹æ¡ˆ
    function selectPlan(period, rate, principal, payment) {
        // æ›´æ–°è®¡ç®—å™¨ä¸­çš„å€¼
        document.getElementById('period').value = period;
        document.getElementById('rate').value = rate;
        document.getElementById('principal').value = formatNumberWithCommas(principal);
        document.getElementById('payment').value = formatNumberWithCommas(Math.round(payment));
        
        // æ›´æ–°æ‰€æœ‰ç›¸å…³è®¡ç®—
        updateAllFields();
        
        // å…³é—­æ¨¡æ€æ¡†
        closeCustomModal('paymentComparisonModal');
        
        // æ˜¾ç¤ºæç¤º
        showToast(`å·²é¸æ“‡ ${period} æœŸæ–¹æ¡ˆ`);
        
        // è§¦å‘éœ‡åŠ¨åé¦ˆ
        vibrate();
    }

    // é€šç”¨çš„æ¨¡æ…‹æ¡†é¡¯ç¤ºå‡½æ•¸
    function showCustomModal(id, html) {
        // å‰µå»ºæ¨¡æ…‹æ¡†
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        modalOverlay.id = id;
        modalOverlay.style.display = 'flex';
        
        // å¦‚æœæ˜¯æœŸæ•¸æ–¹æ¡ˆå°æ¯”ï¼Œä½¿ç”¨å…¨è¢å¹•æ¨£å¼
        if (id === 'paymentComparisonModal') {
            modalOverlay.style.position = 'fixed';
            modalOverlay.style.top = '0';
            modalOverlay.style.left = '0';
            modalOverlay.style.width = '100%';
            modalOverlay.style.height = '100%';
            modalOverlay.style.backgroundColor = 'var(--primary-color)';
            modalOverlay.style.zIndex = '9999';
            modalOverlay.style.overflow = 'auto';
            modalOverlay.innerHTML = `<div class="modal-container" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%; margin: 0; border-radius: 0;">${html}</div>`;
        } else {
            modalOverlay.innerHTML = `<div class="modal-container">${html}</div>`;
        }
        
        // æ·»åŠ åˆ°ç½‘é¡µ
        document.body.appendChild(modalOverlay);
        
        // ç‚¹å‡»èƒŒæ™¯å…³é—­
        modalOverlay.addEventListener('click', function(event) {
            if (event.target === this) {
                closeCustomModal(id);
            }
        });
        
        vibrate();
    }

    // é€šç”¨çš„æ¨¡æ…‹æ¡†é—œé–‰å‡½æ•¸
    function closeCustomModal(id) {
        const modal = document.getElementById(id);
        if (modal) {
            document.body.removeChild(modal);
        }
        vibrate();
    }

    // å…³é—­å­é€‰å•
    function closeSubmenu(submenuId) {
        const submenu = document.getElementById(submenuId);
        if (submenu) {
            const submenuContent = submenu.querySelector('.submenu-content');
            
            // æ·»åŠ å…³é—­åŠ¨ç”»
            submenuContent.classList.add('submenu-closing');
            
            // åŠ¨ç”»ç»“æŸåéšè—å­é€‰å•
            setTimeout(function() {
                submenu.style.display = 'none';
                submenuContent.classList.remove('submenu-closing');
            }, 200); // ä¸åŠ¨ç”»æ—¶é•¿ç›¸åŒ¹é…
            
            vibrate(); // ä½¿ç”¨ç°æœ‰çš„éœ‡åŠ¨å‡½æ•°
        }
    }

    // é€šç”¨çš„æ¨¡æ…‹æ¡†é¡¯ç¤ºå‡½æ•¸
    function showCustomModal(id, html) {
        // å‰µå»ºæ¨¡æ…‹æ¡†
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        modalOverlay.id = id;
        modalOverlay.style.display = 'flex';
        modalOverlay.innerHTML = `<div class="modal-container">${html}</div>`;
        
        // æ·»åŠ åˆ°ç¶²é 
        document.body.appendChild(modalOverlay);
        
        // é»æ“ŠèƒŒæ™¯é—œé–‰
        modalOverlay.addEventListener('click', function(event) {
            if (event.target === this) {
                closeCustomModal(id);
            }
        });
        
        vibrate();
    }

    // é€šç”¨çš„æ¨¡æ…‹æ¡†é—œé–‰å‡½æ•¸
    function closeCustomModal(id) {
        const modal = document.getElementById(id);
        if (modal) {
            document.body.removeChild(modal);
        }
        vibrate();
    }

    // é˜¿æ‹‰ä¼¯æ•¸å­—è½‰ä¸­æ–‡åœ‹å­—å¤§å¯«å‡½æ•¸
    function arabicToChineseNumber(num, format) {
        if (!num || num === '0' || num === 0) {
            return format === 'financial' ? '<span class="financial-digit">é›¶</span>' : 'é›¶';
        }
        
        // åˆ†å‰²æ•´æ•¸å’Œå°æ•¸éƒ¨åˆ†
        const parts = num.toString().split('.');
        const integerPart = parts[0];
        const decimalPart = parts.length > 1 ? parts[1] : '';
        
        // æ ¹æ“šæ ¼å¼é¸æ“‡å°æ‡‰çš„å­—ç¬¦
        let digits, units;
        if (format === 'traditional') {
            digits = ['é›¶', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹'];
            units = ['', 'å', 'ç™¾', 'åƒ', 'è¬', 'å', 'ç™¾', 'åƒ', 'å„„', 'å', 'ç™¾', 'åƒ', 'å…†'];
        } else if (format === 'financial') {
            digits = ['é›¶', 'å£¹', 'è²³', 'åƒ', 'è‚†', 'ä¼', 'é™¸', 'æŸ’', 'æŒ', 'ç–'];
            units = ['', 'æ‹¾', 'ä½°', 'ä»Ÿ', 'è¬', 'æ‹¾', 'ä½°', 'ä»Ÿ', 'å„„', 'æ‹¾', 'ä½°', 'ä»Ÿ', 'å…†'];
        }
        
        // è™•ç†æ•´æ•¸éƒ¨åˆ†
        let intResult = '';
        if (integerPart === '0') {
            intResult = format === 'financial' ? '<span class="financial-digit">é›¶</span>' : digits[0];
        } else {
            const len = integerPart.length;
            
            // ç‰¹æ®Šè™•ç†10-19çš„æ•¸å­—
            if (format !== 'financial' && len === 2 && integerPart.charAt(0) === '1') {
                intResult = units[1];
                if (integerPart.charAt(1) !== '0') {
                    intResult += digits[parseInt(integerPart.charAt(1))];
                }
            } else {
                // æ–°å¢è®Šé‡ä¾†è¿½è¹¤ä¸Šä¸€å€‹è™•ç†éçš„å­—ç¬¦æ˜¯å¦ç‚ºé›¶ï¼Œä»¥åŠæ˜¯å¦å·²ç¶“æ·»åŠ äº†å–®ä½
                let lastWasZero = false;
                let hasAddedUnit = false;
                
                for (let i = 0; i < len; i++) {
                    const digit = parseInt(integerPart.charAt(i));
                    const pos = len - i - 1;
                    
                    if (digit !== 0) {
                        // éé›¶æ•¸å­—ç›´æ¥è½‰æ›ä¸¦åŠ ä¸Šå–®ä½
                        lastWasZero = false;
                        hasAddedUnit = false;
                        
                        // åœ¨ financial æ ¼å¼ä¸­ç‚ºæ•¸å­—æ·»åŠ ç‰¹æ®Šæ¨™ç±¤
                        if (format === 'financial') {
                            intResult += `<span class="financial-digit">${digits[digit]}</span>${units[pos]}`;
                        } else {
                            intResult += digits[digit] + units[pos];
                        }
                    } else {
                        // è™•ç†é›¶çš„ç‰¹æ®Šè¦å‰‡
                        if (pos === 4 || pos === 8) {
                            // è¬ä½æˆ–å„„ä½çš„é›¶ï¼Œéœ€è¦åŠ ä¸Šå°æ‡‰çš„å–®ä½ï¼Œä½†ä¸éœ€è¦åŠ ä¸Š"é›¶"å­—
                            if (intResult.length > 0) {
                                // ç¢ºä¿æ²’æœ‰é€£çºŒåŠ å…¥åŒä¸€å–®ä½
                                if (!intResult.endsWith(units[4]) && !intResult.endsWith(units[8])) {
                                    intResult += units[pos];
                                    hasAddedUnit = true;
                                }
                            }
                        } else if (i < len - 1 && integerPart.charAt(i + 1) !== '0' && !lastWasZero) {
                            // ç•¶å‰æ•¸å­—æ˜¯0ï¼Œä¸‹ä¸€å€‹ä¸æ˜¯0ï¼Œä¸”ä¸Šä¸€å€‹ä¸æ˜¯0ï¼ŒåŠ ä¸Šé›¶
                            if (format === 'financial') {
                                intResult += `<span class="financial-digit">${digits[0]}</span>`;
                            } else {
                                intResult += digits[0];
                            }
                            lastWasZero = true;
                        }
                    }
                }
            }
        }
        
        // è™•ç†å°æ•¸éƒ¨åˆ†
        let decResult = '';
        if (decimalPart) {
            decResult = 'é»';
            for (let i = 0; i < decimalPart.length; i++) {
                if (format === 'financial') {
                    decResult += `<span class="financial-digit">${digits[parseInt(decimalPart.charAt(i))]}</span>`;
                } else {
                    decResult += digits[parseInt(decimalPart.charAt(i))];
                }
            }
        }
        
        // çµ„åˆçµæœ
        return intResult + decResult;
    }

    // é¡¯ç¤ºåŠ æ²¹å¡è¨ˆç®—å™¨
    function showGasCardCalculator() {
        // ä¸éœ€è¦é—œé–‰é€²éšé¸å–®äº†ï¼Œå› ç‚ºå·²ç¶“ç§»é™¤
        
        // ç”ŸæˆåŠ æ²¹å¡è¨ˆç®—å™¨çš„ HTML
        const gasCardHTML = generateGasCardHTML();
        
        // æ’å…¥å…§å®¹
        document.getElementById('gasCardContent').innerHTML = gasCardHTML;
        
        // é¡¯ç¤ºæ¨¡æ…‹æ¡†
        document.getElementById('gasCardModal').style.display = 'flex';
        
        // åˆå§‹åŒ–åŠ æ²¹å¡è¨ˆç®—å™¨
        initializeGasCardCalculator();
        
        // éœ‡å‹•åé¥‹
        vibrate();
    }

    // é—œé–‰åŠ æ²¹å¡è¨ˆç®—å™¨
    function closeGasCardCalculator() {
        document.getElementById('gasCardModal').style.display = 'none';
        vibrate();
    }

    // ç”ŸæˆåŠ æ²¹å¡è¨ˆç®—å™¨ HTMLï¼ˆä½¿ç”¨ä¸»é¡Œè®Šé‡ï¼‰
    function generateGasCardHTML() {
        return `
            <div style="width: 100%; max-width: 380px; margin: 0 auto;">
                <!-- è¶…ç´šæŸ´æ²¹åƒ¹æ ¼è¼¸å…¥æ¬„ä½ -->
                <div class="row">
                    <span class="label">è¶…ç´šæŸ´æ²¹</span>
                    <input type="text" 
                        id="dieselPrice" 
                        placeholder="0.0"
                        value="26.0"
                        readonly
                        style="width: 95px; text-align: right;">
                    <span style="margin-left: 10px; color: var(--text-color);">å…ƒ/å…¬å‡</span>
                </div>
                
                <!-- æ¯æœˆæ²¹éŒ¢è¼¸å…¥æ¬„ä½ -->
                <div class="row">
                    <span class="label">æ¯æœˆæ²¹éŒ¢</span>
                    <input type="text" 
                        id="monthlyExpense" 
                        placeholder="0"
                        readonly
                        style="width: 95px; text-align: right;">
                    <span style="margin-left: 10px; color: var(--text-color);">å…ƒ</span>
                </div>
                
                <!-- æ¯æœˆæ²¹é‡è¼¸å…¥æ¬„ä½ -->
                <div class="row">
                    <span class="label">æ¯æœˆæ²¹é‡</span>
                    <input type="text" 
                        id="monthlyVolume" 
                        placeholder="0"
                        readonly
                        style="width: 95px; text-align: right;">
                    <span style="margin-left: 10px; color: var(--text-color);">å…¬å‡</span>
                </div>
                
                <!-- æŠ˜æ‰£é‡‘é¡è¼¸å…¥æ¬„ä½ -->
                <div class="row">
                    <span class="label">æŠ˜æ‰£é‡‘é¡</span>
                    <input type="text" 
                        id="discountAmount" 
                        placeholder="0.0"
                        readonly
                        style="width: 95px; text-align: right;">
                    <span style="margin-left: 10px; color: var(--text-color);">å…ƒ/å…¬å‡</span>
                </div>
                
                <!-- æŠ˜å¾Œæ²¹éŒ¢é¡¯ç¤ºæ¬„ä½ -->
                <div class="row emphasized-row">
                    <span class="label">æŠ˜å¾Œæ²¹éŒ¢</span>
                    <input type="text" 
                        id="discountedExpense" 
                        class="readonly"
                        placeholder="0"
                        readonly
                        style="width: 95px; text-align: right;">
                    <span style="margin-left: 10px; color: var(--text-color);">å…ƒ</span>
                </div>
                
                <!-- æ¯æœˆç¯€çœé¡¯ç¤ºæ¬„ä½ -->
                <div class="row emphasized-row">
                    <span class="label">æ¯æœˆç¯€çœ</span>
                    <input type="text" 
                        id="monthlySaving" 
                        class="readonly"
                        placeholder="0"
                        readonly
                        style="width: 95px; text-align: right;">
                    <span style="margin-left: 10px; color: var(--text-color);">å…ƒ</span>
                </div>
                
                <!-- æ¯å¹´ç¯€çœé¡¯ç¤ºæ¬„ä½ -->
                <div class="row emphasized-row">
                    <span class="label">æ¯å¹´ç¯€çœ</span>
                    <input type="text" 
                        id="yearlySaving" 
                        class="readonly"
                        placeholder="0"
                        readonly
                        style="width: 95px; text-align: right;">
                    <span style="margin-left: 10px; color: var(--text-color);">å…ƒ</span>
                </div>
                
                <!-- æ¸…é™¤æŒ‰éˆ• -->
                <div class="function-buttons" style="margin-top: 10px;">
                    <div class="button-row">
                        <button onclick="clearGasCalculation()" class="main-action-btn">æ¸…é™¤</button>
                    </div>
                </div>
            </div>
            
            <!-- åŠ æ²¹å¡è¨ˆç®—æ©Ÿå½ˆå‡ºè¦–çª— -->
            <div id="gasCalculatorModal" class="modal-overlay">
                <div class="number-input-modal">
                    <div class="modal-header">
                        <h3 id="gasInputModalTitle">æ•¸å­—è¼¸å…¥å™¨</h3>
                        <button class="close-btn" onclick="closeGasCalculator()">Ã—</button>
                    </div>

                    <div class="calculator-display-container">
                        <div class="calculator-display" id="gasCalcDisplay">0</div>
                    </div>

                    <div class="calculator-buttons">
                        <!-- ç¬¬ä¸€è¡Œï¼šåŠŸèƒ½éµ -->
                        <button onclick="gasCalcClear()" class="clear">C</button>
                        <button onclick="gasCalcBackspace()" class="function">âŒ«</button>
                        <button onclick="gasCalcOperation('/')" class="operator">Ã·</button>
                        <button onclick="gasCalcOperation('*')" class="operator">Ã—</button>
                        
                        <!-- ç¬¬äºŒè¡Œï¼šæ•¸å­—å’Œæ¸›è™Ÿ -->
                        <button onclick="gasCalcInput(7)" class="number-btn">
                            <div class="arabic-number">7</div>
                            <div class="financial-char">æŸ’</div>
                        </button>
                        <button onclick="gasCalcInput(8)" class="number-btn">
                            <div class="arabic-number">8</div>
                            <div class="financial-char">æŒ</div>
                        </button>
                        <button onclick="gasCalcInput(9)" class="number-btn">
                            <div class="arabic-number">9</div>
                            <div class="financial-char">ç–</div>
                        </button>
                        <button onclick="gasCalcOperation('-')" class="operator">âˆ’</button>
                        
                        <!-- ç¬¬ä¸‰è¡Œï¼šæ•¸å­—å’ŒåŠ è™Ÿ -->
                        <button onclick="gasCalcInput(4)" class="number-btn">
                            <div class="arabic-number">4</div>
                            <div class="financial-char">è‚†</div>
                        </button>
                        <button onclick="gasCalcInput(5)" class="number-btn">
                            <div class="arabic-number">5</div>
                            <div class="financial-char">ä¼</div>
                        </button>
                        <button onclick="gasCalcInput(6)" class="number-btn">
                            <div class="arabic-number">6</div>
                            <div class="financial-char">é™¸</div>
                        </button>
                        <button onclick="gasCalcOperation('+')" class="operator">+</button>
                        
                        <!-- ç¬¬å››è¡Œï¼šåº•éƒ¨æ•¸å­—å’Œç­‰è™Ÿ -->
                        <button onclick="gasCalcInput(1)" class="number-btn">
                            <div class="arabic-number">1</div>
                            <div class="financial-char">å£¹</div>
                        </button>
                        <button onclick="gasCalcInput(2)" class="number-btn">
                            <div class="arabic-number">2</div>
                            <div class="financial-char">è²³</div>
                        </button>
                        <button onclick="gasCalcInput(3)" class="number-btn">
                            <div class="arabic-number">3</div>
                            <div class="financial-char">åƒ</div>
                        </button>
                        <button onclick="gasCalcEquals()" class="equals">=</button>
                        
                        <!-- ç¬¬äº”è¡Œï¼šé›¶ã€å°æ•¸é»å’Œç¢ºèªéµ -->
                        <button onclick="gasCalcInput(0)" class="number-btn">
                            <div class="arabic-number">0</div>
                            <div class="financial-char">é›¶</div>
                        </button>
                        <button onclick="gasCalcDecimal()" class="function">.</button>
                        <button onclick="confirmGasCalculation()" class="submit">ç¢ºèªè¼¸å…¥</button>
                    </div>
                </div>
            </div>
        `;
    }

    // åˆå§‹åŒ–åŠ æ²¹å¡è¨ˆç®—å™¨
    function initializeGasCardCalculator() {
        // è¨­å®šè¶…ç´šæŸ´æ²¹çš„é è¨­å€¼
        const dieselPriceField = document.getElementById('dieselPrice');
        if (dieselPriceField && !dieselPriceField.value) {
            dieselPriceField.value = '26.0';
        }
        // ç‚ºå¯ç·¨è¼¯çš„è¼¸å…¥æ¡†æ·»åŠ é»æ“Šäº‹ä»¶
        const editableFields = ['dieselPrice', 'monthlyExpense', 'monthlyVolume', 'discountAmount'];
        editableFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('click', function() {
                    openGasCalculator(fieldId);
                });
            }
        });
        
        // é»æ“Šè¨ˆç®—æ©Ÿå¤–éƒ¨å€åŸŸé—œé–‰è¨ˆç®—æ©Ÿ
        const gasCalcModal = document.getElementById('gasCalculatorModal');
        if (gasCalcModal) {
            gasCalcModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeGasCalculator();
                }
            });
        }
    }

    // åŠ æ²¹å¡è¨ˆç®—å™¨çš„å…¨å±€è®Šé‡
    let gasCurrentInput = '';
    let gasCalcExpression = '';
    let gasLastResult = '0';
    let gasLastModifiedField = '';
    let gasFirstValue = null;
    let gasOperator = null;
    let gasWaitingForSecondValue = false;

    // é–‹å•ŸåŠ æ²¹å¡è¨ˆç®—æ©Ÿ
    function openGasCalculator(inputId) {
        vibrate();
        gasCurrentInput = inputId;
        
        // è¨­å®šæ¨™é¡Œ
        const titles = {
            'dieselPrice': 'è«‹è¼¸å…¥ã€è¶…ç´šæŸ´æ²¹åƒ¹æ ¼ã€‘',
            'monthlyExpense': 'è«‹è¼¸å…¥ã€æ¯æœˆæ²¹éŒ¢ã€‘',
            'monthlyVolume': 'è«‹è¼¸å…¥ã€æ¯æœˆæ²¹é‡ã€‘',
            'discountAmount': 'è«‹è¼¸å…¥ã€æŠ˜æ‰£é‡‘é¡ã€‘'
        };
        document.getElementById('gasInputModalTitle').textContent = titles[inputId] || 'æ•¸å­—è¼¸å…¥å™¨';
        
        const modal = document.getElementById('gasCalculatorModal');
        const display = document.getElementById('gasCalcDisplay');
        
        const fieldValue = document.getElementById(inputId).value;
        let currentValue = fieldValue.replace(/,/g, '');
        
        if (!currentValue || currentValue === '0') {
            gasCalcExpression = '0';
        } else {
            if (inputId === 'dieselPrice' || inputId === 'discountAmount') {
                gasCalcExpression = parseFloat(currentValue).toString();
            } else {
                gasCalcExpression = parseInt(currentValue).toString();
            }
        }
        
        display.textContent = gasCalcExpression;
        gasOperator = null;
        gasFirstValue = null;
        gasWaitingForSecondValue = false;
        
        modal.style.display = 'flex';
    }

    // é—œé–‰åŠ æ²¹å¡è¨ˆç®—æ©Ÿ
    function closeGasCalculator() {
        vibrate();
        const modal = document.getElementById('gasCalculatorModal');
        modal.style.display = 'none';
        gasCalcExpression = '';
        gasCurrentInput = '';
    }

    // åŠ æ²¹å¡è¨ˆç®—æ©Ÿé‹ç®—ç¬¦
    function gasCalcOperation(op) {
        vibrate();
        
        // å¦‚æœå·²ç¶“æœ‰é‹ç®—ç¬¦åœ¨ç­‰å¾…ï¼Œå…ˆé€²è¡Œè¨ˆç®—
        if (gasFirstValue !== null && gasOperator !== null) {
            gasCalcEquals();
        }
        
        gasFirstValue = parseFloat(gasCalcExpression);
        gasOperator = op;
        gasWaitingForSecondValue = true;
        
        document.getElementById('gasCalcDisplay').textContent = gasCalcExpression;
    }

    // åŠ æ²¹å¡è¨ˆç®—æ©Ÿè¼¸å…¥
    function gasCalcInput(value) {
        vibrate();
        
        if (gasWaitingForSecondValue) {
            gasCalcExpression = value.toString();
            gasWaitingForSecondValue = false;
        } else {
            gasCalcExpression = gasCalcExpression === '0' ? value.toString() : gasCalcExpression + value.toString();
        }
        
        document.getElementById('gasCalcDisplay').textContent = gasCalcExpression;
    }

    // åŠ æ²¹å¡è¨ˆç®—æ©Ÿå°æ•¸é»è¼¸å…¥
    function gasCalcDecimal() {
        vibrate();
        
        if (gasWaitingForSecondValue) {
            gasCalcExpression = '0';
            gasWaitingForSecondValue = false;
        }
        
        if (!gasCalcExpression.includes('.')) {
            gasCalcExpression += '.';
        }
        
        document.getElementById('gasCalcDisplay').textContent = gasCalcExpression;
    }

    // åŠ æ²¹å¡è¨ˆç®—æ©Ÿæ¸…é™¤
    function gasCalcClear() {
        vibrate();
        gasCalcExpression = '0';
        gasOperator = null;
        gasFirstValue = null;
        gasWaitingForSecondValue = false;
        document.getElementById('gasCalcDisplay').textContent = '0';
    }

    // åŠ æ²¹å¡è¨ˆç®—æ©Ÿé€€æ ¼
    function gasCalcBackspace() {
        vibrate();
        if (gasCalcExpression.length > 1) {
            gasCalcExpression = gasCalcExpression.slice(0, -1);
        } else {
            gasCalcExpression = '0';
        }
        document.getElementById('gasCalcDisplay').textContent = gasCalcExpression;
    }

    // åŠ æ²¹å¡è¨ˆç®—æ©Ÿç­‰è™Ÿ
    function gasCalcEquals() {
        vibrate();
        
        if (gasFirstValue === null || gasOperator === null) return;
        
        const secondValue = parseFloat(gasCalcExpression);
        let result;
        
        switch (gasOperator) {
            case '+':
                result = gasFirstValue + secondValue;
                break;
            case '-':
                result = gasFirstValue - secondValue;
                break;
            case '*':
                result = gasFirstValue * secondValue;
                break;
            case '/':
                if (secondValue === 0) {
                    showToast('éŒ¯èª¤ï¼šä¸èƒ½é™¤ä»¥é›¶', true);
                    gasCalcClear();
                    return;
                }
                result = gasFirstValue / secondValue;
                break;
            default:
                return;
        }
        
        gasCalcExpression = result.toString();
        document.getElementById('gasCalcDisplay').textContent = gasCalcExpression;
        
        gasOperator = null;
        gasFirstValue = parseFloat(gasCalcExpression);
        gasWaitingForSecondValue = true;
    }

    // ç¢ºèªåŠ æ²¹å¡è¨ˆç®—çµæœ
    function confirmGasCalculation() {
        vibrate();
        try {
            if (!gasCalcExpression || gasCalcExpression === '') {
                gasCalcExpression = '0';
            }
            
            let result;
            try {
                result = new Function('return ' + gasCalcExpression)();
            } catch (e) {
                result = parseFloat(gasCalcExpression) || 0;
            }
            
            const field = document.getElementById(gasCurrentInput);
            
            if (gasCurrentInput === 'dieselPrice') {
                result = Math.max(0, result);
                result = Math.round(result * 10) / 10;
                field.value = result.toFixed(1);
            } else if (gasCurrentInput === 'discountAmount') {
                result = Math.max(0, Math.min(5, result));
                result = Math.round(result * 10) / 10;
                field.value = result.toFixed(1);
            } else if (gasCurrentInput === 'monthlyExpense' || gasCurrentInput === 'monthlyVolume') {
                result = Math.max(0, Math.round(result));
                field.value = addGasThousandsSeparator(result);
            }
            
            gasLastModifiedField = gasCurrentInput;
            closeGasCalculator();
            updateGasCalculations();
        } catch (e) {
            showToast('è¨ˆç®—éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥', true);
            console.error('è¨ˆç®—éŒ¯èª¤:', e);
        }
    }

    // æ›´æ–°åŠ æ²¹å¡æ‰€æœ‰è¨ˆç®—
    function updateGasCalculations() {
        const dieselPrice = parseFloat(document.getElementById('dieselPrice').value) || 0;
        let monthlyExpense = parseInt(document.getElementById('monthlyExpense').value.replace(/,/g, '')) || 0;
        let monthlyVolume = parseInt(document.getElementById('monthlyVolume').value.replace(/,/g, '')) || 0;
        const discountAmount = parseFloat(document.getElementById('discountAmount').value) || 0;
        
        if (dieselPrice > 0) {
            if (gasLastModifiedField === 'monthlyVolume' && monthlyVolume > 0) {
                monthlyExpense = Math.round(dieselPrice * monthlyVolume);
                document.getElementById('monthlyExpense').value = addGasThousandsSeparator(monthlyExpense);
            } else if ((gasLastModifiedField === 'monthlyExpense' || gasLastModifiedField === 'dieselPrice') && monthlyExpense > 0) {
                monthlyVolume = Math.round(monthlyExpense / dieselPrice);
                document.getElementById('monthlyVolume').value = addGasThousandsSeparator(monthlyVolume);
            }
        }
        
        if (dieselPrice > 0 && monthlyVolume > 0 && discountAmount > 0) {
            const discountedPrice = Math.max(0, dieselPrice - discountAmount);
            const discountedExpense = Math.round(discountedPrice * monthlyVolume);
            document.getElementById('discountedExpense').value = addGasThousandsSeparator(discountedExpense);
            
            const currentMonthlyExpense = Math.round(dieselPrice * monthlyVolume);
            const monthlySaving = Math.max(0, currentMonthlyExpense - discountedExpense);
            document.getElementById('monthlySaving').value = addGasThousandsSeparator(monthlySaving);
            
            const yearlySaving = monthlySaving * 12;
            document.getElementById('yearlySaving').value = addGasThousandsSeparator(yearlySaving);
        } else {
            document.getElementById('discountedExpense').value = '';
            document.getElementById('monthlySaving').value = '';
            document.getElementById('yearlySaving').value = '';
        }
    }

    // æ¸…é™¤åŠ æ²¹å¡è¨ˆç®—
    function clearGasCalculation() {
        vibrate();
        
        const fieldsToClear = ['monthlyExpense', 'monthlyVolume', 'discountAmount', 'discountedExpense', 'monthlySaving', 'yearlySaving'];
        
        fieldsToClear.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            field.value = '';
        });
        
        gasLastModifiedField = '';
    }

    // æ·»åŠ åƒåˆ†ä½ç¬¦è™Ÿï¼ˆåŠ æ²¹å¡å°ˆç”¨ï¼‰
    function addGasThousandsSeparator(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }


</script>
	
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('loaded');
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    const header = document.querySelector('.sticky-header');
    const h1Element = document.querySelector('h1');
    
    if (!header || !h1Element) return; // æ·»åŠ æ£€æŸ¥

    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const headerRect = header.getBoundingClientRect();
        const h1Rect = h1Element.getBoundingClientRect();
        
        // ä½¿ç”¨æ›´ç²¾ç¡®çš„æ¡ä»¶åˆ¤æ–­
        if (scrollTop > header.offsetTop) {
            header.classList.add('is-sticky');
            if (h1Rect.bottom > 0) {
                header.classList.remove('is-sticky');
            }
        } else {
            header.classList.remove('is-sticky');
        }
    });
    });
</script>

<script>
        if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
            .then(registration => {
                console.log('ServiceWorker registration successful');
            })
            .catch(err => {
                console.log('ServiceWorker registration failed: ', err);
            });
        });
        }

        // åœ¨æ‰€æœ‰ JavaScript å‡½æ•¸å®šç¾©ä¹‹å¾Œæ·»åŠ 
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­ç½®è¼¸å…¥æ¡†é»æ“Šäº‹ä»¶
            document.getElementById('period').addEventListener('click', function() {
                openCalculator('period', 'è«‹è¼¸å…¥ã€æœŸæ•¸ã€‘');
            });
            
            document.getElementById('rate').addEventListener('click', function() {
                openCalculator('rate', 'è«‹è¼¸å…¥ã€ç¨…å‰åˆ©ç‡ã€‘');
            });
            
            document.getElementById('principal').addEventListener('click', function() {
                openCalculator('principal', 'è«‹è¼¸å…¥ã€æœ¬é‡‘ã€‘');
            });
            
            document.getElementById('payment').addEventListener('click', function() {
                openCalculator('payment', 'è«‹è¼¸å…¥ã€æœŸç¹³ã€‘');
            });
            
            document.getElementById('commission').addEventListener('click', function() {
                openCalculator('commission', 'è«‹è¼¸å…¥ã€æ¨å»£ã€‘');
            });
            
            // é»æ“Šæ¨¡æ…‹æ¡†èƒŒæ™¯é—œé–‰æ¨¡æ…‹æ¡†
            document.getElementById('numberInputModal').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeModal('numberInputModal');
                }
            });

            // åœ¨è¿™é‡Œæ·»åŠ å†å²è®°å½•é¢æ¿èƒŒæ™¯ç‚¹å‡»å…³é—­åŠŸèƒ½
            document.getElementById('historyPanel').addEventListener('click', function(event) {
                if (event.target === this) {
                    this.style.display = 'none';
                }
            });
            
            // æ·»åŠ è¨ˆç®—æ­·å²çš„æ»¾å‹•åŠŸèƒ½
            const historyElement = document.getElementById('calculatorHistory');
            let isScrolling = false;
            let startX;
            let scrollLeft;

            historyElement.addEventListener('mousedown', (e) => {
                isScrolling = true;
                startX = e.pageX - historyElement.offsetLeft;
                scrollLeft = historyElement.scrollLeft;
            });

            historyElement.addEventListener('mouseleave', () => {
                isScrolling = false;
            });

            historyElement.addEventListener('mouseup', () => {
                isScrolling = false;
            });

            historyElement.addEventListener('mousemove', (e) => {
                if (!isScrolling) return;
                e.preventDefault();
                const x = e.pageX - historyElement.offsetLeft;
                const walk = (x - startX) * 2; // æ»¾å‹•é€Ÿåº¦
                historyElement.scrollLeft = scrollLeft - walk;
            });

            // æ·»åŠ è§¸æ‘¸äº‹ä»¶æ”¯æŒ
            historyElement.addEventListener('touchstart', (e) => {
                isScrolling = true;
                startX = e.touches[0].pageX - historyElement.offsetLeft;
                scrollLeft = historyElement.scrollLeft;
            });

            historyElement.addEventListener('touchend', () => {
                isScrolling = false;
            });

            historyElement.addEventListener('touchmove', (e) => {
                if (!isScrolling) return;
                const x = e.touches[0].pageX - historyElement.offsetLeft;
                const walk = (x - startX) * 2;
                historyElement.scrollLeft = scrollLeft - walk;
            });

        });
    </script>

    <!-- æ•¸å­—è¼¸å…¥å™¨æ¨¡æ…‹æ¡† -->
    <div id="numberInputModal" class="modal-overlay">
        <div class="number-input-modal">
            <div class="modal-header">
                <h3 id="inputModalTitle">æ•¸å­—è¼¸å…¥å™¨</h3>
                <button class="close-btn" onclick="closeModal('numberInputModal')">Ã—</button>
            </div>

            <div class="calculator-display-container">
                <div class="calculator-scroll-indicator" id="historyScrollIndicator"></div>
                <div class="calculator-history" id="calculatorHistory"></div>
                <div class="calculator-display" id="calculatorDisplay">0</div>
            </div>

            <div class="calculator-buttons">
                <!-- ç¬¬ä¸€è¡Œï¼šåŠŸèƒ½éµ -->
                <button onclick="calculatorClear()" class="clear">C</button>
                <button onclick="calculatorBackspace()" class="function">âŒ«</button>
                <button onclick="calculatorOperation('/')" class="operator">Ã·</button>
                <button onclick="calculatorOperation('*')" class="operator">Ã—</button>
                
                <!-- ç¬¬äºŒè¡Œï¼šæ•¸å­—å’Œæ¸›è™Ÿ -->
                <button onclick="calculatorInput(7)" class="number-btn">
                    <div class="arabic-number">7</div>
                    <div class="financial-char">æŸ’</div>
                </button>
                <button onclick="calculatorInput(8)" class="number-btn">
                    <div class="arabic-number">8</div>
                    <div class="financial-char">æŒ</div>
                </button>
                <button onclick="calculatorInput(9)" class="number-btn">
                    <div class="arabic-number">9</div>
                    <div class="financial-char">ç–</div>
                </button>
                <button onclick="calculatorOperation('-')" class="operator">âˆ’</button>
                
                <!-- ç¬¬ä¸‰è¡Œï¼šæ•¸å­—å’ŒåŠ è™Ÿ -->
                <button onclick="calculatorInput(4)" class="number-btn">
                    <div class="arabic-number">4</div>
                    <div class="financial-char">è‚†</div>
                </button>
                <button onclick="calculatorInput(5)" class="number-btn">
                    <div class="arabic-number">5</div>
                    <div class="financial-char">ä¼</div>
                </button>
                <button onclick="calculatorInput(6)" class="number-btn">
                    <div class="arabic-number">6</div>
                    <div class="financial-char">é™¸</div>
                </button>
                <button onclick="calculatorOperation('+')" class="operator">+</button>
                
                <!-- ç¬¬å››è¡Œï¼šåº•éƒ¨æ•¸å­—å’Œç­‰è™Ÿ -->
                <button onclick="calculatorInput(1)" class="number-btn">
                    <div class="arabic-number">1</div>
                    <div class="financial-char">å£¹</div>
                </button>
                <button onclick="calculatorInput(2)" class="number-btn">
                    <div class="arabic-number">2</div>
                    <div class="financial-char">è²³</div>
                </button>
                <button onclick="calculatorInput(3)" class="number-btn">
                    <div class="arabic-number">3</div>
                    <div class="financial-char">åƒ</div>
                </button>
                <button onclick="calculatorEquals()" class="equals">=</button>
                
                <!-- ç¬¬äº”è¡Œï¼šé›¶ã€å°æ•¸é»å’Œç¢ºèªéµ -->
                <button onclick="calculatorInput(0)" class="number-btn">
                    <div class="arabic-number">0</div>
                    <div class="financial-char">é›¶</div>
                </button>
                <button onclick="calculatorDecimal()" class="function">.</button>
                <button onclick="submitCalculatorValue()" class="submit">ç¢ºèªè¼¸å…¥</button>
            </div>
        </div>
    </div>

    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.getElementById('toggleViewBtn');
            const toggleIcon = document.getElementById('toggleIcon');
            
            // éœ€è¦åˆ‡æ›é¡¯ç¤ºçš„æŒ‰éˆ•çµ„
            const buttonGroups = [
                'periodButtons',
                'rateButtons',
                'principalButtons',
                'PaymentduringButtons',
                'commissionButtons',
                'commissionPercentButtons'
            ];
            
            // åœ¨"è‡ªè¡Œè¨ˆç®—"æ¨¡å¼ä¸­éœ€è¦éš±è—çš„æ¬„ä½ï¼ˆæ ¹æ“šæ‚¨çš„æ–°éœ€æ±‚ï¼‰
            const autoCalcHideFields = [
                'totalPayment',           // ç¸½ç¹³æ¬¾
                'yearlyInterest',         // æ¯å¹´åˆ©æ¯
                'monthlyInterest',        // æ¯æœˆåˆ©æ¯
                'afterTaxRate',           // ç¨…å¾Œåˆ©ç‡
                'annualMillionInterest',  // ç™¾è¬æ¯å¹´åˆ©æ¯
                'monthlyMillionInterest', // ç™¾è¬æ¯æœˆåˆ©æ¯
                'annualTenThousandInterest', // ä¸€è¬æ¯å¹´åˆ©æ¯
                'monthlyTenThousandInterest', // ä¸€è¬æ¯æœˆåˆ©æ¯
                'customerInvoice',        // å®¢æˆ¶ç™¼ç¥¨
                'businessTax',            // ç‡Ÿæ¥­ç¨…
                'untaxedAmount'           // æœªç¨…é‡‘é¡
            ];
            
            // åœ¨"ç²¾ç°¡é¡¯ç¤º"æ¨¡å¼ä¸­éœ€è¦éš±è—çš„æ¬„ä½
            const simpleHideFields = [
                'totalInterest',          // ç¸½åˆ©æ¯
                'yearlyInterest',         // æ¯å¹´åˆ©æ¯
                'monthlyInterest',        // æ¯æœˆåˆ©æ¯
                'tax',                    // ç¨…é‡‘
                'afterTaxRate',           // ç¨…å¾Œåˆ©ç‡
                'annualMillionInterest',  // ç™¾è¬æ¯å¹´åˆ©æ¯
                'monthlyMillionInterest', // ç™¾è¬æ¯æœˆåˆ©æ¯
                'annualTenThousandInterest', // ä¸€è¬æ¯å¹´åˆ©æ¯
                'monthlyTenThousandInterest', // ä¸€è¬æ¯æœˆåˆ©æ¯
                'monthlyCost',            // æœ¬æœˆè³‡é‡‘æˆæœ¬
                'spread',                 // Spread
                'fundingCost',            // NPV
                'customerInvoice',        // å®¢æˆ¶ç™¼ç¥¨
                'businessTax',            // ç‡Ÿæ¥­ç¨…
                'untaxedAmount',          // æœªç¨…é‡‘é¡
                'chineseAmount',          // ä¸­æ–‡å¤§å¯«
                'totalPaymentChinese'     // ç¸½ç¹³å¤§å¯«
            ];
            
            let viewMode = 0; // 0: å®Œæ•´é¡¯ç¤º, 1: è‡ªè¡Œè¨ˆç®—, 2: ç²¾ç°¡é¡¯ç¤º
            
            // æ ¹æ“šæ¬„ä½IDæ‰¾åˆ°å°æ‡‰çš„è¡Œå®¹å™¨
            function getRowByFieldId(fieldId) {
                const field = document.getElementById(fieldId);
                if (!field) return null;
                return field.closest('.row');
            }
            
            // æ‰¾åˆ°"ä¸€è¬æ¯æœˆåˆ©æ¯"æ¬„ä½ä¸‹æ–¹çš„åˆ†éš”ç·š
            function getTenThousandMonthlyDivider() {
                const tenThousandRow = getRowByFieldId('monthlyTenThousandInterest');
                if (!tenThousandRow) return null;
                
                // æ‰¾åˆ°é€™å€‹è¡Œçš„ä¸‹ä¸€å€‹å…„å¼Ÿå…ƒç´ 
                let nextElement = tenThousandRow.nextElementSibling;
                
                // æª¢æŸ¥ä¸‹ä¸€å€‹å…ƒç´ æ˜¯å¦æ˜¯åˆ†éš”ç·š
                if (nextElement && nextElement.classList.contains('divider-flow')) {
                    return nextElement;
                }
                
                return null;
            }
            
            // éš±è—æŒ‡å®šæ¬„ä½çš„è¡Œ
            function hideFieldRows(fieldIds) {
                fieldIds.forEach(fieldId => {
                    const row = getRowByFieldId(fieldId);
                    if (row) {
                        row.classList.add('hidden-element');
                    }
                });
            }
            
            // é¡¯ç¤ºæŒ‡å®šæ¬„ä½çš„è¡Œ
            function showFieldRows(fieldIds) {
                fieldIds.forEach(fieldId => {
                    const row = getRowByFieldId(fieldId);
                    if (row) {
                        row.classList.remove('hidden-element');
                    }
                });
            }
            
            // é¡¯ç¤ºæ‰€æœ‰æ¬„ä½
            function showAllFields() {
                const allFields = [...autoCalcHideFields, ...simpleHideFields];
                const uniqueFields = [...new Set(allFields)]; // å»é™¤é‡è¤‡
                showFieldRows(uniqueFields);
            }
            
            // éš±è—"ä¸€è¬æ¯æœˆåˆ©æ¯"ä¸‹æ–¹çš„åˆ†éš”ç·š
            function hideTenThousandDivider() {
                const divider = getTenThousandMonthlyDivider();
                if (divider) {
                    divider.classList.add('hidden-element');
                }
            }
            
            // é¡¯ç¤º"ä¸€è¬æ¯æœˆåˆ©æ¯"ä¸‹æ–¹çš„åˆ†éš”ç·š
            function showTenThousandDivider() {
                const divider = getTenThousandMonthlyDivider();
                if (divider) {
                    divider.classList.remove('hidden-element');
                }
            }
            
            toggleBtn.addEventListener('click', function() {
                // å¾ªç’°åˆ‡æ›æ¨¡å¼ï¼š0 -> 1 -> 2 -> 0
                viewMode = (viewMode + 1) % 3;
                
                // æ›´æ–°åœ–æ¨™
                if (viewMode === 0) {
                    // å®Œæ•´é¡¯ç¤ºï¼šå‘ä¸‹ç®­é ­
                    toggleIcon.classList.remove('icon-rotate-up');
                    toggleIcon.textContent = 'â–¼';
                } else if (viewMode === 1) {
                    // è‡ªè¡Œè¨ˆç®—ï¼šæ©«ç·š
                    toggleIcon.classList.remove('icon-rotate-up');
                    toggleIcon.textContent = 'â”';
                } else {
                    // ç²¾ç°¡é¡¯ç¤ºï¼šå‘ä¸Šç®­é ­
                    toggleIcon.classList.add('icon-rotate-up');
                    toggleIcon.textContent = 'â–¼';
                }
                
                // æ ¹æ“šä¸åŒæ¨¡å¼è™•ç†é¡¯ç¤º/éš±è—
                if (viewMode === 0) {
                    // å®Œæ•´é¡¯ç¤ºæ¨¡å¼ï¼šé¡¯ç¤ºæ‰€æœ‰å…§å®¹
                    
                    // é¡¯ç¤ºæ‰€æœ‰æŒ‰éˆ•çµ„
                    buttonGroups.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.classList.remove('hidden-element');
                        }
                    });
                    
                    // é¡¯ç¤ºæ‰€æœ‰æ¬„ä½
                    showAllFields();
                    
                    // é¡¯ç¤º"ä¸€è¬æ¯æœˆåˆ©æ¯"ä¸‹æ–¹çš„åˆ†éš”ç·š
                    showTenThousandDivider();
                    
                    // é¡¯ç¤ºæ‰€æœ‰åˆ†éš”ç·š
                    const dividers = document.querySelectorAll('.divider-flow');
                    dividers.forEach(divider => {
                        divider.classList.remove('hidden-element');
                    });
                    
                } else if (viewMode === 1) {
                    // è‡ªè¡Œè¨ˆç®—æ¨¡å¼ï¼šéš±è—ç‰¹å®šæ¬„ä½å’Œåˆ†éš”ç·š
                    
                    // é¡¯ç¤ºæ‰€æœ‰æŒ‰éˆ•çµ„
                    buttonGroups.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.classList.remove('hidden-element');
                        }
                    });
                    
                    // å…ˆé¡¯ç¤ºæ‰€æœ‰æ¬„ä½å’Œåˆ†éš”ç·š
                    showAllFields();
                    showTenThousandDivider();
                    
                    // é¡¯ç¤ºæ‰€æœ‰åˆ†éš”ç·š
                    const dividers = document.querySelectorAll('.divider-flow');
                    dividers.forEach(divider => {
                        divider.classList.remove('hidden-element');
                    });
                    
                    // ç„¶å¾Œéš±è—è‡ªè¡Œè¨ˆç®—æ¨¡å¼ç‰¹å®šçš„æ¬„ä½
                    hideFieldRows(autoCalcHideFields);
                    
                    // éš±è—"ä¸€è¬æ¯æœˆåˆ©æ¯"ä¸‹æ–¹çš„åˆ†éš”ç·š
                    hideTenThousandDivider();
                    
                } else {
                    // ç²¾ç°¡é¡¯ç¤ºæ¨¡å¼ï¼ˆviewMode === 2ï¼‰
                    
                    // éš±è—æŒ‰éˆ•çµ„
                    buttonGroups.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.classList.add('hidden-element');
                        }
                    });
                    
                    // å…ˆé¡¯ç¤ºæ‰€æœ‰æ¬„ä½å’Œåˆ†éš”ç·š
                    showAllFields();
                    showTenThousandDivider();
                    
                    // ç„¶å¾Œéš±è—ç²¾ç°¡é¡¯ç¤ºæ¨¡å¼ç‰¹å®šçš„æ¬„ä½
                    hideFieldRows(simpleHideFields);
                    
                    // è™•ç†åˆ†éš”ç·š
                    const dividers = document.querySelectorAll('.divider-flow');
                    if (dividers.length >= 3) {
                        dividers[0].classList.add('hidden-element');
                        
                        for (let i = 1; i < dividers.length - 1; i++) {
                            dividers[i].classList.add('hidden-element');
                        }
                        
                        dividers[dividers.length - 1].classList.remove('hidden-element');
                    }
                }
                
                // è§¸ç™¼éœ‡å‹•æ•ˆæœ
                vibrate();

                // é¡¯ç¤ºç•¶å‰æ¨¡å¼æç¤º
                const modeName = ['å®Œæ•´é¡¯ç¤º', 'è‡ªè¡Œè¨ˆç®—', 'ç²¾ç°¡é¡¯ç¤º'][viewMode];
                showToast(`åˆ‡æ›è‡³${modeName}æ¨¡å¼`);
            });
        });
    </script>

    <script>
        // é¸å–®åŠŸèƒ½æ§åˆ¶
        document.addEventListener('DOMContentLoaded', function() {
            // ç¶å®šé¸å–®æŒ‰éˆ•äº‹ä»¶
            const menuBtn = document.getElementById('menuBtn');
            menuBtn.addEventListener('click', function() {
                // ç§»é™¤ä»»ä½•å½±éŸ¿æŒ‰éˆ•ä½ç½®çš„ä»£ç¢¼
                openMainMenu();
                vibrate();
            });
            
            // é»æ“ŠèƒŒæ™¯é—œé–‰é¸å–®
            const mainMenuContainer = document.getElementById('mainMenuContainer');
            mainMenuContainer.addEventListener('click', function(event) {
                if (event.target === this) {
                    closeMainMenu();
                }
            });
            
            // é»æ“ŠèƒŒæ™¯é—œé–‰å­é¸å–®
            const submenus = document.querySelectorAll('.submenu-container');
            submenus.forEach(function(submenu) {
                submenu.addEventListener('click', function(event) {
                    if (event.target === this) {
                        closeSubmenu(this.id);
                    }
                });
            });
        });
        
        // æ‰“é–‹ä¸»é¸å–®
        function openMainMenu() {
            const mainMenuContainer = document.getElementById('mainMenuContainer');
            mainMenuContainer.style.display = 'flex';
            // æ·»åŠ å»¶é²ä»¥è§¸ç™¼å‹•ç•«
            setTimeout(() => {
                mainMenuContainer.classList.add('show');
            }, 10);
        }
        
        // é—œé–‰ä¸»é¸å–®
        function closeMainMenu() {
            const mainMenuContainer = document.getElementById('mainMenuContainer');
            mainMenuContainer.classList.remove('show');
            
            // ç­‰å¾…å‹•ç•«çµæŸå¾Œéš±è—
            setTimeout(function() {
                mainMenuContainer.style.display = 'none';
                
                // åŒæ™‚ç¢ºä¿æ‰€æœ‰å­é¸å–®ä¹Ÿé—œé–‰
                const submenus = document.querySelectorAll('.submenu-container');
                submenus.forEach(function(submenu) {
                    submenu.style.display = 'none';
                });
            }, 400); // èˆ‡CSSéæ¸¡æ™‚é–“ç›¸åŒ¹é…
            
            vibrate(); // ä½¿ç”¨ç¾æœ‰çš„éœ‡å‹•å‡½æ•¸
        }

        // æ‰“é–‹å­é¸å–®
        function openSubmenu(submenuId) {
            // å…ˆé—œé–‰ä¸»é¸å–®
            const mainMenuContainer = document.getElementById('mainMenuContainer');
            mainMenuContainer.classList.remove('show');
            
            setTimeout(() => {
                mainMenuContainer.style.display = 'none';
                
                // æ‰“é–‹æŒ‡å®šçš„å­é¸å–®
                const submenu = document.getElementById(submenuId);
                submenu.style.display = 'flex';
                
                // æ·»åŠ å»¶é²ä»¥è§¸ç™¼å‹•ç•«
                setTimeout(() => {
                    submenu.classList.add('show');
                }, 10);
            }, 300);
            
            vibrate(); // ä½¿ç”¨ç¾æœ‰çš„éœ‡å‹•å‡½æ•¸
        }

        // è¿”å›ä¸»é¸å–®
        function backToMainMenu(submenuId) {
            // é—œé–‰ç•¶å‰å­é¸å–®
            const submenu = document.getElementById(submenuId);
            submenu.classList.remove('show');
            
            // ç­‰å¾…å‹•ç•«çµæŸ
            setTimeout(function() {
                submenu.style.display = 'none';
                
                // é¡¯ç¤ºä¸»é¸å–®
                const mainMenuContainer = document.getElementById('mainMenuContainer');
                mainMenuContainer.style.display = 'flex';
                
                setTimeout(() => {
                    mainMenuContainer.classList.add('show');
                }, 10);
            }, 300);
            
            vibrate(); // ä½¿ç”¨ç¾æœ‰çš„éœ‡å‹•å‡½æ•¸
        }

        // é—œé–‰å­é¸å–®
        function closeSubmenu(submenuId) {
            const submenu = document.getElementById(submenuId);
            const submenuContent = submenu.querySelector('.submenu-content');
            
            // æ·»åŠ é—œé–‰å‹•ç•«
            submenuContent.classList.add('submenu-closing');
            
            // å‹•ç•«çµæŸå¾Œéš±è—å­é¸å–®
            setTimeout(function() {
                submenu.style.display = 'none';
                submenuContent.classList.remove('submenu-closing');
            }, 200); // èˆ‡å‹•ç•«æ™‚é•·ç›¸åŒ¹é…
            
            vibrate(); // ä½¿ç”¨ç¾æœ‰çš„éœ‡å‹•å‡½æ•¸
        }

        // é¡¯ç¤ºåŠŸèƒ½é–‹ç™¼ä¸­æç¤º
        function showDevelopingToast() {
            // ä½¿ç”¨ç¾æœ‰çš„ showToast å‡½æ•¸
            showToast('åŠŸèƒ½é–‹ç™¼ä¸­');
            vibrate(); // è§¸ç™¼éœ‡å‹•
        }

        function switchTheme(themeName) {
            // å…ˆç§»é™¤èˆŠæœ‰ä»»ä½•ä¸»é¡Œæ•¸æ“š
            document.documentElement.removeAttribute('data-theme');
            
            // å¦‚æœé¸æ“‡çš„ä¸æ˜¯é è¨­ä¸»é¡Œï¼Œå‰‡è¨­å®šæ–°ä¸»é¡Œ
            if (themeName !== 'default') {
                document.documentElement.setAttribute('data-theme', themeName);
            }
            
            // ä¿å­˜ä¸»é¡Œè¨­ç½®åˆ°localStorage
            localStorage.setItem('selectedTheme', themeName);
            
            // å¦‚æœæœ‰å¯è¦‹çš„å ±åƒ¹å¡ç‰‡ï¼Œæ ¹æ“šæ–°ä¸»é¡Œæ›´æ–°å®ƒ
            const shareQuoteCard = document.getElementById('shareQuoteCard');
            if (shareQuoteCard && shareQuoteCard.innerHTML.trim() !== '') {
                // å»¶é²ä¸€é»æ™‚é–“ä»¥ç¢ºä¿CSSè®Šé‡å·²æ›´æ–°
                setTimeout(() => {
                    const updatedQuoteHtml = generateQuoteCardHtml();
                    shareQuoteCard.innerHTML = updatedQuoteHtml;
                }, 100);
            }
            
            // è§¸ç™¼éœ‡å‹•åé¥‹
            vibrate();
        }

        function getThemeName(themeCode) {
            switch(themeCode) {
                case 'default': return 'æš—å¤œæ©˜ç„°';
                case 'white': return 'æ¥µç°¡é»‘ç™½';
                case 'pink': return 'æ«»èŠ±é›ª';
                case 'red': return 'æš—å¤œçƒˆç„°';
                case 'blue-purple': return 'æš®å…‰æ˜Ÿå¡µ';
                case 'green': return 'ç¿ ç‰æ¸…é¢¨';
                case 'blue': return 'ç§‘æŠ€è—èª¿';
                case 'royal': return 'çš‡å®¶ç´«éŸ»';
                default: return themeCode;
            }
        }

        // æ ¹æ“šä¸»é¡Œä»£ç¢¼è¿”å›é¡¯ç¤ºåç¨±
        function getThemeName(themeCode) {
            switch(themeCode) {
                case 'default': return 'æš—å¤œæ©˜ç„°';
                case 'white': return 'æ¥µç°¡é»‘ç™½';
                case 'pink': return 'æ«»èŠ±é›ª';
                case 'red': return 'æš—å¤œçƒˆç„°';
                case 'blue-purple': return 'æš®å…‰æ˜Ÿå¡µ';
                case 'green': return 'ç¿ ç‰æ¸…é¢¨';
                case 'blue': return 'ç§‘æŠ€è—èª¿';
                case 'royal': return 'çš‡å®¶ç´«éŸ»';
                default: return themeCode;
            }
        }

        // é é¢åŠ è¼‰æ™‚æ¢å¾©ä¿å­˜çš„ä¸»é¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('selectedTheme');
            if (savedTheme) {
                switchTheme(savedTheme);
            }
        });

    </script>

    <!-- å ±åƒ¹å¡ç‰‡æ¨¡æ¿ -->
    <div id="quoteCardTemplate" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; background-color: var(--primary-color); padding: 20px; box-sizing: border-box;">
        <div id="quoteCard" style="width: 100%; max-width: 380px; margin: 0 auto; background-color: var(--primary-color); padding: 20px; border-radius: 15px; font-family: 'Microsoft JhengHei', Arial, sans-serif; color: var(--text-color); box-shadow: 0 10px 25px var(--shadow-color); border: 2px solid var(--accent-color);">
            <div style="text-align: center; margin-bottom: 15px; border-bottom: 2px solid var(--accent-color); padding-bottom: 10px;">
                <h2 style="margin: 0; font-size: 20px; color: var(--accent-color);">è²¸æ¬¾è¨ˆç®—å ±åƒ¹å–®</h2>
                <div style="font-size: 14px; margin-top: 5px;" id="quoteDate"></div>
            </div>
            
            <table style="width: 100%; border-collapse: separate; border-spacing: 0 8px;">
                <tr>
                    <td style="width: 40%; text-align: right; padding-right: 15px; color: var(--accent-color); font-weight: bold;">æœŸæ•¸:</td>
                    <td style="text-align: left; font-weight: bold;" id="quotePeriod"></td>
                </tr>
                <tr>
                    <td style="width: 40%; text-align: right; padding-right: 15px; color: var(--accent-color); font-weight: bold;">ç¨…å‰åˆ©ç‡:</td>
                    <td style="text-align: left; font-weight: bold;" id="quoteRate"></td>
                </tr>
                <tr>
                    <td style="width: 40%; text-align: right; padding-right: 15px; color: var(--accent-color); font-weight: bold;">æœ¬é‡‘:</td>
                    <td style="text-align: left; font-weight: bold;" id="quotePrincipal"></td>
                </tr>
                <tr>
                    <td style="width: 40%; text-align: right; padding-right: 15px; color: var(--accent-color); font-weight: bold;">æœŸç¹³:</td>
                    <td style="text-align: left; font-weight: bold;" id="quotePayment"></td>
                </tr>
                <tr>
                    <td style="width: 40%; text-align: right; padding-right: 15px; color: var(--accent-color); font-weight: bold;">ç¸½åˆ©æ¯:</td>
                    <td style="text-align: left; font-weight: bold;" id="quoteTotalInterest"></td>
                </tr>
                <tr>
                    <td style="width: 40%; text-align: right; padding-right: 15px; color: var(--accent-color); font-weight: bold;">ç¨…å¾Œåˆ©ç‡:</td>
                    <td style="text-align: left; font-weight: bold;" id="quoteAfterTaxRate"></td>
                </tr>
                <tr id="quoteCommissionRow">
                    <td style="width: 40%; text-align: right; padding-right: 15px; color: var(--accent-color); font-weight: bold;">æ¨å»£:</td>
                    <td style="text-align: left; font-weight: bold;" id="quoteCommission"></td>
                </tr>
                <tr>
                    <td style="width: 40%; text-align: right; padding-right: 15px; color: var(--accent-color); font-weight: bold;">ç¨…ä½£å¾Œåˆ©ç‡:</td>
                    <td style="text-align: left; font-weight: bold;" id="quoteAfterCommissionRate"></td>
                </tr>
            </table>
            
            <div style="text-align: center; margin-top: 15px; font-size: 14px; color: var(--text-muted); border-top: 1px dashed var(--border-color); padding-top: 10px;">
                å ±åƒ¹å¾Œè¨˜å¾—åƒç¢—ç«é›è‚‰é£¯å”·ï¼
            </div>
        </div>
    </div>

    <!-- åˆ†äº«æ¨¡æ…‹æ¡† -->
    <div id="shareModalOverlay" class="modal-overlay">
        <div class="modal-container" style="max-width: 400px;">
            <div class="modal-header">
                <h3>åˆ†äº«è²¸æ¬¾è¨ˆç®—çµæœ</h3>
                <button class="close-btn" onclick="hideShareModal()">Ã—</button>
            </div>
            <div class="modal-content" style="text-align: center; padding: 10px;">
                <div id="shareQuoteCard" style="margin: 0 auto; max-width: 380px; padding: 0;"></div>
                <div style="margin: 15px 0;">
                    <div id="shareOptions" style="display: flex; justify-content: center; gap: 15px; margin-top: 15px;">
                        <button id="downloadBtn" class="modal-btn modal-btn-primary" style="display: flex; align-items: center; justify-content: center; gap: 5px;">
                            <span style="font-size: 18px;">ğŸ’¾</span> ä¸‹è¼‰åœ–ç‰‡
                        </button>
                        <button id="shareBtn" class="modal-btn modal-btn-primary" style="display: flex; align-items: center; justify-content: center; gap: 5px;">
                            <span style="font-size: 18px;">ğŸ”—</span> ç›´æ¥åˆ†äº«
                        </button>
                    </div>
                    <div id="shareStatus" style="margin-top: 15px; color: #ff9c33; font-size: 14px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»é¸å–® -->
    <div id="mainMenuContainer" class="menu-container">
        <div class="menu-content">
            <div class="menu-header">
                <h3>ä¸»é¸å–®</h3>
                <button class="menu-close-btn" onclick="closeMainMenu()">Ã—</button>
            </div>

            <ul class="menu-list" style="flex: 1; overflow-y: auto;">
                <li class="menu-item" id="authMenuItem">
                    <span>ğŸ” Google ç™»å…¥</span> <span class="menu-item-arrow">â–¶</span>
                </li>
                <li id="userInfoItem" style="display: none; background-color: rgba(255, 255, 255, 0.05); border-radius: 8px; margin: 5px;">
                    <!-- ä½¿ç”¨è€…è³‡è¨Šæœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                </li>
                <li class="menu-item" onclick="showPaymentComparison(); closeMainMenu();">
                    <span>ğŸ“Š æœŸæ•¸æ–¹æ¡ˆå°æ¯”</span>
                </li>
                <li class="menu-item" onclick="showGasCardCalculator(); closeMainMenu();">
                    <span>â›½ åŠ æ²¹å¡å„ªæƒ è¨ˆç®—</span>
                </li>
                <li class="menu-item" onclick="openSubmenu('themeSubmenu')">
                    <span>ğŸ¨ å¤–è§€</span> <span class="menu-item-arrow">â–¶</span>
                </li>
                <li class="menu-item" onclick="openSubmenu('languageSubmenu')">
                    <span>ğŸŒ èªè¨€</span> <span class="menu-item-arrow">â–¶</span>
                </li>
            </ul>
            <div class="version-info">v3.39</div>
        </div>
    </div>

    <!-- å¤–è§€å­é¸å–® -->
    <div id="themeSubmenu" class="submenu-container">
        <div class="submenu-content">
            <div class="submenu-header">
                <button class="submenu-back-btn" onclick="backToMainMenu('themeSubmenu')">
                    â—€ è¿”å›
                </button>
                <h3>å¤–è§€</h3>
            </div>
            <ul class="submenu-list" style="flex: 1; overflow-y: auto;">
                <li class="submenu-item" onclick="switchTheme('default')">ğŸ”¥ æš—å¤œæ©˜ç„°</li>
                <li class="submenu-item" onclick="switchTheme('white')">âšª æ¥µç°¡é»‘ç™½</li> 
                <li class="submenu-item" onclick="switchTheme('pink')">ğŸŒ¸ æ«»èŠ±é›ª</li>
                <li class="submenu-item" onclick="switchTheme('red')">ğŸ”´ æš—å¤œçƒˆç„°</li>
                <li class="submenu-item" onclick="switchTheme('blue-purple')">ğŸŒŒ æš®å…‰æ˜Ÿå¡µ</li>
                <li class="submenu-item" onclick="switchTheme('green')">ğŸƒ ç¿ ç‰æ¸…é¢¨</li>
                <li class="submenu-item" onclick="switchTheme('blue')">ğŸ’™ ç§‘æŠ€è—èª¿</li>
                <li class="submenu-item" onclick="switchTheme('royal')">ğŸ‘‘ çš‡å®¶ç´«éŸ»</li>
            </ul>
        </div>
    </div>

    <!-- èªè¨€å­é¸å–® -->
    <div id="languageSubmenu" class="submenu-container">
        <div class="submenu-content">
            <div class="submenu-header">
                <button class="submenu-back-btn" onclick="backToMainMenu('languageSubmenu')">
                    â—€ è¿”å›
                </button>
                <h3>èªè¨€</h3>
            </div>
            <ul class="submenu-list" style="flex: 1; overflow-y: auto;">
                <li class="submenu-item" onclick="showDevelopingToast()">ğŸ‡¹ğŸ‡¼ ä¸­æ–‡</li>
                <li class="submenu-item" onclick="showDevelopingToast()">ğŸ‡ºğŸ‡¸ è‹±æ–‡</li>
                <li class="submenu-item" onclick="showDevelopingToast()">ğŸ‡µğŸ‡­ è²å¾‹è³“</li>
                <li class="submenu-item" onclick="showDevelopingToast()">ğŸ‡¯ğŸ‡µ æ—¥æ–‡</li>
            </ul>
        </div>
    </div>

    <!-- å¹´é½¡æç¤ºè¦–çª— -->
    <div id="ageModal" class="install-modal-overlay" style="display: none;">
        <div class="install-modal">
            <h2 class="install-modal-title">18+ **Warning!**</h2>
            <div class="install-modal-content">
                This is a specialized calculator meticulously engineered for children who exhibit difficulties with mathematics and demonstrate notably sluggish computational speed. Should you be an adult possessing proficient arithmetic capabilities, it is strongly advised that you refrain from accessing this website without necessity. However, if you, too, are an enthusiast of turkey rice, your utilization of this platform's features is most heartily welcomed.
            </div>
            <div class="install-modal-buttons">
                <button id="notAdultBtn" class="install-modal-btn install-btn-cancel">Not 18 yet</button>
                <button id="adultBtn" class="install-modal-btn install-btn-confirm">Already 18+</button>
            </div>
        </div>
    </div>

    <!-- å®‰è£æ©«å¹…æç¤º -->
    <div id="installBanner" class="install-banner" style="display: none;">
        <div class="install-banner-text">å°‡å°æœ‹å‹å°ˆç”¨è¨ˆç®—æ©Ÿå®‰è£åˆ°æ¡Œé¢</div>
        <button id="installBtn" class="install-banner-btn">å®‰è£</button>
        <button id="closeBannerBtn" class="install-banner-close">Ã—</button>
    </div>

    <!-- åŠ æ²¹å¡å„ªæƒ è¨ˆç®—æ¨¡æ…‹æ¡† -->
    <div id="gasCardModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--primary-color); z-index: 2000;">
        <div style="width: 100%; height: 100%; display: flex; flex-direction: column; background-color: var(--primary-color);">
            <div class="modal-header" style="background-color: var(--secondary-color); border-bottom: 2px solid var(--accent-color); padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; color: var(--accent-color); font-size: 20px;">åŠ æ²¹å¡å„ªæƒ è¨ˆç®—</h3>
                <button class="close-btn" onclick="closeGasCardCalculator()" style="background: none; border: none; color: var(--text-color); font-size: 24px; cursor: pointer; padding: 5px 10px;">Ã—</button>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 10px; background-color: var(--primary-color);">
                <div id="gasCardContent">
                    <!-- åŠ æ²¹å¡è¨ˆç®—å™¨å…§å®¹å°‡å‹•æ…‹æ’å…¥é€™è£¡ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let deferredPrompt;
    
        // é¡¯ç¤ºå¹´é½¡æç¤ºè¦–çª—å’Œå®‰è£æç¤º
        function showInstallPrompt() {
            document.getElementById('ageModal').style.display = 'flex';
            
            // ç•¶ç”¨æˆ¶é»æ“Šã€ŒNot 18 yetã€æŒ‰éˆ•æ™‚
            document.getElementById('notAdultBtn').addEventListener('click', function() {
                document.getElementById('ageModal').style.display = 'none';
                
                // é¡¯ç¤ºå®‰è£æç¤ºï¼Œå¦‚æœå¯ç”¨
                checkInstallAvailable();
            });
            
            // ç•¶ç”¨æˆ¶é»æ“Šã€ŒAlready 18+ã€æŒ‰éˆ•æ™‚
            document.getElementById('adultBtn').addEventListener('click', function() {
                // è·³è½‰åˆ°Rick Rollè¦–é »
                window.location.href = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ&ab_channel=RickAstley';
            });
        }
    
        // æª¢æŸ¥æ˜¯å¦å¯ä»¥å®‰è£PWA
        function checkInstallAvailable() {
            const installBanner = document.getElementById('installBanner');
            const installBtn = document.getElementById('installBtn');
            const closeBannerBtn = document.getElementById('closeBannerBtn');
            
            // ç›£è½beforeinstallpromptäº‹ä»¶
            window.addEventListener('beforeinstallprompt', (e) => {
                // é˜»æ­¢Chrome 67åŠæ›´æ—©ç‰ˆæœ¬è‡ªå‹•é¡¯ç¤ºçš„å®‰è£æç¤º
                e.preventDefault();
                // ä¿å­˜äº‹ä»¶ï¼Œä»¥ä¾¿ç¨å¾Œè§¸ç™¼
                deferredPrompt = e;
                // é¡¯ç¤ºå®‰è£æ©«å¹…
                installBanner.style.display = 'flex';
            });
            
            // å®‰è£æŒ‰éˆ•é»æ“Šäº‹ä»¶
            installBtn.addEventListener('click', () => {
                if (deferredPrompt) {
                    // é¡¯ç¤ºå®‰è£æç¤º
                    deferredPrompt.prompt();
                    // ç­‰å¾…ç”¨æˆ¶å›æ‡‰æç¤º
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('ç”¨æˆ¶æ¥å—å®‰è£');
                            // éš±è—å®‰è£æ©«å¹…
                            installBanner.style.display = 'none';
                        }
                        deferredPrompt = null;
                    });
                }
            });
            
            // é—œé–‰æŒ‰éˆ•é»æ“Šäº‹ä»¶
            closeBannerBtn.addEventListener('click', () => {
                installBanner.style.display = 'none';
            });
            
            // ç›£è½appinstalledäº‹ä»¶
            window.addEventListener('appinstalled', (evt) => {
                console.log('æ‡‰ç”¨å·²å®‰è£');
                // éš±è—å®‰è£æ©«å¹…
                installBanner.style.display = 'none';
            });
        }
    </script>

    <script>
        // Firebase è¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyBvaz4vcGzVFSQU52abK5YLk2Ii1sEOoM8",
            authDomain: "loan-calculator-app-76a7d.firebaseapp.com",
            projectId: "loan-calculator-app-76a7d",
            storageBucket: "loan-calculator-app-76a7d.firebasestorage.app",
            messagingSenderId: "939791472492",
            appId: "1:939791472492:web:0685760b3eb4faaac68549",
            measurementId: "G-3N3S9DKLPN"
        };

        // åˆå§‹åŒ– Firebase
        firebase.initializeApp(firebaseConfig);

        // åˆå§‹åŒ– Firebase Auth
        const auth = firebase.auth();
        auth.languageCode = 'zh-TW';

        // å…¨åŸŸè®Šæ•¸å„²å­˜ä½¿ç”¨è€…è³‡è¨Š
        window.currentUser = null;

        // ç™»å…¥å‡½æ•¸
        function signInWithGoogle() {
            console.log('é–‹å§‹ Google ç™»å…¥...');
            const provider = new firebase.auth.GoogleAuthProvider();
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    console.log('ç™»å…¥æˆåŠŸ:', result.user);
                    showToast('ç™»å…¥æˆåŠŸï¼æ­¡è¿ ' + result.user.displayName);
                    vibrate();
                })
                .catch((error) => {
                    console.error('ç™»å…¥éŒ¯èª¤:', error);
                    if (error.code === 'auth/popup-blocked') {
                        showToast('è«‹å…è¨±å½ˆå‡ºè¦–çª—ä»¥å®Œæˆç™»å…¥', true);
                    } else if (error.code === 'auth/cancelled-popup-request') {
                        showToast('ç™»å…¥å·²å–æ¶ˆ', true);
                    } else {
                        showToast('ç™»å…¥å¤±æ•—ï¼š' + error.message, true);
                    }
                });
        }

        // ç™»å‡ºå‡½æ•¸
        function signOut() {
            auth.signOut()
                .then(() => {
                    showToast('å·²æˆåŠŸç™»å‡º');
                    vibrate();
                })
                .catch((error) => {
                    console.error('ç™»å‡ºéŒ¯èª¤:', error);
                    showToast('ç™»å‡ºå¤±æ•—ï¼š' + error.message, true);
                });
        }

        // æ›´æ–°ä»‹é¢ä»¥åæ˜ ç™»å…¥ç‹€æ…‹
        function updateUIForAuth(user) {
            const authMenuItem = document.getElementById('authMenuItem');
            const userInfoItem = document.getElementById('userInfoItem');
            
            if (user) {
                // ä½¿ç”¨è€…å·²ç™»å…¥
                if (authMenuItem) {
                    authMenuItem.innerHTML = 'ç™»å‡º <span class="menu-item-arrow">â–¶</span>';
                    authMenuItem.onclick = signOut;
                }
                if (userInfoItem) {
                    userInfoItem.style.display = 'block';
                    userInfoItem.innerHTML = `<div style="padding: 10px; font-size: 14px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            ${user.photoURL ? `<img src="${user.photoURL}" style="width: 32px; height: 32px; border-radius: 50%;">` : ''}
                            <div>
                                <div>${user.displayName || 'ä½¿ç”¨è€…'}</div>
                                <div style="color: var(--text-muted); font-size: 12px;">${user.email}</div>
                            </div>
                        </div>
                    </div>`;
                }
            } else {
                // ä½¿ç”¨è€…æœªç™»å…¥
                if (authMenuItem) {
                    authMenuItem.innerHTML = 'Google ç™»å…¥ <span class="menu-item-arrow">â–¶</span>';
                    authMenuItem.onclick = signInWithGoogle;
                }
                if (userInfoItem) {
                    userInfoItem.style.display = 'none';
                }
            }
        }

        // ç­‰å¾… DOM è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç›£è½ä½¿ç”¨è€…ç™»å…¥ç‹€æ…‹
            auth.onAuthStateChanged((user) => {
                window.currentUser = user;
                updateUIForAuth(user);
                
                if (user) {
                    // å„²å­˜ä½¿ç”¨è€…è³‡è¨Šåˆ° localStorage
                    const userInfo = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName,
                        photoURL: user.photoURL,
                        lastLogin: new Date().toISOString()
                    };
                    localStorage.setItem('userInfo', JSON.stringify(userInfo));
                } else {
                    // æ¸…é™¤æœ¬åœ°å„²å­˜çš„ä½¿ç”¨è€…è³‡è¨Š
                    localStorage.removeItem('userInfo');
                }
            });

            // åˆå§‹è¨­å®šç™»å…¥æŒ‰éˆ•
            const authMenuItem = document.getElementById('authMenuItem');
            if (authMenuItem) {
                authMenuItem.onclick = signInWithGoogle;
            }
        });
    </script>

</body>
</html>
