<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
	 <meta name="viewport" content="width=412, user-scalable=no">
    <title>雞肉飯要每天吃</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f6fa;
            --text-color: #2c3e50;
            --border-color: #dcdde1;
            --hover-color: #357abd;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
         html, body {
            width: 412px;
            min-width: 412px;
            margin: 0 auto;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            padding: 5px;
            background-color: #f8f9fa;
            color: var(--text-color);
        }
		h1 {
            color: var(--primary-color);
            font-size: 22px;
            margin-bottom: 0px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
        }
        .row {
            margin: 4px 0;
            display: flex;
            align-items: center;
            background: white;
            padding: 3px;
            border-radius: 20px;
            box-shadow: 0 3px 15px var(--shadow-color);
        }
        .label {
            width: 120px;
            margin-right: 15px;
            text-align: right;
            font-weight: 600;
            color: var(--text-color);
        }
        input {
            width: 120px;
            padding: 5px 12px;
            margin-right: 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 15px;
            transition: border-color 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 3px 9px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 15px;
        }

        button:hover {
            background-color: var(--hover-color);
        }
		
		 div[id$="Buttons"] button {
        background-color: white;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
        transition: all 0.3s ease;
    }

    	div[id$="Buttons"] button:hover {
        background-color: var(--primary-color);
        color: white;
    }

        .readonly {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        #timeDisplay {
            margin: 5px 0;
            font-size: 15px;
            color: var(--text-color);
            background: white;
            padding: 10px;
            border-radius: 80px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .time-label {
            font-weight: bold;
            margin-right: 10px;
            color: var(--primary-color);
        }

         #periodButtons, #rateButtons, #principalButtons, #commissionButtons, #PaymentduringButtons {
            margin: 10px 3px 20px 0;
            display: flex;
            flex-wrap: nowrap;
            gap: 8px;
            width: calc(100% - 3px);
            overflow-x: visible;
            white-space: nowrap;
            justify-content: flex-end;
        }
        
        /* 保持按鈕大小一致 */
        button {
            flex-shrink: 0;
        }

    </style>
</head>
<body>
	<div style="text-align: center;">
     <h1>小朋友專用計算機</h1>
	</div>
	
    <div id="timeDisplay" style="display: flex; justify-content: center;">
        <span class="time-label">報價時間：</span><span id="currentTime"></span>
    </div>
    
<div class="row">
        <span class="label">期數</span>
        <input type="number" id="period" step="0.1">
        <button onclick="calculatePeriod()">算</button>
        <button onclick="clearField('period')">清</button>
    </div>

    <div id="periodButtons" style="display: flex; justify-content: flex-end;">
		<button onclick="adjustPeriod(-1)">-1</button>
		<button onclick="setPeriod(12)">1</button>
        <button onclick="setPeriod(24)">2</button>
        <button onclick="setPeriod(36)">3</button>
        <button onclick="setPeriod(48)">4</button>
        <button onclick="setPeriod(60)">5</button>
      <button onclick="adjustPeriod(1)">+1</button>
	</div>
    <div class="row">
        <span class="label">稅前利率</span>
        <input type="number" id="rate" step="0.01">
        <button onclick="calculateRate()">算</button>
        <button onclick="clearField('rate')">清</button>
    </div>

    <div id="rateButtons" style="display: flex; justify-content: flex-end;">
        <button onclick="adjustRate(-0.2)">-0.2</button>
        <button onclick="setRate(4)">4</button>
        <button onclick="setRate(7)">7</button>
        <button onclick="setRate(10)">10</button>
        <button onclick="setRate(13)">13</button>
        <button onclick="adjustRate(0.2)">+0.2</button>
    </div>
    <div class="row">
        <span class="label">本金</span>
        <input type="number" id="principal">
        <button onclick="calculatePrincipal()">算</button>
        <button onclick="clearField('principal')">清</button>
    </div>
    <div id="principalButtons" style="display: flex; justify-content: flex-end;">
		<button onclick="adjustPrincipal(-1000000)">-100</button>
		<button onclick="adjustPrincipal(-100000)">-10</button>
		<button onclick="adjustPrincipal(-10000)">-1</button>
        <button onclick="adjustPrincipal(10000)">+1</button>
		<button onclick="adjustPrincipal(100000)">+10</button>
		<button onclick="adjustPrincipal(1000000)">+100</button>
    </div>
    <div class="row">
        <span class="label">期繳</span>
        <input type="number" id="payment" step="0.01">
        <button onclick="calculatePayment()">算</button>
        <button onclick="clearField('payment')">清</button>
    </div>
	 <div id="PaymentduringButtons" style="display: flex; justify-content: flex-end;">
        <button onclick="adjustPayment(-100)">-100</button>
        <button onclick="roundPayment('down', 1000)">捨千</button>
        <button onclick="roundPayment('down', 100)">捨百</button>
        <button onclick="roundPayment('up', 100)">進百</button>
        <button onclick="roundPayment('up', 1000)">進千</button>
        <button onclick="adjustPayment(100)">+100</button>
    </div>
	<div class="row">
        <span class="label">總利息</span>
        <input type="number" id="totalInterest" class="readonly" readonly>
    </div>
    <div class="row">
        <span class="label">等於幾碗雞肉飯</span>
        <input type="number" id="chickenRice" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">稅金</span>
        <input type="number" id="tax" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">稅後利率</span>
        <input type="number" id="afterTaxRate" class="readonly" readonly>
    </div>

     <div class="row">
        <span class="label">佣金</span>
        <input type="number" id="commission">
        <button onclick="calculateAfterCommissionRate()">算</button>
        <button onclick="clearCommission()">清</button>
    </div>

    <div id="commissionButtons" style="display: flex; justify-content: flex-end;">
        <button onclick="setCommissionPercentage(1)">1</button>
        <button onclick="setCommissionPercentage(2)">2</button>
        <button onclick="setCommissionPercentage(3)">3</button>
        <button onclick="setCommissionPercentage(4)">4</button>
        <button onclick="setCommissionPercentage(5)">5</button>
    </div>
    <div class="row">
        <span class="label">稅佣後利率</span>
        <input type="number" id="afterCommissionRate" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">百萬每年利息</span>
        <input type="number" id="annualMillionInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">百萬每月利息</span>
        <input type="number" id="monthlyMillionInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">一萬每年利息</span>
        <input type="number" id="annualTenThousandInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">一萬每月利息</span>
        <input type="number" id="monthlyTenThousandInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">本月資金成本</span>
        <input type="number" id="monthlyCost" value="2.0951" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">Spread</span>
        <input type="number" id="spread" class="readonly" readonly>
    </div>
<script>
	     // 添加更新時間的函數
        function updateTime() {
            const now = new Date();
            const days = ['日', '一', '二', '三', '四', '五', '六'];
            
            // 調整為台北時間 (GMT+8)
            const taipeiTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            
            const year = taipeiTime.getUTCFullYear();
            const month = String(taipeiTime.getUTCMonth() + 1).padStart(2, '0');
            const date = String(taipeiTime.getUTCDate()).padStart(2, '0');
            const day = days[taipeiTime.getUTCDay()];
            const hours = String(taipeiTime.getUTCHours()).padStart(2, '0');
            const minutes = String(taipeiTime.getUTCMinutes()).padStart(2, '0');
            const seconds = String(taipeiTime.getUTCSeconds()).padStart(2, '0');
            
            const timeString = `${year}年${month}月${date}日，星期${day}，${hours}:${minutes}:${seconds}`;
            document.getElementById('currentTime').textContent = timeString;
        }

        // 每秒更新一次時間
        setInterval(updateTime, 1000);
        updateTime(); // 初始化顯示

        // 原始的JavaScript函數保持不變
        function PMT(rate, nper, pv) {
            rate = rate / 100 / 12;
            return (pv * rate * Math.pow(1 + rate, nper)) / (Math.pow(1 + rate, nper) - 1);
        }
        function PMT(rate, nper, pv) {
            rate = rate / 100 / 12;
            return (pv * rate * Math.pow(1 + rate, nper)) / (Math.pow(1 + rate, nper) - 1);
        }

        function RATE(nper, pmt, pv) {
            let rate = 0.1;
            let step = 0.05;
            let tolerance = 0.0001;
            let maxIterations = 100;
            let iteration = 0;

            while (iteration < maxIterations) {
                let monthlyRate = rate / 12;
                let calculated = pv * monthlyRate * Math.pow(1 + monthlyRate, nper) / 
                               (Math.pow(1 + monthlyRate, nper) - 1);
                
                if (Math.abs(calculated - pmt) < tolerance) {
                    return rate * 100;
                }

                if (calculated > pmt) {
                    rate -= step;
                } else {
                    rate += step;
                }
                
                step *= 0.5;
                iteration++;
            }
            
            return rate * 100;
        }

        function calculatePeriod() {
            const rate = parseFloat(document.getElementById('rate').value);
            const principal = parseFloat(document.getElementById('principal').value);
            const payment = parseFloat(document.getElementById('payment').value);
            
            // TODO: Implement period calculation
            updateAllFields();
        }

        function calculateRate() {
            const period = parseFloat(document.getElementById('period').value);
            const principal = parseFloat(document.getElementById('principal').value);
            const payment = parseFloat(document.getElementById('payment').value);
            
            const rate = RATE(period, payment, principal);
            document.getElementById('rate').value = rate.toFixed(2);
            
            updateAllFields();
        }

        function calculatePrincipal() {
            const period = parseFloat(document.getElementById('period').value);
            const rate = parseFloat(document.getElementById('rate').value);
            const payment = parseFloat(document.getElementById('payment').value);
            
            // TODO: Implement principal calculation
            updateAllFields();
        }

        function calculatePayment() {
            const period = parseFloat(document.getElementById('period').value);
            const rate = parseFloat(document.getElementById('rate').value);
            const principal = parseFloat(document.getElementById('principal').value);
            
            const payment = PMT(rate, period, principal);
            document.getElementById('payment').value = payment.toFixed(2);
            
            updateAllFields();
        }

        function updateAllFields() {
            const period = parseFloat(document.getElementById('period').value);
            const rate = parseFloat(document.getElementById('rate').value);
            const principal = parseFloat(document.getElementById('principal').value);
            const payment = parseFloat(document.getElementById('payment').value);

            // Calculate total interest
            const totalInterest = (payment * period) - principal;
            document.getElementById('totalInterest').value = totalInterest.toFixed(2);

            // Calculate tax
            const tax = totalInterest / 21;
            document.getElementById('tax').value = tax.toFixed(2);

            // Calculate after-tax rate
            const afterTaxRate = RATE(period, payment, principal + tax);
            document.getElementById('afterTaxRate').value = afterTaxRate.toFixed(3);

            // Calculate after-commission rate
            calculateAfterCommissionRate();

            // Calculate million interest
            const millionPayment = PMT(rate, 12, 1000000);
            const annualMillionInterest = (millionPayment * 12) - 1000000;
            document.getElementById('annualMillionInterest').value = annualMillionInterest.toFixed(2);
            document.getElementById('monthlyMillionInterest').value = (annualMillionInterest / 12).toFixed(2);

            // Calculate ten thousand interest
            const tenThousandPayment = PMT(rate, 12, 10000);
            const annualTenThousandInterest = (tenThousandPayment * 12) - 10000;
            document.getElementById('annualTenThousandInterest').value = annualTenThousandInterest.toFixed(2);
            document.getElementById('monthlyTenThousandInterest').value = (annualTenThousandInterest / 12).toFixed(2);

            // Calculate spread
            const monthlyCost = parseFloat(document.getElementById('monthlyCost').value);
            const afterCommissionRate = parseFloat(document.getElementById('afterCommissionRate').value);
            document.getElementById('spread').value = (afterCommissionRate - monthlyCost).toFixed(3);

            // Calculate chicken rice bowls
            document.getElementById('chickenRice').value = Math.floor(totalInterest / 35);
        }

        function clearField(fieldId) {
            document.getElementById(fieldId).value = '';
        }
	
		function clearCommission() {
        	document.getElementById('commission').value = '';
        	calculateAfterCommissionRate(); // 清除後重新計算稅佣後利率
    	}

        function adjustPeriod(delta) {
            const periodField = document.getElementById('period');
            const currentValue = parseFloat(periodField.value) || 0;
            periodField.value = currentValue + delta;
            calculatePayment();
        }

        function setPeriod(value) {
            document.getElementById('period').value = value;
            calculatePayment();
        }

        function adjustRate(delta) {
            const rateField = document.getElementById('rate');
            const currentValue = parseFloat(rateField.value) || 0;
            rateField.value = (currentValue + delta).toFixed(2);
            calculatePayment();
        }

        function setRate(value) {
            document.getElementById('rate').value = value;
            calculatePayment();
        }

        function adjustPrincipal(delta) {
            const principalField = document.getElementById('principal');
            const currentValue = parseFloat(principalField.value) || 0;
            principalField.value = currentValue + delta;
            calculatePayment();
        }

        function setCommissionPercentage(percentage) {
            const principal = parseFloat(document.getElementById('principal').value);
            document.getElementById('commission').value = (principal * percentage / 100).toFixed(2);
            calculateAfterCommissionRate();
        }

        function calculateAfterCommissionRate() {
            const period = parseFloat(document.getElementById('period').value);
            const payment = parseFloat(document.getElementById('payment').value);
            const principal = parseFloat(document.getElementById('principal').value);
            const tax = parseFloat(document.getElementById('tax').value);
            const commission = parseFloat(document.getElementById('commission').value) || 0;

            const afterCommissionRate = RATE(period, payment, principal + tax + commission);
            document.getElementById('afterCommissionRate').value = afterCommissionRate.toFixed(3);
            
            // Update spread
            const monthlyCost = parseFloat(document.getElementById('monthlyCost').value);
            document.getElementById('spread').value = (afterCommissionRate - monthlyCost).toFixed(3);
        }
	 function roundPayment(direction, base) {
            const paymentField = document.getElementById('payment');
            let value = parseFloat(paymentField.value) || 0;
            
            if (direction === 'down') {
                value = Math.floor(value / base) * base;
            } else {
                value = Math.ceil(value / base) * base;
            }
            
            paymentField.value = value.toFixed(2);
            calculateRate(); // Recalculate the rate
        }
	function adjustPayment(delta) {
    const paymentField = document.getElementById('payment');
    const currentValue = parseFloat(paymentField.value) || 0;
    paymentField.value = (currentValue + delta).toFixed(2);
    calculateRate(); // 重新計算利率
}
    </script>
</body>
</html>
