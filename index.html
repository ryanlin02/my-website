<!DOCTYPE html>
<html lang="zh-TW">
<head>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XE5XMQR0Z1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-XE5XMQR0Z1');
    </script>

    <!-- åœ¨ <head> æ¨™ç±¤å…§æ·»åŠ ä»¥ä¸‹å…§å®¹ -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#333333">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="é›è‚‰é£¯">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">

    <meta charset="UTF-8">
	<meta name="viewport" content="width=400, user-scalable=no">

    <!-- åœ¨ç¾æœ‰çš„ meta æ¨™ç±¤ä¸‹æ–¹æ·»åŠ  -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>å°æœ‹å‹è¨ˆç®—æ©Ÿ</title>
    <style>

    :root {
        --primary-color: #333333;
        --secondary-color: #4a4a4a;
        --text-color: #ffffff;
        --border-color: #555555;
        --hover-color: #666666;
        --shadow-color: rgba(0, 0, 0, 0.3);
        --button-orange: #ff9c33;
        --button-blue: #33b5e5;
		--button-grey: #333333;
    }

    /* ä¿®æ”¹ç¾æœ‰çš„åŸºç¤æ¨£å¼ï¼Œæ·»åŠ å‹•ç•«æ•ˆæœ */

    html, body {
    	width: 100%;           /* æ”¹ç‚º100%å¯¬åº¦ */
    	max-width: 400px;      /* è¨­å®šæœ€å¤§å¯¬åº¦ */
    	margin: 0 auto;
        position: relative; /* æ·»åŠ è¿™è¡Œ */
    	overflow-x: hidden;
    	-webkit-text-size-adjust: 100%;
    	padding: 0 3px;       /* å¢åŠ å·¦å³padding */
    	background-color: #333333;
    	color: var(--text-color);
    	font-family: "Microsoft JhengHei", Arial, sans-serif;
    	box-sizing: border-box; /* æ·»åŠ é€™è¡Œ */
	}

    h1 {
        color: var(--text-color);
        font-size: 22px;
        margin-bottom: 0px;
        border-bottom: 2px solid var(--button-orange);
        padding-bottom: 5px;
		position: relative;
		transition: all 0.3s ease;
    }
    h1:hover {
        transform: translateY(-2px);
        text-shadow: 0 2px 4px rgba(255, 156, 51, 0.3);
    }
    h1::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: var(--button-orange);
        transform: scaleX(0);
        transform-origin: right;
        transition: transform 0.6s ease-out;
    }

    h1:hover::after {
        transform: scaleX(1);
        transform-origin: left;
    }
		

    .row {
        margin: 4px 0;
        display: flex;
        align-items: center;
        background: var(--secondary-color);
        padding: 3px;
        border-radius: 4px;
        box-shadow: 0 4px 8px var(--shadow-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
        transform-origin: left;
        will-change: transform; 
    }

	.row:hover {
        transform: translateX(5px);
        box-shadow: 0 6px 12px var(--shadow-color);
    }

    .row:hover::before {
        content: '';
        position: absolute;
        left: -5px;
        top: 50%;
        width: 3px;
        height: 0;
        background: var(--button-orange);
        animation: expandHeight 0.3s forwards;
    }

    /* å‰µå»ºè¼¸å…¥æ¡†èˆ‡æŒ‰éµçš„è¦–è¦ºåˆ†çµ„ */
    .input-button-group {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin: 4px 0;
        padding: 1px; /* æ¸›å°‘æ•´é«”å…§é‚Šè· */
        background: var(--secondary-color);
        box-shadow: 0 4px 8px var(--shadow-color);
        position: relative;
        overflow: hidden;
    }

    .input-button-group .row {
        background: transparent;
        box-shadow: none;
        margin: 2px 0;  /* æ¸›å°‘ä¸Šä¸‹é–“è· */
        padding-top: 1px; /* æ¸›å°‘ä¸Šéƒ¨å…§é‚Šè· */
        padding-bottom: 1px; /* æ¸›å°‘ä¸‹éƒ¨å…§é‚Šè· */
    }

    .input-button-group .row:hover {
        transform: translateX(2px);
        box-shadow: none;
    }

    .input-button-group .row:hover::before {
        display: none;
    }

    /* æŒ‰éµå®¹å™¨æ¨£å¼èª¿æ•´ */
    .input-button-group div[id$="Buttons"] {
        margin: 0;
        padding-top: 0;
        padding-bottom: 2px; /* æ¸›å°‘ä¸‹éƒ¨å…§é‚Šè· */
        border-top: none; /* ç§»é™¤è™›ç·šé‚Šæ¡† */
    }

    @keyframes expandHeight {
        to {
            height: 100%;
            top: 0;
        }
    }

    .label {
        width: 120px;
        margin-right: 15px;
        text-align: right;
        font-weight: 600;
        color: var(--text-color);
        position: relative;
        overflow: hidden;
    }

    input {
        width: 95px;
        padding: 5px 12px;
        margin-right: 10px;
        background-color: #222222;
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    input:focus {
		outline: none;
		border-color: var(--button-orange);
		box-shadow: 0 0 0 3px rgba(255, 156, 51, 0.2);
		transform: scale(1.07);
	}

    .value-changed {
        animation: valueChange 0.5s ease-out;
        will-change: background-color;
    }

    @keyframes valueChange {
        0% { 
            background-color: rgba(255, 156, 51, 0.2);
            transform: scale(1.02);
        }
        100% { 
            background-color: transparent;
            transform: scale(1);
        }
    }


    button {
        background-color: var(--secondary-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 3px 8px;
        margin: 0 5px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 16px;
    }

    button:hover {
        background-color: var(--hover-color);
		transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
	button:active {
        transform: scale(0.95) translateY(1px);
    	transition: transform 0.1s;
    }
	
	.row button {
        background-color: var(--secondary-color);
        color: #888888; /* é™ä½æ–‡å­—äº®åº¦ */
        border: 1px solid #444444; /* æ›´æ·±çš„é‚Šæ¡†é¡è‰² */
        padding: 3px 8px;
        margin: 0 5px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 15px;
        opacity: 0.8;
    }

    /* çµ±ä¸€æŒ‰éˆ•å€åŸŸä¸­çš„æŒ‰éˆ•æ¨£å¼ */
    #periodButtons button, 
    #rateButtons button, 
    #principalButtons button, 
    #commissionButtons button, 
    #PaymentduringButtons button {
        min-width: 50px;       /* è¨­ç½®æœ€å°å¯¬åº¦ */
        text-align: center;    /* æ–‡å­—å±…ä¸­ */
        flex: 1;               /* å¹³å‡åˆ†é…ç©ºé–“ */
        max-width: 80px;       /* é™åˆ¶æœ€å¤§å¯¬åº¦ */
        margin: 0 2px;         /* èª¿æ•´é‚Šè· */
        height: 28px;          /* çµ±ä¸€é«˜åº¦ */
        padding: 0 5px;        /* èª¿æ•´å…§è· */
        display: flex;         /* ä½¿ç”¨flexä½ˆå±€ */
        align-items: center;   /* å‚ç›´å±…ä¸­ */
        justify-content: center; /* æ°´å¹³å±…ä¸­ */
        white-space: nowrap;   /* é˜²æ­¢æ–‡å­—æ›è¡Œ */
        overflow: hidden;      /* éš±è—æº¢å‡ºå…§å®¹ */
        text-overflow: ellipsis; /* è¶…å‡ºéƒ¨åˆ†ä½¿ç”¨çœç•¥è™Ÿ */
    }

    /* é‡å°æŒ‰éˆ•æ•¸é‡å¤šçš„å…©å€‹çµ„åˆ¥é€²è¡Œç‰¹æ®Šèª¿æ•´ */
    #periodButtons button, 
    #rateButtons button {
        min-width: 35px;      /* æ¸›å°æœ€å°å¯¬åº¦ */
        max-width: 50px;      /* æ¸›å°æœ€å¤§å¯¬åº¦ */
        padding: 0 3px;       /* æ¸›å°å…§éƒ¨é–“è· */
        font-size: 15px;      /* ç¨å¾®æ¸›å°å­—é«”å¤§å° */
    }

    /* æ¸›å°é€™å…©å€‹æŒ‰éˆ•çµ„çš„æŒ‰éˆ•é–“è· */
    #periodButtons, 
    #rateButtons {
        gap: 2px;             /* æ¸›å°æŒ‰éˆ•ä¹‹é–“çš„é–“è· */
    }

    .row button:hover {
        background-color: #4a4a4a; /* ç¨å¾®äº®ä¸€é»çš„ç°è‰² */
        color: #cccccc; /* äº®ä¸€é»çš„æ–‡å­—ï¼Œä½†ä¸æ˜¯ç´”ç™½ */
        border-color: #555555;
        opacity: 0.9;
    }

    .row button:active {
        background-color: var(--secondary-color);  /* é»æ“Šæ™‚æ¢å¾©åŸæœ¬é¡è‰² */
        color: var(--text-color);
        border-color: var(--button-grey);
    }
	.row button::after {
		content: '';
		position: absolute;
		top: 50%;
		left: 50%;
		width: 0;
		height: 0;
		background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
		transition: width 0.3s ease-out, height 0.3s ease-out;
		transform: translate(-50%, -50%);
		border-radius: 50%;
	}

	.row button:active::after {
		width: 150px;
		height: 150px;
	}

    /* ç•¶æ»‘é¼ æ‡¸åœåœ¨æŒ‰éµçµ„ä¸Šæ™‚çš„æ•ˆæœ */
    .input-button-group div[id$="Buttons"]:hover {
        background-color: rgba(255, 156, 51, 0.05);
        border-radius: 4px;
    }

    /* å°‡çµ„å…§çš„æŒ‰éµè¼•å¾®çªå‡ºé¡¯ç¤º */
    .input-button-group div[id$="Buttons"] button {
        position: relative;
        z-index: 2;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
    }

    /* æ”¹é€²æŒ‰éµé»æ“Šåé¥‹ */
    .input-button-group div[id$="Buttons"] button:active {
        transform: scale(0.95);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        transition: transform 0.1s, box-shadow 0.1s;
    }

    /* æ·»åŠ è¼•å¾®çš„æ‡¸åœæ•ˆæœ */
    .input-button-group div[id$="Buttons"] button:hover {
        border-color: var(--button-orange);
    }

    div[id$="Buttons"] button {
        background-color: var(--secondary-color);
        color: #bcbcbc; /* æé«˜æ–‡å­—æ˜åº¦ */
        border: 1px solid var(--button-orange); /* ä½¿ç”¨æ©˜è‰²å¤–æ¡† */
        padding: 4px 9px;
        margin: 0 4px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 15px;
        opacity: 0.95; /* æé«˜ä¸é€æ˜åº¦ */
    }

    div[id$="Buttons"] button:hover {
        background-color: rgba(255, 156, 51, 0.15); /* æ·¡æ©˜è‰²èƒŒæ™¯ */
        color: #ffffff;
        border-color: var(--button-orange);
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(255, 156, 51, 0.2);
    }

	div[id$="Buttons"] button:active {
        transform: translateY(1px);
        background-color: rgba(255, 156, 51, 0.3); /* é»æ“Šæ™‚åªæ”¹è®Šç•¶å‰æŒ‰éˆ•çš„èƒŒæ™¯ */
        box-shadow: 0 0 5px rgba(255, 156, 51, 0.5) inset; /* å…§é™°å½±æ•ˆæœ */
        transition: all 0.1s ease;
    }

    .readonly {
        background-color: #222222;
        animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.8; }
    }

    /* åŒ…è£…å®¹å™¨æ ·å¼ */
    /* ä¿®æ”¹ wrapper æ ·å¼ */
    .time-display-wrapper {
        position: relative;
        height: auto;
        margin: 3px 0;
        z-index: 1000; /* æé«˜ z-index */
    }

    /* ä¿®æ”¹åŸæœ‰çš„timeDisplayæ ·å¼ */
    .sticky-header {
        position: -webkit-sticky !important; /* æ·»åŠ  !important */ /* Safariæ”¯æŒ */
        position: sticky!important;         /* æ·»åŠ  !important */
        top: 0;
        background: var(--secondary-color);
        padding: 8px;
        border-radius: 4px;
        box-shadow: 0 2px 4px var(--shadow-color);
        animation: fadeIn 0.8s ease-out;
        transition: all 0.3s ease;
        z-index: 999;
        width: calc(100% - 16px); /* è€ƒè™‘å†…è¾¹è· */
        margin: 0 auto;
    }

    /* æ·»åŠ å›ºå®šçŠ¶æ€çš„æ ·å¼ */
    .sticky-header.is-sticky {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        border-radius: 0 0 4px 4px;
    }

    #timeDisplay {
        margin: 3px 0;
        font-size: 15px;
        background: var(--secondary-color);
        color: var(--text-color);
        padding: 8px;
        border-radius: 4px;
        box-shadow: 0 2px 4px var(--shadow-color);
		animation: fadeIn 0.8s ease-out;
        transition: all 0.3s ease;
		position: relative;
    	overflow: hidden;
    }

	#timeDisplay:hover {
        transform: scale(1.02);
        box-shadow: 0 6px 12px var(--shadow-color);
    }

	#timeDisplay::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 2px;
		background: linear-gradient(90deg, transparent, var(--button-orange), transparent);
		animation: timelineSlide 3s linear infinite;
	}
	@keyframes timelineSlide {
		0% { left: -100%; }
		100% { left: 100%; }
    }

    .time-label {
        font-weight: bold;
        margin-right: 10px;
        color: var(--button-orange);
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* æ·»åŠ æ»šåŠ¨æ—¶çš„æ•ˆæœ */
    .sticky-header.is-sticky {
        border-radius: 0 0 4px 4px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        transform: translateY(0);
    }

    #periodButtons, #rateButtons, #principalButtons, #commissionButtons, #PaymentduringButtons {
        margin: 0;
        display: flex;
        flex-wrap: wrap;
        gap: 3px;
        width: 100%;
        justify-content: center;
        padding: 0 5px;
        box-sizing: border-box;
        min-height: 32px;
        align-items: center;
    }

    button {
        flex-shrink: 0;
    }

    /* æ–°çš„æŒ‰éˆ•çµ„æ¨£å¼ */
    .function-buttons {
        display: flex;
        flex-direction: column;
        gap: 4px;
        margin: 4px 0;
        padding: 0;  /* ç§»é™¤å·¦å³å…§é‚Šè· */
        width: 100%; /* ç¢ºä¿å¯¬åº¦èˆ‡å…¶ä»–æ¬„ä½ä¸€è‡´ */
    }

    .function-buttons .button-row {
        display: flex;
        justify-content: space-between;
        gap: 4px;  /* ç¸®å°æŒ‰éˆ•ä¹‹é–“çš„é–“è· */
        width: 100%;
    }

    /* èª¿æ•´é ‚éƒ¨æŒ‰éˆ•çµ„ */
    .top-buttons .button-row button {
        flex: 1;
        min-width: 0;
    }

    /* èª¿æ•´åº•éƒ¨æŒ‰éˆ•çµ„ */
    .bottom-buttons .button-row button {
        flex: 1;
        min-width: 0;
    }

    .function-buttons .top-row,
    .function-buttons .bottom-row {
        display: flex;
        justify-content: space-between;
        gap: 10px;
    }

    .function-buttons .top-row button {
        flex: 1;
        min-width: 0;
        margin: 0;  /* ç¢ºä¿æ²’æœ‰é¡å¤–çš„å¤–é‚Šè· */
    }

    .function-buttons .bottom-row button {
        flex: 1;
        min-width: 0;
        margin: 0;  /* ç¢ºä¿æ²’æœ‰é¡å¤–çš„å¤–é‚Šè· */
    }

    /* çµ±ä¸€æ‰€æœ‰åŠŸèƒ½æŒ‰éˆ•çš„åŸºç¤æ¨£å¼ */
    .function-buttons button {
        background-color: var(--secondary-color);
        color: #ffffff; /* ä½¿ç”¨ç™½è‰²æ–‡å­—è€Œéæ©™è‰² */
        border: 1px solid var(--button-orange);
        border-radius: 6px; /* çµ±ä¸€åœ“è§’ */
        padding: 8px 0;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        text-align: center;
        position: relative;
        overflow: hidden;
        flex: 1;  /* ç¢ºä¿æŒ‰éˆ•å¹³å‡åˆ†é…ç©ºé–“ */
        min-width: 0;  /* å…è¨±æŒ‰éˆ•è®Šçª„ */
        margin: 0;  /* ç§»é™¤æŒ‰éˆ•å¤–é‚Šè· */
    }

    .function-buttons button::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to right, rgba(255, 156, 51, 0.1), transparent);
        z-index: -1;
        transform: translateX(-100%);
        transition: transform 0.6s ease;
    }

    /* çµ±ä¸€æ‰€æœ‰æŒ‰éˆ•çš„æ‡¸åœæ•ˆæœ */
    .function-buttons button:hover {
        background-color: var(--button-orange);
        color: #ffffff;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .function-buttons button:hover::before {
        transform: translateX(0);
    }

    /* çµ±ä¸€æ‰€æœ‰æŒ‰éˆ•çš„é»æ“Šæ•ˆæœ */
    .function-buttons button:active {
        transform: translateY(1px);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        transition: all 0.1s;
    }

    /* ä¸»è¦æ“ä½œæŒ‰éˆ•æ¨£å¼ */
    /* ç§»é™¤main-action-btnç‰¹æ®Šæ¨£å¼ï¼Œä¿æŒçµ±ä¸€ */
    .function-buttons .main-action-btn {
        /* ç§»é™¤å·®ç•°åŒ–æ¨£å¼ï¼Œä¿æŒèˆ‡å…¶ä»–æŒ‰éˆ•ä¸€è‡´ */
        background-color: var(--secondary-color);
        color: #ffffff;
        padding: 8px 0;
        border: 1px solid var(--button-orange);
    }

    .function-buttons .main-action-btn::before {
        background: linear-gradient(to right, rgba(255, 255, 255, 0.05), transparent);  /* é™ä½æ¼¸è®Šäº®åº¦ */
    }

    .function-buttons .main-action-btn:hover {
        background-color: var(--button-orange);  /* æ‡¸åœæ™‚æ”¹ç‚ºæ©™è‰² */
        box-shadow: 0 7px 14px rgba(255, 156, 51, 0.4);
        transform: translateY(-3px);
    }

    .function-buttons .main-action-btn:active {
        transform: translateY(1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* åœ¨ style æ¨™ç±¤ä¸­ä¿®æ”¹æˆ–æ–°å¢ä»¥ä¸‹ CSS */
	.quote-table {
		width: 100%;
		border-collapse: separate;
		border-spacing: 0;
		margin: 10px 0;
		background: var(--primary-color);
		border-radius: 12px;
		overflow: hidden;
		box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
	}

	.quote-table tr {
		background: var(--secondary-color);
		transition: background-color 0.3s ease;
	}

	.quote-table tr:hover {
		background: var(--hover-color);
	}

	.quote-table td {
		padding: 10px 10px; /* å¢åŠ å…§é‚Šè· */
		border-bottom: 1px solid var(--border-color);
		color: var(--text-color);
		font-size: 16px; /* å¢åŠ å­—é«”å¤§å° */
		line-height: 1.2; /* å¢åŠ è¡Œé«˜ */
	}

	.quote-table td:first-child {
		width: 140px; /* å¢åŠ æ¨™ç±¤æ¬„å¯¬åº¦ */
		white-space: nowrap;
		color: var(--button-orange);
		font-weight: 700; /* åŠ ç²— */
		text-align: right;
		padding-right: 10px;
		font-size: 16px; /* æ¨™ç±¤æ–‡å­—æ›´å¤§ */
	}

	.quote-table td:last-child {
		text-align: right;
		font-family: monospace;
		font-size: 16px; /* æ•¸å€¼æ›´å¤§ */
		letter-spacing: 0px; /* å¢åŠ å­—è· */
	}

	/* æ–°å¢å®¹å™¨æ¨£å¼ */

	#quoteContainer {
		padding: 24px;
		background: #333333;
		border-radius: 16px;
		box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
		margin: 20px;
	}

    .function-buttons button::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: var(--button-orange);
        z-index: -1;
        border-radius: 6px;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .function-buttons button:hover::before {
        opacity: 0.2;
        animation: pulseGlow 1.5s infinite;
    }

    @keyframes pulseGlow {
        0% { transform: scale(1); opacity: 0.2; }
        50% { transform: scale(1.05); opacity: 0.3; }
        100% { transform: scale(1); opacity: 0.2; }
    }
    
	.function-buttons button::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        transform: translate(-50%, -50%) scale(0);
        border-radius: 50%;
        transition: transform 0.5s;
    }

	.function-buttons button:hover {
		background-color: var(--button-orange);
		color: var(--text-color);
		border-color: var(--button-orange);
	}
	.function-buttons button:hover::after {
        transform: translate(-50%, -50%) scale(2);
    }

	.function-buttons button:active {
		background-color: var(--secondary-color);
		color: var(--button-orange);
		border-color: var(--button-orange);
	}
	.footer-message {
		background-color: #333333;
		color: var(--text-color);
		padding: 15px;
		text-align: center;
		margin-top: 15px;
		border-radius: 4px;
		transform: scale(1.05);
        text-shadow: 0 0 10px var(--button-orange);
		transition: all 0.3s ease;
    	position: relative;
	}

	.footer-spacing {
		background-color: #333333;
		height: 50px;
		margin-top: 0px;
	}

	.footer-message::before {
		content: 'ğŸš';
		margin-right: 8px;
		display: inline-block;
		transition: transform 0.3s ease;
	}

	.footer-message:hover::before {
		transform: rotate(360deg);
	}

	@keyframes glowBorder {
		0%, 100% { box-shadow: 0 0 5px var(--button-orange); }
		50% { box-shadow: 0 0 15px var(--button-orange), 0 0 30px rgba(255, 156, 51, 0.3); }
    }
	.warning-text {
		color: #ff0000 !important;
		font-weight: bold !important;
		animation: pulse 1s infinite, shake 0.5s ease-in-out; 
        will-change: transform; 
	}

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-1px); }
        40%, 80% { transform: translateX(1px); }
    }


    /* 1. æµå…‰åˆ†éš”ç·š */
    .divider-flow {
            position: relative;
            height: 2px;
            background: linear-gradient(90deg, 
                var(--secondary-color) 0%,
                var(--button-orange) 50%,
                var(--secondary-color) 100%);
            margin: 4px 0;
            overflow: hidden;
        }

        .divider-flow::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent,
                rgba(255, 156, 51, 0.8),
                transparent);
            animation: flowLight 3s ease-in-out infinite;
        }

        @keyframes flowLight {
            0% { transform: translateX(0); }
            100% { transform: translateX(200%); }
        }

    /* åˆ†éš”ç·šæ·¡å…¥å‹•ç•« */
    @keyframes dividerFadeIn {
        from {
            opacity: 0;
            transform: scaleX(0.8);
        }
        to {
            opacity: 1;
            transform: scaleX(1);
        }
    }

    /* ç™¼å…‰æ•ˆæœå‹•ç•« */
    @keyframes dividerGlow {
        0% {
            left: -100%;
        }
        50% {
            left: 100%;
        }
        100% {
            left: 100%;
        }
    }

    /* å¼·èª¿é‡è¦æ¬„ä½ */
    .emphasized-row {
        border-left: 3px solid var(--button-orange);
        background: linear-gradient(90deg, rgba(255, 156, 51, 0.1), transparent);
        transform: scale(1.01);
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .emphasized-row .label {
        color: var(--button-orange);
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .emphasized-row input {
        font-weight: bold;
        color: #ffffff;
        font-size: 17px;
        border-color: var(--button-orange);
    }

    .emphasized-row:hover {
        transform: scale(1.02) translateX(5px);
        box-shadow: 0 7px 20px rgba(0, 0, 0, 0.25);
    }

    /* æ­·å²è¨˜éŒ„é¢æ¿æ¨£å¼ */
    /* é‡æ–°è®¾è®¡å†å²è®°å½•é¢æ¿æ ·å¼ */
    .history-panel {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95); /* æ·±è‰²èƒŒæ™¯å¢åŠ å¯¹æ¯”åº¦ */
        z-index: 1000;
        overflow-y: auto;
        animation: fadeIn 0.3s ease-out;
    }

    .history-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background-color: var(--primary-color);
        position: sticky;
        top: 0;
        z-index: 1001;
        border-bottom: 2px solid var(--button-orange);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    .header-left {
        flex: 1;
    }

    .header-right {
        margin-right: 10px;
    }

    .history-header h2 {
        margin: 0;
        color: var(--button-orange);
        font-size: 20px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .close-btn {
        background: none;
        border: none;
        color: var(--text-color);
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 5px 10px;
        border-radius: 50%;
        margin-left: 10px;
        background-color: rgba(255, 255, 255, 0.1);
    }

    .close-btn:hover {
        color: var(--button-orange);
        transform: scale(1.1);
        background-color: rgba(255, 255, 255, 0.2);
    }

    .history-content {
        padding: 8px; /* å¾ 10px æ¸›å°‘åˆ° 8px */
        max-width: 400px;
        margin: 0 auto;
    }

    /* æ”¹è¿›å†å²è®°å½•åˆ—è¡¨ */
    .history-list {
        display: flex;
        flex-direction: column;
        gap: 10px; /* å¾ 12px æ¸›å°‘åˆ° 10px */
        padding: 3px; /* å¾ 5px æ¸›å°‘åˆ° 3px */
        margin-bottom: 10px; /* å¢åŠ åº•éƒ¨é–“è· */
    }

    /* é‡æ–°è®¾è®¡å†å²é¡¹ç›®å¡ç‰‡ */
    /* ä½ç½®: .history-item æ¨£å¼ (ç´„åœ¨ CSS ç¬¬ 1010 è¡Œé™„è¿‘) */
    .history-item {
        background-color: var(--secondary-color);
        padding: 8px; /* å¾ 12px æ¸›å°‘åˆ° 8px */
        border-radius: 8px; /* å¾ 10px æ¸›å°‘åˆ° 8px */
        position: relative;
        transition: all 0.3s ease;
        border-left: 3px solid var(--button-orange);
        display: flex;
        flex-direction: column;
        gap: 6px; /* å¾ 8px æ¸›å°‘åˆ° 6px */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* ç¨å¾®é™ä½é™°å½± */
        margin-bottom: 10px; /* å¢åŠ å¡ç‰‡é–“çš„é–“è· */
    }

    .history-item:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    }

    /* å†å²è®°å½•é¡¶éƒ¨åŒºåŸŸ - æ—¥æœŸå’ŒæŒ‰é’® */
    /* ä¿®æ”¹å†å²è®°å½•å¡ç‰‡å¤´éƒ¨å¸ƒå±€æ ·å¼ */
    .history-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding-bottom: 2px; /* å¢åŠ åº•éƒ¨ä¸€é»é–“è· */
    }

    .history-date {
        font-weight: bold;
        color: var(--button-orange);
        font-size: 14px; /* å¾ 15px æ¸›å°‘åˆ° 14px */
        padding: 2px 0; /* å¾ 3px æ¸›å°‘åˆ° 2px */
    }

    /* å°†ç¨ä½£ååˆ©ç‡ç§»åˆ°å¤´éƒ¨å³ä¾§ */
    .history-header-rate {
        font-weight: bold;
        color: #ffffff;
        font-size: 16px; /* å¾ 16px æ¸›å°‘åˆ° 14px */
        background-color: rgba(255, 156, 51, 0.2);
        padding: 2px 6px; /* å¾ 3px 8px æ”¹ç‚º 2px 6px */
        border-radius: 4px;
    }


    /* å†å²è¯¦æƒ…å±•ç¤ºåŒº */
    .history-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 6px; /* å¾ 10px æ¸›å°‘åˆ° 6px */
        background-color: rgba(0, 0, 0, 0.15);
        padding: 6px; /* å¾ 10px æ¸›å°‘åˆ° 6px */
        border-radius: 4px; /* å¾ 6px æ¸›å°‘åˆ° 4px */
    }

    .history-detail-item {
        display: flex;
        flex-direction: column;
        gap: 1px; /* å¾ 3px æ¸›å°‘åˆ° 1px */
    }

    .detail-label {
        font-size: 12px; /* å¾ 13px æ¸›å°‘åˆ° 12px */
        color: #aaaaaa;
    }

    /* å¢å¤§å­—ä½“å¤§å° */
    .detail-value {
        font-size: 18px; /* å¾ 18px æ¸›å°‘åˆ° 16px */
        font-weight: bold;
        color: #ffffff;
        line-height: 1.2; /* æ·»åŠ è¡Œé«˜æ§åˆ¶ */
    }

    /* é€‚é…ç§»åŠ¨è®¾å¤‡ */
    @media screen and (max-width: 360px) {
        .history-item {
            padding: 6px;
            gap: 4px;
        }
        
        .history-header-rate {
            font-size: 13px;
            padding: 2px 5px;
        }
        
        .history-date {
            font-size: 13px;
        }
        
        .detail-value {
            font-size: 15px;
        }
        
        .history-details {
            padding: 5px;
            gap: 5px;
        }
        
        .delete-btn, .detail-btn {
            padding: 5px 10px;
            font-size: 12px;
            min-width: 65px;
        }
    }


    /* æŒ‰é’®åŒºåŸŸ */
    .history-actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px; /* å¾ 10px æ¸›å°‘åˆ° 8px */
        margin-top: 3px; /* å¾ 5px æ¸›å°‘åˆ° 3px */
    }

    .delete-btn, .detail-btn {
        padding: 6px 12px; /* å¾ 8px 15px æ”¹ç‚º 6px 12px */
        border-radius: 4px; /* å¾ 6px æ¸›å°‘åˆ° 4px */
        font-size: 13px; /* å¾ 14px æ¸›å°‘åˆ° 13px */
        font-weight: bold;
        transition: all 0.25s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        min-width: 70px; /* å¢åŠ æœ€å°å¯¬åº¦ç¢ºä¿å¯é»æ“Šå€åŸŸ */
    }

    .delete-btn {
        background-color: rgba(231, 76, 60, 0.25); /* å¢åŠ èƒŒæ™¯ä¸é€æ˜åº¦ */
        color: #ffffff; /* æ”¹ç‚ºç™½è‰²æ–‡å­— */
        border: 1px solid rgba(231, 76, 60, 0.5); /* å¢åŠ é‚Šæ¡† */
    }

    .delete-btn:hover {
        background-color: #e74c3c;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 3px 5px rgba(231, 76, 60, 0.4);
    }

    .delete-btn:active {
        transform: translateY(1px);
    }

    .detail-btn {
        background-color: rgba(51, 181, 229, 0.25); /* å¢åŠ èƒŒæ™¯ä¸é€æ˜åº¦ */
        color: #ffffff; /* æ”¹ç‚ºç™½è‰²æ–‡å­— */
        border: 1px solid rgba(51, 181, 229, 0.5); /* å¢åŠ é‚Šæ¡† */
    }

    .detail-btn:hover {
        background-color: var(--button-blue);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 3px 5px rgba(51, 181, 229, 0.4);
    }

    .detail-btn:active {
        transform: translateY(1px);
    }

    .no-data {
        text-align: center;
        color: #cccccc;
        font-style: italic;
        padding: 30px 0;
        font-size: 16px;
    }

    /* å…¨éƒ¨åˆ é™¤æŒ‰é’®æ”¹è¿› */
    .delete-all-btn {
        background: rgba(231, 76, 60, 0.15);
        border: 1px solid #e74c3c;
        color: #e74c3c;
        font-size: 14px;
        padding: 6px 14px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
    }

    .delete-all-btn:hover {
        background-color: #e74c3c;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 3px 5px rgba(231, 76, 60, 0.4);
    }

    .delete-all-btn:active {
        transform: translateY(1px);
        box-shadow: none;
    }

    /* æ¨¡æ…‹æ¡†æ¨£å¼ */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        animation: fadeIn 0.3s ease-out;
    }

    .modal-container {
        background-color: var(--primary-color);
        border-radius: 10px;
        width: 90%;
        max-width: 350px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        animation: modalSlideIn 0.3s ease-out;
        overflow: hidden;
    }

    @keyframes modalSlideIn {
        from { opacity: 0; transform: translateY(-30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
        background-color: var(--secondary-color);
    }

    .modal-header h3 {
        margin: 0;
        color: var(--button-orange);
        font-size: 18px;
    }

    .modal-content {
        padding: 20px 15px;
        color: var(--text-color);
        max-height: 70vh;
        overflow-y: auto;
    }

    .modal-footer {
        padding: 10px 15px 15px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        border-top: 1px solid var(--border-color);
        background-color: var(--secondary-color);
    }

    .modal-btn {
        padding: 8px 15px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 15px;
        transition: all 0.3s ease;
        border: none;
    }

    .modal-btn-primary {
        background-color: var(--button-orange);
        color: white;
    }

    .modal-btn-primary:hover {
        background-color: #e88a22;
        transform: translateY(-2px);
    }

    .modal-btn-secondary {
        background-color: var(--secondary-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
    }

    .modal-btn-secondary:hover {
        background-color: var(--hover-color);
        transform: translateY(-2px);
    }

    /* æç¤ºæ¡†æ¨£å¼ */
    .toast-message {
        position: fixed;
        bottom: 60px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(51, 181, 229, 0.9);
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 9999;
        font-weight: bold;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        opacity: 1;
        transition: opacity 0.5s ease;
    }

    /* è®“ã€Œç¨…ä½£å¾Œåˆ©ç‡ã€è¼¸å…¥æ¡†æ›´æ˜é¡¯ä½†ä¸çªå…€ */
    #afterCommissionRate {
        font-weight: bold;
        color: #ffffff;
        background-color: rgba(255, 156, 51, 0.08); /* æ›´æ·¡çš„æ©˜è‰²èƒŒæ™¯ */
        border: 1px solid rgba(255, 156, 51, 0.6); /* åŠé€æ˜æ©˜è‰²é‚Šæ¡† */
        box-shadow: 0 0 4px rgba(255, 156, 51, 0.15); /* å¾®å¼±çš„ç™¼å…‰æ•ˆæœ */
    }

    #afterCommissionRate.value-changed {
        animation: afterRateChange 0.8s ease-out;
    }

    @keyframes afterRateChange {
        0% { 
            background-color: rgba(255, 156, 51, 0.3);
            transform: scale(1.02);
        }
        100% { 
            background-color: rgba(255, 156, 51, 0.08);
            transform: scale(1);
        }
    }

    /* Number Input Modal */
    .number-input-modal {
        background-color: var(--primary-color);
        border-radius: 12px;
        width: 95%;
        max-width: 350px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        animation: modalSlideIn 0.3s ease-out;
    }

    .calculator-display {
        background-color: #222222;
        color: var(--text-color);
        font-size: 32px;
        padding: 10px 15px;
        text-align: right;
        margin: 10px;
        border-radius: 6px;
        border: 1px solid var(--border-color);
        height: 46px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        overflow: hidden;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .calculator-buttons {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(5, auto);
        gap: 6px;
        padding: 10px;
    }

    .calculator-buttons button {
        padding: 10px 0;
        font-size: 20px;
        border-radius: 10px;
        background-color: #3a3a3a;
        color: var(--text-color);
        border: none;
        transition: all 0.2s ease;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 48px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: hidden;
    }

    .calculator-buttons button:hover {
        background-color: #464646;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .calculator-buttons button:active {
        transform: scale(0.95);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    /* æŒ‰éˆ•æŒ‰ä¸‹å¾Œç”¢ç”Ÿæ³¢ç´‹æ•ˆæœ */
    .calculator-buttons button::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%, -50%);
        transform-origin: 50% 50%;
    }

    .calculator-buttons button:active::after {
        animation: ripple 0.4s ease-out;
    }

    @keyframes ripple {
        0% {
            transform: scale(0, 0) translate(-50%, -50%);
            opacity: 0.5;
        }
        100% {
            transform: scale(20, 20) translate(-50%, -50%);
            opacity: 0;
        }
    }

    /* åŠŸèƒ½éµæ¨£å¼ */
    .calculator-buttons .function {
        background-color: #4d4d4d;
        color: #eee;
        font-weight: bold;
    }

    /* é‹ç®—ç¬¦è™Ÿæ¨£å¼ */
    .calculator-buttons .operator {
        background-color: rgba(255, 156, 51, 0.9);
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(255, 156, 51, 0.4);
    }

    /* æ¸…é™¤éµæ¨£å¼ */
    .calculator-buttons .clear {
        background-color: rgba(231, 76, 60, 0.9);
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(231, 76, 60, 0.4);
    }

    /* ç­‰è™Ÿéµæ¨£å¼ */
    .calculator-buttons .equals {
        background-color: rgba(52, 152, 219, 0.9);
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(52, 152, 219, 0.4);
    }

    /* é›¶éµä½”æ“šå…©æ¬„ */
    .calculator-buttons .zero {
        grid-column: span 2;
        background-color: #3a3a3a;
    }

    /* æäº¤æŒ‰éˆ•ä½”æ“šå…©æ¬„ */
    .calculator-buttons .submit {
        grid-column: span 2;
        background-color: var(--button-orange);
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(255, 156, 51, 0.4);
    }

    .toast-error {
        background-color: rgba(231, 76, 60, 0.9);
    }

    .toggle-view-btn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background-color: var(--secondary-color);
        color: var(--button-orange);
        border: 1px solid var(--button-orange);
        border-radius: 50%;
        width: 24px;         /* ç¸®å°æŒ‰éˆ•å°ºå¯¸ */
        height: 24px;        /* ç¸®å°æŒ‰éˆ•å°ºå¯¸ */
        font-size: 12px;     /* ç¸®å°åœ–æ¨™å¤§å° */
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        overflow: hidden;    /* ç¢ºä¿æ•ˆæœåœ¨æŒ‰éˆ•å…§éƒ¨ */
    }

    .toggle-view-btn:hover {
        background-color: rgba(255, 156, 51, 0.2);
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
    }

    .toggle-view-btn:active {
        transform: translateY(-50%) scale(0.95);
    }

    /* æ·»åŠ æŒ‰éˆ•æ³¢ç´‹å‹•ç•«æ•ˆæœ */
    .toggle-view-btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, rgba(255, 156, 51, 0.6) 0%, rgba(255, 156, 51, 0) 70%);
        opacity: 0;
        transform: translate(-50%, -50%) scale(0);
        border-radius: 50%;
        transition: transform 0.5s ease, opacity 0.5s ease;
    }

    .toggle-view-btn:hover::after {
        opacity: 0.3;
        transform: translate(-50%, -50%) scale(1.5);
    }

    /* æ·»åŠ ç®­é ­æ—‹è½‰å‹•ç•« */
    #toggleIcon {
        display: inline-block;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #toggleIcon.icon-rotate-up {
        transform: rotate(180deg);
    }

    .icon-rotate-up {
        transform: rotate(180deg);
    }

    /* ç”¨æ–¼éš±è—å…ƒç´ çš„é¡ */
    .hidden-element {
        display: none !important;
    }

    /* æ·»åŠ åœ¨ç¾æœ‰ CSS ä¸­ */
    .input-button-group {
        transition: all 0.3s ease-in-out;
        overflow: hidden;
    }

    .input-button-group div[id$="Buttons"] {
        transition: all 0.3s ease-in-out, max-height 0.3s ease-in-out;
        max-height: 100px; /* é è¨­æœ€å¤§é«˜åº¦ */
        opacity: 1;
    }

    .input-button-group div[id$="Buttons"].hidden-element {
        max-height: 0;
        opacity: 0;
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    .hidden-element {
        max-height: 0 !important;
        opacity: 0 !important;
        padding: 0 !important;
        margin: 0 !important;
        transition: all 0.3s ease-in-out;
        overflow: hidden !important;
    }

    /* æ·»åŠ ç¸®æ”¾å’Œæ·¡å…¥æ·¡å‡ºæ•ˆæœ */
    @keyframes smoothFadeIn {
        from {
            opacity: 0;
            transform: scaleY(0.8);
        }
        to {
            opacity: 1;
            transform: scaleY(1);
        }
    }

    @keyframes smoothFadeOut {
        from {
            opacity: 1;
            transform: scaleY(1);
        }
        to {
            opacity: 0;
            transform: scaleY(0.8);
        }
    }

    .history-note-container {
        background-color: rgba(0, 0, 0, 0.1);
        border-radius: 4px;
        margin: 6px 0;
        padding: 6px;
    }

    .history-item-footer {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .history-note-preview {
        color: #bcbcbc;
        font-size: 14px;
        min-height: 20px;
        padding: 4px;
        border: 1px solid transparent;
        transition: all 0.3s ease;
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex-grow: 1;
        max-width: 170px; /* ç¸®å°å¯¬åº¦ */
    }

    .history-actions {
        display: flex;
        gap: 4px;
        margin-left: auto; /* å°‡æŒ‰éˆ•æ¨åˆ°å³å´ */
    }

    .history-note-preview:hover {
        background-color: rgba(255, 156, 51, 0.1);
        border-color: rgba(255, 156, 51, 0.3);
    }

    .note-editor-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        justify-content: center;  /* æ°´å¹³ç½®ä¸­ */
        align-items: flex-start;  /* å‚ç›´å¾é ‚éƒ¨é–‹å§‹ï¼Œä½†ä¸æ˜¯é ‚éƒ¨å°é½Š */
        padding-top: 160px;  /* å¢åŠ é ‚éƒ¨é–“è·ï¼Œé¿å…å¤ªè²¼è¿‘é ‚éƒ¨ */
    }

    .note-editor-content {
        background-color: var(--primary-color);
        border-radius: 12px;
        width: 80%;  /* æ”¹ç‚º80%å¯¬åº¦ */
        max-width: 320px;  /* æ¸›å°æœ€å¤§å¯¬åº¦ */
        padding: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        border: 1px solid var(--button-orange);
        animation: slideDown 0.3s ease-out;
        margin: 0 auto;  /* ç¢ºä¿æ°´å¹³ç½®ä¸­ */
    }

    @keyframes slideDown {
        from { transform: translateY(-20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .note-editor-input {
        width: calc(100% - 24px);  /* æ¸›å»paddingå¯¬åº¦ï¼Œé¿å…æº¢å‡º */
        padding: 12px;
        margin: 12px 0;
        background-color: #222222;
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        min-height: 100px;
        resize: none;
        font-size: 16px;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        box-sizing: border-box;  /* ç¢ºä¿å¯¬åº¦è¨ˆç®—åŒ…å«padding */
    }

    .note-editor-input:focus {
        border-color: var(--button-orange);
        box-shadow: 0 0 0 2px rgba(255, 156, 51, 0.2);
        outline: none;
    }

    .note-editor-buttons {
        display: flex;
        justify-content: flex-end;  /* æŒ‰éˆ•é å³å°é½Š */
        gap: 8px;  /* æ¸›å°‘æŒ‰éˆ•é–“éš™ */
        margin-top: 8px;
    }

    .note-editor-content h3 {
        color: var(--button-orange);
        font-size: 18px;
        margin: 0 0 8px 0;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(255, 156, 51, 0.3);
    }

</style>

</head>
<body>

	<div style="text-align: center; position: relative;">
        <h1>å°æœ‹å‹å°ˆç”¨è¨ˆç®—æ©Ÿ</h1>
        <button id="toggleViewBtn" class="toggle-view-btn">
            <span id="toggleIcon">â–¼</span>
        </button>
    </div>
	
    <div class="time-display-wrapper">
        <div id="timeDisplay" class="sticky-header">
            <div style="display: flex; justify-content: center; width: 100%;">
                <span class="time-label">å ±åƒ¹æ™‚é–“ï¼š</span>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>
    
    <div class="input-button-group">
        <div class="row">
            <span class="label">æœŸæ•¸</span>
            <input type="text" id="period" step="0.1" readonly>
            <button onclick="calculatePeriod()">ç®—</button>
            <button onclick="clearField('period')">æ¸…</button>
        </div>
    
        <div id="periodButtons">
            <button onclick="adjustPeriod(-1)">-1</button>
            <button onclick="setPeriod(13)">åº•</button>
            <button onclick="setPeriod(24)">2</button>
            <button onclick="setPeriod(36)">3</button>
            <button onclick="setPeriod(48)">4</button>
            <button onclick="setPeriod(60)">5</button>
            <button onclick="setPeriod(72)">6</button>
            <button onclick="adjustPeriod(1)">+1</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row">
            <span class="label">ç¨…å‰åˆ©ç‡</span>
            <input type="text" id="rate" step="0.001" readonly>
            <button onclick="calculateRate()">ç®—</button>
            <button onclick="clearField('rate')">æ¸…</button>
        </div>

        <div id="rateButtons">
            <button onclick="adjustRate(-0.2)">-0.2</button>
            <button onclick="setRate(4)">4</button>
            <button onclick="setRate(6)">6</button>
            <button onclick="setRate(8)">8</button>
            <button onclick="setRate(10)">10</button>
            <button onclick="setRate(13)">13</button>
            <button onclick="adjustRate(0.2)">+0.2</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row">
            <span class="label">æœ¬é‡‘</span>
            <input type="text" id="principal" min="0" readonly>
            <button onclick="calculatePrincipal()">ç®—</button>
            <button onclick="clearField('principal')">æ¸…</button>
        </div>

        <div id="principalButtons">
            <button onclick="adjustPrincipal(-1000000)">-100</button>
            <button onclick="adjustPrincipal(-100000)">-10</button>
            <button onclick="adjustPrincipal(-10000)">-1</button>
            <button onclick="adjustPrincipal(10000)">+1</button>
            <button onclick="adjustPrincipal(100000)">+10</button>
            <button onclick="adjustPrincipal(1000000)">+100</button>
        </div>
    </div>

    <div class="input-button-group">
        <div class="row">
            <span class="label">æœŸç¹³</span>
            <input type="text" id="payment" step="0.01" readonly>
            <button onclick="calculatePayment()">ç®—</button>
            <button onclick="clearField('payment')">æ¸…</button>
        </div>

        <div id="PaymentduringButtons">
            <button onclick="adjustPayment(-100)">-100</button>
            <button onclick="adjustPayment(-50)">-50</button>
            <button onclick="roundPayment('down', 100)">æ¨ç™¾</button>
            <button onclick="roundPayment('up', 100)">é€²ç™¾</button>
            <button onclick="adjustPayment(50)">+50</button>
            <button onclick="adjustPayment(100)">+100</button>
        </div>
    </div>

	<div class="row">
        <span class="label">ç¸½åˆ©æ¯</span>
        <input type="text" id="totalInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ç¨…é‡‘</span>
        <input type="text" id="tax" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ç¨…å¾Œåˆ©ç‡</span>
        <input type="text" id="afterTaxRate" step="0.001" class="readonly" readonly>
    </div>

    <div class="input-button-group">
        <div class="row">
            <span class="label">æ¨å»£</span>
            <input type="text" id="commission" min="0" step="1" readonly>
            <button onclick="calculateAfterCommissionRate()">ç®—</button>
            <button onclick="clearCommission()">æ¸…</button>
        </div>

        <div id="commissionButtons">
            <button onclick="adjustCommission(-10000)">-è¬</button>
            <button onclick="adjustCommission(-1000)">-åƒ</button>
            <button onclick="adjustCommission(-100)">-ç™¾</button>
            <button onclick="adjustCommission(100)">+ç™¾</button>
            <button onclick="adjustCommission(1000)">+åƒ</button>
            <button onclick="adjustCommission(10000)">+è¬</button>
        </div>
    </div>

    <div class="row">
        <span class="label">æ¨å»£æ¯”ä¾‹</span>
        <input type="text" id="commissionRatio" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ç¨…ä½£å¾Œåˆ©ç‡</span>
        <input type="text" id="afterCommissionRate" class="readonly" readonly>
    </div>

    <div class="divider-flow"></div>

    <div class="row">
        <span class="label">ç™¾è¬æ¯å¹´åˆ©æ¯</span>
        <input type="text" id="annualMillionInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ç™¾è¬æ¯æœˆåˆ©æ¯</span>
        <input type="text" id="monthlyMillionInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ä¸€è¬æ¯å¹´åˆ©æ¯</span>
        <input type="text" id="annualTenThousandInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ä¸€è¬æ¯æœˆåˆ©æ¯</span>
        <input type="text" id="monthlyTenThousandInterest" class="readonly" readonly>
    </div>

    <div class="divider-flow"></div>

    <div class="row">
        <span class="label">æœ¬æœˆè³‡é‡‘æˆæœ¬</span>
        <input type="text" id="monthlyCost" value="2.1106" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">Spread</span>
        <input type="text" id="spread" class="readonly" readonly>
    </div>
	
    <div class="row">
        <span class="label">NPV</span>
        <input type="text" id="fundingCost" class="readonly" readonly>
        <span style="margin-left: 0px; color: var(--text-color);">ä¿®æ­£ä¸­</span>
    </div>

	<!-- æŒ‰éˆ•å€åŸŸé‡æ–°çµ„ç¹” -->
    <div class="divider-flow"></div>

    <div class="function-buttons top-buttons">
        <div class="button-row">
            <button onclick="saveLoanData()" >ä¿å­˜è¨ˆç®—</button>
            <button onclick="toggleHistoryPanel()" >æ­·å²è¨˜éŒ„</button>
        </div>
    </div>

    <div class="divider-flow"></div>

    <div class="function-buttons bottom-buttons">
        <div class="button-row">
            <button onclick="window.open('https://travel.chiayi.gov.tw/Folder/TurkeyRice', '_blank')">é›è‚‰é£¯</button>
            <button onclick="clearAllFieldsExceptMonthlyCost()">æ¸…é™¤</button>
            <button onclick="generateQuote()">æˆªåœ–</button>
        </div>
    </div>

    <div class="footer-message">å ±åƒ¹å¾Œè¨˜å¾—åƒç¢—ç«é›è‚‰é£¯å”·ï¼</div>

    <div class="divider-flow"></div>

    <!-- æ·»åŠ æ­·å²è¨˜éŒ„é¢æ¿ -->
    <!-- é‡æ–°è®¾è®¡çš„å†å²è®°å½•é¢æ¿ -->
    <div id="historyPanel" class="history-panel">
        <div class="history-header">
            <div class="header-left">
                <h2>è²¸æ¬¾è¨ˆç®—æ­·å²è¨˜éŒ„</h2>
            </div>
            <div class="header-right">
                <button class="delete-all-btn" onclick="confirmDeleteAll()">å…¨éƒ¨åˆªé™¤</button>
            </div>
            <button class="close-btn" onclick="toggleHistoryPanel()">Ã—</button>
        </div>
        <div id="historyContent" class="history-content"></div>
    </div>

    <!-- æ™®é€šæç¤ºæ¨¡æ…‹æ¡† -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle">æç¤º</h3>
                <button class="close-btn" onclick="hideModal()">Ã—</button>
            </div>
            <div id="modalContent" class="modal-content"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="hideModal()">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <!-- ç¢ºèªæ¨¡æ…‹æ¡† -->
    <div id="confirmModalOverlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="confirmModalTitle">ç¢ºèª</h3>
                <button class="close-btn" onclick="hideConfirmModal()">Ã—</button>
            </div>
            <div id="confirmModalContent" class="modal-content"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="hideConfirmModal()">å–æ¶ˆ</button>
                <button id="confirmModalOk" class="modal-btn modal-btn-primary">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <div class="footer-spacing"></div>

<script>

    window.onload = function() {
        // åƒ…åˆå§‹åŒ–æ™‚é–“é¡¯ç¤º
        updateTime();
    }

    // ç²å–è£ç½®é¡å‹
    function getDeviceType() {
        const ua = navigator.userAgent;
        if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) {
            return "tablet";
        }
        if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(ua)) {
            return "mobile";
        }
        return "desktop";
    }

    // ç²å–ç€è¦½å™¨è³‡è¨Š
    function getBrowserInfo() {
        const ua = navigator.userAgent;
        let browser = "Unknown";
        if (ua.indexOf("Chrome") > -1) browser = "Chrome";
        else if (ua.indexOf("Safari") > -1) browser = "Safari";
        else if (ua.indexOf("Firefox") > -1) browser = "Firefox";
        else if (ua.indexOf("Edge") > -1) browser = "Edge";
        else if (ua.indexOf("Opera") > -1) browser = "Opera";
        else if (ua.indexOf("MSIE") > -1 || ua.indexOf("Trident/") > -1) browser = "Internet Explorer";
        
        return `${browser} ${navigator.platform}`;
    }

	// æ·»åŠ éœ‡å‹•å‡½æ•¸
	function vibrate() {
		if (navigator.vibrate) {
		navigator.vibrate(30); // éœ‡å‹•30æ¯«ç§’
		}
	}

    // æ·»åŠ é€™å€‹æ–°å‡½æ•¸åˆ°ç¬¬ä¸€å€‹ script æ¨™ç±¤å…§ï¼ŒupdateTime å‡½æ•¸ä¹‹å‰
    function calculateNPV(payment, period, principal, monthlyCost) {
        try {
        // æª¢æŸ¥è¼¸å…¥å€¼æ˜¯å¦æœ‰æ•ˆ
        if (!payment || !period || !principal || !monthlyCost || 
            isNaN(payment) || isNaN(period) || isNaN(principal) || isNaN(monthlyCost)) {
            return 0;
        }

        // å°‡å¹´åˆ©ç‡è½‰æ›ç‚ºæœˆåˆ©ç‡
        const monthlyRate = monthlyCost / 100 / 12;

        // è¨ˆç®—æœŸæœ›ç¾å€¼ï¼ˆä½¿ç”¨æœŸç¹³é‡‘é¡å’ŒæœŸæ•¸åæ¨ï¼‰
        const expectedPresentValue = payment * (1 - Math.pow(1 + monthlyRate, -period)) / monthlyRate;

        // è¨ˆç®—èˆ‡å¯¦éš›æœ¬é‡‘çš„å·®é¡
        return Math.round(expectedPresentValue - principal);
        } catch (error) {
        console.error('NPV è¨ˆç®—éŒ¯èª¤:', error);
        return 0;
        }
    }

    // æ·»åŠ æ›´æ–°æ™‚é–“çš„å‡½æ•¸
    function updateTime() {
        const now = new Date();
        const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        
        // èª¿æ•´ç‚ºå°åŒ—æ™‚é–“ (GMT+8)
        const taipeiTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
        
        const year = taipeiTime.getUTCFullYear();
        const month = String(taipeiTime.getUTCMonth() + 1).padStart(2, '0');
        const date = String(taipeiTime.getUTCDate()).padStart(2, '0');
        const day = days[taipeiTime.getUTCDay()];
        const hours = String(taipeiTime.getUTCHours()).padStart(2, '0');
        const minutes = String(taipeiTime.getUTCMinutes()).padStart(2, '0');
        const seconds = String(taipeiTime.getUTCSeconds()).padStart(2, '0');
        
        const timeString = `${year}å¹´${month}æœˆ${date}æ—¥
            æ˜ŸæœŸ${day} ${hours}:${minutes}:${seconds}`;
        document.getElementById('currentTime').textContent = timeString;
    }

    // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ™‚é–“
    setInterval(updateTime, 1000);
    updateTime(); // åˆå§‹åŒ–é¡¯ç¤º

    // åŸå§‹çš„JavaScriptå‡½æ•¸ä¿æŒä¸è®Š
    function PMT(rate, nper, pv) {
        rate = rate / 100 / 12;
        return (pv * rate * Math.pow(1 + rate, nper)) / (Math.pow(1 + rate, nper) - 1);
    }
        
    function RATE(nper, pmt, pv) {
        let rate = 0.1;
        let step = 0.05;
        let tolerance = 0.0001;
        let maxIterations = 100;
        let iteration = 0;

        while (iteration < maxIterations) {
            let monthlyRate = rate / 12;
            let calculated = pv * monthlyRate * Math.pow(1 + monthlyRate, nper) / 
                            (Math.pow(1 + monthlyRate, nper) - 1);
            
            if (Math.abs(calculated - pmt) < tolerance) {
                return rate * 100;
            }

            if (calculated > pmt) {
                rate -= step;
            } else {
                rate += step;
            }
            
            step *= 0.5;
            iteration++;
        }
        
        return rate * 100;
    }

    function calculatePeriod() {
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, ''));
        
        // TODO: Implement period calculation
        updateAllFields();
    }

    function calculateRate() {
        const period = parseFloat(document.getElementById('period').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, ''));
        
        const rate = RATE(period, payment, principal);
        document.getElementById('rate').value = rate.toFixed(4);
        
        updateAllFields();
    }

    function calculatePrincipal() {
        const period = parseFloat(document.getElementById('period').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, ''));
        
        // TODO: Implement principal calculation
        updateAllFields();
    }

    function calculatePayment() {
        const period = parseFloat(document.getElementById('period').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        
        // ç¢ºä¿æ‰€æœ‰å¿…è¦è¼¸å…¥éƒ½æœ‰æ•ˆ
        if (isNaN(period) || isNaN(rate) || isNaN(principal) || period <= 0 || rate <= 0 || principal <= 0) {
            // ç¼ºå°‘å¿…è¦è¼¸å…¥ï¼Œä¸é€²è¡Œè¨ˆç®—
            return;
        }
        
        const payment = PMT(rate, period, principal);
        // ä¿®æ”¹ï¼šå°‡çµæœå››æ¨äº”å…¥ç‚ºæ•´æ•¸ä¸¦æ ¼å¼åŒ–
        document.getElementById('payment').value = formatNumberWithCommas(Math.round(payment));
        
        updateAllFields();
    }


    function updateAllFields() {
        // ç²å–åŸºæœ¬å€¼ - éœ€è¦å…ˆç§»é™¤åƒä½åˆ†éš”ç¬¦å†è½‰æ›ç‚ºæ•¸å­—
        const period = parseFloat(document.getElementById('period').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, '')) || 0;
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, '')) || 0;
        const monthlyCost = parseFloat(document.getElementById('monthlyCost').value);

        // æœŸæ•¸æª¢æŸ¥
        const periodInput = document.getElementById('period');
        if (period <= 12) {
            periodInput.classList.add('warning-text');
        } else {
            periodInput.classList.remove('warning-text');
        }

        // æª¢æŸ¥å››å€‹åŸºæœ¬è¼¸å…¥æ¡†æ˜¯å¦éƒ½æœ‰å€¼
        const hasAllRequiredValues = period && rate && principal && payment && 
                                    !isNaN(period) && !isNaN(rate) && !isNaN(principal) && !isNaN(payment);

        // è¨ˆç®—ä¸¦é¡¯ç¤ºç¸½åˆ©æ¯
        const totalInterestField = document.getElementById('totalInterest');
        if (hasAllRequiredValues) {
            // è¨ˆç®—ç¸½åˆ©æ¯
            const totalInterest = (payment * period) - principal;
            // ç¸½åˆ©æ¯æ ¼å¼åŒ–å¸¶åƒä½åˆ†éš”ç¬¦
            totalInterestField.value = formatNumberWithCommas(totalInterest.toFixed(2));
        } else {
            // å¦‚æœç¼ºå°‘ä»»ä½•å¿…è¦å€¼ï¼Œæ¸…ç©ºç¸½åˆ©æ¯è¼¸å…¥æ¡†
            totalInterestField.value = '';
        }

        // è¨ˆç®—ç¨…é‡‘ - åŒæ¨£éœ€è¦æª¢æŸ¥ç¸½åˆ©æ¯æ˜¯å¦å·²è¨ˆç®—
        const taxField = document.getElementById('tax');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            const tax = totalInterest / 21;
            taxField.value = formatNumberWithCommas(tax.toFixed(2));
        } else {
            taxField.value = '';
        }

        // è¨ˆç®—ç¨…å¾Œåˆ©ç‡ - åŒæ¨£éœ€è¦æª¢æŸ¥å¿…è¦å€¼
        const afterTaxRateInput = document.getElementById('afterTaxRate');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            const tax = totalInterest / 21;
            const afterTaxRate = RATE(period, payment, principal + tax);
            afterTaxRateInput.value = afterTaxRate.toFixed(4);
            if (afterTaxRate <= 2.5) {
                afterTaxRateInput.classList.add('warning-text');
            } else {
                afterTaxRateInput.classList.remove('warning-text');
            }
        } else {
            afterTaxRateInput.value = '';
            afterTaxRateInput.classList.remove('warning-text');
        }

        // ä½£é‡‘æ ¼å¼åŒ–ç‚ºæ•´æ•¸ä¸¦å¸¶åƒä½åˆ†éš”ç¬¦
        const commission = parseFloat(document.getElementById('commission').value.replace(/,/g, '')) || 0;
        document.getElementById('commission').value = formatNumberWithCommas(Math.round(commission));
        
        // æª¢æŸ¥ä½£é‡‘æ˜¯å¦è¶…éç¸½åˆ©æ¯çš„95%
        const commissionInput = document.getElementById('commission');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            if (commission >= totalInterest * 0.95) {
                commissionInput.classList.add('warning-text');
            } else {
                commissionInput.classList.remove('warning-text');
            }
        } else {
            commissionInput.classList.remove('warning-text');
        }

        // è¨ˆç®—ä¸¦æ›´æ–°æ¨å»£è²»æ¯”ä¾‹
        const commissionRatioInput = document.getElementById('commissionRatio');
        if (principal > 0 && commission > 0) {
            const commissionRatio = commission / principal * 100;
            commissionRatioInput.value = commissionRatio.toFixed(2);
            
            // æª¢æŸ¥æ¨å»£è²»æ¯”ä¾‹æ˜¯å¦è¶…é5%
            if (commissionRatio > 5) {
                commissionRatioInput.classList.add('warning-text');
            } else {
                commissionRatioInput.classList.remove('warning-text');
            }
        } else {
            commissionRatioInput.value = '';
            commissionRatioInput.classList.remove('warning-text');
        }

        // è¨ˆç®—ç¨…ä½£å¾Œåˆ©ç‡
        const afterCommissionRateInput = document.getElementById('afterCommissionRate');
        if (hasAllRequiredValues) {
            const totalInterest = (payment * period) - principal;
            const tax = totalInterest / 21;
            const afterCommissionRate = RATE(period, payment, principal + tax + commission);
            
            // ç¨…ä½£å¾Œåˆ©ç‡ä¸éœ€è¦åƒä½åˆ†éš”ç¬¦
            afterCommissionRateInput.value = afterCommissionRate.toFixed(4);
            if (afterCommissionRate <= 2.5) {
                afterCommissionRateInput.classList.add('warning-text');
            } else {
                afterCommissionRateInput.classList.remove('warning-text');
            }
            
            // è¨ˆç®— Spread
            const spread = afterCommissionRate - monthlyCost;
            // Spread ä¸éœ€è¦åƒä½åˆ†éš”ç¬¦
            const spreadInput = document.getElementById('spread');
            spreadInput.value = spread.toFixed(4);
            if (spread <= 0) {
                spreadInput.classList.add('warning-text');
            } else {
                spreadInput.classList.remove('warning-text');
            }
        } else {
            afterCommissionRateInput.value = '';
            afterCommissionRateInput.classList.remove('warning-text');
            
            document.getElementById('spread').value = '';
            document.getElementById('spread').classList.remove('warning-text');
        }
        
        // è¨ˆç®—ç™¾è¬åˆ©æ¯ç›¸é—œ
        if (rate > 0) {
            // ç™¾è¬åˆ©æ¯è¨ˆç®—
            const millionPayment = PMT(rate, 12, 1000000);
            const annualMillionInterest = (millionPayment * 12) - 1000000;
            
            // ç™¾è¬æ¯å¹´åˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            document.getElementById('annualMillionInterest').value = formatNumberWithCommas(Math.round(annualMillionInterest));
            // ç™¾è¬æ¯æœˆåˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            document.getElementById('monthlyMillionInterest').value = formatNumberWithCommas(Math.round(annualMillionInterest / 12));
            
            // ä¸€è¬åˆ©æ¯
            const tenThousandPayment = PMT(rate, 12, 10000);
            const annualTenThousandInterest = (tenThousandPayment * 12) - 10000;
            
            // ä¸€è¬æ¯å¹´åˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            document.getElementById('annualTenThousandInterest').value = formatNumberWithCommas(Math.round(annualTenThousandInterest));
            // ä¸€è¬æ¯æœˆåˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸å¸¶åƒä½åˆ†éš”ç¬¦
            document.getElementById('monthlyTenThousandInterest').value = formatNumberWithCommas(Math.round(annualTenThousandInterest / 12));
        } else {
            document.getElementById('annualMillionInterest').value = '';
            document.getElementById('monthlyMillionInterest').value = '';
            document.getElementById('annualTenThousandInterest').value = '';
            document.getElementById('monthlyTenThousandInterest').value = '';
        }
        
        // è¨ˆç®— NPV
        const npvValue = calculateNPV(
            payment,
            period,
            principal,
            monthlyCost
        );
        
        // æ›´æ–° NPV é¡¯ç¤ºï¼Œå¸¶åƒä½åˆ†éš”ç¬¦
        const fundingCostInput = document.getElementById('fundingCost');
        if (hasAllRequiredValues) {
            fundingCostInput.value = formatNumberWithCommas(npvValue);
            
            // æ›´æ–°è­¦å‘Šæ¨£å¼
            if (npvValue < 0) {
                fundingCostInput.classList.add('warning-text');
            } else {
                fundingCostInput.classList.remove('warning-text');
            }
        } else {
            fundingCostInput.value = '';
            fundingCostInput.classList.remove('warning-text');
        }

        // åœ¨æ›´æ–°å€¼ä¹‹å‰ä¿å­˜èˆŠå€¼
        const oldValues = {};
        const fieldsToTrack = ['totalInterest', 'afterTaxRate', 'spread'];
        fieldsToTrack.forEach(field => {
            oldValues[field] = document.getElementById(field).value;
        });

        // åœ¨æ›´æ–°å¾Œæª¢æŸ¥è®ŠåŒ–
        fieldsToTrack.forEach(field => {
            const newValue = document.getElementById(field).value;
            if (oldValues[field] !== newValue) {
                animateValueChange(field);
            }
        });
    }

    // åœ¨ clearField å‡½æ•¸ä¹‹å‰æ·»åŠ é€™å€‹æ–°å‡½æ•¸
    // ä¿®æ”¹ validatePrincipalInput å‡½æ•°
    function validatePrincipalInput(input) {
        // ç§»é™¤è´Ÿå·ï¼Œç¡®ä¿ä¸ºæ­£æ•´æ•°
        let value = Math.floor(Math.abs(parseFloat(input.value))) || 0;
        
        // å¦‚æœè¾“å…¥ä¸º0ï¼Œè®¾ç½®ä¸ºæœ€å°å€¼1
        if (value <= 0) {
            value = 1;
        }
        
        // æ›´æ–°è¾“å…¥æ¡†å€¼å¹¶æ ¼å¼åŒ–
        input.value = formatNumberWithCommas(value);
        
        // æ›´æ–°ç›¸å…³è®¡ç®—
        updateAllFields();
    }

    function clearField(fieldId) {
        vibrate();
        document.getElementById(fieldId).value = '';
    }

    function clearCommission() {
        vibrate();
        document.getElementById('commission').value = '';
        updateAllFields(); // æ›´æ–°æ‰€æœ‰æ¬„ä½
    }

    function adjustPeriod(delta) {
        vibrate();
        const periodField = document.getElementById('period');
        const currentValue = parseFloat(periodField.value) || 0;
        periodField.value = currentValue + delta;
        calculatePayment();
    }

    function setPeriod(value) {
        vibrate();
        document.getElementById('period').value = value;
        
        // æª¢æŸ¥å…¶ä»–å¿…è¦è¼¸å…¥æ˜¯å¦å·²æœ‰å€¼
        const rate = parseFloat(document.getElementById('rate').value);
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        
        if (!isNaN(rate) && !isNaN(principal) && rate > 0 && principal > 0) {
            calculatePayment(); // åªæœ‰ç•¶å…¶ä»–å¿…è¦å€¼éƒ½å­˜åœ¨æ™‚æ‰è¨ˆç®—
        }
    }

    function adjustRate(delta) {
        vibrate();
        const rateField = document.getElementById('rate');
        const currentValue = parseFloat(rateField.value) || 0;
        rateField.value = (currentValue + delta).toFixed(4);
        calculatePayment();
    }

    function setRate(value) {
        vibrate();
        document.getElementById('rate').value = value;
        calculatePayment();
    }

    function validateCommissionInput(input) {
        // ç§»é™¤å°æ•¸é»
        let value = parseInt(input.value) || 0;
        
        // å¦‚æœæ˜¯è² æ•¸ï¼Œè¨­ç‚º0
        if (value < 0) {
            value = 0;
        }
        
        // æ›´æ–°è¼¸å…¥æ¡†çš„å€¼ç‚ºæ•´æ•¸
        input.value = Math.floor(value);
        
        // æ›´æ–°ç›¸é—œè¨ˆç®—
        updateAllFields();
    }

    function adjustCommission(delta) {
        vibrate();
        const commissionField = document.getElementById('commission');
        
        // ç²å–ç•¶å‰å€¼ï¼Œå¦‚æœç‚ºç©ºå‰‡é è¨­ç‚º0ï¼Œç§»é™¤åƒä½åˆ†éš”ç¬¦
        const currentValue = parseFloat(commissionField.value.replace(/,/g, '')) || 0;
        
        // è¨ˆç®—æ–°å€¼
        const newValue = Math.max(0, currentValue + delta);
        
        // æ›´æ–°è¼¸å…¥æ¡†çš„å€¼ï¼Œä½¿ç”¨ Math.floor å–æ•´æ•¸ä¸¦æ·»åŠ åƒä½åˆ†éš”ç¬¦
        commissionField.value = formatNumberWithCommas(Math.floor(newValue));
        
        // æ›´æ–°æ‰€æœ‰ç›¸é—œæ¬„ä½çš„è¨ˆç®—
        updateAllFields();
    }

    // ä¿®æ”¹ adjustPrincipal å‡½æ•°
    function adjustPrincipal(delta) {
        vibrate();
        const principalField = document.getElementById('principal');
        // ç§»é™¤åƒä½åˆ†éš”ç¬¦åå†è½¬æ¢ä¸ºæ•°å­—
        const currentValue = parseFloat(principalField.value.replace(/,/g, '')) || 0;
        // è®¡ç®—æ–°å€¼ï¼Œç¡®ä¿æ˜¯æ­£æ•´æ•°
        const newValue = Math.max(1, Math.floor(currentValue + delta)); // ç¡®ä¿æœ€å°å€¼ä¸º1ä¸”ä¸ºæ•´æ•°
        // æ·»åŠ åƒä½åˆ†éš”ç¬¦æ˜¾ç¤º
        principalField.value = formatNumberWithCommas(newValue);
        calculatePayment();
        updateAllFields();
    }

    function calculateAfterCommissionRate() {
        const period = parseFloat(document.getElementById('period').value);
        const payment = parseFloat(document.getElementById('payment').value.replace(/,/g, ''));
        const principal = parseFloat(document.getElementById('principal').value.replace(/,/g, ''));
        const tax = parseFloat(document.getElementById('tax').value.replace(/,/g, ''));
        const commission = parseFloat(document.getElementById('commission').value.replace(/,/g, '')) || 0;

        updateAllFields(); // æ›´æ–°æ‰€æœ‰æ¬„ä½
    }

    // ä¿®æ”¹ roundPayment å‡½æ•°ä»¥ä¿æŒæ­£æ•°é™åˆ¶
    function roundPayment(direction, base) {
        vibrate();
        const paymentField = document.getElementById('payment');
        // ç§»é™¤åƒä½åˆ†éš”ç¬¦åå†è½¬æ¢ä¸ºæ•°å­—
        let value = parseFloat(paymentField.value.replace(/,/g, '')) || 0;
        
        if (direction === 'down') {
            value = Math.floor(value / base) * base;
        } else {
            value = Math.ceil(value / base) * base;
        }
        
        // ç¡®ä¿å€¼ä¸ºæ­£æ•´æ•°
        value = Math.max(1, Math.round(value));
        
        // æ·»åŠ åƒä½åˆ†éš”ç¬¦æ˜¾ç¤ºï¼Œä¸å†ä¿ç•™å°æ•¸ä½
        paymentField.value = formatNumberWithCommas(value);
        calculateRate(); // ç¡®ä¿è¿™ä¸ªè°ƒç”¨èƒ½æ­£ç¡®è®¡ç®—ç¨å‰åˆ©ç‡
    }

    // ä¿®æ”¹ adjustPayment å‡½æ•°
    function adjustPayment(delta) {
        vibrate();
        const paymentField = document.getElementById('payment');
        // ç§»é™¤åƒä½åˆ†éš”ç¬¦åå†è½¬æ¢ä¸ºæ•°å­—
        const currentValue = parseFloat(paymentField.value.replace(/,/g, '')) || 0;
        // è®¡ç®—æ–°å€¼ï¼Œç¡®ä¿æ˜¯æ­£æ•´æ•°
        const newValue = Math.max(1, Math.round(currentValue + delta)); // ä½¿ç”¨Math.roundç¢ºä¿æ˜¯æ•´æ•¸
        // æ·»åŠ åƒä½åˆ†éš”ç¬¦æ˜¾ç¤ºï¼Œä¸å†ä¿ç•™å°æ•¸
        paymentField.value = formatNumberWithCommas(newValue);
        calculateRate(); // ç¡®ä¿è¿™ä¸ªè°ƒç”¨èƒ½æ­£ç¡®è®¡ç®—ç¨å‰åˆ©ç‡
    }

    function saveData() {
        const dataToSave = {
        period: document.getElementById('period').value,
        rate: document.getElementById('rate').value,
        principal: document.getElementById('principal').value,
        payment: document.getElementById('payment').value,
        commission: document.getElementById('commission').value
        };
        localStorage.setItem('loanCalculatorData', JSON.stringify(dataToSave));
        alert('è³‡æ–™å·²æš«å­˜ï¼');
    }

    function generateQuote() {
        vibrate();
        console.log('é–‹å§‹ç”Ÿæˆå ±åƒ¹...'); // æ–°å¢åµéŒ¯è¨Šæ¯

        // å‰µå»ºå ±åƒ¹è¡¨æ ¼
        const table = document.createElement('table');
            table.className = 'quote-table';

        // æ·»åŠ è¡¨æ ¼å…§å®¹
        const rows = [
            ['å ±åƒ¹æ™‚é–“', `${document.getElementById('currentTime').textContent.split('æ˜ŸæœŸ')[0]}<br>æ˜ŸæœŸ${document.getElementById('currentTime').textContent.split('æ˜ŸæœŸ')[1]}`],
            ['æœŸæ•¸', document.getElementById('period').value || ''],
            ['ç¨…å‰åˆ©ç‡', (document.getElementById('rate').value || '') + '%'],  // ä¿ç•™é€™è£¡çš„ç™¾åˆ†æ¯”ç¬¦è™Ÿ
            ['æœ¬é‡‘', document.getElementById('principal').value || ''],
            ['æœŸç¹³', document.getElementById('payment').value || ''],
            ['ç¨…å¾Œåˆ©ç‡', (document.getElementById('afterTaxRate').value || '') + '%'],  // ä¿ç•™é€™è£¡çš„ç™¾åˆ†æ¯”ç¬¦è™Ÿ
            ['ä½£é‡‘', document.getElementById('commission').value || ''],
            ['ç¨…ä½£å¾Œåˆ©ç‡', (document.getElementById('afterCommissionRate').value || '') + '%']  // ä¿ç•™é€™è£¡çš„ç™¾åˆ†æ¯”ç¬¦è™Ÿ
        ];

        // å»ºç«‹è¡¨æ ¼å…§å®¹
        rows.forEach(([label, value]) => {
            const tr = table.insertRow();
            const labelCell = tr.insertCell();
            const valueCell = tr.insertCell();
            labelCell.textContent = label;
            valueCell.innerHTML = value; // æ”¹ç”¨ innerHTML ä¾†æ”¯æ´æ›è¡Œæ¨™ç±¤
            });

        // å‰µå»ºè‡¨æ™‚å®¹å™¨
        const container = document.createElement('div');
            container.style.padding = '24px';
            container.style.background = '#333333';
            container.style.borderRadius = '12px';
            container.appendChild(table);
            document.body.appendChild(container);

            console.log('æº–å‚™é€²è¡Œæˆªåœ–...'); // æ–°å¢åµéŒ¯è¨Šæ¯

        // ä½¿ç”¨ html2canvas è½‰æ›ç‚ºåœ–ç‰‡
        html2canvas(container).then(canvas => {
            console.log('Canvas å·²ç”Ÿæˆ'); // æ–°å¢åµéŒ¯è¨Šæ¯

        // ç§»é™¤è‡¨æ™‚å®¹å™¨
        document.body.removeChild(container);

        // ä¸‹è¼‰åœ–ç‰‡
        const link = document.createElement('a');
            link.download = `å ±åƒ¹_${document.getElementById('currentTime').textContent.replace(/[^0-9]/g, '')}.png`;
            link.href = canvas.toDataURL();
            console.log('æº–å‚™ä¸‹è¼‰...'); // æ–°å¢åµéŒ¯è¨Šæ¯
            link.click();
        }).catch(error => {
            console.error('æˆªåœ–éç¨‹ç™¼ç”ŸéŒ¯èª¤:', error); // æ–°å¢éŒ¯èª¤è™•ç†
            document.body.removeChild(container); // ç¢ºä¿æ¸…ç†è‡¨æ™‚å®¹å™¨
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        // ç‚ºç›¸é—œè¼¸å…¥æ¬„ä½æ·»åŠ äº‹ä»¶ç›£è½
        const inputIds = ['period', 'payment', 'principal', 'monthlyCost'];
        inputIds.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', updateAllFields);
                element.addEventListener('change', updateAllFields);
            }
        });
    });

    // æ·»åŠ æ•¸å€¼è®ŠåŒ–å‹•ç•«
        function animateValueChange(elementId) {
        const element = document.getElementById(elementId);
        element.classList.remove('value-changed');
        void element.offsetWidth; // è§¸ç™¼é‡ç¹ª
        element.classList.add('value-changed');
    }

    

    // ä¿å­˜è²¸æ¬¾è¨ˆç®—çµæœ
    // ä¿®æ”¹ saveLoanData å‡½æ•°æ¥ç¡®ä¿ä¿å­˜çš„æ•°æ®æ˜¯å¹²å‡€çš„æ•°å­—å€¼
    function saveLoanData() {
        const period = document.getElementById('period').value;
        const rate = document.getElementById('rate').value;
        // ç§»é™¤åƒä½åˆ†éš”ç¬¦ä»¥ä¿å­˜å¹²å‡€çš„æ•°å€¼
        const principal = document.getElementById('principal').value.replace(/,/g, '');
        const payment = document.getElementById('payment').value.replace(/,/g, '');
        const afterTaxRate = document.getElementById('afterTaxRate').value;
        const commission = document.getElementById('commission').value.replace(/,/g, '');
        const afterCommissionRate = document.getElementById('afterCommissionRate').value;
        
        // æ£€æŸ¥å¿…è¦å­—æ®µæ˜¯å¦å¡«å†™
        if (!period || !rate || !principal || !payment) {
            showToast('è«‹å…ˆå®Œæˆå¿…è¦æ¬„ä½ï¼ˆæœŸæ•¸ã€åˆ©ç‡ã€æœ¬é‡‘ã€æœŸç¹³ï¼‰çš„è¨ˆç®—ï¼');
            return;
        }
        
        const loanDate = new Date();
        const year = loanDate.getFullYear();
        const month = String(loanDate.getMonth() + 1).padStart(2, '0');
        const date = String(loanDate.getDate()).padStart(2, '0');
        const formattedDate = `${year}-${month}-${date}`;
        
        const loanData = {
            id: new Date().getTime(),
            date: formattedDate,
            period: period,
            rate: rate,
            principal: principal,
            payment: payment,
            afterTaxRate: afterTaxRate,
            commission: commission || '0',
            afterCommissionRate: afterCommissionRate,
            totalInterest: document.getElementById('totalInterest').value.replace(/,/g, ''),
            timestamp: new Date().toISOString(),
            note: '' // åˆå§‹å‚™è¨»ç‚ºç©º
        };
        
        // è·å–å·²å­˜å‚¨çš„è´·æ¬¾è®°å½•
        let loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        loanHistory.push(loanData);
        
        // ä¿å­˜åˆ° localStorage
        localStorage.setItem('loanHistory', JSON.stringify(loanHistory));
        
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        showToast('è²¸æ¬¾è¨ˆç®—çµæœå·²ä¿å­˜ï¼');
        
        // è§¦è§‰åé¦ˆï¼ˆå¦‚æœè®¾å¤‡æ”¯æŒï¼‰
        if (navigator.vibrate) {
            navigator.vibrate(70);
        }
    }

    // é¡¯ç¤º/éš±è—æ­·å²è¨˜éŒ„é¢æ¿
    function toggleHistoryPanel() {
        const panel = document.getElementById('historyPanel');
        if (panel.style.display === 'block') {
            panel.style.display = 'none';
        } else {
            panel.style.display = 'block';
            loadHistoryData();
            
            // æ·»åŠ ä¸€æ¬¡æ€§èƒŒæ™¯ç‚¹å‡»å…³é—­äº‹ä»¶
            panel.onclick = function(event) {
                if (event.target === this) {
                    this.style.display = 'none';
                }
            };
        }
    }

    // è¼‰å…¥æ­·å²è¨˜éŒ„
    // ä¿®æ”¹ loadHistoryData å‡½æ•°ä»¥ä½¿ç”¨æ–°çš„è®¾è®¡
    function loadHistoryData() {
        const historyContent = document.getElementById('historyContent');
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        
        if (loanHistory.length === 0) {
            historyContent.innerHTML = '<p class="no-data">å°šç„¡è²¸æ¬¾è¨ˆç®—è¨˜éŒ„</p>';
            return;
        }
        
        // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰é¢
        loanHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        let html = '<div class="history-list">';
        loanHistory.forEach(loan => {
            // ç¡®ä¿æ•°å€¼æ­£ç¡®æ˜¾ç¤ºï¼Œç§»é™¤åƒä½åˆ†éš”ç¬¦åå†æ ¼å¼åŒ–
            const principalDisplay = formatNumber(loan.principal);
            const paymentDisplay = formatNumber(loan.payment);
            const commissionDisplay = formatNumber(loan.commission);
            
            html += `
                <div class="history-item">
                    <div class="history-item-header">
                        <div class="history-date">${formatDate(loan.date)}</div>
                        <div class="history-header-rate">ç¨…ä½£å¾Œåˆ©ç‡: ${parseFloat(loan.afterCommissionRate).toFixed(4)}%</div>
                    </div>
                    
                    <div class="history-details">
                        <div class="history-detail-item">
                            <span class="detail-label">æœŸæ•¸</span>
                            <span class="detail-value">${loan.period}</span>
                        </div>
                        <div class="history-detail-item">
                            <span class="detail-label">æ¨å»£</span>
                            <span class="detail-value">${commissionDisplay}</span>
                        </div>
                        <div class="history-detail-item">
                            <span class="detail-label">æœ¬é‡‘</span>
                            <span class="detail-value">${principalDisplay}</span>
                        </div>
                        <div class="history-detail-item">
                            <span class="detail-label">æœŸç¹³</span>
                            <span class="detail-value">${paymentDisplay}</span>
                        </div>
                    </div>

                    <div class="history-note-container">
                        <div class="history-item-footer">
                            <div class="history-note-preview" onclick="openNoteEditor(${loan.id}, '${loan.note || ''}')">
                                ${loan.note ? loan.note : 'é»æ“Šæ·»åŠ å‚™è¨»'}
                            </div>
                            <div class="history-actions">
                                <button class="detail-btn" onclick="loadLoanToForm(${loan.id})">è¼‰å…¥è¨ˆç®—</button>
                                <button class="delete-btn" onclick="deleteLoan(${loan.id})">åˆªé™¤</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        
        historyContent.innerHTML = html;
    }

    function openNoteEditor(loanId, existingNote = '') {
        // å‰µå»ºå‚™è¨»ç·¨è¼¯å™¨æ¨¡æ…‹æ¡†
        const noteEditorModal = document.createElement('div');
        noteEditorModal.className = 'note-editor-modal';
        noteEditorModal.id = 'noteEditorModal';
        noteEditorModal.innerHTML = `
            <div class="note-editor-content">
                <h3>å‚™è¨»ç·¨è¼¯</h3>
                <textarea id="noteEditorInput" class="note-editor-input" placeholder="è«‹è¼¸å…¥å‚™è¨»å…§å®¹...">${existingNote}</textarea>
                <div class="note-editor-buttons">
                    <button onclick="closeNoteEditor(false)" class="modal-btn modal-btn-secondary">å–æ¶ˆ</button>
                    <button onclick="saveNote(${loanId})" class="modal-btn modal-btn-primary">å„²å­˜</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(noteEditorModal);
        
        // é¡¯ç¤ºæ¨¡æ…‹æ¡†
        noteEditorModal.style.display = 'flex';
        
        // è‡ªå‹•èšç„¦åˆ°è¼¸å…¥æ¡†ä¸¦èª¿å‡ºéµç›¤
        const noteInput = document.getElementById('noteEditorInput');
        noteInput.focus();
        
        // æ·»åŠ é»æ“Šç©ºç™½è™•é—œé–‰åŠŸèƒ½
        noteEditorModal.addEventListener('click', function(event) {
            if (event.target === this) {
                closeNoteEditor();
            }
        });
        
        // ç›£è½éµç›¤å½ˆå‡ºäº‹ä»¶ï¼Œé€²ä¸€æ­¥èª¿æ•´ä½ç½®
        window.addEventListener('resize', adjustNoteEditorPosition);
        
        // åˆå§‹èª¿æ•´ä½ç½®
        adjustNoteEditorPosition();
    }

    // æ–°å¢å‡½æ•¸ï¼šèª¿æ•´å‚™è¨»ç·¨è¼¯å™¨ä½ç½®
    function adjustNoteEditorPosition() {
        const modal = document.getElementById('noteEditorModal');
        if (!modal) return;
        
        // åµæ¸¬è¦–çª—é«˜åº¦è®ŠåŒ–ä¾†æ¨æ¸¬éµç›¤æ˜¯å¦å½ˆå‡º
        const windowHeight = window.innerHeight;
        const viewportHeight = window.visualViewport ? window.visualViewport.height : windowHeight;
        
        // éµç›¤å½ˆå‡ºæ™‚æœƒæ¸›å°‘è¦–å£é«˜åº¦
        if (viewportHeight < windowHeight * 0.8) {
            // éµç›¤å·²å½ˆå‡ºï¼Œå°‡ç·¨è¼¯å™¨ç§»è‡³æ›´é é ‚éƒ¨çš„ä½ç½®
            modal.style.paddingTop = '180px';
            modal.style.justifyContent = 'center'; // ä¿æŒæ°´å¹³ç½®ä¸­
        } else {
            // éµç›¤æ”¶èµ·ï¼Œæ¢å¾©åŸæœ¬ä½ç½®
            modal.style.paddingTop = '180px';
            modal.style.justifyContent = 'center'; // ä¿æŒæ°´å¹³ç½®ä¸­
        }
    }

    function closeNoteEditor(isCancelled = true) {
        const noteEditorModal = document.getElementById('noteEditorModal');
        if (noteEditorModal) {
            document.body.removeChild(noteEditorModal);
        }
        
        // ç§»é™¤äº‹ä»¶ç›£è½å™¨
        window.removeEventListener('resize', adjustNoteEditorPosition);
    }

    function saveNote(loanId) {
        const noteInput = document.getElementById('noteEditorInput');
        const newNote = noteInput.value.trim();
        
        // ç²å–ç•¶å‰çš„æ­·å²è¨˜éŒ„
        let loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        
        // æ‰¾åˆ°å°æ‡‰çš„è²¸æ¬¾è¨˜éŒ„ä¸¦æ›´æ–°å‚™è¨»
        const updatedHistory = loanHistory.map(loan => {
            if (loan.id === loanId) {
                return { ...loan, note: newNote };
            }
            return loan;
        });
        
        // å„²å­˜æ›´æ–°å¾Œçš„æ­·å²è¨˜éŒ„
        localStorage.setItem('loanHistory', JSON.stringify(updatedHistory));
        
        // é—œé–‰å‚™è¨»ç·¨è¼¯å™¨
        closeNoteEditor();
        
        // é‡æ–°è¼‰å…¥æ­·å²è¨˜éŒ„
        loadHistoryData();
        
        // é¡¯ç¤ºæˆåŠŸæç¤º
        showToast('å‚™è¨»å·²å„²å­˜');
    }

    // æ ¼å¼åŒ–æ—¥æœŸé¡¯ç¤º
    function formatDate(dateString) {
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}/${month}/${day}`;
    }

    // ä¿®æ”¹ formatNumber å‡½æ•°
    function formatNumber(num) {
        if (!num) return '0';
        
        // å¦‚æœæ˜¯å­—ç¬¦ä¸²ä¸”åŒ…å«é€—å·ï¼Œå…ˆå»é™¤åƒä½åˆ†éš”ç¬¦
        if (typeof num === 'string') {
            num = num.replace(/,/g, '');
        }
        
        // ç¡®ä¿æ˜¯æ•°å­—ï¼Œç„¶åæ ¼å¼åŒ–
        return parseFloat(num).toLocaleString();
    }

    // è¼‰å…¥è²¸æ¬¾è¨˜éŒ„åˆ°è¡¨å–®
    function loadLoanToForm(id) {
        const loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        const loan = loanHistory.find(item => item.id === id);
        
        if (loan) {
            // é™¤äº†åŸæœ‰çš„è¼‰å…¥é‚è¼¯å¤–ï¼Œä¸è¦é‡ç½®å‚™è¨»
            document.getElementById('period').value = loan.period;
            document.getElementById('rate').value = loan.rate;
            
            document.getElementById('principal').value = formatNumberWithCommas(Math.round(parseFloat(loan.principal)));
            document.getElementById('payment').value = formatNumberWithCommas(Math.round(parseFloat(loan.payment)));
            document.getElementById('commission').value = formatNumberWithCommas(Math.round(parseFloat(loan.commission)));
            
            calculatePayment();
            updateAllFields();
            
            document.getElementById('historyPanel').style.display = 'none';
            
            showToast('å·²è¼‰å…¥è²¸æ¬¾è¨ˆç®—è³‡æ–™');
            
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
    }

    // åˆªé™¤è²¸æ¬¾è¨˜éŒ„
    function deleteLoan(id) {
        let loanHistory = JSON.parse(localStorage.getItem('loanHistory') || '[]');
        loanHistory = loanHistory.filter(loan => loan.id !== id);
        localStorage.setItem('loanHistory', JSON.stringify(loanHistory));
        loadHistoryData(); // é‡æ–°è¼‰å…¥æ­·å²è¨˜éŒ„
        showToast('è²¸æ¬¾è¨˜éŒ„å·²åˆªé™¤ï¼');
        
        // è§¸è¦ºåé¥‹
        if (navigator.vibrate) {
            navigator.vibrate([30, 20, 30]);
        }
    }

    // ç¢ºèªæ˜¯å¦åˆªé™¤æ‰€æœ‰è²¸æ¬¾è¨˜éŒ„
    function confirmDeleteAll() {
        showConfirmModal('ç¢ºèªåˆªé™¤', 'ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰è²¸æ¬¾è¨ˆç®—è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚', deleteAllLoans);
    }

    // åˆªé™¤æ‰€æœ‰è²¸æ¬¾è¨˜éŒ„
    function deleteAllLoans() {
        localStorage.removeItem('loanHistory');
        loadHistoryData(); // é‡æ–°è¼‰å…¥æ­·å²è¨˜éŒ„ï¼ˆæœƒé¡¯ç¤ºç„¡è¨˜éŒ„ï¼‰
        showToast('æ‰€æœ‰è²¸æ¬¾è¨˜éŒ„å·²åˆªé™¤ï¼');
        
        // è§¸è¦ºåé¥‹
        if (navigator.vibrate) {
            navigator.vibrate([50, 30, 50, 30, 50]);
        }
    }

    // é¡¯ç¤ºä¸€èˆ¬æ¨¡æ…‹æ¡†
    function showModal(title, content) {
        document.getElementById('modalTitle').textContent = title || 'æç¤º';
        document.getElementById('modalContent').innerHTML = content;
        document.getElementById('modalOverlay').style.display = 'flex';
        
        // æ·»åŠ èƒŒæ™¯é»æ“Šé—œé–‰åŠŸèƒ½
        document.getElementById('modalOverlay').onclick = function(event) {
            if (event.target === this) {
                hideModal();
            }
        };
    }

    // éš±è—ä¸€èˆ¬æ¨¡æ…‹æ¡†
    function hideModal() {
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // é¡¯ç¤ºç¢ºèªæ¨¡æ…‹æ¡†
    function showConfirmModal(title, content, confirmCallback) {
        document.getElementById('confirmModalTitle').textContent = title || 'ç¢ºèª';
        document.getElementById('confirmModalContent').innerHTML = content;
        document.getElementById('confirmModalOverlay').style.display = 'flex';
        
        // è¨­å®šç¢ºèªæŒ‰éˆ•é»æ“Šäº‹ä»¶
        const confirmButton = document.getElementById('confirmModalOk');
        
        // ç§»é™¤èˆŠçš„äº‹ä»¶ç›£è½å™¨ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
        const newConfirmButton = confirmButton.cloneNode(true);
        confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
        
        // æ·»åŠ æ–°çš„äº‹ä»¶ç›£è½å™¨
        newConfirmButton.addEventListener('click', function() {
            hideConfirmModal();
            if (typeof confirmCallback === 'function') {
                confirmCallback();
            }
        });
        
        // æ·»åŠ èƒŒæ™¯é»æ“Šé—œé–‰åŠŸèƒ½
        document.getElementById('confirmModalOverlay').onclick = function(event) {
            if (event.target === this) {
                hideConfirmModal();
            }
        };
    }

    // éš±è—ç¢ºèªæ¨¡æ…‹æ¡†
    function hideConfirmModal() {
        document.getElementById('confirmModalOverlay').style.display = 'none';
    }

    // é¡¯ç¤ºè¼•é‡ç´šçš„æç¤ºè¨Šæ¯
    function showToast(message) {
        // æª¢æŸ¥æ˜¯å¦å·²æœ‰ toast å­˜åœ¨
        const existingToast = document.querySelector('.toast-message');
        if (existingToast) {
            document.body.removeChild(existingToast);
        }
        
        // å‰µå»ºä¸€å€‹æ–°çš„ toast å…ƒç´ 
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        toast.textContent = message;
        document.body.appendChild(toast);
        
        // 2ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 500);
        }, 2000);
    }

    // æ¸…ç©ºæ‰€æœ‰æ¬„ä½é™¤äº†æœ¬æœˆè³‡é‡‘æˆæœ¬
    function clearAllFieldsExceptMonthlyCost() {
        // éœ‡å‹•æ•ˆæœ
        vibrate();
        
        // è¦æ¸…ç©ºçš„æ¬„ä½IDåˆ—è¡¨
        const fieldsToReset = [
            'period', 'rate', 'principal', 'payment', 
            'totalInterest', 'tax', 'afterTaxRate', 
            'commission', 'commissionRatio', 'afterCommissionRate',
            'annualMillionInterest', 'monthlyMillionInterest',
            'annualTenThousandInterest', 'monthlyTenThousandInterest',
            'spread', 'fundingCost'
        ];
        
        // æ¸…ç©ºæ¯å€‹æ¬„ä½
        fieldsToReset.forEach(fieldId => {
            document.getElementById(fieldId).value = '';
            // ç§»é™¤ä»»ä½•è­¦å‘Šæ¨£å¼
            document.getElementById(fieldId).classList.remove('warning-text');
        });
        
        // é¡¯ç¤ºæç¤ºè¨Šæ¯
        showToast('å·²æ¸…ç©ºæ‰€æœ‰æ¬„ä½');
    }

    // å…¨å±€è®Šé‡
    let currentInputField = null;
    let calculatorValue = "0";
    let calculatorOperator = null;
    let calculatorFirstValue = null;
    let calculatorWaitingForSecondValue = false;

    // é–‹å•Ÿè¨ˆç®—æ©Ÿè¼¸å…¥å™¨
    function openCalculator(inputId, title) {
        currentInputField = inputId;
        document.getElementById('inputModalTitle').textContent = title;
        
        // ç²å–ç•¶å‰è¼¸å…¥æ¡†çš„å€¼
        const currentValue = document.getElementById(inputId).value;
        
        if (currentValue && currentValue !== '') {
            // å¦‚æœè¼¸å…¥æ¡†æœ‰å€¼ï¼Œä½¿ç”¨è©²å€¼åˆå§‹åŒ–è¨ˆç®—å™¨
            calculatorValue = currentValue.replace(/,/g, ''); // ç§»é™¤åƒä½åˆ†éš”ç¬¦
            document.getElementById('calculatorDisplay').textContent = calculatorValue;
        } else {
            // å¦‚æœè¼¸å…¥æ¡†æ²’æœ‰å€¼ï¼Œä½¿ç”¨ "0"
            calculatorValue = "0";
            document.getElementById('calculatorDisplay').textContent = calculatorValue;
        }
        
        calculatorOperator = null;
        calculatorFirstValue = null;
        calculatorWaitingForSecondValue = false;
        
        document.getElementById('numberInputModal').style.display = 'flex';
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // é—œé–‰æ¨¡æ…‹æ¡†
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿæ•¸å­—è¼¸å…¥
    function calculatorInput(num) {
        if (calculatorWaitingForSecondValue) {
            calculatorValue = num.toString();
            calculatorWaitingForSecondValue = false;
        } else {
            calculatorValue = calculatorValue === '0' ? num.toString() : calculatorValue + num.toString();
        }
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿæ¸…é™¤
    function calculatorClear() {
        calculatorValue = '0';
        calculatorOperator = null;
        calculatorFirstValue = null;
        calculatorWaitingForSecondValue = false;
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿé€€æ ¼
    function calculatorBackspace() {
        if (calculatorValue.length > 1) {
            calculatorValue = calculatorValue.slice(0, -1);
        } else {
            calculatorValue = '0';
        }
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿé‹ç®—ç¬¦
    function calculatorOperation(op) {
        // å¦‚æœå·²ç¶“æœ‰é‹ç®—ç¬¦åœ¨ç­‰å¾…ï¼Œå…ˆé€²è¡Œè¨ˆç®—
        if (calculatorFirstValue !== null && calculatorOperator !== null) {
            calculatorEquals();
        }
        
        calculatorFirstValue = parseFloat(calculatorValue);
        calculatorOperator = op;
        calculatorWaitingForSecondValue = true;
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // è¨ˆç®—æ©Ÿç­‰è™Ÿ
    function calculatorEquals() {
        if (calculatorFirstValue === null || calculatorOperator === null) return;
        
        const secondValue = parseFloat(calculatorValue);
        let result;
        
        switch (calculatorOperator) {
            case '+':
                result = calculatorFirstValue + secondValue;
                break;
            case '-':
                result = calculatorFirstValue - secondValue;
                break;
            case '*':
                result = calculatorFirstValue * secondValue;
                break;
            case '/':
                // å¢åŠ é™¤é›¶æª¢æŸ¥
                if (secondValue === 0) {
                    showToast('éŒ¯èª¤ï¼šä¸èƒ½é™¤ä»¥é›¶', true);
                    calculatorClear();
                    return;
                }
                result = calculatorFirstValue / secondValue;
                break;
            default:
                return;
        }
        
        // é™åˆ¶å°æ•¸é»ä½æ•¸
        calculatorValue = result.toFixed(8).replace(/\.?0+$/, '');
        
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        calculatorOperator = null;
        calculatorFirstValue = parseFloat(calculatorValue);
        calculatorWaitingForSecondValue = true;
        
        // æ·»åŠ éœ‡å‹•æ•ˆæœ
        vibrate();
    }

    // ä¿®æ”¹ submitCalculatorValue å‡½æ•°
    function submitCalculatorValue() {
        if (!currentInputField) return;
        
        let value = parseFloat(calculatorValue);
        if (isNaN(value)) value = 0;
        
        // æ ¹æ®ä¸åŒè¾“å…¥æ¡†è¿›è¡ŒéªŒè¯
        switch (currentInputField) {
            case 'period':
                // æœŸæ•°ä¸éœ€è¦åƒä½åˆ†éš”ç¬¦
                value = Math.floor(value);
                if (value < 0) {
                    showToast('é”™è¯¯ï¼šæœŸæ•°ä¸èƒ½ä¸ºè´Ÿæ•°', true);
                    return;
                }
                if (value > 99) {
                    showToast('é”™è¯¯ï¼šæœŸæ•°ä¸èƒ½è¶…è¿‡2ä½æ•°', true);
                    return;
                }
                document.getElementById(currentInputField).value = value;
                break;
                
            case 'rate':
                // åˆ©ç‡ä¸éœ€è¦åƒä½åˆ†éš”ç¬¦
                if (value < 0) {
                    showToast('é”™è¯¯ï¼šåˆ©ç‡ä¸èƒ½ä¸ºè´Ÿæ•°', true);
                    return;
                }
                if (value > 20) {
                    showToast('é”™è¯¯ï¼šåˆ©ç‡ä¸èƒ½è¶…è¿‡20', true);
                    return;
                }
                document.getElementById(currentInputField).value = value.toFixed(4);
                break;
                
            case 'principal':
                // æœ¬é‡‘éœ€è¦åƒä½åˆ†éš”ç¬¦å¹¶ä¸”åªèƒ½æ˜¯æ­£æ•´æ•°
                value = Math.floor(value); // ç¡®ä¿æ˜¯æ•´æ•°
                if (value <= 0) {
                    showToast('é”™è¯¯ï¼šæœ¬é‡‘å¿…é¡»æ˜¯æ­£æ•´æ•°', true);
                    return;
                }
                if (value > 999999999) {
                    showToast('é”™è¯¯ï¼šæœ¬é‡‘ä¸èƒ½è¶…è¿‡9ä½æ•°', true);
                    return;
                }
                document.getElementById(currentInputField).value = formatNumberWithCommas(value);
                break;
                
            case 'payment':
                // æœŸç¹³å¿…é¡»æ˜¯æ­£æ•´æ•°
                value = Math.max(1, Math.round(value)); // æ”¹ç‚ºå–æ•´æ•¸
                if (value > 999999) {
                    showToast('é”™è¯¯ï¼šæœŸç¹³ä¸èƒ½è¶…è¿‡6ä½æ•°', true);
                    return;
                }
                document.getElementById(currentInputField).value = formatNumberWithCommas(value);
                break;
                
            case 'commission':
                // æ¨å»£éœ€è¦åƒä½åˆ†éš”ç¬¦
                value = Math.floor(value);
                if (value < 0) {
                    showToast('é”™è¯¯ï¼šæ¨å»£è´¹ä¸èƒ½ä¸ºè´Ÿæ•°', true);
                    return;
                }
                if (value > 999999) {
                    showToast('é”™è¯¯ï¼šæ¨å»£è´¹ä¸èƒ½è¶…è¿‡6ä½æ•°', true);
                    return;
                }
                document.getElementById(currentInputField).value = formatNumberWithCommas(value);
                break;
        }
        
        // è§¦å‘ change äº‹ä»¶ä»¥æ›´æ–°ç›¸å…³è®¡ç®—
        const event = new Event('change');
        document.getElementById(currentInputField).dispatchEvent(event);
        
        // å…³é—­æ¨¡æ€æ¡†
        closeModal('numberInputModal');
        
        // æ ¹æ®å­—æ®µæ‰§è¡Œç›¸åº”çš„è®¡ç®—å‡½æ•°
        if (currentInputField === 'period' || currentInputField === 'rate' || currentInputField === 'principal') {
            calculatePayment();
        } else if (currentInputField === 'payment') {
            calculateRate();
        } else if (currentInputField === 'commission') {
            calculateAfterCommissionRate();
        }
        
        // æ·»åŠ éœ‡åŠ¨æ•ˆæœ
        vibrate();
    }

    // é¡¯ç¤ºæç¤ºè¨Šæ¯ï¼ˆå¯é‡ç”¨ç¾æœ‰çš„ showToast å‡½æ•¸ï¼Œå¦‚æœæ²’æœ‰çš„è©±æ·»åŠ é€™å€‹ï¼‰
    function showToast(message, isError = false) {
        // æª¢æŸ¥æ˜¯å¦å·²æœ‰ toast
        const existingToast = document.querySelector('.toast-message');
        if (existingToast) {
            document.body.removeChild(existingToast);
        }
        
        // å‰µå»ºæ–°çš„ toast
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        if (isError) {
            toast.classList.add('toast-error');
        }
        toast.textContent = message;
        document.body.appendChild(toast);
        
        // 2ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 500);
        }, 2000);
    }

    // æ ¼å¼åŒ–æ•¸å­— - æ·»åŠ åƒä½åˆ†éš”ç¬¦
    function formatNumberWithCommas(num) {
        if (!num && num !== 0) return '';
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    </script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
	
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('loaded');
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    const header = document.querySelector('.sticky-header');
    const h1Element = document.querySelector('h1');
    
    if (!header || !h1Element) return; // æ·»åŠ æ£€æŸ¥

    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const headerRect = header.getBoundingClientRect();
        const h1Rect = h1Element.getBoundingClientRect();
        
        // ä½¿ç”¨æ›´ç²¾ç¡®çš„æ¡ä»¶åˆ¤æ–­
        if (scrollTop > header.offsetTop) {
            header.classList.add('is-sticky');
            if (h1Rect.bottom > 0) {
                header.classList.remove('is-sticky');
            }
        } else {
            header.classList.remove('is-sticky');
        }
    });
    });
    </script>

    <script>
        if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
            .then(registration => {
                console.log('ServiceWorker registration successful');
            })
            .catch(err => {
                console.log('ServiceWorker registration failed: ', err);
            });
        });
        }

        // åœ¨æ‰€æœ‰ JavaScript å‡½æ•¸å®šç¾©ä¹‹å¾Œæ·»åŠ 
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­ç½®è¼¸å…¥æ¡†é»æ“Šäº‹ä»¶
            document.getElementById('period').addEventListener('click', function() {
                openCalculator('period', 'è«‹è¼¸å…¥ã€æœŸæ•¸ã€‘');
            });
            
            document.getElementById('rate').addEventListener('click', function() {
                openCalculator('rate', 'è«‹è¼¸å…¥ã€ç¨…å‰åˆ©ç‡ã€‘');
            });
            
            document.getElementById('principal').addEventListener('click', function() {
                openCalculator('principal', 'è«‹è¼¸å…¥ã€æœ¬é‡‘ã€‘');
            });
            
            document.getElementById('payment').addEventListener('click', function() {
                openCalculator('payment', 'è«‹è¼¸å…¥ã€æœŸç¹³ã€‘');
            });
            
            document.getElementById('commission').addEventListener('click', function() {
                openCalculator('commission', 'è«‹è¼¸å…¥ã€æ¨å»£ã€‘');
            });
            
            // é»æ“Šæ¨¡æ…‹æ¡†èƒŒæ™¯é—œé–‰æ¨¡æ…‹æ¡†
            document.getElementById('numberInputModal').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeModal('numberInputModal');
                }
            });

            // åœ¨è¿™é‡Œæ·»åŠ å†å²è®°å½•é¢æ¿èƒŒæ™¯ç‚¹å‡»å…³é—­åŠŸèƒ½
            document.getElementById('historyPanel').addEventListener('click', function(event) {
                if (event.target === this) {
                    this.style.display = 'none';
                }
            });

            

        });
    </script>

    <!-- æ•¸å­—è¼¸å…¥å™¨æ¨¡æ…‹æ¡† -->
    <div id="numberInputModal" class="modal-overlay">
        <div class="number-input-modal">
            <div class="modal-header">
                <h3 id="inputModalTitle">æ•¸å­—è¼¸å…¥å™¨</h3>
                <button class="close-btn" onclick="closeModal('numberInputModal')">Ã—</button>
            </div>
            <div class="calculator-display" id="calculatorDisplay">0</div>
            <div class="calculator-buttons">
                <!-- ç¬¬ä¸€è¡Œï¼šåŠŸèƒ½éµ -->
                <button onclick="calculatorClear()" class="clear">C</button>
                <button onclick="calculatorBackspace()" class="function">âŒ«</button>
                <button onclick="calculatorOperation('/')" class="operator">Ã·</button>
                <button onclick="calculatorOperation('*')" class="operator">Ã—</button>
                
                <!-- ç¬¬äºŒè¡Œï¼šæ•¸å­—å’Œæ¸›è™Ÿ -->
                <button onclick="calculatorInput(7)">7</button>
                <button onclick="calculatorInput(8)">8</button>
                <button onclick="calculatorInput(9)">9</button>
                <button onclick="calculatorOperation('-')" class="operator">âˆ’</button>
                
                <!-- ç¬¬ä¸‰è¡Œï¼šæ•¸å­—å’ŒåŠ è™Ÿ -->
                <button onclick="calculatorInput(4)">4</button>
                <button onclick="calculatorInput(5)">5</button>
                <button onclick="calculatorInput(6)">6</button>
                <button onclick="calculatorOperation('+')" class="operator">+</button>
                
                <!-- ç¬¬å››è¡Œï¼šåº•éƒ¨æ•¸å­—å’Œç­‰è™Ÿ -->
                <button onclick="calculatorInput(1)">1</button>
                <button onclick="calculatorInput(2)">2</button>
                <button onclick="calculatorInput(3)">3</button>
                <button onclick="calculatorEquals()" class="equals">=</button>
                
                <!-- ç¬¬äº”è¡Œï¼šé›¶å’Œæ›´å¯¬çš„ç­‰è™Ÿéµ -->
                <button onclick="calculatorInput(0)" class="zero">0</button>
                <button onclick="submitCalculatorValue()" class="submit">ç¢ºèªè¼¸å…¥</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.getElementById('toggleViewBtn');
            const toggleIcon = document.getElementById('toggleIcon');
            
            // éœ€è¦åˆ‡æ›é¡¯ç¤ºçš„å…ƒç´ 
            const buttonGroups = [
                'periodButtons',
                'rateButtons',
                'principalButtons',
                'PaymentduringButtons',
                'commissionButtons'
            ];
            
            // éœ€è¦éš±è—çš„æ•´è¡Œå…ƒç´ 
            const hideRows = [
                document.querySelector('.row:has(#tax)'), // ç¨…é‡‘æ¬„ä½
            ];
            
            // éœ€è¦éš±è—çš„å€æ®µï¼ˆç™¾è¬æ¯å¹´åˆ©æ¯åˆ°NPVï¼‰
            const hideSection = document.querySelectorAll('.row:has(#annualMillionInterest), .row:has(#monthlyMillionInterest), .row:has(#annualTenThousandInterest), .row:has(#monthlyTenThousandInterest), .row:has(#monthlyCost), .row:has(#spread), .row:has(#fundingCost)');
            
            let isSimpleView = false;
            
            toggleBtn.addEventListener('click', function() {
                isSimpleView = !isSimpleView;
                
                // æ›´æ”¹åœ–æ¨™ä¸¦æ·»åŠ æ—‹è½‰å‹•ç•«
                if (isSimpleView) {
                    toggleIcon.classList.add('icon-rotate-up');
                } else {
                    toggleIcon.classList.remove('icon-rotate-up');
                }
                
                // å®šç¾©çµ±ä¸€çš„å‹•ç•«æ•ˆæœ
                const animationOptions = {
                    duration: 300,
                    easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
                };
                
                // åˆ‡æ›æŒ‰éˆ•çµ„çš„é¡¯ç¤º
                buttonGroups.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        if (isSimpleView) {
                            // ä½¿ç”¨ Web Animations API å¯¦ç¾çµ±ä¸€çš„å‹•ç•«
                            element.animate([
                                { opacity: 1, transform: 'scaleY(1)' },
                                { opacity: 0, transform: 'scaleY(0.8)' }
                            ], animationOptions).onfinish = () => {
                                element.classList.add('hidden-element');
                            };
                        } else {
                            element.classList.remove('hidden-element');
                            element.animate([
                                { opacity: 0, transform: 'scaleY(0.8)' },
                                { opacity: 1, transform: 'scaleY(1)' }
                            ], animationOptions);
                        }
                    }
                });
                
                // åˆ‡æ›ç¨…é‡‘æ¬„ä½çš„é¡¯ç¤º
                hideRows.forEach(row => {
                    if (row) {
                        if (isSimpleView) {
                            row.animate([
                                { opacity: 1, transform: 'scaleY(1)' },
                                { opacity: 0, transform: 'scaleY(0.8)' }
                            ], animationOptions).onfinish = () => {
                                row.classList.add('hidden-element');
                            };
                        } else {
                            row.classList.remove('hidden-element');
                            row.animate([
                                { opacity: 0, transform: 'scaleY(0.8)' },
                                { opacity: 1, transform: 'scaleY(1)' }
                            ], animationOptions);
                        }
                    }
                });
                
                // åˆ‡æ›ç™¾è¬æ¯å¹´åˆ©æ¯åˆ°NPVå€æ®µçš„é¡¯ç¤º
                hideSection.forEach(row => {
                    if (row) {
                        if (isSimpleView) {
                            row.animate([
                                { opacity: 1, transform: 'scaleY(1)' },
                                { opacity: 0, transform: 'scaleY(0.8)' }
                            ], animationOptions).onfinish = () => {
                                row.classList.add('hidden-element');
                            };
                        } else {
                            row.classList.remove('hidden-element');
                            row.animate([
                                { opacity: 0, transform: 'scaleY(0.8)' },
                                { opacity: 1, transform: 'scaleY(1)' }
                            ], animationOptions);
                        }
                    }
                });
                
                // è™•ç†åˆ†éš”ç·š
                const dividers = document.querySelectorAll('.divider-flow');
                
                if (isSimpleView) {
                    if (dividers.length >= 3) {
                        dividers[0].animate([
                            { opacity: 1, transform: 'scaleX(1)' },
                            { opacity: 0, transform: 'scaleX(0.8)' }
                        ], animationOptions).onfinish = () => {
                            dividers[0].classList.add('hidden-element');
                        };
                        
                        for (let i = 1; i < dividers.length - 1; i++) {
                            dividers[i].animate([
                                { opacity: 1, transform: 'scaleX(1)' },
                                { opacity: 0, transform: 'scaleX(0.8)' }
                            ], animationOptions).onfinish = () => {
                                dividers[i].classList.add('hidden-element');
                            };
                        }
                        
                        dividers[dividers.length - 1].classList.remove('hidden-element');
                    }
                } else {
                    dividers.forEach(divider => {
                        divider.classList.remove('hidden-element');
                        divider.animate([
                            { opacity: 0, transform: 'scaleX(0.8)' },
                            { opacity: 1, transform: 'scaleX(1)' }
                        ], animationOptions);
                    });
                }
                
                // è§¸ç™¼éœ‡å‹•æ•ˆæœ
                vibrate();
            });
        });
    </script>

</body>
</html>
