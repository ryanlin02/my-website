<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=400, user-scalable=no">
    <title>小朋友工具</title>

    <!-- 將以下程式碼加入 index.html 的 <head> 標籤內 -->
    <!-- 放在 <title> 標籤之後 -->

    <!-- Google Analytics 4 追蹤代碼 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XE5XMQR0Z1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        // 初始化 GA4 - 請將 G-XE5XMQR0Z1 替換為您的測量 ID
        gtag('config', 'G-XE5XMQR0Z1', {
            // 增強型測量設定
            page_title: '小朋友工具 - 主頁',
            page_location: window.location.href,
            page_path: window.location.pathname,
            
            // 自訂維度（可選）
            custom_map: {
                'dimension1': 'user_type',
                'dimension2': 'device_type'
            }
        });
        
        // ============================================
        // 自訂事件追蹤函數
        // ============================================
        
        /**
        * 發送自訂事件到 GA4
        * @param {string} eventName - 事件名稱
        * @param {object} parameters - 事件參數
        */
        function trackEvent(eventName, parameters = {}) {
            gtag('event', eventName, parameters);
            console.log('GA4 Event:', eventName, parameters);
        }
        
        // ============================================
        // 追蹤頁面切換事件
        // ============================================
        
        // 修改原本的 switchPage 函數，加入追蹤
        const originalSwitchPage = window.switchPage;
        window.switchPage = function(pageName) {
            // 追蹤頁面切換事件
            trackEvent('page_switch', {
                from_page: currentPage,
                to_page: pageName,
                switch_method: 'navigation_button'
            });
            
            // 追蹤虛擬頁面瀏覽
            gtag('event', 'page_view', {
                page_title: `小朋友工具 - ${getPageTitle(pageName)}`,
                page_location: window.location.href + '#' + pageName,
                page_path: '/' + pageName
            });
            
            // 執行原本的切換函數
            if (originalSwitchPage) {
                originalSwitchPage.call(this, pageName);
            }
        };
        
        // 頁面標題對應
        function getPageTitle(pageName) {
            const titles = {
                'calculator': '計算機',
                'check': '支票',
                'invoice': '發票',
                'gas': '加油'
            };
            return titles[pageName] || pageName;
        }
        
        // ============================================
        // 追蹤使用者互動事件
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // 追蹤導航按鈕點擊
            document.querySelectorAll('.nav-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const targetPage = this.getAttribute('data-page');
                    trackEvent('navigation_click', {
                        button_text: this.textContent,
                        target_page: targetPage
                    });
                });
            });
            
            // 追蹤 iframe 載入時間
            const iframe = document.getElementById('pageIframe');
            let loadStartTime;
            
            iframe.addEventListener('loadstart', function() {
                loadStartTime = performance.now();
            });
            
            iframe.addEventListener('load', function() {
                if (loadStartTime) {
                    const loadTime = performance.now() - loadStartTime;
                    trackEvent('iframe_load', {
                        page: currentPage,
                        load_time_ms: Math.round(loadTime),
                        iframe_src: iframe.src
                    });
                }
            });
            
            // 追蹤使用者參與度
            let engagementStartTime = Date.now();
            let isEngaged = true;
            
            // 每30秒追蹤一次參與度
            setInterval(function() {
                if (isEngaged) {
                    trackEvent('user_engagement', {
                        engagement_time_seconds: Math.round((Date.now() - engagementStartTime) / 1000),
                        current_page: currentPage
                    });
                }
            }, 30000);
            
            // 追蹤頁面可見性變化
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    isEngaged = false;
                    trackEvent('page_visibility', {
                        visibility: 'hidden',
                        current_page: currentPage
                    });
                } else {
                    isEngaged = true;
                    engagementStartTime = Date.now();
                    trackEvent('page_visibility', {
                        visibility: 'visible',
                        current_page: currentPage
                    });
                }
            });
            
            // 追蹤錯誤
            window.addEventListener('error', function(e) {
                trackEvent('javascript_error', {
                    error_message: e.message,
                    error_source: e.filename,
                    error_line: e.lineno,
                    current_page: currentPage
                });
            });
        });
        
        // ============================================
        // 追蹤 PWA 安裝事件
        // ============================================
        
        window.addEventListener('beforeinstallprompt', function(e) {
            trackEvent('pwa_install_prompt', {
                prompted: true
            });
            
            e.userChoice.then(function(choiceResult) {
                trackEvent('pwa_install_choice', {
                    outcome: choiceResult.outcome
                });
            });
        });
        
        // 追蹤 Service Worker 註冊
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(function(registration) {
                trackEvent('service_worker_ready', {
                    scope: registration.scope
                });
            });
        }
        
        // ============================================
        // 追蹤裝置資訊
        // ============================================
        
        // 初始載入時追蹤裝置資訊
        window.addEventListener('load', function() {
            trackEvent('device_info', {
                screen_width: window.screen.width,
                screen_height: window.screen.height,
                viewport_width: window.innerWidth,
                viewport_height: window.innerHeight,
                device_pixel_ratio: window.devicePixelRatio,
                touch_enabled: 'ontouchstart' in window,
                standalone_mode: window.matchMedia('(display-mode: standalone)').matches
            });
        });
    </script>
    
    <!-- PWA 相關設定 -->
    <!-- PWA 主題顏色設定 - 控制手機狀態列背景色 -->
    <!-- 設定為與標題欄相同的深灰色 #333333 -->
    <meta name="theme-color" content="#333333">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="小朋友工具">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-192.png">
    
    <style>
        /* ============================================
         * CSS 變數定義區域 - 與原本計算機保持一致的外觀設計
         * ============================================ */
        
        :root {
            /* 主題色彩 - 沿用原本的暗夜橘焰主題 */
            --primary-color: #333333;                      /* 主要背景色 */
            --secondary-color: #4a4a4a;                    /* 次要背景色 */
            --text-color: #ffffff;                         /* 文字顏色 */
            --text-muted: #999999;                         /* 淡化文字顏色 */
            --border-color: #555555;                       /* 邊框顏色 */
            --hover-color: #666666;                        /* 懸停背景色 */
            --shadow-color: rgba(0, 0, 0, 0.3);           /* 陰影顏色 */
            
            /* 橘色強調色系 */
            --accent-color: #ff9c33;                       /* 強調色（橘色） */
            --accent-color-light: rgba(255, 156, 51, 0.2); /* 淡強調色 */
            --accent-color-dark: #e88a22;                  /* 深強調色 */
            
            /* 字體大小 */
            --font-size-md: 16px;                          /* 中字體 */
            --font-size-lg: 18px;                          /* 大字體 */
            --font-size-xl: 22px;                          /* 特大字體（標題） */
            
            /* 動畫效果 */
            --transition-fast: 0.2s;                       /* 快速過渡動畫 */

            /* 新增尺寸相關變數 */
            --border-radius-sm: 4px;                       /* 小圓角 */
            --border-radius-md: 8px;                       /* 中圓角 */
            --spacing-sm: 4px;                             /* 小間距 */
            --spacing-md: 8px;                             /* 中間距 */
            --spacing-lg: 15px;                            /* 大間距 */
            --font-size-sm: 14px;                          /* 小字體 */

            /* 陰影效果 */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);    /* 小陰影 */

        }
        
        /* ============================================
         * 基本頁面設定
         * ============================================ */
        
        * {
            margin: 0;                                      /* 重置所有外邊距 */
            padding: 0;                                     /* 重置所有內邊距 */
            box-sizing: border-box;                         /* 使用邊框盒模型 */
        }
        
        body {
            width: 100%;                                      /* 滿寬度 */
            max-width: 400px;                                 /* 最大寬度限制 */
            margin: 0 auto;                                   /* 水平居中 */
            position: relative;                               /* 相對定位 */
            overflow-x: hidden;                               /* 隱藏水平捲軸 */
            -webkit-text-size-adjust: 100%;                   /* 防止字體縮放 */
            padding: 0 3px;                                   /* 左右小內距 */
            background-color: var(--primary-color);          /* 背景色 */
            color: var(--text-color);                         /* 文字顏色 */
            font-family: "Microsoft JhengHei", Arial, sans-serif; /* 字體設定 */
            box-sizing: border-box;                           /* 邊框盒模型 */
            height: 100vh;                                    /* 視窗滿高度 */
            padding-top: 0;                                   /* 頂部無內距 */
            -webkit-user-select: none;                        /* 禁止選取（iOS） */
            -moz-user-select: none;                           /* 禁止選取（Firefox） */
            user-select: none;                                /* 禁止選取 */
        }
        
        /* ============================================
         * Header 設計 - 沿用原本計算機的外觀
         * ============================================ */
        
        .header-container {
            position: fixed;                                  /* 固定在頂部 */
            top: 0;                                          /* 頂部對齊 */
            left: 50%;                                       /* 左側定位到中央 */
            transform: translateX(-50%);                     /* 水平居中對齊 */
            width: 100%;                                     /* 滿寬度 */
            max-width: 400px;                               /* 最大寬度限制 */
            height: 60px;                                    /* 固定高度 */
            background-color: var(--primary-color);         /* 背景色 */
            box-shadow: var(--shadow-sm);                   /* 陰影效果 */
            z-index: 1100;                                  /* 最高層級 */
            display: flex;                                   /* 彈性佈局 */
            align-items: center;                             /* 垂直居中 */
            justify-content: space-between;                  /* 兩端對齊 */
            padding: 0 var(--spacing-lg);                   /* 左右內距 */
            box-sizing: border-box;                          /* 邊框盒模型 */
        }
        
        /* 主標題設計 */
        .page-title {
            color: var(--text-color);                        /* 白色文字 */
            font-size: var(--font-size-xl);                 /* 大字體 */
            margin: 0;                                       /* 移除邊距 */
            border-bottom: 2px solid var(--accent-color);   /* 底部橘色邊框 */
            padding-bottom: 5px;                            /* 底部內距 */
            flex-shrink: 0;                                  /* 不縮小 */
            font-weight: bold;                               /* 粗體 */
        }
        
        /* ============================================
        * 導航按鈕設計 - 參考檔案風格
        * ============================================ */

        /* 導航按鈕容器 */
        .nav-buttons {
            display: flex;                                   /* 彈性佈局 */
            gap: var(--spacing-md);                         /* 按鈕間距 */
            align-items: center;                             /* 垂直居中 */
        }

        /* 導航按鈕樣式 */
        .nav-btn {
            background-color: var(--secondary-color);       /* 次要背景色 */
            color: var(--text-color);                       /* 白色文字 */
            border: none;                                    /* 無邊框 */
            border-radius: var(--border-radius-sm);         /* 小圓角 */
            padding: 6px 12px;                              /* 內距設定 */
            font-size: var(--font-size-sm);                /* 小字體 */
            cursor: pointer;                                 /* 指標樣式 */
            transition: background-color var(--transition-fast); /* 背景色動畫 */
            font-family: inherit;                            /* 繼承字體 */
            font-weight: normal;                             /* 正常字重 */
        }

        /* 導航按鈕懸停效果 */
        .nav-btn:hover {
            background-color: var(--hover-color);           /* 懸停背景 */
        }

        /* 導航按鈕激活狀態 */
        .nav-btn.active {
            background-color: var(--accent-color);          /* 橘色背景 */
            color: #333333;                                 /* 深色文字 */
            font-weight: bold;                              /* 粗體 */
        }
        
        /* ============================================
         * iframe 內容區域設計
         * ============================================ */
        
        .content-container {
            position: fixed;                                 /* 固定定位 */
            top: 45px;                                       /* 在header下方 */
            left: 50%;                                       /* 左側定位到中央 */
            transform: translateX(-50%);                     /* 水平居中對齊 */
            width: 100%;                                     /* 滿寬度 */
            max-width: 400px;                               /* 最大寬度限制 */
            height: calc(100vh - 60px);                     /* 剩餘高度 */
            border: none;                                    /* 無邊框 */
            overflow: hidden;                                /* 隱藏溢出 */
        }
        
        /* iframe 樣式 */
        .page-iframe {
            width: 100%;                                     /* 滿寬度 */
            height: 100%;                                    /* 滿高度 */
            border: none;                                    /* 無邊框 */
            background: var(--primary-color);               /* 背景色 */
        }
        
        /* ============================================
         * 響應式設計 - 適配不同螢幕尺寸
         * ============================================ */
        
        /* 針對較小的螢幕調整 */
        @media screen and (max-width: 380px) {
            .nav-button {
                font-size: 14px;                            /* 較小字體 */
            }
            
            .page-title {
                font-size: 20px;                            /* 較小標題 */
            }
        }
        
        /* 針對觸控設備優化 */
        @media (hover: none) {
            .nav-button:hover {
                background: none;                            /* 取消懸停效果 */
                color: var(--text-color);                    /* 保持原色 */
            }
            
            .nav-button:active {
                background: var(--hover-color);             /* 點擊效果 */
                color: var(--accent-color);                  /* 橘色文字 */
            }
        }

        /* ============================================
        * PWA 安裝引導畫面樣式
        * ============================================ */

        /* 安裝引導畫面遮罩層 */
        .install-prompt-overlay {
            position: fixed;                                /* 固定定位覆蓋整個螢幕 */
            top: 0;                                        /* 從頂部開始 */
            left: 0;                                       /* 從左側開始 */
            width: 100%;                                   /* 全寬度 */
            height: 100%;                                  /* 全高度 */
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%); /* 漸層背景 */
            z-index: 9999;                                 /* 最高層級確保覆蓋所有內容 */
            display: flex;                                 /* 彈性佈局 */
            flex-direction: column;                        /* 垂直排列 */
            align-items: center;                           /* 水平居中 */
            justify-content: center;                       /* 垂直居中 */
            padding: 20px;                                 /* 內邊距 */
            box-sizing: border-box;                       /* 邊框盒模型 */
            opacity: 0;                                    /* 初始透明 */
            animation: fadeIn 0.01s forwards;              /* 淡入動畫 */
        }

        /* 淡入動畫定義 */
        @keyframes fadeIn {
            to {
                opacity: 1;                                /* 完全不透明 */
            }
        }

        /* 安裝引導容器 */
        .install-prompt-container {
            background: var(--primary-color);             /* 主要背景色 */
            border-radius: 15px;                          /* 圓角 */
            padding: 30px 25px;                           /* 內邊距 */
            max-width: 350px;                             /* 最大寬度 */
            width: 90%;                                   /* 寬度90% */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);  /* 陰影效果 */
            text-align: center;                           /* 文字居中 */
        }

        /* 安裝引導標題 - 可點擊但不顯示 */
        .install-prompt-title {
            color: var(--accent-color);                   /* 橘色文字 */
            font-size: 24px;                              /* 大字體 */
            font-weight: bold;                            /* 粗體 */
            margin-bottom: 15px;                          /* 底部間距 */
            cursor: default;                               /* 預設游標不暗示可點擊 */
            user-select: none;                            /* 禁止選取文字 */
            -webkit-user-select: none;                    /* iOS禁止選取 */
            -webkit-tap-highlight-color: transparent;     /* 移除點擊高亮 */
        }

        /* 安裝引導說明文字 */
        .install-prompt-text {
            color: var(--text-color);                     /* 白色文字 */
            font-size: 16px;                              /* 標準字體 */
            line-height: 1.6;                             /* 行高 */
            margin-bottom: 25px;                          /* 底部間距 */
        }

        /* 操作系統區塊 */
        .install-os-section {
            background: var(--secondary-color);           /* 次要背景色 */
            border-radius: 10px;                          /* 圓角 */
            padding: 15px;                                /* 內邊距 */
            margin-bottom: 15px;                          /* 底部間距 */
            text-align: left;                             /* 文字左對齊 */
        }

        /* 操作系統標題 */
        .install-os-title {
            color: var(--accent-color);                   /* 橘色文字 */
            font-size: 18px;                              /* 中等字體 */
            font-weight: bold;                            /* 粗體 */
            margin-bottom: 10px;                          /* 底部間距 */
            display: flex;                                /* 彈性佈局 */
            align-items: center;                          /* 垂直居中 */
            gap: 8px;                                     /* 圖示與文字間距 */
        }

        /* 安裝步驟列表 */
        .install-steps {
            color: var(--text-muted);                     /* 淡化文字顏色 */
            font-size: 14px;                              /* 小字體 */
            line-height: 1.8;                             /* 行高 */
            padding-left: 20px;                           /* 左側內邊距 */
        }

        /* 安裝步驟項目 */
        .install-steps li {
            margin-bottom: 8px;                           /* 底部間距 */
        }

        /* 強調文字樣式 */
        .install-highlight {
            color: var(--accent-color);                   /* 橘色文字 */
            font-weight: bold;                            /* 粗體 */
        }

        /* 隱藏安裝引導畫面 */
        .install-prompt-overlay.hidden {
            display: none;                                 /* 完全隱藏 */
        }

    </style>
</head>

<body>

    <!-- ============================================
    * PWA 安裝引導畫面
    * ============================================ -->
    <div class="install-prompt-overlay" id="installPromptOverlay">
        <div class="install-prompt-container">
            <!-- 標題：連續點擊4次可關閉（隱藏功能） -->
            <h2 class="install-prompt-title" id="installPromptTitle">
                安裝小朋友工具
            </h2>
            
            <p class="install-prompt-text">
                請依照以下指引安裝應用程式
            </p>
            
            <!-- iOS 安裝說明 -->
            <div class="install-os-section" id="iosSection">
                <div class="install-os-title">
                    iPhone / iPad
                </div>
                <ol class="install-steps">
                    <li>點擊瀏覽器底部的 <span class="install-highlight">分享按鈕</span> ⬆️</li>
                    <li>在選單中向下滑動</li>
                    <li>點選 <span class="install-highlight">「加入主畫面」</span></li>
                    <li>點擊右上角的 <span class="install-highlight">「加入」</span></li>
                </ol>
            </div>
            
            <!-- Android 安裝說明 -->
            <div class="install-os-section" id="androidSection">
                <div class="install-os-title">
                    Android
                </div>
                <ol class="install-steps">
                    <li>點擊瀏覽器右上角的 <span class="install-highlight">選單按鈕</span> ⋮</li>
                    <li>選擇 <span class="install-highlight">「安裝應用程式」</span></li>
                    <li>或選擇 <span class="install-highlight">「加到主畫面」</span></li>
                    <li>點擊 <span class="install-highlight">「安裝」</span> 確認</li>
                </ol>
            </div>
            
            <!-- 電腦版 Chrome 安裝說明 -->
            <div class="install-os-section" id="desktopSection">
                <div class="install-os-title">
                    電腦版瀏覽器
                </div>
                <ol class="install-steps">
                    <li>點擊網址列右側的 <span class="install-highlight">安裝圖示</span> ⊕</li>
                    <li>或點擊右上角 <span class="install-highlight">選單</span> ⋮</li>
                    <li>選擇 <span class="install-highlight">「安裝小朋友工具」</span></li>
                    <li>點擊 <span class="install-highlight">「安裝」</span> 確認</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- ============================================
    * 頁面標題區域 - Header
    * ============================================ -->
    <div class="header-container">
        <h1 class="page-title">小朋友專用</h1>
        <div class="nav-buttons">
            <button class="nav-btn active" data-page="calculator">計算</button>
            <button class="nav-btn" data-page="check">支票</button>
            <button class="nav-btn" data-page="invoice">發票</button>
            <button class="nav-btn" data-page="gas">加油</button>
        </div>
    </div>
    
    <!-- ============================================
     * 主要內容區域 - iframe
     * ============================================ -->
    <div class="content-container">
        <!-- 移除載入動畫，改為預載所有頁面的 iframe -->
        <!-- 計算機頁面 - 預設顯示 -->
        <iframe class="page-iframe" id="calculatorFrame" src="pages/calculator.html" style="display: block;"></iframe>
        
        <!-- 支票頁面 - 預設隱藏 -->
        <iframe class="page-iframe" id="checkFrame" src="pages/check.html" style="display: none;"></iframe>
        
        <!-- 發票頁面 - 預設隱藏 -->
        <iframe class="page-iframe" id="invoiceFrame" src="pages/invoice.html" style="display: none;"></iframe>
        
        <!-- 加油頁面 - 預設隱藏 -->
        <iframe class="page-iframe" id="gasFrame" src="pages/gas.html" style="display: none;"></iframe>
    </div>
    
    <!-- ============================================
     * JavaScript 功能程式碼
     * ============================================ -->
    <script>
        /**
         * 小朋友工具 - 主要功能控制程式
         * 處理頁面切換、iframe載入、PWA註冊等功能
         */
        
        // ============================================
        // 全域變數定義
        // ============================================
        
        let currentPage = 'calculator';                     // 目前顯示的頁面
        const pageMapping = {                               // 頁面對應關係
            'calculator': 'pages/calculator.html',         // 計算機頁面
            'check': 'pages/check.html',                   // 支票頁面
            'invoice': 'pages/invoice.html',               // 發票頁面
            'gas': 'pages/gas.html'                        // 加油頁面
        };
        
        // ============================================
        // 頁面載入完成後初始化
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('小朋友工具 - 頁面初始化開始');
            
            // 初始化安裝引導畫面（新增的）
            initializeInstallPrompt();
            
            // 初始化導航功能
            initializeNavigation();
            
            // 註冊Service Worker (PWA功能)
            registerServiceWorker();
            
            console.log('小朋友工具 - 頁面初始化完成');
        });


        // ============================================
        // PWA 安裝引導畫面控制
        // ============================================

        // 初始化安裝引導畫面
        initializeInstallPrompt();

        /**
         * 初始化 PWA 安裝引導畫面
         * 檢測是否已安裝為 PWA，控制顯示邏輯
         */
        function initializeInstallPrompt() {
            const installOverlay = document.getElementById('installPromptOverlay');
            const installTitle = document.getElementById('installPromptTitle');
            
            // 檢測是否為 PWA 模式（已安裝的應用程式）
            const isPWA = window.matchMedia('(display-mode: standalone)').matches || 
                        window.navigator.standalone === true;  // iOS 檢測
            
            // 檢測作業系統類型
            const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            const isDesktop = !isIOS && !isAndroid;
            
            // 根據作業系統顯示對應的安裝說明
            const iosSection = document.getElementById('iosSection');
            const androidSection = document.getElementById('androidSection');
            const desktopSection = document.getElementById('desktopSection');
            
            // 預設隱藏所有區塊
            iosSection.style.display = 'none';
            androidSection.style.display = 'none';
            desktopSection.style.display = 'none';
            
            // 顯示對應的操作系統說明
            if (isIOS) {
                iosSection.style.display = 'block';
            } else if (isAndroid) {
                androidSection.style.display = 'block';
            } else {
                desktopSection.style.display = 'block';
            }
            
            // 如果已經是 PWA 模式，直接隱藏引導畫面
            if (isPWA) {
                installOverlay.classList.add('hidden');
                console.log('已偵測到 PWA 模式，隱藏安裝引導');
                return;
            }
            
            // 如果不是 PWA 模式，顯示引導畫面
            console.log('非 PWA 模式，顯示安裝引導');
            
            // ============================================
            // 隱藏功能：連續點擊標題 4 次關閉引導畫面
            // ============================================
            
            let clickCount = 0;                    // 點擊計數器
            let clickTimer = null;                 // 計時器
            
            // 為標題綁定點擊事件
            installTitle.addEventListener('click', function(e) {
                e.preventDefault();                 // 防止預設行為
                
                clickCount++;                       // 增加點擊次數
                
                // 清除之前的計時器
                if (clickTimer) {
                    clearTimeout(clickTimer);
                }
                
                // 檢查是否達到 4 次點擊
                if (clickCount >= 4) {
                    console.log('觸發隱藏功能：關閉安裝引導畫面');
                    
                    // 添加淡出動畫後隱藏
                    installOverlay.style.animation = 'fadeOut 0.3s forwards';
                    
                    setTimeout(() => {
                        installOverlay.classList.add('hidden');
                        // 儲存關閉狀態到本地存儲（可選）
                        localStorage.setItem('installPromptDismissed', 'true');
                    }, 300);
                    
                    // 重置計數器
                    clickCount = 0;
                }
                
                // 設置計時器：2秒後重置計數器
                clickTimer = setTimeout(() => {
                    clickCount = 0;                 // 重置計數
                    console.log('點擊計數器已重置');
                }, 2000);  // 2秒內要完成4次點擊
            });
            
            // 檢查是否曾經關閉過引導畫面（可選功能）
            const wasDismissed = localStorage.getItem('installPromptDismissed');
            if (wasDismissed === 'true') {
                // 如果使用者曾經關閉過，可以選擇直接隱藏
                // installOverlay.classList.add('hidden');
                // 或者仍然顯示，讓使用者自行決定
            }
        }

        // 添加淡出動畫定義
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // ============================================
        // 導航功能初始化
        // ============================================
        
        function initializeNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');  // 更改選擇器為新的類別名稱
            
            // 為每個導航按鈕綁定點擊事件
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetPage = this.getAttribute('data-page');
                    switchPage(targetPage);
                });
            });
        }
        
        // ============================================
        // 頁面切換功能
        // ============================================
        
        function switchPage(pageName) {
            console.log(`頁面切換: ${currentPage} -> ${pageName}`);
            
            // 檢查頁面是否存在
            if (!pageMapping[pageName]) {
                console.error(`頁面不存在: ${pageName}`);
                return;
            }
            
            // ============================================
            // 使用顯示/隱藏方式切換頁面，不重新載入
            // ============================================
            
            // 隱藏當前頁面的 iframe
            const currentFrame = document.getElementById(currentPage + 'Frame');
            if (currentFrame) {
                currentFrame.style.display = 'none';  // 隱藏當前頁面
            }
            
            // 顯示目標頁面的 iframe
            const targetFrame = document.getElementById(pageName + 'Frame');
            if (targetFrame) {
                targetFrame.style.display = 'block';   // 顯示新頁面
            }
            
            // 更新目前頁面變數
            currentPage = pageName;
            
            // 更新導航按鈕狀態
            updateNavigationState(pageName);
            
            // 不再需要呼叫 loadPageInIframe
            // loadPageInIframe(pageName);  // 移除這行
        }
        
        // ============================================
        // 更新導航按鈕狀態
        // ============================================
        
        function updateNavigationState(activePage) {
            const navButtons = document.querySelectorAll('.nav-btn');  // 更改選擇器為新的類別名稱
            
            // 移除所有active狀態
            navButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // 添加新的active狀態
            const activeButton = document.querySelector(`[data-page="${activePage}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }
        
        // ============================================
        // PWA Service Worker註冊
        // ============================================
        
        function registerServiceWorker() {
            // 檢查瀏覽器是否支援Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('sw.js')
                        .then(function(registration) {
                            console.log('Service Worker 註冊成功:', registration.scope);
                        })
                        .catch(function(error) {
                            console.log('Service Worker 註冊失敗:', error);
                        });
                });
            }
        }
        
        // ============================================
        // 防止右鍵選單和長按選取 (行動裝置優化)
        // ============================================
        
        // 禁止右鍵選單
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // 禁止文字選取 (觸控裝置)
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
        });
        
        // 禁止拖拽
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
        });
        
        console.log('小朋友工具 - JavaScript載入完成');
    </script>
</body>
</html>
