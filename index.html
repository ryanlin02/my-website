<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=400, user-scalable=no">
    <title>å°æœ‹å‹å·¥å…·</title>

    <!-- å°‡ä»¥ä¸‹ç¨‹å¼ç¢¼åŠ å…¥ index.html çš„ <head> æ¨™ç±¤å…§ -->
    <!-- æ”¾åœ¨ <title> æ¨™ç±¤ä¹‹å¾Œ -->

    <!-- Google Analytics 4 è¿½è¹¤ä»£ç¢¼ -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XE5XMQR0Z1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        // åˆå§‹åŒ– GA4 - è«‹å°‡ G-XE5XMQR0Z1 æ›¿æ›ç‚ºæ‚¨çš„æ¸¬é‡ ID
        gtag('config', 'G-XE5XMQR0Z1', {
            // å¢å¼·å‹æ¸¬é‡è¨­å®š
            page_title: 'å°æœ‹å‹å·¥å…· - ä¸»é ',
            page_location: window.location.href,
            page_path: window.location.pathname,
            
            // è‡ªè¨‚ç¶­åº¦ï¼ˆå¯é¸ï¼‰
            custom_map: {
                'dimension1': 'user_type',
                'dimension2': 'device_type'
            }
        });
        
        // ============================================
        // è‡ªè¨‚äº‹ä»¶è¿½è¹¤å‡½æ•¸
        // ============================================
        
        /**
        * ç™¼é€è‡ªè¨‚äº‹ä»¶åˆ° GA4
        * @param {string} eventName - äº‹ä»¶åç¨±
        * @param {object} parameters - äº‹ä»¶åƒæ•¸
        */
        function trackEvent(eventName, parameters = {}) {
            gtag('event', eventName, parameters);
            console.log('GA4 Event:', eventName, parameters);
        }
        
        // ============================================
        // è¿½è¹¤é é¢åˆ‡æ›äº‹ä»¶
        // ============================================
        
        // ä¿®æ”¹åŸæœ¬çš„ switchPage å‡½æ•¸ï¼ŒåŠ å…¥è¿½è¹¤
        const originalSwitchPage = window.switchPage;
        window.switchPage = function(pageName) {
            // è¿½è¹¤é é¢åˆ‡æ›äº‹ä»¶
            trackEvent('page_switch', {
                from_page: currentPage,
                to_page: pageName,
                switch_method: 'navigation_button'
            });
            
            // è¿½è¹¤è™›æ“¬é é¢ç€è¦½
            gtag('event', 'page_view', {
                page_title: `å°æœ‹å‹å·¥å…· - ${getPageTitle(pageName)}`,
                page_location: window.location.href + '#' + pageName,
                page_path: '/' + pageName
            });
            
            // åŸ·è¡ŒåŸæœ¬çš„åˆ‡æ›å‡½æ•¸
            if (originalSwitchPage) {
                originalSwitchPage.call(this, pageName);
            }
        };
        
        // é é¢æ¨™é¡Œå°æ‡‰
        function getPageTitle(pageName) {
            const titles = {
                'calculator': 'è¨ˆç®—æ©Ÿ',
                'check': 'æ”¯ç¥¨',
                'invoice': 'ç™¼ç¥¨',
                'gas': 'åŠ æ²¹'
            };
            return titles[pageName] || pageName;
        }
        
        // ============================================
        // è¿½è¹¤ä½¿ç”¨è€…äº’å‹•äº‹ä»¶
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // è¿½è¹¤å°èˆªæŒ‰éˆ•é»æ“Š
            document.querySelectorAll('.nav-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const targetPage = this.getAttribute('data-page');
                    trackEvent('navigation_click', {
                        button_text: this.textContent,
                        target_page: targetPage
                    });
                });
            });
            
            // è¿½è¹¤ iframe è¼‰å…¥æ™‚é–“
            const iframe = document.getElementById('pageIframe');
            let loadStartTime;
            
            iframe.addEventListener('loadstart', function() {
                loadStartTime = performance.now();
            });
            
            iframe.addEventListener('load', function() {
                if (loadStartTime) {
                    const loadTime = performance.now() - loadStartTime;
                    trackEvent('iframe_load', {
                        page: currentPage,
                        load_time_ms: Math.round(loadTime),
                        iframe_src: iframe.src
                    });
                }
            });
            
            // è¿½è¹¤ä½¿ç”¨è€…åƒèˆ‡åº¦
            let engagementStartTime = Date.now();
            let isEngaged = true;
            
            // æ¯30ç§’è¿½è¹¤ä¸€æ¬¡åƒèˆ‡åº¦
            setInterval(function() {
                if (isEngaged) {
                    trackEvent('user_engagement', {
                        engagement_time_seconds: Math.round((Date.now() - engagementStartTime) / 1000),
                        current_page: currentPage
                    });
                }
            }, 30000);
            
            // è¿½è¹¤é é¢å¯è¦‹æ€§è®ŠåŒ–
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    isEngaged = false;
                    trackEvent('page_visibility', {
                        visibility: 'hidden',
                        current_page: currentPage
                    });
                } else {
                    isEngaged = true;
                    engagementStartTime = Date.now();
                    trackEvent('page_visibility', {
                        visibility: 'visible',
                        current_page: currentPage
                    });
                }
            });
            
            // è¿½è¹¤éŒ¯èª¤
            window.addEventListener('error', function(e) {
                trackEvent('javascript_error', {
                    error_message: e.message,
                    error_source: e.filename,
                    error_line: e.lineno,
                    current_page: currentPage
                });
            });
        });
        
        // ============================================
        // è¿½è¹¤ PWA å®‰è£äº‹ä»¶
        // ============================================
        
        window.addEventListener('beforeinstallprompt', function(e) {
            trackEvent('pwa_install_prompt', {
                prompted: true
            });
            
            e.userChoice.then(function(choiceResult) {
                trackEvent('pwa_install_choice', {
                    outcome: choiceResult.outcome
                });
            });
        });
        
        // è¿½è¹¤ Service Worker è¨»å†Š
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(function(registration) {
                trackEvent('service_worker_ready', {
                    scope: registration.scope
                });
            });
        }
        
        // ============================================
        // è¿½è¹¤è£ç½®è³‡è¨Š
        // ============================================
        
        // åˆå§‹è¼‰å…¥æ™‚è¿½è¹¤è£ç½®è³‡è¨Š
        window.addEventListener('load', function() {
            trackEvent('device_info', {
                screen_width: window.screen.width,
                screen_height: window.screen.height,
                viewport_width: window.innerWidth,
                viewport_height: window.innerHeight,
                device_pixel_ratio: window.devicePixelRatio,
                touch_enabled: 'ontouchstart' in window,
                standalone_mode: window.matchMedia('(display-mode: standalone)').matches
            });
        });
    </script>
    
    <!-- PWA ç›¸é—œè¨­å®š -->
    <!-- PWA ä¸»é¡Œé¡è‰²è¨­å®š - æ§åˆ¶æ‰‹æ©Ÿç‹€æ…‹åˆ—èƒŒæ™¯è‰² -->
    <!-- è¨­å®šç‚ºèˆ‡æ¨™é¡Œæ¬„ç›¸åŒçš„æ·±ç°è‰² #333333 -->
    <meta name="theme-color" content="#333333">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å°æœ‹å‹å·¥å…·">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-192.png">
    
    <style>
        /* ============================================
         * CSS è®Šæ•¸å®šç¾©å€åŸŸ - èˆ‡åŸæœ¬è¨ˆç®—æ©Ÿä¿æŒä¸€è‡´çš„å¤–è§€è¨­è¨ˆ
         * ============================================ */
        
        :root {
            /* ä¸»é¡Œè‰²å½© - æ²¿ç”¨åŸæœ¬çš„æš—å¤œæ©˜ç„°ä¸»é¡Œ */
            --primary-color: #333333;                      /* ä¸»è¦èƒŒæ™¯è‰² */
            --secondary-color: #4a4a4a;                    /* æ¬¡è¦èƒŒæ™¯è‰² */
            --text-color: #ffffff;                         /* æ–‡å­—é¡è‰² */
            --text-muted: #999999;                         /* æ·¡åŒ–æ–‡å­—é¡è‰² */
            --border-color: #555555;                       /* é‚Šæ¡†é¡è‰² */
            --hover-color: #666666;                        /* æ‡¸åœèƒŒæ™¯è‰² */
            --shadow-color: rgba(0, 0, 0, 0.3);           /* é™°å½±é¡è‰² */
            
            /* æ©˜è‰²å¼·èª¿è‰²ç³» */
            --accent-color: #ff9c33;                       /* å¼·èª¿è‰²ï¼ˆæ©˜è‰²ï¼‰ */
            --accent-color-light: rgba(255, 156, 51, 0.2); /* æ·¡å¼·èª¿è‰² */
            --accent-color-dark: #e88a22;                  /* æ·±å¼·èª¿è‰² */
            
            /* å­—é«”å¤§å° */
            --font-size-md: 16px;                          /* ä¸­å­—é«” */
            --font-size-lg: 18px;                          /* å¤§å­—é«” */
            --font-size-xl: 22px;                          /* ç‰¹å¤§å­—é«”ï¼ˆæ¨™é¡Œï¼‰ */
            
            /* å‹•ç•«æ•ˆæœ */
            --transition-fast: 0.2s;                       /* å¿«é€Ÿéæ¸¡å‹•ç•« */

            /* æ–°å¢å°ºå¯¸ç›¸é—œè®Šæ•¸ */
            --border-radius-sm: 4px;                       /* å°åœ“è§’ */
            --border-radius-md: 8px;                       /* ä¸­åœ“è§’ */
            --spacing-sm: 4px;                             /* å°é–“è· */
            --spacing-md: 8px;                             /* ä¸­é–“è· */
            --spacing-lg: 15px;                            /* å¤§é–“è· */
            --font-size-sm: 14px;                          /* å°å­—é«” */

            /* é™°å½±æ•ˆæœ */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);    /* å°é™°å½± */

        }
        
        /* ============================================
         * åŸºæœ¬é é¢è¨­å®š
         * ============================================ */
        
        * {
            margin: 0;                                      /* é‡ç½®æ‰€æœ‰å¤–é‚Šè· */
            padding: 0;                                     /* é‡ç½®æ‰€æœ‰å…§é‚Šè· */
            box-sizing: border-box;                         /* ä½¿ç”¨é‚Šæ¡†ç›’æ¨¡å‹ */
        }
        
        body {
            width: 100%;                                      /* æ»¿å¯¬åº¦ */
            max-width: 400px;                                 /* æœ€å¤§å¯¬åº¦é™åˆ¶ */
            margin: 0 auto;                                   /* æ°´å¹³å±…ä¸­ */
            position: relative;                               /* ç›¸å°å®šä½ */
            overflow-x: hidden;                               /* éš±è—æ°´å¹³æ²è»¸ */
            -webkit-text-size-adjust: 100%;                   /* é˜²æ­¢å­—é«”ç¸®æ”¾ */
            padding: 0 3px;                                   /* å·¦å³å°å…§è· */
            background-color: var(--primary-color);          /* èƒŒæ™¯è‰² */
            color: var(--text-color);                         /* æ–‡å­—é¡è‰² */
            font-family: "Microsoft JhengHei", Arial, sans-serif; /* å­—é«”è¨­å®š */
            box-sizing: border-box;                           /* é‚Šæ¡†ç›’æ¨¡å‹ */
            height: 100vh;                                    /* è¦–çª—æ»¿é«˜åº¦ */
            padding-top: 0;                                   /* é ‚éƒ¨ç„¡å…§è· */
            -webkit-user-select: none;                        /* ç¦æ­¢é¸å–ï¼ˆiOSï¼‰ */
            -moz-user-select: none;                           /* ç¦æ­¢é¸å–ï¼ˆFirefoxï¼‰ */
            user-select: none;                                /* ç¦æ­¢é¸å– */
        }
        
        /* ============================================
         * Header è¨­è¨ˆ - æ²¿ç”¨åŸæœ¬è¨ˆç®—æ©Ÿçš„å¤–è§€
         * ============================================ */
        
        .header-container {
            position: fixed;                                  /* å›ºå®šåœ¨é ‚éƒ¨ */
            top: 0;                                          /* é ‚éƒ¨å°é½Š */
            left: 50%;                                       /* å·¦å´å®šä½åˆ°ä¸­å¤® */
            transform: translateX(-50%);                     /* æ°´å¹³å±…ä¸­å°é½Š */
            width: 100%;                                     /* æ»¿å¯¬åº¦ */
            max-width: 400px;                               /* æœ€å¤§å¯¬åº¦é™åˆ¶ */
            height: 60px;                                    /* å›ºå®šé«˜åº¦ */
            background-color: var(--primary-color);         /* èƒŒæ™¯è‰² */
            box-shadow: var(--shadow-sm);                   /* é™°å½±æ•ˆæœ */
            z-index: 1100;                                  /* æœ€é«˜å±¤ç´š */
            display: flex;                                   /* å½ˆæ€§ä½ˆå±€ */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
            justify-content: space-between;                  /* å…©ç«¯å°é½Š */
            padding: 0 var(--spacing-lg);                   /* å·¦å³å…§è· */
            box-sizing: border-box;                          /* é‚Šæ¡†ç›’æ¨¡å‹ */
        }
        
        /* ä¸»æ¨™é¡Œè¨­è¨ˆ */
        .page-title {
            color: var(--text-color);                        /* ç™½è‰²æ–‡å­— */
            font-size: var(--font-size-xl);                 /* å¤§å­—é«” */
            margin: 0;                                       /* ç§»é™¤é‚Šè· */
            border-bottom: 2px solid var(--accent-color);   /* åº•éƒ¨æ©˜è‰²é‚Šæ¡† */
            padding-bottom: 5px;                            /* åº•éƒ¨å…§è· */
            flex-shrink: 0;                                  /* ä¸ç¸®å° */
            font-weight: bold;                               /* ç²—é«” */
        }
        
        /* ============================================
        * å°èˆªæŒ‰éˆ•è¨­è¨ˆ - åƒè€ƒæª”æ¡ˆé¢¨æ ¼
        * ============================================ */

        /* å°èˆªæŒ‰éˆ•å®¹å™¨ */
        .nav-buttons {
            display: flex;                                   /* å½ˆæ€§ä½ˆå±€ */
            gap: var(--spacing-md);                         /* æŒ‰éˆ•é–“è· */
            align-items: center;                             /* å‚ç›´å±…ä¸­ */
        }

        /* å°èˆªæŒ‰éˆ•æ¨£å¼ */
        .nav-btn {
            background-color: var(--secondary-color);       /* æ¬¡è¦èƒŒæ™¯è‰² */
            color: var(--text-color);                       /* ç™½è‰²æ–‡å­— */
            border: none;                                    /* ç„¡é‚Šæ¡† */
            border-radius: var(--border-radius-sm);         /* å°åœ“è§’ */
            padding: 6px 12px;                              /* å…§è·è¨­å®š */
            font-size: var(--font-size-sm);                /* å°å­—é«” */
            cursor: pointer;                                 /* æŒ‡æ¨™æ¨£å¼ */
            transition: background-color var(--transition-fast); /* èƒŒæ™¯è‰²å‹•ç•« */
            font-family: inherit;                            /* ç¹¼æ‰¿å­—é«” */
            font-weight: normal;                             /* æ­£å¸¸å­—é‡ */
        }

        /* å°èˆªæŒ‰éˆ•æ‡¸åœæ•ˆæœ */
        .nav-btn:hover {
            background-color: var(--hover-color);           /* æ‡¸åœèƒŒæ™¯ */
        }

        /* å°èˆªæŒ‰éˆ•æ¿€æ´»ç‹€æ…‹ */
        .nav-btn.active {
            background-color: var(--accent-color);          /* æ©˜è‰²èƒŒæ™¯ */
            color: #333333;                                 /* æ·±è‰²æ–‡å­— */
            font-weight: bold;                              /* ç²—é«” */
        }
        
        /* ============================================
         * iframe å…§å®¹å€åŸŸè¨­è¨ˆ
         * ============================================ */
        
        .content-container {
            position: fixed;                                 /* å›ºå®šå®šä½ */
            top: 45px;                                       /* åœ¨headerä¸‹æ–¹ */
            left: 50%;                                       /* å·¦å´å®šä½åˆ°ä¸­å¤® */
            transform: translateX(-50%);                     /* æ°´å¹³å±…ä¸­å°é½Š */
            width: 100%;                                     /* æ»¿å¯¬åº¦ */
            max-width: 400px;                               /* æœ€å¤§å¯¬åº¦é™åˆ¶ */
            height: calc(100vh - 60px);                     /* å‰©é¤˜é«˜åº¦ */
            border: none;                                    /* ç„¡é‚Šæ¡† */
            overflow: hidden;                                /* éš±è—æº¢å‡º */
        }
        
        /* iframe æ¨£å¼ */
        .page-iframe {
            width: 100%;                                     /* æ»¿å¯¬åº¦ */
            height: 100%;                                    /* æ»¿é«˜åº¦ */
            border: none;                                    /* ç„¡é‚Šæ¡† */
            background: var(--primary-color);               /* èƒŒæ™¯è‰² */
        }
        
        /* ============================================
         * éŸ¿æ‡‰å¼è¨­è¨ˆ - é©é…ä¸åŒè¢å¹•å°ºå¯¸
         * ============================================ */
        
        /* é‡å°è¼ƒå°çš„è¢å¹•èª¿æ•´ */
        @media screen and (max-width: 380px) {
            .nav-button {
                font-size: 14px;                            /* è¼ƒå°å­—é«” */
            }
            
            .page-title {
                font-size: 20px;                            /* è¼ƒå°æ¨™é¡Œ */
            }
        }
        
        /* é‡å°è§¸æ§è¨­å‚™å„ªåŒ– */
        @media (hover: none) {
            .nav-button:hover {
                background: none;                            /* å–æ¶ˆæ‡¸åœæ•ˆæœ */
                color: var(--text-color);                    /* ä¿æŒåŸè‰² */
            }
            
            .nav-button:active {
                background: var(--hover-color);             /* é»æ“Šæ•ˆæœ */
                color: var(--accent-color);                  /* æ©˜è‰²æ–‡å­— */
            }
        }

        /* ============================================
        * PWA å®‰è£å¼•å°ç•«é¢æ¨£å¼
        * ============================================ */

        /* å®‰è£å¼•å°ç•«é¢é®ç½©å±¤ */
        .install-prompt-overlay {
            position: fixed;                                /* å›ºå®šå®šä½è¦†è“‹æ•´å€‹è¢å¹• */
            top: 0;                                        /* å¾é ‚éƒ¨é–‹å§‹ */
            left: 0;                                       /* å¾å·¦å´é–‹å§‹ */
            width: 100%;                                   /* å…¨å¯¬åº¦ */
            height: 100%;                                  /* å…¨é«˜åº¦ */
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%); /* æ¼¸å±¤èƒŒæ™¯ */
            z-index: 9999;                                 /* æœ€é«˜å±¤ç´šç¢ºä¿è¦†è“‹æ‰€æœ‰å…§å®¹ */
            display: flex;                                 /* å½ˆæ€§ä½ˆå±€ */
            flex-direction: column;                        /* å‚ç›´æ’åˆ— */
            align-items: center;                           /* æ°´å¹³å±…ä¸­ */
            justify-content: center;                       /* å‚ç›´å±…ä¸­ */
            padding: 20px;                                 /* å…§é‚Šè· */
            box-sizing: border-box;                       /* é‚Šæ¡†ç›’æ¨¡å‹ */
            opacity: 0;                                    /* åˆå§‹é€æ˜ */
            animation: fadeIn 0.01s forwards;              /* æ·¡å…¥å‹•ç•« */
        }

        /* æ·¡å…¥å‹•ç•«å®šç¾© */
        @keyframes fadeIn {
            to {
                opacity: 1;                                /* å®Œå…¨ä¸é€æ˜ */
            }
        }

        /* å®‰è£å¼•å°å®¹å™¨ */
        .install-prompt-container {
            background: var(--primary-color);             /* ä¸»è¦èƒŒæ™¯è‰² */
            border-radius: 15px;                          /* åœ“è§’ */
            padding: 30px 25px;                           /* å…§é‚Šè· */
            max-width: 350px;                             /* æœ€å¤§å¯¬åº¦ */
            width: 90%;                                   /* å¯¬åº¦90% */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);  /* é™°å½±æ•ˆæœ */
            text-align: center;                           /* æ–‡å­—å±…ä¸­ */
        }

        /* å®‰è£å¼•å°æ¨™é¡Œ - å¯é»æ“Šä½†ä¸é¡¯ç¤º */
        .install-prompt-title {
            color: var(--accent-color);                   /* æ©˜è‰²æ–‡å­— */
            font-size: 24px;                              /* å¤§å­—é«” */
            font-weight: bold;                            /* ç²—é«” */
            margin-bottom: 15px;                          /* åº•éƒ¨é–“è· */
            cursor: default;                               /* é è¨­æ¸¸æ¨™ä¸æš—ç¤ºå¯é»æ“Š */
            user-select: none;                            /* ç¦æ­¢é¸å–æ–‡å­— */
            -webkit-user-select: none;                    /* iOSç¦æ­¢é¸å– */
            -webkit-tap-highlight-color: transparent;     /* ç§»é™¤é»æ“Šé«˜äº® */
        }

        /* å®‰è£å¼•å°èªªæ˜æ–‡å­— */
        .install-prompt-text {
            color: var(--text-color);                     /* ç™½è‰²æ–‡å­— */
            font-size: 16px;                              /* æ¨™æº–å­—é«” */
            line-height: 1.6;                             /* è¡Œé«˜ */
            margin-bottom: 25px;                          /* åº•éƒ¨é–“è· */
        }

        /* æ“ä½œç³»çµ±å€å¡Š */
        .install-os-section {
            background: var(--secondary-color);           /* æ¬¡è¦èƒŒæ™¯è‰² */
            border-radius: 10px;                          /* åœ“è§’ */
            padding: 15px;                                /* å…§é‚Šè· */
            margin-bottom: 15px;                          /* åº•éƒ¨é–“è· */
            text-align: left;                             /* æ–‡å­—å·¦å°é½Š */
        }

        /* æ“ä½œç³»çµ±æ¨™é¡Œ */
        .install-os-title {
            color: var(--accent-color);                   /* æ©˜è‰²æ–‡å­— */
            font-size: 18px;                              /* ä¸­ç­‰å­—é«” */
            font-weight: bold;                            /* ç²—é«” */
            margin-bottom: 10px;                          /* åº•éƒ¨é–“è· */
            display: flex;                                /* å½ˆæ€§ä½ˆå±€ */
            align-items: center;                          /* å‚ç›´å±…ä¸­ */
            gap: 8px;                                     /* åœ–ç¤ºèˆ‡æ–‡å­—é–“è· */
        }

        /* å®‰è£æ­¥é©Ÿåˆ—è¡¨ */
        .install-steps {
            color: var(--text-muted);                     /* æ·¡åŒ–æ–‡å­—é¡è‰² */
            font-size: 14px;                              /* å°å­—é«” */
            line-height: 1.8;                             /* è¡Œé«˜ */
            padding-left: 20px;                           /* å·¦å´å…§é‚Šè· */
        }

        /* å®‰è£æ­¥é©Ÿé …ç›® */
        .install-steps li {
            margin-bottom: 8px;                           /* åº•éƒ¨é–“è· */
        }

        /* å¼·èª¿æ–‡å­—æ¨£å¼ */
        .install-highlight {
            color: var(--accent-color);                   /* æ©˜è‰²æ–‡å­— */
            font-weight: bold;                            /* ç²—é«” */
        }

        /* éš±è—å®‰è£å¼•å°ç•«é¢ */
        .install-prompt-overlay.hidden {
            display: none;                                 /* å®Œå…¨éš±è— */
        }

        /* ============================================
        * ä¸»é¸å–®æ¨£å¼è¨­è¨ˆ
        * ============================================ */

        /* ä¸»é¸å–®é®ç½©å±¤ - å…¨è¢å¹•è¦†è“‹ */
        .main-menu-overlay {
            position: fixed;                              /* å›ºå®šå®šä½ */
            top: 0;                                      /* å¾é ‚éƒ¨é–‹å§‹ */
            left: 0;                                     /* å¾å·¦å´é–‹å§‹ */
            width: 100%;                                 /* å…¨å¯¬åº¦ */
            height: 100%;                                /* å…¨é«˜åº¦ */
            background: var(--primary-color);           /* ä½¿ç”¨ä¸»è¦èƒŒæ™¯è‰² */
            z-index: 10000;                             /* æœ€é«˜å±¤ç´šç¢ºä¿è¦†è“‹æ‰€æœ‰å…§å®¹ */
            display: none;                               /* é è¨­éš±è— */
            opacity: 0;                                  /* åˆå§‹é€æ˜ */
            transition: opacity var(--transition-fast);  /* æ·¡å…¥æ·¡å‡ºå‹•ç•« */
        }

        /* ä¸»é¸å–®å®¹å™¨ */
        .main-menu-container {
            width: 100%;                                 /* å…¨å¯¬åº¦ */
            max-width: 400px;                           /* æœ€å¤§å¯¬åº¦é™åˆ¶ */
            height: 100%;                                /* å…¨é«˜åº¦ */
            margin: 0 auto;                              /* æ°´å¹³å±…ä¸­ */
            display: flex;                               /* å½ˆæ€§ä½ˆå±€ */
            flex-direction: column;                      /* å‚ç›´æ’åˆ— */
            padding: 20px;                               /* å…§é‚Šè· */
            box-sizing: border-box;                      /* é‚Šæ¡†ç›’æ¨¡å‹ */
            transform: translateY(-20px);                /* åˆå§‹ä¸Šç§»ä½ç½® */
            transition: transform var(--transition-fast); /* æ»‘å…¥å‹•ç•« */
        }

        /* ä¸»é¸å–®é ‚éƒ¨å€åŸŸ */
        .main-menu-header {
            display: flex;                               /* å½ˆæ€§ä½ˆå±€ */
            justify-content: space-between;              /* å…©ç«¯å°é½Š */
            align-items: center;                         /* å‚ç›´å±…ä¸­ */
            padding-bottom: 20px;                        /* åº•éƒ¨å…§è· */
            border-bottom: 2px solid var(--accent-color); /* åº•éƒ¨æ©˜è‰²é‚Šæ¡† */
            margin-bottom: 30px;                         /* åº•éƒ¨å¤–é‚Šè· */
        }

        /* ä¸»é¸å–®æ¨™é¡Œ */
        .main-menu-title {
            font-size: var(--font-size-xl);             /* ç‰¹å¤§å­—é«” */
            color: var(--text-color);                    /* ç™½è‰²æ–‡å­— */
            font-weight: bold;                           /* ç²—é«” */
        }

        /* é—œé–‰æŒ‰éˆ• */
        .main-menu-close {
            width: 32px;                                 /* å¯¬åº¦ */
            height: 32px;                                /* é«˜åº¦ */
            background: var(--secondary-color);          /* æ¬¡è¦èƒŒæ™¯è‰² */
            border: none;                                /* ç„¡é‚Šæ¡† */
            border-radius: var(--border-radius-sm);      /* å°åœ“è§’ */
            color: var(--text-color);                    /* ç™½è‰²æ–‡å­— */
            font-size: 20px;                            /* å­—é«”å¤§å° */
            cursor: pointer;                             /* æŒ‡æ¨™æ¨£å¼ */
            display: flex;                               /* å½ˆæ€§ä½ˆå±€ */
            align-items: center;                         /* å‚ç›´å±…ä¸­ */
            justify-content: center;                     /* æ°´å¹³å±…ä¸­ */
            transition: background-color var(--transition-fast); /* èƒŒæ™¯è‰²å‹•ç•« */
        }

        /* é—œé–‰æŒ‰éˆ•æ‡¸åœæ•ˆæœ */
        .main-menu-close:hover {
            background-color: var(--hover-color);        /* æ‡¸åœèƒŒæ™¯ */
        }

        /* ä¸»é¸å–®å…§å®¹å€åŸŸ */
        .main-menu-content {
            flex: 1;                                     /* ä½”æ“šå‰©é¤˜ç©ºé–“ */
            overflow-y: auto;                            /* å‚ç›´æ»¾å‹• */
        }

        /* å·¥å…·èªªæ˜å€å¡Š */
        .menu-section {
            margin-bottom: 30px;                         /* åº•éƒ¨å¤–é‚Šè· */
        }

        /* å€å¡Šæ¨™é¡Œ */
        .menu-section-title {
            color: var(--accent-color);                  /* æ©˜è‰²æ–‡å­— */
            font-size: var(--font-size-lg);             /* å¤§å­—é«” */
            font-weight: bold;                           /* ç²—é«” */
            margin-bottom: 15px;                         /* åº•éƒ¨å¤–é‚Šè· */
            padding-left: 10px;                          /* å·¦å´å…§è· */
            border-left: 3px solid var(--accent-color);  /* å·¦å´æ©˜è‰²é‚Šæ¡† */
        }

        /* é¸å–®é …ç›®åˆ—è¡¨ */
        .menu-items {
            list-style: none;                            /* ç§»é™¤åˆ—è¡¨ç¬¦è™Ÿ */
            padding: 0;                                  /* ç„¡å…§è· */
            margin: 0;                                   /* ç„¡å¤–è· */
        }

        /* é¸å–®é …ç›® */
        .menu-item {
            background: var(--secondary-color);          /* æ¬¡è¦èƒŒæ™¯è‰² */
            margin-bottom: 10px;                         /* åº•éƒ¨å¤–é‚Šè· */
            border-radius: var(--border-radius-md);      /* ä¸­åœ“è§’ */
            transition: all var(--transition-fast);      /* å…¨éƒ¨å±¬æ€§å‹•ç•« */
        }

        /* é¸å–®é …ç›®é€£çµ */
        .menu-item-link {
            display: block;                              /* å€å¡Šé¡¯ç¤º */
            padding: 15px 20px;                          /* å…§è· */
            color: var(--text-color);                    /* ç™½è‰²æ–‡å­— */
            text-decoration: none;                       /* ç„¡åº•ç·š */
            font-size: var(--font-size-md);             /* ä¸­å­—é«” */
            transition: padding-left var(--transition-fast); /* å·¦å…§è·å‹•ç•« */
        }

        /* é¸å–®é …ç›®æ‡¸åœæ•ˆæœ */
        .menu-item:hover {
            background: var(--hover-color);              /* æ‡¸åœèƒŒæ™¯ */
            transform: translateX(5px);                  /* å³ç§»æ•ˆæœ */
        }

        .menu-item-link:hover {
            padding-left: 25px;                          /* å¢åŠ å·¦å…§è· */
        }

        /* ç‰ˆæ¬Šè³‡è¨Š */
        .main-menu-footer {
            text-align: center;                          /* æ–‡å­—å±…ä¸­ */
            padding-top: 20px;                           /* é ‚éƒ¨å…§è· */
            border-top: 1px solid var(--border-color);   /* é ‚éƒ¨é‚Šæ¡† */
            color: var(--text-muted);                    /* æ·¡åŒ–æ–‡å­—é¡è‰² */
            font-size: 12px;                            /* å°å­—é«” */
        }

        /* é¡¯ç¤ºä¸»é¸å–®æ™‚çš„å‹•ç•«æ•ˆæœ */
        .main-menu-overlay.show {
            display: block;                              /* é¡¯ç¤º */
        }

        .main-menu-overlay.show.active {
            opacity: 1;                                  /* å®Œå…¨ä¸é€æ˜ */
        }

        .main-menu-overlay.show.active .main-menu-container {
            transform: translateY(0);                    /* æ»‘å…¥åˆ°æ­£å¸¸ä½ç½® */
        }

        /* èªªæ˜é é¢iframeæ¨£å¼ */
        .instruction-iframe {
            position: fixed;                             /* å›ºå®šå®šä½ */
            top: 0;                                     /* å¾é ‚éƒ¨é–‹å§‹ */
            left: 0;                                    /* å¾å·¦å´é–‹å§‹ */
            width: 100%;                                /* å…¨å¯¬åº¦ */
            height: 100%;                               /* å…¨é«˜åº¦ */
            border: none;                               /* ç„¡é‚Šæ¡† */
            background: var(--primary-color);          /* èƒŒæ™¯è‰² */
            z-index: 10001;                            /* æ¯”ä¸»é¸å–®æ›´é«˜å±¤ç´š */
            display: none;                              /* é è¨­éš±è— */
        }

        .instruction-iframe.show {
            display: block;                             /* é¡¯ç¤º */
        }

    </style>
</head>

<body>

    <!-- ============================================
    * PWA å®‰è£å¼•å°ç•«é¢
    * ============================================ -->
    <div class="install-prompt-overlay" id="installPromptOverlay">
        <div class="install-prompt-container">
            <!-- æ¨™é¡Œï¼šé€£çºŒé»æ“Š4æ¬¡å¯é—œé–‰ï¼ˆéš±è—åŠŸèƒ½ï¼‰ -->
            <h2 class="install-prompt-title" id="installPromptTitle">
                å®‰è£å°æœ‹å‹å·¥å…·
            </h2>
            
            <p class="install-prompt-text">
                è«‹ä¾ç…§ä»¥ä¸‹æŒ‡å¼•å®‰è£æ‡‰ç”¨ç¨‹å¼
            </p>
            
            <!-- iOS å®‰è£èªªæ˜ -->
            <div class="install-os-section" id="iosSection">
                <div class="install-os-title">
                    iPhone / iPad
                </div>
                <ol class="install-steps">
                    <li>é»æ“Šç€è¦½å™¨åº•éƒ¨çš„ <span class="install-highlight">åˆ†äº«æŒ‰éˆ•</span> â¬†ï¸</li>
                    <li>åœ¨é¸å–®ä¸­å‘ä¸‹æ»‘å‹•</li>
                    <li>é»é¸ <span class="install-highlight">ã€ŒåŠ å…¥ä¸»ç•«é¢ã€</span></li>
                    <li>é»æ“Šå³ä¸Šè§’çš„ <span class="install-highlight">ã€ŒåŠ å…¥ã€</span></li>
                </ol>
            </div>
            
            <!-- Android å®‰è£èªªæ˜ -->
            <div class="install-os-section" id="androidSection">
                <div class="install-os-title">
                    Android
                </div>
                <ol class="install-steps">
                    <li>é»æ“Šç€è¦½å™¨å³ä¸Šè§’çš„ <span class="install-highlight">é¸å–®æŒ‰éˆ•</span> â‹®</li>
                    <li>é¸æ“‡ <span class="install-highlight">ã€Œå®‰è£æ‡‰ç”¨ç¨‹å¼ã€</span></li>
                    <li>æˆ–é¸æ“‡ <span class="install-highlight">ã€ŒåŠ åˆ°ä¸»ç•«é¢ã€</span></li>
                    <li>é»æ“Š <span class="install-highlight">ã€Œå®‰è£ã€</span> ç¢ºèª</li>
                </ol>
            </div>
            
            <!-- é›»è…¦ç‰ˆ Chrome å®‰è£èªªæ˜ -->
            <div class="install-os-section" id="desktopSection">
                <div class="install-os-title">
                    é›»è…¦ç‰ˆç€è¦½å™¨
                </div>
                <ol class="install-steps">
                    <li>é»æ“Šç¶²å€åˆ—å³å´çš„ <span class="install-highlight">å®‰è£åœ–ç¤º</span> âŠ•</li>
                    <li>æˆ–é»æ“Šå³ä¸Šè§’ <span class="install-highlight">é¸å–®</span> â‹®</li>
                    <li>é¸æ“‡ <span class="install-highlight">ã€Œå®‰è£å°æœ‹å‹å·¥å…·ã€</span></li>
                    <li>é»æ“Š <span class="install-highlight">ã€Œå®‰è£ã€</span> ç¢ºèª</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- ============================================
    * ä¸»é¸å–®çµæ§‹
    * ============================================ -->
    <div class="main-menu-overlay" id="mainMenuOverlay">
        <div class="main-menu-container">
            <!-- ä¸»é¸å–®é ‚éƒ¨ -->
            <div class="main-menu-header">
                <h2 class="main-menu-title">ä¸»é¸å–®</h2>
                <button class="main-menu-close" id="mainMenuClose">âœ•</button>
            </div>
            
            <!-- ä¸»é¸å–®å…§å®¹ -->
            <div class="main-menu-content">
                <!-- å·¥å…·èªªæ˜å€å¡Š -->
                <div class="menu-section">
                    <h3 class="menu-section-title">å·¥å…·èªªæ˜</h3>
                    <ul class="menu-items">
                        <li class="menu-item">
                            <a href="#" class="menu-item-link" data-instruction="calculator">
                                è²¸æ¬¾åˆ©ç‡è¨ˆç®—
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="menu-item-link" data-instruction="check">
                                æ”¯ç¥¨é–‹ç«‹è¨ˆç®—
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="menu-item-link" data-instruction="invoice">
                                ç™¼ç¥¨æ•¸å­—è½‰æ›
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="menu-item-link" data-instruction="gas">
                                åŠ æ²¹å„ªæƒ å ±åƒ¹
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- ç‰ˆæ¬Šè³‡è¨Š -->
            <div class="main-menu-footer">
                Copyright Â© 2025 Ryan02
            </div>
        </div>
    </div>

    <!-- èªªæ˜é é¢iframe -->
    <iframe class="instruction-iframe" id="instructionIframe"></iframe>

    <!-- ============================================
    * é é¢æ¨™é¡Œå€åŸŸ - Header
    * ============================================ -->
    <div class="header-container">
        <h1 class="page-title" id="mainTitle" style="cursor: pointer;">å°æœ‹å‹å°ˆç”¨</h1>
        <div class="nav-buttons">
            <button class="nav-btn active" data-page="calculator">è¨ˆç®—</button>
            <button class="nav-btn" data-page="check">æ”¯ç¥¨</button>
            <button class="nav-btn" data-page="invoice">ç™¼ç¥¨</button>
            <button class="nav-btn" data-page="gas">åŠ æ²¹</button>
        </div>
    </div>
    
    <!-- ============================================
     * ä¸»è¦å…§å®¹å€åŸŸ - iframe
     * ============================================ -->
    <div class="content-container">
        <!-- ç§»é™¤è¼‰å…¥å‹•ç•«ï¼Œæ”¹ç‚ºé è¼‰æ‰€æœ‰é é¢çš„ iframe -->
        <!-- è¨ˆç®—æ©Ÿé é¢ - é è¨­é¡¯ç¤º -->
        <iframe class="page-iframe" id="calculatorFrame" src="pages/calculator.html" style="display: block;"></iframe>
        
        <!-- æ”¯ç¥¨é é¢ - é è¨­éš±è— -->
        <iframe class="page-iframe" id="checkFrame" src="pages/check.html" style="display: none;"></iframe>
        
        <!-- ç™¼ç¥¨é é¢ - é è¨­éš±è— -->
        <iframe class="page-iframe" id="invoiceFrame" src="pages/invoice.html" style="display: none;"></iframe>
        
        <!-- åŠ æ²¹é é¢ - é è¨­éš±è— -->
        <iframe class="page-iframe" id="gasFrame" src="pages/gas.html" style="display: none;"></iframe>
    </div>
    
    <!-- ============================================
     * JavaScript åŠŸèƒ½ç¨‹å¼ç¢¼
     * ============================================ -->
    <script>
        /**
         * å°æœ‹å‹å·¥å…· - ä¸»è¦åŠŸèƒ½æ§åˆ¶ç¨‹å¼
         * è™•ç†é é¢åˆ‡æ›ã€iframeè¼‰å…¥ã€PWAè¨»å†Šç­‰åŠŸèƒ½
         */
        
        // ============================================
        // å…¨åŸŸè®Šæ•¸å®šç¾©
        // ============================================
        
        let currentPage = 'calculator';                     // ç›®å‰é¡¯ç¤ºçš„é é¢
        const pageMapping = {                               // é é¢å°æ‡‰é—œä¿‚
            'calculator': 'pages/calculator.html',         // è¨ˆç®—æ©Ÿé é¢
            'check': 'pages/check.html',                   // æ”¯ç¥¨é é¢
            'invoice': 'pages/invoice.html',               // ç™¼ç¥¨é é¢
            'gas': 'pages/gas.html'                        // åŠ æ²¹é é¢
        };
        
        // ============================================
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('å°æœ‹å‹å·¥å…· - é é¢åˆå§‹åŒ–é–‹å§‹');
            
            // åˆå§‹åŒ–å®‰è£å¼•å°ç•«é¢ï¼ˆæ–°å¢çš„ï¼‰
            initializeInstallPrompt();

            // åˆå§‹åŒ–ä¸»é¸å–®åŠŸèƒ½
            initializeMainMenu();
            
            // åˆå§‹åŒ–å°èˆªåŠŸèƒ½
            initializeNavigation();
            
            // è¨»å†ŠService Worker (PWAåŠŸèƒ½)
            registerServiceWorker();
            
            console.log('å°æœ‹å‹å·¥å…· - é é¢åˆå§‹åŒ–å®Œæˆ');
        });


        // ============================================
        // PWA å®‰è£å¼•å°ç•«é¢æ§åˆ¶
        // ============================================

        // åˆå§‹åŒ–å®‰è£å¼•å°ç•«é¢
        initializeInstallPrompt();

        /**
         * åˆå§‹åŒ– PWA å®‰è£å¼•å°ç•«é¢
         * æª¢æ¸¬æ˜¯å¦å·²å®‰è£ç‚º PWAï¼Œæ§åˆ¶é¡¯ç¤ºé‚è¼¯
         */
        function initializeInstallPrompt() {
            const installOverlay = document.getElementById('installPromptOverlay');
            const installTitle = document.getElementById('installPromptTitle');
            
            // æª¢æ¸¬æ˜¯å¦ç‚º PWA æ¨¡å¼ï¼ˆå·²å®‰è£çš„æ‡‰ç”¨ç¨‹å¼ï¼‰
            const isPWA = window.matchMedia('(display-mode: standalone)').matches || 
                        window.navigator.standalone === true;  // iOS æª¢æ¸¬
            
            // æª¢æ¸¬ä½œæ¥­ç³»çµ±é¡å‹
            const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            const isDesktop = !isIOS && !isAndroid;
            
            // æ ¹æ“šä½œæ¥­ç³»çµ±é¡¯ç¤ºå°æ‡‰çš„å®‰è£èªªæ˜
            const iosSection = document.getElementById('iosSection');
            const androidSection = document.getElementById('androidSection');
            const desktopSection = document.getElementById('desktopSection');
            
            // é è¨­éš±è—æ‰€æœ‰å€å¡Š
            iosSection.style.display = 'none';
            androidSection.style.display = 'none';
            desktopSection.style.display = 'none';
            
            // é¡¯ç¤ºå°æ‡‰çš„æ“ä½œç³»çµ±èªªæ˜
            if (isIOS) {
                iosSection.style.display = 'block';
            } else if (isAndroid) {
                androidSection.style.display = 'block';
            } else {
                desktopSection.style.display = 'block';
            }
            
            // å¦‚æœå·²ç¶“æ˜¯ PWA æ¨¡å¼ï¼Œç›´æ¥éš±è—å¼•å°ç•«é¢
            if (isPWA) {
                installOverlay.classList.add('hidden');
                console.log('å·²åµæ¸¬åˆ° PWA æ¨¡å¼ï¼Œéš±è—å®‰è£å¼•å°');
                return;
            }
            
            // å¦‚æœä¸æ˜¯ PWA æ¨¡å¼ï¼Œé¡¯ç¤ºå¼•å°ç•«é¢
            console.log('é PWA æ¨¡å¼ï¼Œé¡¯ç¤ºå®‰è£å¼•å°');
            
            // ============================================
            // éš±è—åŠŸèƒ½ï¼šé€£çºŒé»æ“Šæ¨™é¡Œ 4 æ¬¡é—œé–‰å¼•å°ç•«é¢
            // ============================================
            
            let clickCount = 0;                    // é»æ“Šè¨ˆæ•¸å™¨
            let clickTimer = null;                 // è¨ˆæ™‚å™¨
            
            // ç‚ºæ¨™é¡Œç¶å®šé»æ“Šäº‹ä»¶
            installTitle.addEventListener('click', function(e) {
                e.preventDefault();                 // é˜²æ­¢é è¨­è¡Œç‚º
                
                clickCount++;                       // å¢åŠ é»æ“Šæ¬¡æ•¸
                
                // æ¸…é™¤ä¹‹å‰çš„è¨ˆæ™‚å™¨
                if (clickTimer) {
                    clearTimeout(clickTimer);
                }
                
                // æª¢æŸ¥æ˜¯å¦é”åˆ° 4 æ¬¡é»æ“Š
                if (clickCount >= 4) {
                    console.log('è§¸ç™¼éš±è—åŠŸèƒ½ï¼šé—œé–‰å®‰è£å¼•å°ç•«é¢');
                    
                    // æ·»åŠ æ·¡å‡ºå‹•ç•«å¾Œéš±è—
                    installOverlay.style.animation = 'fadeOut 0.3s forwards';
                    
                    setTimeout(() => {
                        installOverlay.classList.add('hidden');
                        // å„²å­˜é—œé–‰ç‹€æ…‹åˆ°æœ¬åœ°å­˜å„²ï¼ˆå¯é¸ï¼‰
                        localStorage.setItem('installPromptDismissed', 'true');
                    }, 300);
                    
                    // é‡ç½®è¨ˆæ•¸å™¨
                    clickCount = 0;
                }
                
                // è¨­ç½®è¨ˆæ™‚å™¨ï¼š2ç§’å¾Œé‡ç½®è¨ˆæ•¸å™¨
                clickTimer = setTimeout(() => {
                    clickCount = 0;                 // é‡ç½®è¨ˆæ•¸
                    console.log('é»æ“Šè¨ˆæ•¸å™¨å·²é‡ç½®');
                }, 2000);  // 2ç§’å…§è¦å®Œæˆ4æ¬¡é»æ“Š
            });
            
            // æª¢æŸ¥æ˜¯å¦æ›¾ç¶“é—œé–‰éå¼•å°ç•«é¢ï¼ˆå¯é¸åŠŸèƒ½ï¼‰
            const wasDismissed = localStorage.getItem('installPromptDismissed');
            if (wasDismissed === 'true') {
                // å¦‚æœä½¿ç”¨è€…æ›¾ç¶“é—œé–‰éï¼Œå¯ä»¥é¸æ“‡ç›´æ¥éš±è—
                // installOverlay.classList.add('hidden');
                // æˆ–è€…ä»ç„¶é¡¯ç¤ºï¼Œè®“ä½¿ç”¨è€…è‡ªè¡Œæ±ºå®š
            }
        }

        // æ·»åŠ æ·¡å‡ºå‹•ç•«å®šç¾©
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // ============================================
        // å°èˆªåŠŸèƒ½åˆå§‹åŒ–
        // ============================================
        
        function initializeNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');  // æ›´æ”¹é¸æ“‡å™¨ç‚ºæ–°çš„é¡åˆ¥åç¨±
            
            // ç‚ºæ¯å€‹å°èˆªæŒ‰éˆ•ç¶å®šé»æ“Šäº‹ä»¶
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetPage = this.getAttribute('data-page');
                    switchPage(targetPage);
                });
            });
        }
        
        // ============================================
        // é é¢åˆ‡æ›åŠŸèƒ½
        // ============================================
        
        function switchPage(pageName) {
            console.log(`é é¢åˆ‡æ›: ${currentPage} -> ${pageName}`);
            
            // æª¢æŸ¥é é¢æ˜¯å¦å­˜åœ¨
            if (!pageMapping[pageName]) {
                console.error(`é é¢ä¸å­˜åœ¨: ${pageName}`);
                return;
            }
            
            // ============================================
            // ä½¿ç”¨é¡¯ç¤º/éš±è—æ–¹å¼åˆ‡æ›é é¢ï¼Œä¸é‡æ–°è¼‰å…¥
            // ============================================
            
            // éš±è—ç•¶å‰é é¢çš„ iframe
            const currentFrame = document.getElementById(currentPage + 'Frame');
            if (currentFrame) {
                currentFrame.style.display = 'none';  // éš±è—ç•¶å‰é é¢
            }
            
            // é¡¯ç¤ºç›®æ¨™é é¢çš„ iframe
            const targetFrame = document.getElementById(pageName + 'Frame');
            if (targetFrame) {
                targetFrame.style.display = 'block';   // é¡¯ç¤ºæ–°é é¢
            }
            
            // æ›´æ–°ç›®å‰é é¢è®Šæ•¸
            currentPage = pageName;
            
            // æ›´æ–°å°èˆªæŒ‰éˆ•ç‹€æ…‹
            updateNavigationState(pageName);
            
            // ä¸å†éœ€è¦å‘¼å« loadPageInIframe
            // loadPageInIframe(pageName);  // ç§»é™¤é€™è¡Œ
        }
        
        // ============================================
        // æ›´æ–°å°èˆªæŒ‰éˆ•ç‹€æ…‹
        // ============================================
        
        function updateNavigationState(activePage) {
            const navButtons = document.querySelectorAll('.nav-btn');  // æ›´æ”¹é¸æ“‡å™¨ç‚ºæ–°çš„é¡åˆ¥åç¨±
            
            // ç§»é™¤æ‰€æœ‰activeç‹€æ…‹
            navButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // æ·»åŠ æ–°çš„activeç‹€æ…‹
            const activeButton = document.querySelector(`[data-page="${activePage}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }
        
        // ============================================
        // PWA Service Workerè¨»å†Š
        // ============================================
        
        function registerServiceWorker() {
            // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æŒService Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('sw.js')
                        .then(function(registration) {
                            console.log('Service Worker è¨»å†ŠæˆåŠŸ:', registration.scope);
                            
                            // æª¢æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬çš„Service Worker
                            registration.addEventListener('updatefound', function() {
                                console.log('ğŸ”„ ç™¼ç¾æ–°ç‰ˆæœ¬Service Worker');
                                const newWorker = registration.installing;
                                
                                newWorker.addEventListener('statechange', function() {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        // æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œæç¤ºç”¨æˆ¶é‡æ–°è¼‰å…¥
                                        console.log('âœ… æ–°ç‰ˆæœ¬å·²æº–å‚™å°±ç·’');
                                        
                                        // è‡ªå‹•æ›´æ–°åˆ°æ–°ç‰ˆæœ¬
                                        if (confirm('ç™¼ç¾æ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦ç«‹å³æ›´æ–°ï¼Ÿ')) {
                                            newWorker.postMessage({ type: 'SKIP_WAITING' });
                                            window.location.reload();
                                        }
                                    }
                                });
                            });
                        })
                        .catch(function(error) {
                            console.log('Service Worker è¨»å†Šå¤±æ•—:', error);
                        });
                    
                    // ç›£è½Service Workeræ§åˆ¶æ¬Šè®Šæ›´
                    navigator.serviceWorker.addEventListener('controllerchange', function() {
                        console.log('ğŸ”„ Service Workerå·²æ›´æ–°ï¼Œé‡æ–°è¼‰å…¥é é¢');
                        window.location.reload();
                    });
                });
            }
        }
        
        // ============================================
        // é˜²æ­¢å³éµé¸å–®å’Œé•·æŒ‰é¸å– (è¡Œå‹•è£ç½®å„ªåŒ–)
        // ============================================
        
        // ç¦æ­¢å³éµé¸å–®
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // ç¦æ­¢æ–‡å­—é¸å– (è§¸æ§è£ç½®)
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
        });
        
        // ç¦æ­¢æ‹–æ‹½
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
        });
        
        console.log('å°æœ‹å‹å·¥å…· - JavaScriptè¼‰å…¥å®Œæˆ');

        // ============================================
        // ä¸»é¸å–®åŠŸèƒ½æ§åˆ¶
        // ============================================

        /**
         * åˆå§‹åŒ–ä¸»é¸å–®åŠŸèƒ½
         * è™•ç†ä¸»é¸å–®çš„é–‹å•Ÿã€é—œé–‰å’Œé¸é …é»æ“Š
         */
        function initializeMainMenu() {
            const mainTitle = document.getElementById('mainTitle');
            const mainMenuOverlay = document.getElementById('mainMenuOverlay');
            const mainMenuClose = document.getElementById('mainMenuClose');
            const instructionIframe = document.getElementById('instructionIframe');
            const menuItemLinks = document.querySelectorAll('.menu-item-link');
            
            // é»æ“Šæ¨™é¡Œé–‹å•Ÿä¸»é¸å–®
            mainTitle.addEventListener('click', function() {
                openMainMenu();
            });
            
            // é»æ“Šé—œé–‰æŒ‰éˆ•é—œé–‰ä¸»é¸å–®
            mainMenuClose.addEventListener('click', function() {
                closeMainMenu();
            });
            
            // é»æ“Šé®ç½©å±¤é—œé–‰ä¸»é¸å–®ï¼ˆå¯é¸åŠŸèƒ½ï¼‰
            mainMenuOverlay.addEventListener('click', function(e) {
                // åªæœ‰é»æ“Šé®ç½©å±¤æœ¬èº«æ‰é—œé–‰ï¼Œä¸æ˜¯é»æ“Šå…§å®¹
                if (e.target === mainMenuOverlay) {
                    closeMainMenu();
                }
            });
            
            // ç¶å®šå·¥å…·èªªæ˜é …ç›®é»æ“Šäº‹ä»¶
            menuItemLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault(); // é˜²æ­¢é è¨­é€£çµè¡Œç‚º
                    
                    const instructionType = this.getAttribute('data-instruction');
                    openInstructionPage(instructionType);
                });
            });
            
            // ç›£è½ ESC éµé—œé–‰ä¸»é¸å–®
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // å„ªå…ˆé—œé–‰èªªæ˜é é¢
                    if (instructionIframe.classList.contains('show')) {
                        closeInstructionPage();
                    } 
                    // å…¶æ¬¡é—œé–‰ä¸»é¸å–®
                    else if (mainMenuOverlay.classList.contains('show')) {
                        closeMainMenu();
                    }
                }
            });
        }

        /**
         * é–‹å•Ÿä¸»é¸å–®
         */
        function openMainMenu() {
            const mainMenuOverlay = document.getElementById('mainMenuOverlay');
            
            // é¡¯ç¤ºä¸»é¸å–®
            mainMenuOverlay.classList.add('show');
            
            // è§¸ç™¼å‹•ç•«
            setTimeout(() => {
                mainMenuOverlay.classList.add('active');
            }, 10);
            
            console.log('ä¸»é¸å–®å·²é–‹å•Ÿ');
        }

        /**
         * é—œé–‰ä¸»é¸å–®
         */
        function closeMainMenu() {
            const mainMenuOverlay = document.getElementById('mainMenuOverlay');
            
            // ç§»é™¤å‹•ç•«é¡
            mainMenuOverlay.classList.remove('active');
            
            // å‹•ç•«çµæŸå¾Œéš±è—
            setTimeout(() => {
                mainMenuOverlay.classList.remove('show');
            }, 200);
            
            console.log('ä¸»é¸å–®å·²é—œé–‰');
        }

        /**
         * é–‹å•Ÿå·¥å…·èªªæ˜é é¢
         * @param {string} type - èªªæ˜é¡å‹ (calculator/check/invoice/gas)
         */
        function openInstructionPage(type) {
            const instructionIframe = document.getElementById('instructionIframe');
            
            // è¨­å®š iframe ä¾†æº
            // è‹±æ–‡è³‡æ–™å¤¾åç¨±ï¼šinstructions
            // æª”æ¡ˆå‘½åè¦å‰‡ï¼šåŸæª”å + _instruction.html
            const instructionFiles = {
                'calculator': 'instructions/calculator_instruction.html',
                'check': 'instructions/check_instruction.html',
                'invoice': 'instructions/invoice_instruction.html',
                'gas': 'instructions/gas_instruction.html'
            };
            
            // æš«æ™‚ä½¿ç”¨è¦åŠƒä¸­é é¢æ¸¬è©¦
            // å¯¦éš›ä½¿ç”¨æ™‚è«‹å‰µå»ºå°æ‡‰çš„èªªæ˜é é¢
            const iframeSrc = instructionFiles[type] || 'instructions/planning.html';
            
            // è¨­å®š iframe ä¾†æºä¸¦é¡¯ç¤º
            instructionIframe.src = iframeSrc;
            instructionIframe.classList.add('show');
            
            // é—œé–‰ä¸»é¸å–®
            closeMainMenu();
            
            console.log(`é–‹å•Ÿèªªæ˜é é¢: ${type}`);
        }

        /**
         * é—œé–‰å·¥å…·èªªæ˜é é¢
         */
        function closeInstructionPage() {
            const instructionIframe = document.getElementById('instructionIframe');
            
            // éš±è— iframe
            instructionIframe.classList.remove('show');
            
            // æ¸…ç©º iframe ä¾†æº
            setTimeout(() => {
                instructionIframe.src = '';
            }, 300);
            
            console.log('èªªæ˜é é¢å·²é—œé–‰');
        }

    </script>
</body>
</html>
