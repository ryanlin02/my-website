<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=400, user-scalable=no">
    <title>é›è‚‰é£¯è¦æ¯å¤©åƒ</title>
    <style>
    :root {
        --primary-color: #333333;
        --secondary-color: #4a4a4a;
        --text-color: #ffffff;
        --border-color: #555555;
        --hover-color: #666666;
        --shadow-color: rgba(0, 0, 0, 0.3);
        --button-orange: #ff9c33;
        --button-blue: #33b5e5;
		--button-grey: #333333;
    }
		 /* æ·»åŠ æ–°çš„å‹•ç•«é—œéµå¹€ */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    @keyframes slideIn {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    @keyframes glowBorder {
        0% { box-shadow: 0 0 5px var(--button-orange); }
        50% { box-shadow: 0 0 15px var(--button-orange); }
        100% { box-shadow: 0 0 5px var(--button-orange); }
    }

    /* ä¿®æ”¹ç¾æœ‰çš„åŸºç¤æ¨£å¼ï¼Œæ·»åŠ å‹•ç•«æ•ˆæœ */

    html, body {
    	width: 100%;           /* æ”¹ç‚º100%å¯¬åº¦ */
    	max-width: 400px;      /* è¨­å®šæœ€å¤§å¯¬åº¦ */
    	margin: 0 auto;
    	overflow-x: hidden;
    	-webkit-text-size-adjust: 100%;
    	padding: 0 3px;       /* å¢åŠ å·¦å³padding */
    	background-color: #333333;
    	color: var(--text-color);
    	font-family: "Microsoft JhengHei", Arial, sans-serif;
    	box-sizing: border-box; /* æ·»åŠ é€™è¡Œ */
	}

    h1 {
        color: var(--text-color);
        font-size: 22px;
        margin-bottom: 0px;
        border-bottom: 2px solid var(--button-orange);
        padding-bottom: 5px;
		position: relative;
		transition: all 0.3s ease;
    }
		h1:hover {
    transform: translateY(-2px);
    text-shadow: 0 2px 4px rgba(255, 156, 51, 0.3);
}
		h1::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: var(--button-orange);
        transform: scaleX(0);
        transform-origin: right;
        transition: transform 0.6s ease-out;
    }

    h1:hover::after {
        transform: scaleX(1);
        transform-origin: left;
    }
		

    .row {
        margin: 4px 0;
        display: flex;
        align-items: center;
        background: var(--secondary-color);
        padding: 3px;
        border-radius: 4px;
        box-shadow: 0 4px 8px var(--shadow-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
		.row:hover {
        transform: translateX(5px);
        box-shadow: 0 6px 12px var(--shadow-color);
    }

    .label {
        width: 120px;
        margin-right: 15px;
        text-align: right;
        font-weight: 600;
        color: var(--text-color);
    }

    input {
        width: 95px;
        padding: 5px 12px;
        margin-right: 10px;
        background-color: #222222;
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    input:focus {
		outline: none;
		border-color: var(--button-orange);
		box-shadow: 0 0 0 3px rgba(255, 156, 51, 0.2);
		transform: scale(1.07);
		}

    button {
        background-color: var(--secondary-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 3px 8px;
        margin: 0 5px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 16px;
    }

    button:hover {
        background-color: var(--hover-color);
		transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
		button:active {
        transform: scale(0.95) translateY(1px);
    	transition: transform 0.1s;
    }
	
	.row button {
        background-color: var(--secondary-color);
        color: var(--text-color);
        border: 1px solid var(--button-grey);  /* ä½¿ç”¨æ·±ç°è‰²é‚Šæ¡† */
        padding: 3px 8px;
        margin: 0 5px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;  /* æ·»åŠ  all ä»¥å¯¦ç¾å®Œæ•´çš„éæ¸¡æ•ˆæœ */
        font-size: 16px;
		position: relative;
    	overflow: hidden;
    }

    .row button:hover {
        background-color: var(--button-orange);  /* æ‡¸åœæ™‚è®Šç‚ºæ©™è‰²èƒŒæ™¯ */
        color: var(--text-color);
        border-color: var(--button-orange);  /* é‚Šæ¡†ä¹Ÿè®Šç‚ºæ©™è‰² */
    }

    .row button:active {
        background-color: var(--secondary-color);  /* é»æ“Šæ™‚æ¢å¾©åŸæœ¬é¡è‰² */
        color: var(--text-color);
        border-color: var(--button-grey);
    }
		.row button::after {
		content: '';
		position: absolute;
		top: 50%;
		left: 50%;
		width: 0;
		height: 0;
		background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
		transition: width 0.3s ease-out, height 0.3s ease-out;
		transform: translate(-50%, -50%);
		border-radius: 50%;
	}

	.row button:active::after {
		width: 150px;
		height: 150px;
	}

    div[id$="Buttons"] button {
        background-color: var(--secondary-color);
        color: var(--button-orange);
        border: 1px solid var(--button-orange);
        padding: 4px 9px;  /* å°‡å·¦å³å…§é‚Šè·å¾ 8px æ”¹ç‚º 6px */
        margin: 0 4px;     /* å°‡å·¦å³å¤–é‚Šè·æ”¹ç‚º 2px */
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 16px;
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    div[id$="Buttons"] button:hover {
        background-color: var(--button-orange);
        color: var(--text-color);
		transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
		div[id$="Buttons"] button:active {
        transform: translateY(1px);
    }

    .readonly {
        background-color: #222222;
    }

    #timeDisplay {
        margin: 5px 0;
        font-size: 15px;
        background: var(--secondary-color);
        color: var(--text-color);
        padding: 8px;
        border-radius: 4px;
        box-shadow: 0 2px 4px var(--shadow-color);
		animation: fadeIn 0.8s ease-out;
        transition: all 0.3s ease;
		position: relative;
    	overflow: hidden;
    }
	#timeDisplay:hover {
        transform: scale(1.02);
        box-shadow: 0 6px 12px var(--shadow-color);
    }
	#timeDisplay::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 2px;
		background: linear-gradient(90deg, transparent, var(--button-orange), transparent);
		animation: timelineSlide 3s linear infinite;
	}
		@keyframes timelineSlide {
		0% { left: -100%; }
		100% { left: 100%; }
}

    .time-label {
        font-weight: bold;
        margin-right: 10px;
        color: var(--button-orange);
    }

    #periodButtons, #rateButtons, #principalButtons, #commissionButtons, #PaymentduringButtons {
    	margin: 2px 1px 5px 1px;    /* ä¿®æ”¹é‚Šè· */
    	display: flex;
    	flex-wrap: wrap;        /* å…è¨±æŒ‰éˆ•æ›è¡Œ */
    	gap: 3px;
    	width: 100%;            /* ä¿®æ”¹å¯¬åº¦è¨­å®š */
    	justify-content: flex-end;
    	padding-right: 5px;     /* æ·»åŠ å³å´padding */
    	box-sizing: border-box; /* æ·»åŠ é€™è¡Œ */
	}

    button {
        flex-shrink: 0;
    }

    .divider {
        border-top: 2px solid var(--border-color);
        margin: 10px 0;
    }

    .function-buttons {
        display: flex;
        justify-content: space-around;
        margin: 10px 0;
    }

    /* åœ¨ style æ¨™ç±¤ä¸­ä¿®æ”¹æˆ–æ–°å¢ä»¥ä¸‹ CSS */
	.quote-table {
		width: 100%;
		border-collapse: separate;
		border-spacing: 0;
		margin: 10px 0;
		background: var(--primary-color);
		border-radius: 12px;
		overflow: hidden;
		box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
	}

	.quote-table tr {
		background: var(--secondary-color);
		transition: background-color 0.3s ease;
	}

	.quote-table tr:hover {
		background: var(--hover-color);
	}

	.quote-table td {
		padding: 10px 10px; /* å¢åŠ å…§é‚Šè· */
		border-bottom: 1px solid var(--border-color);
		color: var(--text-color);
		font-size: 16px; /* å¢åŠ å­—é«”å¤§å° */
		line-height: 1.2; /* å¢åŠ è¡Œé«˜ */
	}

	.quote-table td:first-child {
		width: 140px; /* å¢åŠ æ¨™ç±¤æ¬„å¯¬åº¦ */
		white-space: nowrap;
		color: var(--button-orange);
		font-weight: 700; /* åŠ ç²— */
		text-align: right;
		padding-right: 10px;
		font-size: 16px; /* æ¨™ç±¤æ–‡å­—æ›´å¤§ */
	}

	.quote-table td:last-child {
		text-align: right;
		font-family: monospace;
		font-size: 16px; /* æ•¸å€¼æ›´å¤§ */
		letter-spacing: 0px; /* å¢åŠ å­—è· */
	}

	/* æ–°å¢å®¹å™¨æ¨£å¼ */

	#quoteContainer {
		padding: 24px;
		background: #333333;
		border-radius: 16px;
		box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
		margin: 20px;
	}

	

    .function-buttons button {
		background-color: var(--secondary-color);
		color: var(--button-orange);      /* æ”¹ç‚ºæ©˜è‰²æ–‡å­— */
		border: 1px solid var(--button-orange);  /* æ”¹ç‚ºæ©˜è‰²é‚Šæ¡† */
		padding: 3px 8px;
		margin: 0 5px;
		border-radius: 4px;
		cursor: pointer;
		transition: all 0.3s ease;
		font-size: 16px;
		position: relative;
        overflow: hidden;
	}
		.function-buttons button::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        transform: translate(-50%, -50%) scale(0);
        border-radius: 50%;
        transition: transform 0.5s;
    }

	.function-buttons button:hover {
		background-color: var(--button-orange);
		color: var(--text-color);
		border-color: var(--button-orange);
	}
		.function-buttons button:hover::after {
        transform: translate(-50%, -50%) scale(2);
    }

	.function-buttons button:active {
		background-color: var(--secondary-color);
		color: var(--button-orange);
		border-color: var(--button-orange);
	}
	.footer-message {
		background-color: #333333;
		color: var(--text-color);
		padding: 15px;
		text-align: center;
		margin-top: 15px;
		border-radius: 4px;
		transform: scale(1.05);
        text-shadow: 0 0 10px var(--button-orange);
		transition: all 0.3s ease;
    	position: relative;
	}

	.footer-spacing {
		background-color: #333333;
		height: 30px;
		margin-top: 0px;
	}
		.footer-message::before {
		content: 'ğŸš';
		margin-right: 8px;
		display: inline-block;
		transition: transform 0.3s ease;
	}

	.footer-message:hover::before {
		transform: rotate(360deg);
	}
		/* ç‚ºç‰¹å®šæ•¸å€¼æ·»åŠ å‹•ç•«æ•ˆæœ */
    #chickenRice {
        transition: all 0.3s ease;
    }

    #chickenRice:not([value=""]):not([value="0"]) {
        animation: glowBorder 2s infinite;
		background: linear-gradient(45deg, #222222, #2a2a2a);
		transition: all 0.3s ease;
    }
		@keyframes glowBorder {
		0%, 100% { box-shadow: 0 0 5px var(--button-orange); }
		50% { box-shadow: 0 0 15px var(--button-orange), 0 0 30px rgba(255, 156, 51, 0.3); }
}
		.warning-text {
		color: #ff0000 !important;
		font-weight: bold !important;
		animation: pulse 1s infinite;
	}
</style>
</head>
<body>
	<div style="text-align: center;">
     <h1>å°æœ‹å‹å°ˆç”¨è¨ˆç®—æ©Ÿ</h1>
	</div>
	
    <div id="timeDisplay" style="display: flex; justify-content: center;">
        <span class="time-label">å ±åƒ¹æ™‚é–“ï¼š</span><span id="currentTime"></span>
    </div>
    
<div class="row">
        <span class="label">æœŸæ•¸</span>
        <input type="number" id="period" step="0.1">
        <button onclick="calculatePeriod()">ç®—</button>
        <button onclick="clearField('period')">æ¸…</button>
    </div>

    <div id="periodButtons" style="display: flex; justify-content: flex-end;">
		<button onclick="adjustPeriod(-1)">-1</button>
		<button onclick="setPeriod(13)">åº•</button>
        <button onclick="setPeriod(24)">2</button>
        <button onclick="setPeriod(36)">3</button>
        <button onclick="setPeriod(48)">4</button>
        <button onclick="setPeriod(60)">5</button>
      	<button onclick="adjustPeriod(1)">+1</button>
	</div>
    <div class="row">
        <span class="label">ç¨…å‰åˆ©ç‡</span>
        <input type="number" id="rate" step="0.001">
        <button onclick="calculateRate()">ç®—</button>
        <button onclick="clearField('rate')">æ¸…</button>
    </div>

    <div id="rateButtons" style="display: flex; justify-content: flex-end;">
        <button onclick="adjustRate(-0.2)">-0.2</button>
        <button onclick="setRate(4)">4</button>
        <button onclick="setRate(6)">6</button>
		<button onclick="setRate(8)">8</button>
        <button onclick="setRate(10)">10</button>
        <button onclick="setRate(13)">13</button>
        <button onclick="adjustRate(0.2)">+0.2</button>
    </div>
    <div class="row">
        <span class="label">æœ¬é‡‘</span>
        <input type="number" id="principal">
        <button onclick="calculatePrincipal()">ç®—</button>
        <button onclick="clearField('principal')">æ¸…</button>
    </div>
    <div id="principalButtons" style="display: flex; justify-content: flex-end;">
		<button onclick="adjustPrincipal(-1000000)">-100</button>
		<button onclick="adjustPrincipal(-100000)">-10</button>
		<button onclick="adjustPrincipal(-10000)">-1</button>
        <button onclick="adjustPrincipal(10000)">+1</button>
		<button onclick="adjustPrincipal(100000)">+10</button>
		<button onclick="adjustPrincipal(1000000)">+100</button>
    </div>
    <div class="row">
        <span class="label">æœŸç¹³</span>
        <input type="number" id="payment" step="0.01">
        <button onclick="calculatePayment()">ç®—</button>
        <button onclick="clearField('payment')">æ¸…</button>
    </div>
	 <div id="PaymentduringButtons" style="display: flex; justify-content: flex-end;">
        <button onclick="adjustPayment(-100)">-100</button>
		 <button onclick="adjustPayment(-50)">-50</button>
        <button onclick="roundPayment('down', 100)">æ¨ç™¾</button>
        <button onclick="roundPayment('up', 100)">é€²ç™¾</button>
		 <button onclick="adjustPayment(50)">+50</button>
        <button onclick="adjustPayment(100)">+100</button>
    </div>
	<div class="row">
        <span class="label">ç¸½åˆ©æ¯</span>
        <input type="number" id="totalInterest" class="readonly" readonly>
    </div>
    <div class="row">
        <span class="label">ç­‰æ–¼ç«é›è‚‰é£¯</span>
        <input type="number" id="chickenRice" class="readonly" readonly>
        <span style="margin-left: 0px; color: var(--text-color);">ç¢—</span>
    </div>
    <div class="row">
        <span class="label">ç¨…é‡‘</span>
        <input type="number" id="tax" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ç¨…å¾Œåˆ©ç‡</span>
        <input type="number" id="afterTaxRate" step="0.001" class="readonly" readonly>
    </div>

     <div class="row">
        <span class="label">æ¨å»£</span>
        <input type="number" id="commission">
        <button onclick="calculateAfterCommissionRate()">ç®—</button>
        <button onclick="clearCommission()">æ¸…</button>
    </div>


    <div id="commissionButtons" style="display: flex; justify-content: flex-end;">
        <button onclick="adjustCommissionPercentage(-0.1)">-10</button>
        <button onclick="setCommissionPercentage(1)">1</button>
        <button onclick="setCommissionPercentage(2)">2</button>
        <button onclick="setCommissionPercentage(3)">3</button>
        <button onclick="setCommissionPercentage(4)">4</button>
        <button onclick="setCommissionPercentage(5)">5</button>
        <button onclick="adjustCommissionPercentage(0.1)">+10</button>
    </div>
    <div class="row">
        <span class="label">ç¨…ä½£å¾Œåˆ©ç‡</span>
        <input type="number" id="afterCommissionRate" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ç™¾è¬æ¯å¹´åˆ©æ¯</span>
        <input type="number" id="annualMillionInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ç™¾è¬æ¯æœˆåˆ©æ¯</span>
        <input type="number" id="monthlyMillionInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ä¸€è¬æ¯å¹´åˆ©æ¯</span>
        <input type="number" id="annualTenThousandInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">ä¸€è¬æ¯æœˆåˆ©æ¯</span>
        <input type="number" id="monthlyTenThousandInterest" class="readonly" readonly>
    </div>

    <div class="row">
        <span class="label">æœ¬æœˆè³‡é‡‘æˆæœ¬</span>
        <input type="number" id="monthlyCost" value="2.0951" class="readonly" readonly>
        <span style="margin-left: 0px; color: var(--text-color);">%</span>
    </div>

    <div class="row">
        <span class="label">Spread</span>
        <input type="number" id="spread" class="readonly" readonly>
    </div>
	
    <div class="row">
        <span class="label">è³‡é‡‘æˆæœ¬</span>
        <input type="number" id="fundingCost" class="readonly" readonly>
        <span style="margin-left: 0px; color: var(--text-color);">(å…ƒ)</span>
    </div>
	
	<!-- åœ¨æœ€å¾Œä¸€å€‹ .row div å¾Œé¢æ·»åŠ  -->
	<div class="divider"></div>
	<div class="function-buttons">
    	<button onclick="window.open('https://travel.chiayi.gov.tw/Folder/TurkeyRice', '_blank')">é›è‚‰é£¯</button>
		<button onclick="location.reload()">å…¨æ¸…</button>
    	<button onclick="generateQuote()">æˆªåœ–</button>
	</div>
<script>
	// æ·»åŠ éœ‡å‹•å‡½æ•¸
		function vibrate() {
			if (navigator.vibrate) {
			navigator.vibrate(30); // éœ‡å‹•30æ¯«ç§’
			}
		}
	     // æ·»åŠ æ›´æ–°æ™‚é–“çš„å‡½æ•¸
        function updateTime() {
            const now = new Date();
            const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            
            // èª¿æ•´ç‚ºå°åŒ—æ™‚é–“ (GMT+8)
            const taipeiTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            
            const year = taipeiTime.getUTCFullYear();
            const month = String(taipeiTime.getUTCMonth() + 1).padStart(2, '0');
            const date = String(taipeiTime.getUTCDate()).padStart(2, '0');
            const day = days[taipeiTime.getUTCDay()];
            const hours = String(taipeiTime.getUTCHours()).padStart(2, '0');
            const minutes = String(taipeiTime.getUTCMinutes()).padStart(2, '0');
            const seconds = String(taipeiTime.getUTCSeconds()).padStart(2, '0');
            
            const timeString = `${year}å¹´${month}æœˆ${date}æ—¥
				æ˜ŸæœŸ${day} ${hours}:${minutes}:${seconds}`;
            document.getElementById('currentTime').textContent = timeString;
        }

        // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ™‚é–“
        setInterval(updateTime, 1000);
        updateTime(); // åˆå§‹åŒ–é¡¯ç¤º

        // åŸå§‹çš„JavaScriptå‡½æ•¸ä¿æŒä¸è®Š
        function PMT(rate, nper, pv) {
            rate = rate / 100 / 12;
            return (pv * rate * Math.pow(1 + rate, nper)) / (Math.pow(1 + rate, nper) - 1);
        }
        
        function RATE(nper, pmt, pv) {
            let rate = 0.1;
            let step = 0.05;
            let tolerance = 0.0001;
            let maxIterations = 100;
            let iteration = 0;

            while (iteration < maxIterations) {
                let monthlyRate = rate / 12;
                let calculated = pv * monthlyRate * Math.pow(1 + monthlyRate, nper) / 
                               (Math.pow(1 + monthlyRate, nper) - 1);
                
                if (Math.abs(calculated - pmt) < tolerance) {
                    return rate * 100;
                }

                if (calculated > pmt) {
                    rate -= step;
                } else {
                    rate += step;
                }
                
                step *= 0.5;
                iteration++;
            }
            
            return rate * 100;
        }

        function calculatePeriod() {
            const rate = parseFloat(document.getElementById('rate').value);
            const principal = parseFloat(document.getElementById('principal').value);
            const payment = parseFloat(document.getElementById('payment').value);
            
            // TODO: Implement period calculation
            updateAllFields();
        }

        function calculateRate() {
            const period = parseFloat(document.getElementById('period').value);
            const principal = parseFloat(document.getElementById('principal').value);
            const payment = parseFloat(document.getElementById('payment').value);
            
            const rate = RATE(period, payment, principal);
            document.getElementById('rate').value = rate.toFixed(4);
            
            updateAllFields();
        }

        function calculatePrincipal() {
            const period = parseFloat(document.getElementById('period').value);
            const rate = parseFloat(document.getElementById('rate').value);
            const payment = parseFloat(document.getElementById('payment').value);
            
            // TODO: Implement principal calculation
            updateAllFields();
        }

        function calculatePayment() {
            const period = parseFloat(document.getElementById('period').value);
            const rate = parseFloat(document.getElementById('rate').value);
            const principal = parseFloat(document.getElementById('principal').value);
            
            const payment = PMT(rate, period, principal);
            document.getElementById('payment').value = payment.toFixed(2);
            
            updateAllFields();
        }

        function updateAllFields() {
			// ç²å–åŸºæœ¬å€¼
			const period = parseFloat(document.getElementById('period').value);
			const rate = parseFloat(document.getElementById('rate').value);
			const principal = parseFloat(document.getElementById('principal').value);
			const payment = parseFloat(document.getElementById('payment').value);
			const monthlyCost = parseFloat(document.getElementById('monthlyCost').value);

			// è¦æ±‚1: æœŸæ•¸æª¢æŸ¥
			const periodInput = document.getElementById('period');
			if (period <= 12) {
				periodInput.classList.add('warning-text');
			} else {
				periodInput.classList.remove('warning-text');
			}

			// è¨ˆç®—ç¸½åˆ©æ¯
			const totalInterest = (payment * period) - principal;
			// è¦æ±‚2: ç¸½åˆ©æ¯æ ¼å¼åŒ–åˆ°å°æ•¸é»ç¬¬3ä½
			document.getElementById('totalInterest').value = totalInterest.toFixed(2);

			// è¨ˆç®—ç¨…é‡‘
			const tax = totalInterest / 21;
			document.getElementById('tax').value = tax.toFixed(2);

			// è¨ˆç®—ç¨…å¾Œåˆ©ç‡
			const afterTaxRate = RATE(period, payment, principal + tax);
			// è¦æ±‚3: ç¨…å¾Œåˆ©ç‡æ ¼å¼åŒ–å’Œè­¦å‘Š
			const afterTaxRateInput = document.getElementById('afterTaxRate');
			afterTaxRateInput.value = afterTaxRate.toFixed(4);
			if (afterTaxRate <= 2.5) {
				afterTaxRateInput.classList.add('warning-text');
			} else {
				afterTaxRateInput.classList.remove('warning-text');
			}

			 // è¦æ±‚2: ä½£é‡‘æ ¼å¼åŒ–ç‚ºæ•´æ•¸
			const commission = parseFloat(document.getElementById('commission').value) || 0;
			document.getElementById('commission').value = Math.round(commission);
			
			 // æª¢æŸ¥ä½£é‡‘æ˜¯å¦è¶…éç¸½åˆ©æ¯çš„95%
            const commissionInput = document.getElementById('commission');
            if (commission >= totalInterest * 0.95) {
                commissionInput.classList.add('warning-text');
            } else {
                commissionInput.classList.remove('warning-text');
            }

			// è¨ˆç®—ç¨…ä½£å¾Œåˆ©ç‡
			const afterCommissionRate = RATE(period, payment, principal + tax + commission);
			// è¦æ±‚5: ç¨…ä½£å¾Œåˆ©ç‡æ ¼å¼åŒ–å’Œè­¦å‘Š
			const afterCommissionRateInput = document.getElementById('afterCommissionRate');
			afterCommissionRateInput.value = afterCommissionRate.toFixed(4);
			if (afterCommissionRate <= 2.5) {
				afterCommissionRateInput.classList.add('warning-text');
			} else {
				afterCommissionRateInput.classList.remove('warning-text');
			}

			// è¨ˆç®—ç™¾è¬åˆ©æ¯
			const millionPayment = PMT(rate, 12, 1000000);
			const annualMillionInterest = (millionPayment * 12) - 1000000;
			 // è¦æ±‚3: ç™¾è¬æ¯å¹´åˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸
			document.getElementById('annualMillionInterest').value = Math.round(annualMillionInterest);
			// è¦æ±‚4: ç™¾è¬æ¯æœˆåˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸
			document.getElementById('monthlyMillionInterest').value = Math.round(annualMillionInterest / 12);


			// è¨ˆç®—ä¸€è¬åˆ©æ¯
			const tenThousandPayment = PMT(rate, 12, 10000);
			const annualTenThousandInterest = (tenThousandPayment * 12) - 10000;
			// è¦æ±‚5: ä¸€è¬æ¯å¹´åˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸
			document.getElementById('annualTenThousandInterest').value = Math.round(annualTenThousandInterest);
			// è¦æ±‚6: ä¸€è¬æ¯æœˆåˆ©æ¯æ ¼å¼åŒ–ç‚ºæ•´æ•¸
			document.getElementById('monthlyTenThousandInterest').value = Math.round(annualTenThousandInterest / 12);


			// è¨ˆç®— Spread
			const spread = afterCommissionRate - monthlyCost;
			// è¦æ±‚10: Spread è­¦å‘Š
			const spreadInput = document.getElementById('spread');
			spreadInput.value = spread.toFixed(4);
			if (spread <= 0) {
				spreadInput.classList.add('warning-text');
			} else {
				spreadInput.classList.remove('warning-text');
			}
			
            // åœ¨è¨ˆç®— spread ä¹‹å¾Œæ·»åŠ æ–°çš„è¨ˆç®—é‚è¼¯
            // ä½¿ç”¨æœ¬æœˆè³‡é‡‘æˆæœ¬åˆ©ç‡è¨ˆç®—å›æ¨è²¸æ¬¾é‡‘é¡
            const monthlyRate = monthlyCost / 100 / 12; // å°‡å¹´åˆ©ç‡è½‰æ›ç‚ºæœˆåˆ©ç‡
            const fundingPrincipal = payment * (1 - Math.pow(1 + monthlyRate, -period)) / monthlyRate;
            
            // è¨ˆç®—è³‡é‡‘æˆæœ¬å·®é¡
            const fundingCostDiff = Math.round(fundingPrincipal - principal);
            
            // æ›´æ–°è³‡é‡‘æˆæœ¬æ¬„ä½
            document.getElementById('fundingCost').value = fundingCostDiff;
            
            // å¦‚æœè³‡é‡‘æˆæœ¬ç‚ºè² å€¼ï¼Œæ·»åŠ è­¦å‘Šæ¨£å¼
            const fundingCostInput = document.getElementById('fundingCost');
            if (fundingCostDiff < 0) {
                fundingCostInput.classList.add('warning-text');
            } else {
                fundingCostInput.classList.remove('warning-text');
            }
			

			// è¨ˆç®—é›è‚‰é£¯ç¢—æ•¸
			document.getElementById('chickenRice').value = Math.floor(totalInterest / 35);
		}

        function clearField(fieldId) {
			vibrate();
            document.getElementById(fieldId).value = '';
        }
	
		function clearCommission() {
			vibrate();
        	document.getElementById('commission').value = '';
        	updateAllFields(); // æ›´æ–°æ‰€æœ‰æ¬„ä½
    	}
	
		function adjustCommissionPercentage(delta) {
			vibrate();
			const commissionField = document.getElementById('commission');
			const currentValue = parseFloat(commissionField.value) || 0;
			let newValue;

			if (delta > 0) {
				// ç•¶æŒ‰ä¸‹ +10 æ™‚ï¼Œä¹˜ä»¥ 1.1
				newValue = currentValue * 1.1;
			} else {
				// ç•¶æŒ‰ä¸‹ -10 æ™‚ï¼Œä¹˜ä»¥ 0.9
				newValue = currentValue * 0.9;
			}

			// é€²ä½è‡³ç™¾ä½æ•¸
			newValue = Math.ceil(newValue / 100) * 100;

			// æ›´æ–°ä½£é‡‘æ¬„ä½çš„å€¼ï¼Œä¿ç•™å…©ä½å°æ•¸
			commissionField.value = newValue.toFixed(2);

			updateAllFields(); // æ›´æ–°æ‰€æœ‰æ¬„ä½
		}

        function adjustPeriod(delta) {
			vibrate();
            const periodField = document.getElementById('period');
            const currentValue = parseFloat(periodField.value) || 0;
            periodField.value = currentValue + delta;
            calculatePayment();
        }

        function setPeriod(value) {
			vibrate();
            document.getElementById('period').value = value;
            calculatePayment();
        }

        function adjustRate(delta) {
			vibrate();
            const rateField = document.getElementById('rate');
            const currentValue = parseFloat(rateField.value) || 0;
            rateField.value = (currentValue + delta).toFixed(4);
            calculatePayment();
        }

        function setRate(value) {
			vibrate();
            document.getElementById('rate').value = value;
            calculatePayment();
        }

        function adjustPrincipal(delta) {
			vibrate();
            const principalField = document.getElementById('principal');
            const currentValue = parseFloat(principalField.value) || 0;
            principalField.value = currentValue + delta;
            calculatePayment();
        }

        function setCommissionPercentage(percentage) {
			vibrate();
            const principal = parseFloat(document.getElementById('principal').value);
            document.getElementById('commission').value = (principal * percentage / 100).toFixed(2);
            updateAllFields(); // æ›´æ–°æ‰€æœ‰æ¬„ä½
        }

        function calculateAfterCommissionRate() {
			const period = parseFloat(document.getElementById('period').value);
			const payment = parseFloat(document.getElementById('payment').value);
			const principal = parseFloat(document.getElementById('principal').value);
			const tax = parseFloat(document.getElementById('tax').value);
			const commission = parseFloat(document.getElementById('commission').value) || 0;

			updateAllFields(); // æ›´æ–°æ‰€æœ‰æ¬„ä½
		}
	 	function roundPayment(direction, base) {
		 	vibrate();
            const paymentField = document.getElementById('payment');
            let value = parseFloat(paymentField.value) || 0;
            
            if (direction === 'down') {
                value = Math.floor(value / base) * base;
            } else {
                value = Math.ceil(value / base) * base;
            }
            
            paymentField.value = value.toFixed(2);
            calculateRate(); // Recalculate the rate
        }
		function adjustPayment(delta) {
			vibrate();
			const paymentField = document.getElementById('payment');
			const currentValue = parseFloat(paymentField.value) || 0;
			paymentField.value = (currentValue + delta).toFixed(2);
			calculateRate(); // é‡æ–°è¨ˆç®—åˆ©ç‡
			}
		function saveData() {
			const dataToSave = {
			period: document.getElementById('period').value,
			rate: document.getElementById('rate').value,
			principal: document.getElementById('principal').value,
			payment: document.getElementById('payment').value,
			commission: document.getElementById('commission').value
			};
			localStorage.setItem('loanCalculatorData', JSON.stringify(dataToSave));
			alert('è³‡æ–™å·²æš«å­˜ï¼');
		}

		function generateQuote() {
			vibrate();
			console.log('é–‹å§‹ç”Ÿæˆå ±åƒ¹...'); // æ–°å¢åµéŒ¯è¨Šæ¯

			// å‰µå»ºå ±åƒ¹è¡¨æ ¼
			const table = document.createElement('table');
			table.className = 'quote-table';

			// æ·»åŠ è¡¨æ ¼å…§å®¹
			const rows = [
			['å ±åƒ¹æ™‚é–“', `${document.getElementById('currentTime').textContent.split('æ˜ŸæœŸ')[0]}<br>æ˜ŸæœŸ${document.getElementById('currentTime').textContent.split('æ˜ŸæœŸ')[1]}`],
			['æœŸæ•¸', document.getElementById('period').value || ''],
			['ç¨…å‰åˆ©ç‡', (document.getElementById('rate').value || '') + '%'],
			['æœ¬é‡‘', document.getElementById('principal').value || ''],
			['æœŸç¹³', document.getElementById('payment').value || ''],
			['ç¨…å¾Œåˆ©ç‡', (document.getElementById('afterTaxRate').value || '') + '%'],
			['ä½£é‡‘', document.getElementById('commission').value || ''],
			['ç¨…ä½£å¾Œåˆ©ç‡', (document.getElementById('afterCommissionRate').value || '') + '%'],
			['é›è‚‰é£¯', document.getElementById('chickenRice').value + ' ç¢—']
			];

			// å»ºç«‹è¡¨æ ¼å…§å®¹
			rows.forEach(([label, value]) => {
			const tr = table.insertRow();
			const labelCell = tr.insertCell();
			const valueCell = tr.insertCell();
			labelCell.textContent = label;
			valueCell.innerHTML = value; // æ”¹ç”¨ innerHTML ä¾†æ”¯æ´æ›è¡Œæ¨™ç±¤
			});

			// å‰µå»ºè‡¨æ™‚å®¹å™¨
			const container = document.createElement('div');
				container.style.padding = '24px';
				container.style.background = '#333333';
				container.style.borderRadius = '12px';
				container.appendChild(table);
				document.body.appendChild(container);

				console.log('æº–å‚™é€²è¡Œæˆªåœ–...'); // æ–°å¢åµéŒ¯è¨Šæ¯

			// ä½¿ç”¨ html2canvas è½‰æ›ç‚ºåœ–ç‰‡
			html2canvas(container).then(canvas => {
				console.log('Canvas å·²ç”Ÿæˆ'); // æ–°å¢åµéŒ¯è¨Šæ¯

				// ç§»é™¤è‡¨æ™‚å®¹å™¨
				document.body.removeChild(container);

				// ä¸‹è¼‰åœ–ç‰‡
				const link = document.createElement('a');
				link.download = `å ±åƒ¹_${document.getElementById('currentTime').textContent.replace(/[^0-9]/g, '')}.png`;
				link.href = canvas.toDataURL();
				console.log('æº–å‚™ä¸‹è¼‰...'); // æ–°å¢åµéŒ¯è¨Šæ¯
				link.click();
			}).catch(error => {
				console.error('æˆªåœ–éç¨‹ç™¼ç”ŸéŒ¯èª¤:', error); // æ–°å¢éŒ¯èª¤è™•ç†
				document.body.removeChild(container); // ç¢ºä¿æ¸…ç†è‡¨æ™‚å®¹å™¨
			});
}
    </script>
	<!-- åœ¨ </body> æ¨™ç±¤å‰æ·»åŠ  -->
	<div class="footer-message">å ±åƒ¹å¾Œè¨˜å¾—åƒç¢—ç«é›è‚‰é£¯å”·ï¼</div>
	<div class="footer-spacing"></div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
	
	<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('loaded');
    });
</script>
</body>
</html>
